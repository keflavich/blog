<!DOCTYPE html>
<html lang="en">
<head>
        <title>LaTeX: VIM + Skim</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
                <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Adam Ginsburg's blog Atom Feed" />
                
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
                <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="./">Adam Ginsburg's blog </a></h1>
                <nav><ul>
                                                                                                    <li class="active"><a href="./category/blog.html">blog</a></li>
                                </ul></nav>
        </header><!-- /#banner -->
        <section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="./latex-vim-skim.html" rel="bookmark"
           title="Permalink to LaTeX: VIM + Skim">LaTeX: VIM + Skim</a></h1>
          </header>

    <div class="entry-content">
      <footer class="post-info">
        <abbr class="published" title="2012-09-20T20:02:00">
                Thu 20 September 2012
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="./author/adam-keflavichgmailcom.html">Adam (keflavich@gmail.com)</a>
        </address>
        <p>In <a href="./category/blog.html">blog</a>. </p>
<p>tags: <a href="./tag/httpschemasgooglecomblogger2008kindpost.html">http://schemas.google.com/blogger/2008/kind#post</a><a href="./tag/latex.html">latex</a><a href="./tag/vim.html">vim</a><a href="./tag/code.html">code</a></p>
</footer><!-- /.post-info -->      <p><p><a class="reference external" href="http://agpy.googlecode.com/svn/trunk/macvim-skim/macvim-skim-install.sh">macvim-skim-install.sh</a> is my install script for using MacVim.app with
Skim.app.
The <a class="reference external" href="http://code.google.com/p/agpy/wiki/macvimskim">agpy wiki page</a> has instructions that are probably more clear; I
don't really like the colorscheme / layout of this blog.
You can use <a class="reference external" href="http://mactex-wiki.tug.org/wiki/index.php/SyncTeX">synctex</a> to make an editor and viewer work together, but
it is far from easy and far harder than it should be. Forward-search is
pretty easy, but the latex-suite <tt class="docutils literal">\ls</tt> only works intermittently and
is not easily customizable.
I had to do the following:
For VIM-&gt;Skim.app (Skim.app is necessary for any of this to work), add
these commands to .vimrc:</p>
<pre class="literal-block">
&quot; Activate skimmap ,v :w&lt;CR&gt;:silent !/Applications/Skim.app/Contents/SharedSupport/displayline -r &lt;C-r&gt;=line('.')&lt;CR&gt; %&lt;.pdf %&lt;CR&gt;&lt;CR&gt;map ,p :w&lt;CR&gt;:silent !pdflatex -synctex=1 --interaction=nonstopmode %:p &lt;CR&gt;:silent !/Applications/Skim.app/Contents/SharedSupport/displayline -r &lt;C-r&gt;=line('.')&lt;CR&gt; %&lt;.pdf %&lt;CR&gt;&lt;CR&gt;map ,m :w&lt;CR&gt;:silent !make &lt;CR&gt;:silent !/Applications/Skim.app/Contents/SharedSupport/displayline -r &lt;C-r&gt;=line('.')&lt;CR&gt; %&lt;.pdf %&lt;CR&gt;&lt;CR&gt;&quot; Reactivate VIMmap ,r :w&lt;CR&gt;:silent !/Applications/Skim.app/Contents/SharedSupport/displayline -r &lt;C-r&gt;=line('.')&lt;CR&gt; %&lt;.pdf %&lt;CR&gt;:silent !osascript -e &quot;tell application \&quot;MacVim\&quot; to activate&quot; &lt;CR&gt;&lt;CR&gt;map ,t :w&lt;CR&gt;:silent !pdflatex -synctex=1 --interaction=nonstopmode %:p &lt;CR&gt;:silent !/Applications/Skim.app/Contents/SharedSupport/displayline -r &lt;C-r&gt;=line('.')&lt;CR&gt; %&lt;.pdf %&lt;CR&gt;:silent !osascript -e &quot;tell application \&quot;MacVim\&quot; to activate&quot; &lt;CR&gt;&lt;CR&gt;
</pre>
<p>The <tt class="docutils literal">,m</tt> command will reload the file and put your cursor where the
text is. <tt class="docutils literal">,t</tt> will return VIM to the front afterwards.
Going the other way (reverse-search / inverse-search) was MUCH more
challenging. The code that does this is <a class="reference external" href="http://code.google.com/p/agpy/source/browse/trunk/macvim-skim/macvim-load-line">on agpy</a>. Reproduced here for
posterity (I hope to update the agpy version to <a class="reference external" href="http://stackoverflow.com/questions/8839846/vim-check-if-a-file-is-open-in-current-tab-window">deal with tabs</a>). [A
few hours later, I HAVE replaced the code. Below are the old applescript
version, then the new, vim-based version
<tt class="docutils literal"><span class="pre">#!/bin/bashfile=&quot;$1&quot;line=&quot;$2&quot;[</span> <span class="pre">&quot;${file:0:1}&quot;</span> == &quot;/&quot; ] || <span class="pre">file=&quot;${PWD}/$file&quot;#</span> Use Applescript to activate VIM, find file, and load it# the 'delay' command is needed to prevent command/control/shift from sticking when this# is activated (e.g., from Skim, where the command is <span class="pre">command-shift-click)##</span> key code 53 is &quot;escape&quot; to escape to command mode in VIMexec osascript <span class="pre">\-e</span> &quot;delay 0.2&quot; <span class="pre">\-e</span> &quot;tell application \&quot;MacVim\&quot; to activate&quot; <span class="pre">\-e</span> &quot;tell application \&quot;System <span class="pre">Events\&quot;&quot;</span> <span class="pre">\-e</span> &quot;&nbsp; tell process <span class="pre">\&quot;MacVim\&quot;&quot;</span> <span class="pre">\-e</span> &quot;&nbsp;&nbsp;&nbsp; key code 53 <span class="pre">&quot;\-e</span> &quot;&nbsp;&nbsp;&nbsp; keystroke <span class="pre">\&quot;:set</span> hidden\&quot; &amp; return &quot; <span class="pre">\-e</span> &quot;&nbsp;&nbsp;&nbsp; keystroke <span class="pre">\&quot;:if</span> <span class="pre">bufexists(bufname('$file'))\&quot;</span> &amp; return &quot; <span class="pre">\-e</span> &quot;&nbsp;&nbsp;&nbsp; keystroke <span class="pre">\&quot;:exe</span> <span class="pre">\\\&quot;:buffer</span> <span class="pre">\\\&quot;</span> . <span class="pre">bufnr(bufname('$file'))\&quot;</span>&nbsp; &amp; return &quot; <span class="pre">\-e</span> &quot;&nbsp;&nbsp;&nbsp; keystroke <span class="pre">\&quot;:else</span> \&quot; &amp; return &quot; <span class="pre">\-e</span> &quot;&nbsp;&nbsp;&nbsp; keystroke <span class="pre">\&quot;:echo</span> <span class="pre">\\\&quot;Could</span> not load <span class="pre">file\\\&quot;</span> \&quot; &amp; return &quot; <span class="pre">\-e</span> &quot;&nbsp;&nbsp;&nbsp; keystroke <span class="pre">\&quot;:endif\&quot;</span> &amp; return &quot; <span class="pre">\-e</span> &quot;&nbsp;&nbsp;&nbsp; keystroke <span class="pre">\&quot;:$line\&quot;</span> &amp; return &quot; <span class="pre">\-e</span> &quot;&nbsp; end tell&quot; <span class="pre">\-e</span> &quot;end tell&quot;</tt>
New code: <a href="#id2"><span class="problematic" id="id3">`download link`_</span></a></p>
<pre class="literal-block">
#!/bin/bash# Install directions:# Put this file somewhere in your path and make it executable# To set up in Skim, go to Preferences:Sync# Change Preset: to Custom# Change Command: to macvim-load-line# Change Arguments: to &quot;%file&quot; %linefile=&quot;$1&quot;line=&quot;$2&quot;debug=&quot;$3&quot;echo file: $fileecho line: $lineecho debug: $debugfor server in `mvim --serverlist` do    foundfile=`mvim --servername $server --remote-expr &quot;WhichTab('$file')&quot;`    if [[ $foundfile &gt; 0 ]]    then        mvim --servername $server --remote-expr &quot;foreground()&quot;         if [[ $debug ]] ; then echo mvim --servername $server --remote-send &quot;:exec \&quot;tabnext $foundfile\&quot; &quot;; fi        mvim --servername $server --remote-send &quot;:exec \&quot;tabnext $foundfile\&quot; &quot;        if [[ $debug ]] ; then echo mvim --servername $server --remote-send &quot;:$line &quot;; fi        mvim --servername $server --remote-send &quot;:$line &quot;    fidone
</pre>
<p>Save that as an executable in your default path (e.g.,
<tt class="docutils literal"><span class="pre">/usr/local/bin/macvim-load-line</span></tt>) and open Skim.app, go to
Preferences:Sync and make the command look like this:</p>
<div class="separator" style="clear: both; text-align: center;"><p><a href="#id4"><span class="problematic" id="id5">`|image0|`_</span></a></p>
</div><p>You need to have mvim on your path. mvim comes with MacVim.app, but is
NOT installed by default. Install it by doing something like:
`` cp /Users/adam/Downloads/MacVim-7_3-53/mvim /usr/local/bin/mvim ``
You'll also need to install WhichTab.vim in your <tt class="docutils literal"><span class="pre">~/.vim/plugins/</span></tt>
directory. It's available <a class="reference external" href="http://code.google.com/p/agpy/source/browse/trunk/macvim-skim/WhichTab.vim">here</a> (<a href="#id6"><span class="problematic" id="id7">`download link`_</span></a>). Here's the source:</p>
<pre class="literal-block">
function! WhichTab(filename)    &quot; Try to determine whether file is open in any tab.      &quot; Return number of tab it's open in    let buffername = bufname(a:filename)    if buffername == &quot;&quot;        return 0    endif    let buffernumber = bufnr(buffername)    &quot; tabdo will loop through pages and leave you on the last one;    &quot; this is to make sure we don't leave the current page    let currenttab = tabpagenr()    let tab_arr = []    tabdo let tab_arr += tabpagebuflist()    &quot; return to current page    exec &quot;tabnext &quot;.currenttab    &quot; Start checking tab numbers for matches    let i = 0    for tnum in tab_arr        let i += 1        echo &quot;tnum: &quot;.tnum.&quot; buff: &quot;.buffernumber.&quot; i: &quot;.i        if tnum == buffernumber            return i        endif    endforendfunctionfunction! WhichWindow(filename)    &quot; Try to determine whether the file is open in any GVIM *window*    let serverlist = split(serverlist(),&quot;\n&quot;)    &quot;let currentserver = ????    for server in serverlist        let remotetabnum = remote_expr(server,             \&quot;WhichTab('&quot;.a:filename.&quot;')&quot;)        if remotetabnum != 0            return server        endif    endforendfunction
</pre>
</p><div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">/Users/adam/repos/pelican.keflavich.github.com/content/blog/latex-vim-skim.rst</tt>, line 77); <em><a href="#id1">backlink</a></em></p>
Duplicate explicit target name: &quot;download link&quot;.</div>
<div class="system-messages section">
<h2>Docutils System Messages</h2>
<div class="system-message" id="id2">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">/Users/adam/repos/pelican.keflavich.github.com/content/blog/latex-vim-skim.rst</tt>, line 27); <em><a href="#id3">backlink</a></em></p>
Duplicate target name, cannot be used as a unique reference: &quot;download link&quot;.</div>
<div class="system-message" id="id4">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">/Users/adam/repos/pelican.keflavich.github.com/content/blog/latex-vim-skim.rst</tt>, line 49); <em><a href="#id5">backlink</a></em></p>
Unknown target name: &quot;|image0|&quot;.</div>
<div class="system-message" id="id6">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">/Users/adam/repos/pelican.keflavich.github.com/content/blog/latex-vim-skim.rst</tt>, line 55); <em><a href="#id7">backlink</a></em></p>
Duplicate target name, cannot be used as a unique reference: &quot;download link&quot;.</div>
</div>

    </div><!-- /.entry-content -->
    
  </article>
</section>
        <section id="extras" class="body">
                        <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                                                    <li><a href="http://docs.notmyidea.org/alexis/pelican/">Pelican</a></li>
                                                    <li><a href="http://python.org">Python.org</a></li>
                                                    <li><a href="http://jinja.pocoo.org">Jinja2</a></li>
                                                    <li><a href="#">You can modify those links in your config file</a></li>
                                                </ul>
                </div><!-- /.blogroll -->
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="#">You can add links in your config file</a></li>
                                                    <li><a href="#">Another social link</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>