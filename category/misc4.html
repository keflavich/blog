<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" type="text/css" href="https://keflavich.github.io/blog/theme/css/style.css" />
<link rel="icon" type="image/gif" href="https://keflavich.github.io/blog/theme/favicon8.ico">
<head>
    <base href="https://keflavich.github.io/blog">
        <title>Adam Ginsburg's blog</title>
        <meta charset="utf-8" />
        <link href="https://keflavich.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Adam Ginsburg's blog Full Atom Feed" />
        <link href="https://keflavich.github.io/blog/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Adam Ginsburg's blog Categories Atom Feed" />
<!-- Using MathJax, with the delimiters $ -->
<!-- Conflict with pygments for the .mo and .mi -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
    styles: {
    ".MathJax .mo, .MathJax .mi": {color: "inherit !important"}},
    'div.typeset': { 'text-align': 'left'}
    },
    tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']],processEscapes: true}
    });
    TeX: {
        extensions: ["AMSmath.js", "AMSsymbols.js"]
    }
    MathJax.Hub.Register.StartupHook("HTML-CSS Jax Ready",function () {
    var VARIANT = MathJax.OutputJax["HTML-CSS"].FONTDATA.VARIANT;
    VARIANT["normal"].fonts.unshift("MathJax_SansSerif");
    VARIANT["bold"].fonts.unshift("MathJax_SansSerif-bold");
    VARIANT["italic"].fonts.unshift("MathJax_SansSerif-italic");
    VARIANT["-tex-mathit"].fonts.unshift("MathJax_SansSerif-italic");
    });
    MathJax.Hub.Register.StartupHook("SVG Jax Ready",function () {
    var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;
    VARIANT["normal"].fonts.unshift("MathJax_SansSerif");
    VARIANT["bold"].fonts.unshift("MathJax_SansSerif-bold");
    VARIANT["italic"].fonts.unshift("MathJax_SansSerif-italic");
    VARIANT["-tex-mathit"].fonts.unshift("MathJax_SansSerif-italic");
    });
</script>

<script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>
        
</head>

<body id="base" class="home">


    <header id="banner" class="body" >
        <div id="header" style='background-image: url("https://keflavich.github.io/blog/images/GC_4096sq_bolo.png"); background-position:left; min-heigt: 200px;  background-repeat: no-repeat; max-width: 80%;'>
            <h1 style="color: #C4C4C4;"><a class="header" href="https://keflavich.github.io/blog">Adam Ginsburg's blog <strong></strong></a></h1>

            <nav id="menu"><ul id="menulist">
                <li><a href="https://www.adamgginsburg.com">Homepage</a></li>
                <li><a href="/index.html">Blog Index</a></li>
                <li><a href="/category/bgps.html">BGPS Blog</a></li>
                <li><a href="/category/publications.html">Publications</a></li>
                <li><a href="/archives.html">Archives</a></li>
                <li><a href="/tags.html">Tags</a></li>
            </ul></nav><!-- /#menu -->
        </div>
    </header><!-- /#banner -->

  <div id="sidebar">
    <ul>
      <li>
        <h3 id='recent_header'>Recent Posts</h3>
        <ul>
              <li class="post">
                  2025/03/15
                  <br>
                  <a href="https://keflavich.github.io/blog/pushing-to-a-pull-request.html">Pushing to a pull request</a>
              </li>
              <li class="post">
                  2023/08/11
                  <br>
                  <a href="https://keflavich.github.io/blog/editing-metadata-in-measurement-sets.html">Editing metadata in measurement sets</a>
              </li>
              <li class="post">
                  2022/05/06
                  <br>
                  <a href="https://keflavich.github.io/blog/casa-mpi-debugging-contd.html">CASA MPI debugging cont'd</a>
              </li>
              <li class="post">
                  2022/05/01
                  <br>
                  <a href="https://keflavich.github.io/blog/co2-monitoring-at-conferences-update-in-2022.html">CO2 Monitoring at Conferences: Update in 2022</a>
              </li>
              <li class="post">
                  2022/04/14
                  <br>
                  <a href="https://keflavich.github.io/blog/alma-cycle-9-corrupted-zip-fix.html">ALMA Cycle 9 corrupted zip fix</a>
              </li>
        </ul>
      </li>
    
    </ul>
  </div><!-- end #sidebar -->

  <div id="content">
<section id="content">
<h2>Articles in the misc category</h2>

<ul id="post-list">
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/high-mass-protostellar-sio-masers.html" rel="bookmark" title="Permalink to High-mass Protostellar SiO Masers">
                    High-mass Protostellar SiO Masers</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2017-01-30T12:26:00-07:00"> 2017/01/30 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-ginsburg-adamgginsburggmailcom.html">Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>In working on a high-mass star formation proposal, I reviewed the discovery
of SiO vibrationally-excited masers toward high-mass star-forming regions.</p>
<p>Known sources include (with discovery articles listed):</p>
<blockquote>
<ul class="simple">
<li>Sgr B2 M (<a class="reference external" href="http://adsabs.harvard.edu/abs/1986mmmo.conf..275H">Hasegawa</a>)</li>
<li>Sgr B2 N (<a class="reference external" href="http://esoads.eso.org/abs/2015ApJ...815..106H">Higuchi</a>)</li>
<li>W51N (<a class="reference external" href="http://adsabs.harvard.edu/abs/1986mmmo.conf..275H">Hasegawa</a>)</li>
<li>Orion BN/KL (<a class="reference external" href="http://adsabs.harvard.edu/abs/1974ApJ...189L..31S">Snyder</a>, first mm maser)</li>
<li>G19.61-0.23 (<a class="reference external" href="http://esoads.eso.org/abs/2016ApJ...826..157C">Cho</a>)</li>
<li>G75.78+0.34 (<a class="reference external" href="http://esoads.eso.org/abs/2016ApJ...826..157C">Cho</a>)</li>
<li>G0.38+0.04 &quot;Cloud C&quot; (<a class="reference external" href="http://esoads.eso.org/abs/2015A%26A...584L...7G">Ginsburg</a>)</li>
<li>IRAS 19312+1950 (<a class="reference external" href="http://esoads.eso.org/abs/2016ApJ...828...51C">Cordiner</a>)</li>
<li>DR 21(OH) (<a class="reference external" href="http://adsabs.harvard.edu/abs/2010ARep...54..295K">Kalenskii, tentative</a>)</li>
</ul>
</blockquote>
<p>If you know of any I missed, or have a better collection of these masers, let
me know.</p>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/casa-synthetic-observations.html" rel="bookmark" title="Permalink to CASA synthetic observations">
                    CASA synthetic observations</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2016-08-15T09:36:00-06:00"> 2016/08/15 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-ginsburg-adamgginsburggmailcom.html">Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>To evaluate imaging robustness &amp; quality, it is necessary to do some sort of
synthetic observation.  These synthetic observations can be done on real
images, e.g. Herschel data shifted to greater distances, or on simulated data.</p>
<p>Some examples:</p>
<blockquote>
<ul class="simple">
<li><a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_perseus.py">https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_perseus.py</a></li>
<li><a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_perseus_2.py">https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_perseus_2.py</a></li>
<li><a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_aquila.py">https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_aquila.py</a></li>
</ul>
</blockquote>
<p>General process:</p>
<blockquote>
<ol class="arabic simple">
<li>Import file into CASA .image form (e.g., <tt class="docutils literal">importfits</tt>)</li>
<li>Load the .ms file and replace visibilities w/fourier transform of image</li>
<li>Clean.</li>
</ol>
</blockquote>
<p>The hard part is setting up the files to be imported.</p>
<p>For example, you can import a FITS file, which to me seems to be the most
straightforward approach:</p>
<pre class="literal-block">
importfits(fitsimage=perseus_rescaled,
           imagename=perseus_casa_image,
           overwrite=True,
           defaultaxes=True,#['RA---TAN','DEC--TAN','FREQUENCY','STOKES'],
           defaultaxesvalues=['2.909234541667E+02deg',
                              '1.451177222222E+01deg',
                              '233.9468GHz','I'],
           # 18&quot; = 1.22 lambda/D
           beam=[&quot;{0}deg&quot;.format(18/3600.*distance_scaling),
                 &quot;{0}deg&quot;.format(18/3600.*distance_scaling),
                 &quot;0deg&quot;],
          )
</pre>
<p>The beam probably matters for Jy-&gt;K, or Jy/beam-&gt;Jy conversion.  The
<tt class="docutils literal">defaultaxesvalues</tt> should correspond to the pointing center of the
interferometer pointing or mosaic.</p>
<p>Next is bringing this image - which we now pray is in the correct units - into UV space.:</p>
<pre class="literal-block">
sm.openfromms(&quot;continuum_7m12m_noflag.ms&quot;)
sm.setvp()
success = sm.predict(perseus_casa_image)
assert success
# TODO: get these from ASDM_CALWVR and WEATHER
success2 = sm.setnoise(mode='tsys-atm', relhum=60.0, pwv='2mm', tatmos=265.0, )
success3 = sm.corrupt()
sm.done()
sm.close()
</pre>
<p>This snippet loads the .ms file (the visibilities), then overwrites them with
the fourier transform of the image using <tt class="docutils literal">sm.predict</tt>.  It's not clear whether
<tt class="docutils literal">setvp</tt> is necessary.  <tt class="docutils literal">setnoise</tt> + <tt class="docutils literal">corrupt</tt> just adds &quot;appropriate&quot;
atmospheric noise to the visibilities.</p>
<p>From there, you should just use the same <tt class="docutils literal">clean</tt> parameters as for the
original data, or try to optimize <tt class="docutils literal">clean</tt> here and use these parameters on
the real data.</p>
<p>The result will be the 'perfect' (no phase error, no amplitude error)
interferometric image.</p>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/casa-clean-splotchy-artifacts.html" rel="bookmark" title="Permalink to CASA clean: "splotchy" artifacts">
                    CASA clean: &quot;splotchy&quot; artifacts</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2016-06-14T09:31:00-06:00"> 2016/06/14 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-ginsburg-adamgginsburggmailcom.html">Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>This image shows artifacts that look &quot;splotchy&quot;.  They are locations clean has
placed a negative model component where none belongs, so the residual is highly
positive and the resulting image is negative.</p>
<img alt="" src="https://keflavich.github.io/blog/images/casa/splotchy.png" style="width: 600px;" />
<p>Discussing with others, it appears that this artifact may be unique to
multiscale clean and therefore may be a result of a too-strong component being
added on a large scale.  It is not yet clear how to suppress these artifacts,
but I'm attempting to change the scales included.  Other ideas would be welcome
in the comments.</p>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/single-dish-combination-continued.html" rel="bookmark" title="Permalink to Single Dish Combination Continued">
                    Single Dish Combination Continued</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2016-06-02T16:59:00-06:00"> 2016/06/02 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-ginsburg-adamgginsburggmailcom.html">Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>Continuing from yesterday, I've done some more analysis of my HC3N data on
different scales.  The first critical note is that there appears to be
disagreement between the 7m and 12m data.
In principle, smoothing the 12m data to the 7m resolution should at most
recover the 7m brightness; instead it seems that the 12m data significantly
overpredict the 7m brightness.</p>
<img alt="" src="https://keflavich.github.io/blog/images/sgrb2/array_imagecomparison.png" style="width: 600px;" />
<p>This discrepancy is also evident in the power spectra, where there appears to be missing flux
on 20-100 arcsecond scales.</p>
<img alt="" src="https://keflavich.github.io/blog/images/sgrb2/array_pspeccomparison.png" style="width: 600px;" />
<p>So maybe it's just that the 7m data are bad?</p>
<p>I discussed the image combination process with Baobab, and he suggested that it
may not be the flux calibration of the images (their absolute scaling) but the
relative weights used to combine them.  The default weights, and pretty much
all variants I had experimented with, use the single-dish beam as the starting
point: you weight the interferometer data by (1-SDbeam) in the fourier domain.</p>
<p>It turns out that, while this weighting scheme is the obvious thing to do
because the single-dish beam is well-characterized, it may not be the best.
The interferometer data may lose sensitivity on larger scales much faster than
(1-SDbeam) would suggest.</p>
<p>Carrying the single-dish weight down to smaller angular scales does a better
job of ensuring there are no negatives, but is it really &quot;right&quot;?
Unfortunately, there's no good answer to this; the process is essentially the
same as modifying the Briggs parameter when weighting intereferometric clean
data.  You just have to choose a scale, or a weighting function, and go with
it.  As long as the weights are conservative (i.e., sum to 1), the resulting
image should in some sense be correct.</p>
<img alt="" src="https://keflavich.github.io/blog/images/sgrb2/combination_weighting_scales.png" style="width: 600px;" />
<p>In that figure, the weighting scheme for the large angular scale data was set
to a series of different Gaussians.  The resolution of the 7m+TP data is
(theoretically) 24x11 arcseconds, but preserving the large angular scales below
the major beam axis seems to do a better job of preserving the image's
positivity.</p>
<p>The effect is more pronounced if we just combine the 12m+TP data, ignoring the
7m data (which might be wrong anyway).  For weighting FWHM above 30 arcseconds,
the interferometric data dominates the map.</p>
<img alt="" src="https://keflavich.github.io/blog/images/sgrb2/combination_weighting_scales_no7m.png" style="width: 600px;" />
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/single-dish-interferometer-combination-experiments.html" rel="bookmark" title="Permalink to Single Dish - Interferometer Combination Experiments">
                    Single Dish - Interferometer Combination Experiments</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2016-06-01T11:17:00-06:00"> 2016/06/01 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-ginsburg-adamgginsburggmailcom.html">Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>I spent 3 days in Köln with Alvaro Sanchez-Mongé, Peter Schilke, Fanyi Meng,
and Anika Schmiedeke working on Sgr B2 data and specifically on trying to
combine the single dish (total power) data with my merged ACA+12m data from
ALMA program 2013.1.00269.S.</p>
<p>tl;dr: feathering appears to work fine, and many other methods work equally
well (assuming they can be implemented, which is uniformly harder).  Negative
bowls persisting after feathering are an indication of a problem with the input
data.</p>
<div class="section" id="feathering">
<h2>Feathering</h2>
<p>Fourier space combination of the single-dish and interferometric data is by
far the most straightforward to implement and the fastest.  However, in the HC3N
data, it left strong negative bowls, which should not be possible.</p>
<p>On the Einstein image, the image quality from feathering was not great, but
there were no negative bowls left.  The dynamic range is lower in the Einstein
data, but this still hints that there is a problem with the HC3N images.  We're
investigating the possibility that the 7m data are improperly calibrated or
weighted.</p>
</div>
<div class="section" id="miriad">
<h2>Miriad</h2>
<p>We never managed to create UV data from the single dish data because of complaints about
the pointing information.</p>
</div>
<div class="section" id="cleaning-with-a-single-dish-image-as-an-input-model">
<h2>Cleaning with a single dish image as an input model</h2>
<p>We attempted to clean the data using the single dish image as an input model.</p>
<p>On the real data, this failed with both tclean and clean.  With <tt class="docutils literal">tclean</tt>, there
was no error message, it just hung indefinitely.
With <tt class="docutils literal">clean</tt>, the error message is:</p>
<pre class="literal-block">
*** Error ***  LatticeExprNode - coordinates of operands mismatch
Scanned so far: modelos_0 + __temp_model2

2016-06-01 10:35:05     SEVERE  clean::::       An error occurred running task clean.
</pre>
<p>Changing CDELT to 1 GHz, which solved a previous issue, had no effect here.</p>
<p>It turns out <tt class="docutils literal">tclean</tt> will fail silently if it doesn't find the
<tt class="docutils literal">startmodel</tt>, which has to be specified as an image <em>prefix</em> for version
&lt;=4.6, and the image has to exist as a <tt class="docutils literal">.model</tt> file.  For higher versions, 4.6+,
the model can be directly referenced (as in clean).  Eventually, tclean seems to have
completed, though the results indicate that it does not treat the units as I expected;
the total power data seems to be over-weighted by a factor of 10^3+, probably by the ratio
of the beam areas:</p>
<img alt="" src="http://i.imgur.com/8dW7t8I.png" style="width: 600px;" />
<p>For the simulated images (einstein), we get the error:</p>
<pre class="literal-block">
2016-06-01 10:55:11 SEVERE  SynthesisImager::defineImage (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/ImagerObjects/SynthesisImager.cc, line 668)    Error in adding Mapper : Error in createImStore : ::operator!= (const IPosition&amp;, const IPosition&amp;) - left and right operand do not conform
2016-06-01 10:55:11 SEVERE  tclean::task_tclean::   Exception from task_tclean : 2016-06-01 10:55:11        SEVERE  SynthesisImager::defineImage (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/ImagerObjects/SynthesisImager.cc, line 668)    Error in adding Mapper : Error in createImStore : ::operator!= (const IPosition&amp;, const IPosition&amp;) - left and right operand do not conform
</pre>
<p>This is probably an issue with regridding.  <tt class="docutils literal">imregrid</tt> doesn't like our data:</p>
<pre class="literal-block">
2016-06-01 11:00:41 SEVERE  imregrid::image::regrid Exception Reported: Exception: The number of pixel axes in the output shape and Coordinate System must be the same. Shape has size 4. Output coordinate system has 3 axes.
2016-06-01 11:00:41 SEVERE  imregrid::image::regrid+        ... thrown by SPIIF casa::ImageRegridder::_regrid() const at File: /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/imageanalysis/ImageAnalysis/ImageRegridder.cc, line: 138
</pre>
<p>Adding a frequency axis to the FITS data (which was missing before...) seems to
have fixed this error for the Einstein data, but not for the real HC3N data.</p>
<!-- (this is now incorporated in an above paragraph) -->
<!-- tclean appears to use the wrong units for the input model, treating that model -->
<!-- very differently than ``clean`` does.  This error may be limited to CASA <= -->
<!-- 4.5, since the tclean documentation regarding models changed substantially from -->
<!-- 4.5 to 4.6. -->
</div>
<div class="section" id="linear-combination-in-image-space">
<h2>Linear Combination in Image Space</h2>
<p>Linear combination of the single dish and interferometer data in image space,
followed by image-space deconvolution, has been used successfully on HI data.
In principle, this is very straightforward, except for the need for
deconvolution.  CASA now has an image-space deconvolution program
(<tt class="docutils literal">deconvolve</tt>), so I was able to implement this approach.  However, the
deconvolver seems to only work on the inner 1/4 of the image in each dimension,
which left incomplete images that were difficult to compare.  Additionally,
CASA does not (obviously) carry the appropriate machinery for computing the
residual image and adding the convolved model back to the residual image.
Still, this is a promising route forward as it is computationally relatively
cheap and mostly easy to implement.</p>
<p>Linear combination is partly implemented now using the CASA <tt class="docutils literal">deconvolve</tt> task;
it hasn't been generalized but you can see the outline / single working case at
<a class="reference external" href="https://github.com/radio-astro-tools/uvcombine/blob/master/uvcombine/realspace_combine.py">this link</a>.</p>
<!-- this is how you include images -->
<!-- .. image:: |static|/images/psfFfftF.png -->
<!-- :width: 600px -->
</div>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/what-does-feather-do.html" rel="bookmark" title="Permalink to What does feather do?">
                    What does feather do?</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2016-05-26T08:29:00-06:00"> 2016/05/26 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-ginsburg-adamgginsburggmailcom.html">Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>This is an examination of the 'feather' task in CASA.</p>
<p>First we have to track down what code is actually called.</p>
<p>On mac, this is:</p>
<blockquote>
<ul class="simple">
<li>/Applications/CASA.app/Contents/Resources/python/feather_cli.py -&gt; feather_cli</li>
<li>/Applications/CASA.app/Contents/Resources/python/task_feather.py -&gt; feather</li>
<li>/Applications/CASA.app/Contents/Resources/python/taskinit.py -&gt; imtool-&gt;imager-&gt;casac.imager-&gt;/Applications/CASA.app/Contents/Resources/python/feather_cli.py</li>
<li><a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Imager.cc#L2257">Imager.cc</a></li>
</ul>
</blockquote>
<p>Within the imager, <cite>setvp</cite> is used to do something with the primary beam.  As
far as I can tell, this function spews a lot of text into the logger, sets
local variables, sets one larger-scope variable <cite>BeamSquint::</cite>, then does
<cite>destroySkyEquation();</cite>.  In short, I don't know what this does.  Probably my
reading of the C code is incorrect and these variables are <em>not</em> local, in
which case it is just setting a bunch of default beam parameters.</p>
<p>Then, <cite>Imager.cc</cite> calls <a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L1211">Feather.cc</a>.</p>
<p>Feather sets parameters based on the effective dish diameter.  It uses
<a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L244">1.22*(speed of light)/frequency/dish_diameter</a>,
so it is retrieving the FWHM
assuming a Gaussian beam by default.</p>
<p>A lovely aside: <cite>Imager.cc</cite> passes the local variable <a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Imager.cc#L2320">lowPassFilterSD</a>
to <cite>Feather.cc</cite>, which is read in to the input boolean parameter
<a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L244">doHiPassFilterOnSD</a>.
That seems like a potential place for confusion.</p>
<p>If <cite>doHiPassFilterOnSD</cite> is set <em>or</em> the effective beam diameter is set as a
parameter, the single dish image is deconvolved with its beam using the
GaussianDeconvolver.  This is actually disabled by default, though.</p>
<p>The low resolution image is <a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L142">regridded</a>
to match the high resolution image.</p>
<p>The <a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L375">applyFeather</a>
command seems to do the actual work.
It starts with <a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L414">calcCWeightImage</a>,
which sets the &quot;weight&quot; to one minus the peak-normalized fourier transform of
the low-resolution (single-dish) beam
<a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L427">Feather.cc line 427</a>,
with the result stored in the variable <cite>cwImage_p</cite>.
<a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L408">applyFeather</a> then just
multiplies the high-resolution image by this weight.</p>
<p>Back in the <a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L695">saveFeatheredImage</a>
task, the single-dish data are fourier transformed, then a scaling factor, the ratio
between the low and high beam areas, is computed.  Finally, the single-dish
(scaled) and interferometer <a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L694">fourier-transformed</a> images are <a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L703">added</a>.</p>
<p>Is the single-dish image weighted by the beam at all?  The single-dish image will
be convolved with a kernel only if <a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L1235">doHighPassFilterOnSD</a> is set
or if the effective dish diameter is set.  If the beam is the same size as the original
beam, nothing will happen.
In <a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L256">setEffectiveDishDiam</a>
the low-resolution image is convolved with the <a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/components/ComponentModels/GaussianDeconvolver.cc#L34">*deconvolved*</a>
beam.</p>
<p>The most important note in this post is that the single-dish image is <em>not</em>
weighted unless <cite>doHighPassFilterOnSD</cite> is set, and even then nothing will be
done if the single-dish beam size passed as a parameter is the same as the beam
size specified in the header.  That means only the interferometer image is
weighted.  Maybe that is the correct behavior?  By weighting by (1-convolved
beam), which means setting the total flux in the interferometer image to zero,
the process is guaranteed to be flux conserving.</p>
<!-- this is how you include images -->
<!-- .. image:: |static|/images/psfFfftF.png -->
<!-- :width: 600px -->
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/casa-coordinate-defaults.html" rel="bookmark" title="Permalink to CASA coordinate defaults">
                    CASA coordinate defaults</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2016-05-19T09:31:00-06:00"> 2016/05/19 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-ginsburg-adamgginsburggmailcom.html">Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>A brief public service announcement: CASA coordinate strings follow a
convention of their own making that I at least find thoroughly
counterintuitive.  If you specify a sexagesimal coordinate, e.g. 05:12:15.3
-5:10:20.5 or something similar, CASA interprets that as 5 hours, -5 hours.
The declination is interpreted as being in hours.  Those are units no one has
ever used.  The CASA version requires the second half of the sexagesimal string
to be decimal separated:</p>
<pre class="literal-block">
2016-05-19 00:45:13     WARN    SynthesisParams::stringToMDirection (file /var/rpmbuild/BUILD/casa-prerelease/casa-prerelease-4.6.0/code/synthesis/ImagerObjects/SynthesisUtilMethods.cc, line 786)     You provided the Declination/Latitude value &quot;-28:23:29.22&quot; which is understood to be in units of hours.
2016-05-19 00:45:13     WARN    SynthesisParams::stringToMDirection (file /var/rpmbuild/BUILD/casa-prerelease/casa-prerelease-4.6.0/code/synthesis/ImagerObjects/SynthesisUtilMethods.cc, line 786)+    If you meant degrees, please replace &quot;:&quot; by &quot;.&quot;.
</pre>
<p>This has broken my scripts more than a handful of times now, since copying &amp;
pasting coordinates from any other program inevitably has the &quot;wrong&quot;
units.</p>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/casa-tclean-adds-negative-components.html" rel="bookmark" title="Permalink to CASA tclean adds negative components">
                    CASA tclean adds negative components</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2016-05-01T10:21:00-06:00"> 2016/05/01 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-ginsburg-adamgginsburggmailcom.html">Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>I'm trying to examine some of my 7m+12m combined data and have run into yet another
mysterious behavior of CASA.  <tt class="docutils literal">tclean</tt> is adding negative components in regions with
exclusively positive emission.</p>
<p>In this image, the <em>left</em> is the clean image, which doesn't make any sense; it
looks like it should be a residual image but it is not.  2nd image is the clean
components (negative!!), 3rd is the residual, 4th is the dirty map.</p>
<img alt="" src="https://keflavich.github.io/blog/images/casa/bad_cleancomps.png" style="width: 600px;" />
<p>One tricky thing for this particular image is that the emission is real, BUT it
is also directly on top of a major sidelobe of the brightest source in the
region.  Nonetheless, I cannot imagine any way to explain the negative
component.  I don't really understand when a negative component is added, but
presumably it ought to happen when the residual has a negative value but also
the highest amplitude in the map; this obviously never happens here since the
residual in fact has one of the highest <em>positive</em> amplitudes in the map.</p>
<p>The imaging parameters seem not to affect this problem. I attempted reducing the
gain to 0.05 to no avail.  Changing from natural to robust weighting actually
removed most of the negative components.</p>
<div class="section" id="failed-combination-of-7m-and-12m-data">
<h2>Failed combination of 7m and 12m data</h2>
<p>The above was a tangent.  The real reason I was working on this data set was to
combine the 7m and 12m spectral data.  The problem I keep seeing is very large,
smooth blobs that are spatially distinct from the more compact emission.  It's
as if someone took the two independent cubes (12m and 7m) and just added them
together; it looks like flux is not being conserved.</p>
<p>The UV plots, especially weight vs uvdist, look fine.  The 7m antenna are
downweighted relative to the 7m antennae by a factor ~2.</p>
<p>One of the bigger problems is that I have a vague - possibly not justified -
sense that there is a velocity offset of ~1 km/s between the 7m and 12m data.
If this is the case, there's no wonder the combination isn't working.
However, it's nearly inconceivable.</p>
</div>
<div class="section" id="followup-feb-2017">
<h2>Followup Feb 2017</h2>
<p>That vague fear turned out to be entirely justified.  It turned out that the 7m
and 12m array data sets were not in a common frame, and they were therefore
offset by something like the Earth's change in velocity between the observation
dates.  The solution was to cvel the data sets to the LSRK frame prior to
concatenating them.  While I know I made these changes, I unfortunately can't
find the specific commit where I made them.</p>
</div>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/casa-simulated-imaging-now-ftmachine-is-whining.html" rel="bookmark" title="Permalink to CASA simulated imaging: now FTMachine is whining">
                    CASA simulated imaging: now FTMachine is whining</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2016-04-26T15:12:00-06:00"> 2016/04/26 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-ginsburg-adamgginsburggmailcom.html">Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p><a class="reference external" href="https://keflavich.github.io/blog/casa_simulation_debugging.rst">A few days ago</a>
I apparently got my broken simulator working again.  Today, in my first
attempt to repeat those results, I... have broken it again.:</p>
<pre class="literal-block">
WARN        FTMachine::initMaps     No overlap in frequency between image channels and selected data found for this FTMachine
WARN        FTMachine::initMaps+     Check your data selection and image parameters if you end up with a blank image
</pre>
<p>This warning is not a simple warning, it means nothing is being done.  My
images are empty, pure noise (which, interestingly enough, is far from
gaussian).</p>
<p>I have encountered these errors <cite>before
&lt;|static|/separating_line_and_continuum.rst&gt;</cite>, but unfortunately did not
resolve the issue.</p>
<p>Turns out, the difference was the .ms file I used,
<tt class="docutils literal">continuum_7m12m_noflag.ms</tt>, which works, vs the useful one,
<tt class="docutils literal">w51_contvis_selfcal_3.ms</tt>, which doesn't.</p>
<p>Checking out their headers, the continuum image does overlap with the
data but the selfcal version doesn't.  Wonderful.  Now I'll bet it's only
populating one channel at a time when I invert too...</p>
<p>This leads me to try:</p>
<pre class="literal-block">
split(vis='w51_contvis_selfcal_3.ms', outputvis='simulation_continuum.ms', datacolumn='data', width=100)
</pre>
<p>then use (borrowed from <a class="reference external" href="https://github.com/radio-astro-tools/sandbox/blob/master/casa_7m12m_tools/weight_density_uv_plot.py">this tool</a>):</p>
<pre class="literal-block">
mymsmd = msmdtool()
mymsmd.open(vis)

reffreq = &quot;{value}{unit}&quot;.format(**mymsmd.reffreq(spw)['m0'])
</pre>
<p>to get the frequency to write into the header each time.</p>
<p>At a glance, just changing the frequency of the FITS file to match the first
SPW seems to work.  However, I haven't yet examined whether the other SPWs
are populated.</p>
<p>This assumption proved wrong.  No, it simply doesn't work.  The warnings went away,
but the output images are empty.  Also, the noise went up, which I don't understand.</p>
<p>Imaging just spw1 kind of worked, but resulted in an image with the wrong
resolution by factors of many.</p>
<p>Trying to loop over all spws failed miserably, resulting in <em>nothing</em> being done by
predict and <em>no warning</em> being given.</p>
<p>OK, finally, solution is to make sure CDELT is large enough to cover <em>all</em> SPWs.</p>
<p>Another important note: Jy/beam and Jy/pixel inputs into CASA result in identical images.
In both cases, they are wrong images: they correspond to multiplying the input data by
factors of at least 100.  Therefore, my conclusion now is that I have to divide everything
by some fact, which I <em>sincerely</em> hope is ppbeam, to correct the data.</p>
<p>It looked vaguely like the divide-by-ppbeam trick worked, but my tests kept coming up funny
because the <em>original</em> images were scaled down.  So I tried unscaling them.  Somehow,
without changing anything about the headers, I landed on another failed predict error:</p>
<pre class="literal-block">
2016-04-27 19:14:42 SEVERE  Simulator::createSkyEquation() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc, line 2200)        Caught exception: (/Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc : 2266) Failed AlwaysAssert spectralIndex&gt;=0
2016-04-27 19:14:42 SEVERE  Simulator::predict() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc, line 2118)  Failed to create SkyEquation
</pre>
<p>Spectral Index?  I encountered this <a class="reference external" href="|static|/casa_simulating.rst">previously</a>, but didn't record any solution.
After checking the header, it appears that my files are <em>now</em> missing axes 3 and 4.
I didn't make any changes that should cause this; the axes are just not being added
on importfits despite being forcibly added in the command.</p>
<p>The problem is unfortunately not in the FITS part, but again in the CASA part.
Re-importing the FITS file to .image without forcing <tt class="docutils literal">defaultaxes</tt> again just
broke it.</p>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/more-casa-simulation-debugging.html" rel="bookmark" title="Permalink to More CASA simulation & debugging">
                    More CASA simulation &amp; debugging</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2016-04-24T22:57:00-06:00"> 2016/04/24 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-ginsburg-adamgginsburggmailcom.html">Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>(this post written from snowy-ish ALMA; <a class="reference external" href="https://goo.gl/photos/z3fUkCT6VVRzt8EW6">just cloudy at the OSF though</a>)</p>
<p>(tl; dr version: <tt class="docutils literal">sm.setvp</tt> doesn't work if you have <tt class="docutils literal"><span class="pre">TELESCOP=&quot;ALMA&quot;</span></tt> in
your header)</p>
<p>I'm trying to repeat an experiment very similar to
<a class="reference external" href="|static|/casa_simulating.rst">previous</a>
<a class="reference external" href="|static|/simulated_imaging.rst">simulation work</a>
in order to quantify my completeness and largest angular scales
by injecting synthetic signal into the real UV data.</p>
<p>However, as you might expect, it doesn't work as it did last time, even
when I (afaict) copy and paste the code directly.</p>
<p>Here's the new error:</p>
<pre class="literal-block">
2016-04-25 02:57:21 SEVERE  Simulator::createSkyEquation() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc, line 2200)        Caught exception: Transformations to/from frame &quot;Undefined&quot; are not possible.
2016-04-25 02:57:21 SEVERE  Simulator::predict() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc, line 2118)  Failed to create SkyEquation
Result of predict: False
</pre>
<p>It's strange because there is nothing obviously undefined.</p>
<p>I'm comparing 2 FITS files that should behave identically.
The good header lacks these keywords that the bad header has:</p>
<pre class="literal-block">
['PV2_1',
 'PV2_2',
 'OBSERVER',
 'DATE-OBS',
 'OBSRA',
 'OBSDEC',
 'OBSGEO-X',
 'OBSGEO-Y',
 'OBSGEO-Z']
</pre>
<p>while the good header has these and the bad lacks them:</p>
<pre class="literal-block">
['PC03_01',
 'PC04_01',
 'PC03_02',
 'PC04_02',
 'PC01_03',
 'PC02_03',
 'PC03_03',
 'PC04_03',
 'PC01_04',
 'PC02_04',
 'PC03_04',
 'PC04_04',
 'CREATOR',
 'INSTRUME',
 'BAND',
 'PROPOSAL',
 'PRTITLE',
 'OBSID001',
 'OBSID002',
 'HISTORY']
</pre>
<p>The only significant difference is the <tt class="docutils literal">PC</tt> values, unless CASA
is doing something with the observatory location information.</p>
<p>The only difference in common keywords is numerical, which seems
very unlikely to cause this issue.</p>
<p>I cannot discern any useful difference between these two CASA .image headers:</p>
<pre class="literal-block">
2016-04-25 03:08:55 INFO imhead     ##########################################
2016-04-25 03:08:55 INFO imhead     ##### Begin Task: imhead             #####
2016-04-25 03:08:55 INFO imhead     imhead(imagename=&quot;../perseus_synth/perseus_250_to_w51.image&quot;,mode=&quot;summary&quot;,hdkey=&quot;&quot;,hdvalue=&quot;&quot;,verbose=True)
2016-04-25 03:08:55 INFO ImageAnalysis
2016-04-25 03:08:55 INFO ImageAnalysis      Image name       : perseus_250_to_w51.image
2016-04-25 03:08:55 INFO ImageAnalysis      Object name      : perseus 04
2016-04-25 03:08:55 INFO ImageAnalysis      Image type       : PagedImage
2016-04-25 03:08:55 INFO ImageAnalysis      Image quantity   : Intensity
2016-04-25 03:08:55 INFO ImageAnalysis      Pixel mask(s)    : mask0
2016-04-25 03:08:55 INFO ImageAnalysis      Region(s)        : None
2016-04-25 03:08:55 INFO ImageAnalysis      Image units      : Jy/pixel
2016-04-25 03:08:55 INFO ImageAnalysis      Restoring Beam   : 0.465804 arcsec, 0.465804 arcsec, 0 deg
2016-04-25 03:08:55 INFO ImageAnalysis
2016-04-25 03:08:55 INFO ImageAnalysis      Direction reference : J2000
2016-04-25 03:08:55 INFO ImageAnalysis      Spectral  reference : Undefined
2016-04-25 03:08:55 INFO ImageAnalysis      Velocity  type      : RADIO
2016-04-25 03:08:55 INFO ImageAnalysis      Rest frequency      : 2.33947e+11 Hz
2016-04-25 03:08:55 INFO ImageAnalysis      Telescope           : Herschel
2016-04-25 03:08:55 INFO ImageAnalysis      Observer            : UNKNOWN
2016-04-25 03:08:55 INFO ImageAnalysis      Date observation    : UNKNOWN
2016-04-25 03:08:55 INFO ImageAnalysis
2016-04-25 03:08:55 INFO ImageAnalysis      Axis Coord Type      Name             Proj Shape Tile   Coord value at pixel    Coord incr Units
2016-04-25 03:08:55 INFO ImageAnalysis      ------------------------------------------------------------------------------------------------
2016-04-25 03:08:55 INFO ImageAnalysis      0    0     Direction Right Ascension   TAN  2370  158  19:23:41.765  1099.00 -1.552680e-01 arcsec
2016-04-25 03:08:55 INFO ImageAnalysis      1    0     Direction Declination       TAN  2500  250 +14.30.45.850  1552.00  1.552680e-01 arcsec
2016-04-25 03:08:55 INFO ImageAnalysis      2    2     Spectral  Frequency                 1    1   2.33947e+11     0.00  1.000000e+09 Hz
2016-04-25 03:08:55 INFO ImageAnalysis                           Velocity                                     0     0.00 -1.281456e+03 km/s
2016-04-25 03:08:55 INFO ImageAnalysis      3    1     Stokes    Stokes                    1    1             I
2016-04-25 03:08:55 INFO imhead     ##### End Task: imhead               #####
2016-04-25 03:08:55 INFO imhead     ##########################################
2016-04-25 03:09:07 INFO imhead
2016-04-25 03:09:07 INFO imhead     ##########################################
2016-04-25 03:09:07 INFO imhead     ##### Begin Task: imhead             #####
2016-04-25 03:09:07 INFO imhead     imhead(imagename=&quot;../simulations/simimage_firsttest.image&quot;,mode=&quot;summary&quot;,hdkey=&quot;&quot;,hdvalue=&quot;&quot;,verbose=False)
2016-04-25 03:09:07 INFO ImageAnalysis
2016-04-25 03:09:07 INFO ImageAnalysis      Image name       : simimage_firsttest.image
2016-04-25 03:09:07 INFO ImageAnalysis      Object name      :
2016-04-25 03:09:07 INFO ImageAnalysis      Image type       : PagedImage
2016-04-25 03:09:07 INFO ImageAnalysis      Image quantity   : Intensity
2016-04-25 03:09:07 INFO ImageAnalysis      Pixel mask(s)    : None
2016-04-25 03:09:07 INFO ImageAnalysis      Region(s)        : None
2016-04-25 03:09:07 INFO ImageAnalysis      Image units      : Jy/beam
2016-04-25 03:09:07 INFO ImageAnalysis      Restoring Beam   : 0.21023 arcsec, 0.192666 arcsec, 79.8538 deg
2016-04-25 03:09:07 INFO ImageAnalysis
2016-04-25 03:09:07 INFO ImageAnalysis      Direction reference : J2000
2016-04-25 03:09:07 INFO ImageAnalysis      Spectral  reference : Undefined
2016-04-25 03:09:07 INFO ImageAnalysis      Velocity  type      : RADIO
2016-04-25 03:09:07 INFO ImageAnalysis      Rest frequency      : 2.33947e+11 Hz
2016-04-25 03:09:07 INFO ImageAnalysis      Pointing center     :  19:23:41.629000  +14.30.42.380000
2016-04-25 03:09:07 INFO ImageAnalysis      Telescope           : ALMA
2016-04-25 03:09:07 INFO ImageAnalysis      Observer            : keflavich
2016-04-25 03:09:07 INFO ImageAnalysis      Date observation    : 2015/04/23/09:47:44
2016-04-25 03:09:07 INFO ImageAnalysis      Telescope position: [2.22514e+06m, -5.44031e+06m, -2.48103e+06m] (ITRF)
2016-04-25 03:09:07 INFO ImageAnalysis
2016-04-25 03:09:07 INFO ImageAnalysis      Axis Coord Type      Name             Proj Shape Tile   Coord value at pixel    Coord incr Units
2016-04-25 03:09:07 INFO ImageAnalysis      ------------------------------------------------------------------------------------------------
2016-04-25 03:09:07 INFO ImageAnalysis      0    0     Direction Right Ascension   TAN  3072  192  19:23:41.629  1536.00 -5.000000e-02 arcsec
2016-04-25 03:09:07 INFO ImageAnalysis      1    0     Direction Declination       TAN  3072  192 +14.30.42.380  1536.00  5.000000e-02 arcsec
2016-04-25 03:09:07 INFO ImageAnalysis      2    1     Stokes    Stokes                    1    1             I
2016-04-25 03:09:07 INFO ImageAnalysis      3    2     Spectral  Frequency                 1    1   2.33947e+11     0.00  1.000000e+09 Hz
2016-04-25 03:09:07 INFO ImageAnalysis                           Velocity                                     0     0.00 -1.281456e+03 km/s
2016-04-25 03:09:07 INFO imhead     ##### End Task: imhead               #####
2016-04-25 03:09:07 INFO imhead     ##########################################
</pre>
<p>if anything, the ALMA file includes <em>extra</em> data. Removing this data has no
effect.</p>
<p>The only really substantial difference left is the order of the axes, which
is <em>not what I put in</em> for the ALMA data: it puts Stokes as 2 instead of 3
despite the fact that <tt class="docutils literal"><span class="pre">CTYPE4='STOKES'</span></tt> and <tt class="docutils literal"><span class="pre">CTYPE3='FREQ'</span></tt>.</p>
<p>By doing a round trip FITS-&gt;image-&gt;FITS-&gt;image, I was able to fix the order,
but that is not the underlying problem, apparently.</p>
<p>Could the missing pixel mask be at fault?  It doesn't jive at all with the
error message, so I doubt it.  <tt class="docutils literal">OBSDATE</tt> is not the problem.</p>
<p>Turns out, the error is that ALMA is the telescope.  I added the header entry:</p>
<pre class="literal-block">
ffile[0].header['TELESCOP'] = 'NotReal'
</pre>
<p>and it Just Worked.  It is approaching the end of my shift, so I think it is
now acceptable to say &quot;what kind of !#$&#64;#$!&#64;% up #&#64;$$&#64;% is that?!&quot;.</p>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
</ul><!-- /#posts-list -->
<p class="paginator">
            <a href="https://keflavich.github.io/blog/category/misc3.html">&laquo;</a>
    Page 4 / 25
        <a href="https://keflavich.github.io/blog/category/misc5.html">&raquo;</a>
</p>
</section><!-- /#content -->
  </div>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37306139-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37306139-1');
    ga('send', 'pageview');
</script>
<script type="text/javascript">
  var disqus_shortname = 'adamginsburgsblog';
  (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();
</script>
</body>
</html>
