<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" type="text/css" href="https://keflavich.github.io/blog/theme/css/style.css" />
<link rel="icon" type="image/gif" href="https://keflavich.github.io/blog/theme/favicon8.ico">
<head>
    <base href="https://keflavich.github.io/blog">
        <title>Adam Ginsburg's blog - Articles by Adam (keflavich@gmail.com)</title>
        <meta charset="utf-8" />
        <link href="https://keflavich.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Adam Ginsburg's blog Full Atom Feed" />
<!-- Using MathJax, with the delimiters $ -->
<!-- Conflict with pygments for the .mo and .mi -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
    styles: {
    ".MathJax .mo, .MathJax .mi": {color: "inherit !important"}},
    'div.typeset': { 'text-align': 'left'}
    },
    tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']],processEscapes: true}
    });
    TeX: {
        extensions: ["AMSmath.js", "AMSsymbols.js"]
    }
    MathJax.Hub.Register.StartupHook("HTML-CSS Jax Ready",function () {
    var VARIANT = MathJax.OutputJax["HTML-CSS"].FONTDATA.VARIANT;
    VARIANT["normal"].fonts.unshift("MathJax_SansSerif");
    VARIANT["bold"].fonts.unshift("MathJax_SansSerif-bold");
    VARIANT["italic"].fonts.unshift("MathJax_SansSerif-italic");
    VARIANT["-tex-mathit"].fonts.unshift("MathJax_SansSerif-italic");
    });
    MathJax.Hub.Register.StartupHook("SVG Jax Ready",function () {
    var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;
    VARIANT["normal"].fonts.unshift("MathJax_SansSerif");
    VARIANT["bold"].fonts.unshift("MathJax_SansSerif-bold");
    VARIANT["italic"].fonts.unshift("MathJax_SansSerif-italic");
    VARIANT["-tex-mathit"].fonts.unshift("MathJax_SansSerif-italic");
    });
</script>

<script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>
        
</head>

<body id="base" class="home">


    <header id="banner" class="body" >
        <div id="header" style='background-image: url("https://keflavich.github.io/blog/images/GC_4096sq_bolo.png"); background-position:left; min-heigt: 200px;  background-repeat: no-repeat; max-width: 80%;'>
            <h1 style="color: #C4C4C4;"><a class="header" href="https://keflavich.github.io/blog">Adam Ginsburg's blog <strong></strong></a></h1>

            <nav id="menu"><ul id="menulist">
                <li><a href="https://www.adamgginsburg.com">Homepage</a></li>
                <li><a href="/index.html">Blog Index</a></li>
                <li><a href="/category/bgps.html">BGPS Blog</a></li>
                <li><a href="/category/publications.html">Publications</a></li>
                <li><a href="/archives.html">Archives</a></li>
                <li><a href="/tags.html">Tags</a></li>
            </ul></nav><!-- /#menu -->
        </div>
    </header><!-- /#banner -->

  <div id="sidebar">
    <ul>
      <li>
        <h3 id='recent_header'>Recent Posts</h3>
        <ul>
              <li class="post">
                  2015/10/02
                  <br>
                  <a href="https://keflavich.github.io/blog/alma-qa2-restoration.html">ALMA QA2 restoration</a>
              </li>
              <li class="post">
                  2014/06/13
                  <br>
                  <a href="https://keflavich.github.io/blog/azimuthal-mass-profiles.html">Azimuthal Mass Profiles</a>
              </li>
              <li class="post">
                  2013/09/21
                  <br>
                  <a href="https://keflavich.github.io/blog/generating-a-cv-using-the-ads-labs-api.html">Generating a CV using the ADS Labs API</a>
              </li>
              <li class="post">
                  2013/06/09
                  <br>
                  <a href="https://keflavich.github.io/blog/gps-data-analysis.html">GPS Data Analysis</a>
              </li>
              <li class="post">
                  2013/06/04
                  <br>
                  <a href="https://keflavich.github.io/blog/hopkins-pdf-generalization.html">Hopkins PDF Generalization</a>
              </li>
        </ul>
      </li>
    
    </ul>
  </div><!-- end #sidebar -->

  <div id="content">
<section id="content">
<h2>Articles by Adam (keflavich@gmail.com)</h2>

<ul id="post-list">
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/alma-qa2-restoration.html" rel="bookmark" title="Permalink to ALMA QA2 restoration">
                    ALMA QA2 restoration</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2015-10-02T09:00:00-06:00"> 2015/10/02 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-keflavichgmailcom.html">Adam (keflavich@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>In case you ever encounter this error about a missing <cite>Source.xml</cite> file:</p>
<pre class="literal-block">
IOError: [Errno 2] No such file or directory: '/diskb/aginsbur/orion/2013.1.00546.S/science_goal.uid___A001_X122_X35c/group.uid___A001_X122_X35d/member.uid___A001_X122_X35e/calibrated/working/uid___A002_X960614_X39db.ms/Source.xml'
WARNING: Failure executing file: &lt;scriptForPI.py&gt;
</pre>
<p>the solution is this ticket: <a class="reference external" href="https://help.almascience.org/index.php?/Knowledgebase/Article/View/266/5/what-should-i-do-if-scriptforpi-aborts-at-the-importasdm-step-with-error">https://help.almascience.org/index.php?/Knowledgebase/Article/View/266/5/what-should-i-do-if-scriptforpi-aborts-at-the-importasdm-step-with-error</a></p>
<p>So my solution:</p>
<pre class="literal-block">
orion /diskb/aginsbur/atca master$ mv /diskb/aginsbur/casa/casapy-42.2.30986-pipe-1-64b/lib64/libxml2.so.2 /diskb/aginsbur/casa/casapy-42.2.30986-pipe-1-64b/lib64/origlibxml2.so.2
orion /diskb/aginsbur/atca master$ locate libxml2.so.2
/diskb/aginsbur/casa/casapy-42.2.30986-pipe-1-64b/lib64/libxml2.so.2
/diskb/aginsbur/casa/casapy-42.2.30986-pipe-1-64b/lib64/libxml2.so.2.6.26
/home/aginsbur/anaconda/lib/libxml2.so.2
/home/aginsbur/anaconda/lib/libxml2.so.2.9.2
/home/aginsbur/anaconda/pkgs/libxml2-2.9.2-0/lib/libxml2.so.2
/home/aginsbur/anaconda/pkgs/libxml2-2.9.2-0/lib/libxml2.so.2.9.2
/opt/anaconda/lib/libxml2.so.2
/opt/anaconda/lib/libxml2.so.2.9.2
/opt/anaconda/pkgs/libxml2-2.9.2-0/lib/libxml2.so.2
/opt/anaconda/pkgs/libxml2-2.9.2-0/lib/libxml2.so.2.9.2
/usr/lib64/libxml2.so.2
/usr/lib64/libxml2.so.2.9.1
orion /diskb/aginsbur/atca master$ ln -sf /usr/lib64/libxml2.so.2 /diskb/aginsbur/casa/casapy-42.2.30986-pipe-1-64b/lib64/libxml2.so.2
</pre>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/azimuthal-mass-profiles.html" rel="bookmark" title="Permalink to Azimuthal Mass Profiles">
                    Azimuthal Mass Profiles</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2014-06-13T09:00:00-06:00"> 2014/06/13 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-keflavichgmailcom.html">Adam (keflavich@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>Can we characterize &quot;hub&quot; clumps vs &quot;filament&quot; clumps by examining their
azimuthal column density profile?  Filaments would have two-peaked structures,
hubs many-peaked, and spherically symmetric &quot;isolated&quot; clumps would be
peakless.</p>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/generating-a-cv-using-the-ads-labs-api.html" rel="bookmark" title="Permalink to Generating a CV using the ADS Labs API">
                    Generating a CV using the ADS Labs API</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2013-09-21T00:00:00-06:00"> 2013/09/21 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-keflavichgmailcom.html">Adam (keflavich@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <ul class="simple">
<li>[ <a class="reference external" href="https://github.com/keflavich/generate_cv">Source code related to this
post</a> ]</li>
<li>[ <a class="reference external" href="http://nbviewer.ipython.org/urls/raw.github.com/keflavich/generate_cv/master/examples/GenerateCVExample.ipynb">Notebook
form</a>
]</li>
<li>[ <a class="reference external" href="http://www.adamgginsburg.com/cv.htm">CV partly generated from this
post</a> ]</li>
</ul>
<p>At <a class="reference external" href="http://dotastronomy.com/">.astronomy</a> this past week, the keynote
speaker was <a class="reference external" href="https://www.cfa.harvard.edu/~alberto/">Alberto
Accomazzi</a>, introducing ADS
Labs and <a class="reference external" href="http://labs.adsabs.harvard.edu/adsabs/">ADS 2.0</a>, which are
really quite impressive.</p>
<p>I was inspired to use ADS Labs to help me auto-generate a nicely
formatted CV for myself. I used <a class="reference external" href="https://twitter.com/astrowizicist">Andy
Casey's</a>
<a class="reference external" href="https://github.com/andycasey/ads-python">ADS-python</a> as a starting
point: he introduces a useful convention of storing your <a class="reference external" href="https://github.com/adsabs/adsabs-dev-api#signup--access">ADS API
Key</a>:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">get_dev_key</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; A convenience function for accessing a system-wide ADS Developer&#39;s Key &quot;&quot;&quot;</span>

    <span class="n">ads_dev_key_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/.ads/dev_key&#39;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ads_dev_key_filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ads_dev_key_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">dev_key</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">dev_key</span>

    <span class="k">if</span> <span class="s1">&#39;ADS_DEV_KEY&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ADS_DEV_KEY&#39;</span><span class="p">]</span>

    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;no ADS API key found in ~/.ads/dev_key&quot;</span><span class="p">)</span>
</pre></div>
<p>We'll use <tt class="docutils literal">requests</tt> to send the request to ADS, then <tt class="docutils literal">json</tt> to
parse the data.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
</pre></div>
<p>We then query the database using a keyword query (parameter <tt class="docutils literal">q</tt>)
specifying the author. Other required parameters are the API key
(<tt class="docutils literal">dev_key</tt>) and a filter to select only astronomy articles. The
maximum number of rows returned in the API is 200 right now, which I
have set (the default is 10 or 20).</p>
<div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://adslabs.org/adsabs/api/search/&#39;</span><span class="p">,</span>
                         <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span><span class="s1">&#39;author:ginsburg, a&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;dev_key&#39;</span><span class="p">:</span><span class="n">get_dev_key</span><span class="p">(),</span>
                                 <span class="s1">&#39;rows&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span>
                                 <span class="s1">&#39;filter&#39;</span><span class="p">:</span><span class="s1">&#39;database:astronomy&#39;</span><span class="p">})</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">J</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">J</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
<pre class="literal-block">
[u'meta', u'results']
</pre>
<p>The JSON 'meta' key is just metadata about the query, include the number
of matches and execution time.</p>
<div class="highlight"><pre><span></span><span class="n">J</span><span class="p">[</span><span class="s1">&#39;meta&#39;</span><span class="p">]</span>
</pre></div>
<pre class="literal-block">
{u'api-version': u'0.1',
 u'count': 54,
 u'hits': 54,
 u'qtime': 7,
 u'query': u'author:ginsburg, a'}
</pre>
<p>The 'results' key includes what we're actually interested in, under
another key 'docs'.</p>
<div class="highlight"><pre><span></span><span class="n">J</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
<pre class="literal-block">
[u'docs']
</pre>
<div class="highlight"><pre><span></span><span class="n">datalist</span> <span class="o">=</span> <span class="n">J</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;docs&#39;</span><span class="p">]</span>
<span class="nb">type</span><span class="p">(</span><span class="n">datalist</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">datalist</span><span class="p">)</span>
</pre></div>
<pre class="literal-block">
(list, 54)
</pre>
<p><tt class="docutils literal">datalist</tt> is a list of the retrieved bibliographic entries.</p>
<div class="highlight"><pre><span></span><span class="n">datalist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
<pre class="literal-block">
[u'bibcode',
 u'keyword',
 u'pubdate',
 u'bibstem',
 u'property',
 u'aff',
 u'author',
 u'citation_count',
 u'pub',
 u'page',
 u'volume',
 u'database',
 u'doi',
 u'year',
 u'abstract',
 u'title',
 u'identifier',
 u'issue',
 u'id']
</pre>
<p>At this point, most of the remaining work is building up a nicely
formatted output. We'll start with a web-specific example, using HTML
unordered lists.</p>
<p>In this example, we'll make a list item that creates a hyperlink for the
author names and uses a reasonably standard bibliographic format:</p>
<pre class="literal-block">
Authors Month, Year, Journal
Title
</pre>
<div class="highlight"><pre><span></span><span class="n">fmt</span> <span class="o">=</span> <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;                &#39;</span>
<span class="sa">u</span><span class="s1">&#39;&lt;li&gt;&lt;a class=&quot;norm&quot; href=&quot;http://adsabs.harvard.edu/abs/</span><span class="si">{adsbibid}</span><span class="s1">&quot;&gt;</span><span class="si">{creator}</span><span class="s1">&lt;/a&gt;&#39;</span>
<span class="sa">u</span><span class="s1">&#39; </span><span class="si">{month}</span><span class="s1">, &lt;b&gt;</span><span class="si">{year}</span><span class="s1">&lt;/b&gt; </span><span class="si">{journal}</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="sa">u</span><span class="s1">&#39;                &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><span class="si">{titlestring}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
<p>We need to do a little data wrangling to get the individual JSON entries
into the appropriate format:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">wrangle</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">authorname</span><span class="o">=</span><span class="s1">&#39;Ginsburg&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Create new fields from the input data to insert into the format string &quot;&quot;&quot;</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pubdate&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
    <span class="c1"># Generally, the last identifier is the published version,</span>
    <span class="c1"># while the first is an arXiv identifier</span>
    <span class="c1"># (data[&#39;identifier&#39;] is a list)</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;adsbibid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;identifier&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># data[&#39;title&#39;] &amp; [&#39;pub&#39;] are also lists</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;titlestring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;journal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;bibstem&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># This trick bolds my name in the list of authors</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;b&gt;</span><span class="si">{}</span><span class="s1">&lt;/b&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">authorname</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">]]</span>
    <span class="c1"># Separate names by semicolons</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;creator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
<p>The return from <tt class="docutils literal">wrangle</tt> is a dict with new keys that match the
keywords in the format string. The python <tt class="docutils literal">string.format</tt> method will
nicely ignore any extra keywords that we're uninterested in.</p>
<div class="highlight"><pre><span></span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">wrangle</span><span class="p">(</span><span class="n">datalist</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
<pre class="literal-block">
u'                &lt;li&gt;&lt;a class=&quot;norm&quot; href=&quot;<a class="reference external" href="http://adsabs.harvard.edu/abs/2013ApJ...773..102F">http://adsabs.harvard.edu/abs/2013ApJ...773..102F</a>&quot;&gt;Fallscheer, C.; Reid, M. A.; Di Francesco, J.; Martin, P. G.; Hill, T.; Hennemann, M.; Nguyen-Luong, Q.; Motte, F.; Men'shchikov, A.; Andrxe9, Ph.; Ward-Thompson, D.; Griffin, M.; Kirk, J.; Konyves, V.; Rygl, K. L. J.; Sadavoy, S.; Sauvage, M.; Schneider, N.; Anderson, L. D.; Benedettini, M.; Bernard, J. -P.; Bontemps, S.; &lt;b&gt;Ginsburg, A.&lt;/b&gt;; Molinari, S.; Polychroni, D.; Rivera-Ingraham, A.; Roussel, H.; Testi, L.; White, G.; Williams, J. P.; Wilson, C. D.; Wong, M.; Zavagno, A.&lt;/a&gt; 08, &lt;b&gt;2013&lt;/b&gt; ApJn                &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Herschel Reveals Massive Cold Clumps in NGCxa07538'
</pre>
<p>Now to show it in the notebook...</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">IPython.display</span>
<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">wrangle</span><span class="p">(</span><span class="n">datalist</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
</pre></div>
<p>You can make a complete bibliography by looping over a few entries. The
ordered list (<tt class="docutils literal">&lt;ol&gt;</tt>) tag makes a numbered list.</p>
<div class="highlight"><pre><span></span><span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&lt;ol&gt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">wrangle</span><span class="p">(</span><span class="n">datalist</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;&lt;/ol&gt;&quot;</span>
<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</pre></div>
<p>If you want to make sure you only include refereed articles, use the
'property' tag.</p>
<div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">[</span><span class="s1">&#39;REFEREED&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datalist</span><span class="p">]</span>
</pre></div>
<pre class="literal-block">
[True, False, True, False, False, False, True, True, False, False, False, False, True, True, True, False, False, True, True, False, False, True, True, True, False, False, False, False, True, False, False, True, True, True, True, True, True, False, False, False, False, False, False, True, True, False, False, False, False, False, True, False, False, True]
</pre>
<p>And don't forget that you can also include the citation count:</p>
<div class="highlight"><pre><span></span><span class="nb">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;citation_count&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datalist</span>
                <span class="k">if</span> <span class="s1">&#39;citation_count&#39;</span> <span class="ow">in</span> <span class="n">d</span> <span class="ow">and</span> <span class="s1">&#39;REFEREED&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]])</span>
</pre></div>
<pre class="literal-block">
Fallscheer, C. 2013: 0
Ellsworth-Bowers, Timothy P. 2013: 2
Smith, Nathan 2013: 0
Harvey, Paul M. 2013: 2
Bressert, E. 2012: 10
Ginsburg, A. 2012: 11
Bally, John 2012: 0
Ginsburg, Adam 2011: 5
Battersby, C. 2011: 22
Schlingman, Wayne M. 2011: 17
Ginsburg, Adam 2011: 6
van Aarle, E. 2011: 12
Aguirre, James E. 2011: 72
Bally, John 2010: 36
Battersby, Cara 2010: 30
Yan, Chi-Hung 2010: 5
Bally, J. 2010: 20
Dunham, Miranda K. 2010: 27
Rosolowsky, Erik 2010: 80
Ginsburg, Adam G. 2009: 10
Rubin, D. 2009: 23
van de Steene, G. C. 2008: 4
Golitsyn, G. S. 1985: 4
</pre>
<div class="section" id="wishlist">
<h2>Wishlist</h2>
<p>There are a few other features that would be nice to add to the CV, but
some are not yet well-supported.</p>
<ol class="arabic simple">
<li>You can get the full name, but right now not the short name
('bibstem'), of the journal</li>
<li>The bibtex entry is important for generating tex versions of CVs.
Currently, it is not possible to completely reproduce one, largely
because of point #1.</li>
</ol>
<p>However, the ADS folks will certainly change this soon. You can find out
if they have by querying their API settings. If the query below returns
&quot;True&quot;, then you can access the bibstem.</p>
<p>UPDATE 9/23/2013: Jay Luker &#64;ADS <a class="reference external" href="https://twitter.com/lbjay/status/382138570632204291">added 'bibstem' to the allowed return
entries</a></p>
<div class="highlight"><pre><span></span><span class="n">permissions_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;http://adslabs.org/adsabs/api/settings/&#39;</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dev_key&#39;</span><span class="p">:</span><span class="n">get_dev_key</span><span class="p">()})</span>
<span class="n">permissions</span> <span class="o">=</span> <span class="n">permissions_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="s1">&#39;bibstem&#39;</span> <span class="ow">in</span> <span class="n">permissions</span><span class="p">[</span><span class="s1">&#39;allowed_fields&#39;</span><span class="p">]</span>
</pre></div>
<pre class="literal-block">
True
</pre>
<p>In the meantime, you can get most of the way there. We'll create
&quot;Article&quot; entries for any articles or eprints and ignore abstracts
(e.g., conference abstracts). I don't have any books, but for others
that might be useful.</p>
<p>The approach we'll use is also a good way to reject unwanted articles in
the HTML bibliography above.</p>
<div class="highlight"><pre><span></span><span class="n">bibfmt</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;&quot;&quot;@article{{</span><span class="si">{tagname}</span><span class="s2">,</span>
<span class="s2">abstract={{</span><span class="si">{abstract}</span><span class="s2">}},</span>
<span class="s2">author={{</span><span class="si">{bibtexauthors}</span><span class="s2">}},</span>
<span class="s2">month={{</span><span class="si">{month}</span><span class="s2">}},</span>
<span class="s2">pages={{</span><span class="si">{page}</span><span class="s2">}},</span>
<span class="s2">title={{</span><span class="si">{titlestring}</span><span class="s2">}},</span>
<span class="s2">year={{</span><span class="si">{year}</span><span class="s2">}},</span>
<span class="s2">volume={{</span><span class="si">{volume}</span><span class="s2">}},</span>
<span class="s2">journal={{</span><span class="se">\\</span><span class="si">{lowercasejournal}</span><span class="s2">}}</span>
<span class="s2">}}&quot;&quot;&quot;</span>
</pre></div>
<p>Of course, it's necessary to wrangle the data again for the appropriate
author list formatting for bibtex:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">wrangleauthors</span><span class="p">(</span><span class="n">authorlist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Fit the author list into a bibtex-friendly format.</span>
<span class="sd">    Not the cleanest hack, since we need to allow for single-name</span>
<span class="sd">    authors (e.g., astropy collaboration, Planck collaboration, etc.)</span>
<span class="sd">    The triple braces are needed because TeX uses them&quot;&quot;&quot;</span>
    <span class="n">splita</span> <span class="o">=</span> <span class="p">[[</span><span class="n">b</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">authorlist</span><span class="p">]</span>
    <span class="n">bracketed</span> <span class="o">=</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;{{</span><span class="si">{}</span><span class="s1">}}, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;~&quot;</span><span class="p">))</span>
                 <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                 <span class="k">else</span> <span class="sa">u</span><span class="s1">&#39;{{</span><span class="si">{}</span><span class="s1">}}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                 <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">splita</span><span class="p">]</span>
    <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot; and &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bracketed</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">wrangleauthors</span><span class="p">(</span><span class="n">datalist</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;author&#39;</span><span class="p">])</span>
</pre></div>
<pre class="literal-block">
u&quot;{Fallscheer}, C. and {Reid}, M.~A. and {Di Francesco}, J. and {Martin}, P.~G. and {Hill}, T. and {Hennemann}, M. and {Nguyen-Luong}, Q. and {Motte}, F. and {Men'shchikov}, A. and {Andrxe9}, Ph. and {Ward-Thompson}, D. and {Griffin}, M. and {Kirk}, J. and {Konyves}, V. and {Rygl}, K.~L.~J. and {Sadavoy}, S. and {Sauvage}, M. and {Schneider}, N. and {Anderson}, L.~D. and {Benedettini}, M. and {Bernard}, J.~-P. and {Bontemps}, S. and {Ginsburg}, A. and {Molinari}, S. and {Polychroni}, D. and {Rivera-Ingraham}, A. and {Roussel}, H. and {Testi}, L. and {White}, G. and {Williams}, J.~P. and {Wilson}, C.~D. and {Wong}, M. and {Zavagno}, A.&quot;
</pre>
<p>Now we can start looping through, performing checks for article status,
and making bibentries. We'll use python's <tt class="docutils literal">dateutils.parse</tt> to turn
month numbers into names</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dateutil.parser</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datalist</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;bibtexauthors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrangleauthors</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">])</span>

    <span class="c1"># pubdates don&#39;t include days, and sometimes don&#39;t include months,</span>
    <span class="c1"># so we have to be careful</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;pubdate&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%B&quot;</span><span class="p">)</span>
                  <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;pubdate&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;00&#39;</span>
                  <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># To make the standard macros, e.g. \apj, \aa</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;lowercasejournal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;bibstem&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c1"># list -&gt; string</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;titlestring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># need to make sure there is something to put in the volume field</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;volume&#39;</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># tagname is [First author&#39;s last name][year]</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;tagname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">bibdata</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datalist</span><span class="p">:</span>
    <span class="k">if</span> <span class="s1">&#39;ARTICLE&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;EPRINT&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]:</span>
        <span class="n">bibdata</span> <span class="o">+=</span> <span class="n">bibfmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
</pre></div>
<p>Now this data can be saved to a bibliography file and parsed by LaTeX.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">codecs</span> <span class="c1"># for writing unicode</span>

<span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;mypapers.bib&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bibdata</span><span class="p">)</span>
</pre></div>
<p>Future work:</p>
<ul class="simple">
<li>Verify the bibtex</li>
<li>Generate the CV LaTeX and compile it</li>
</ul>
</div>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/gps-data-analysis.html" rel="bookmark" title="Permalink to GPS Data Analysis">
                    GPS Data Analysis</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2013-06-09T20:30:00-06:00"> 2013/06/09 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-keflavichgmailcom.html">Adam (keflavich@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>I've been running up the same mountain about a dozen times with a GPS on.  With
a little hacking, I was able to take the GPS data and normalize it to the same
start &amp; end points to see how well I did on different runs.</p>
<img alt="" src="https://keflavich.github.io/blog/images/sanitas_timevsdist.png" style="width: 800px;" />
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/hopkins-pdf-generalization.html" rel="bookmark" title="Permalink to Hopkins PDF Generalization">
                    Hopkins PDF Generalization</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2013-06-04T15:00:00-06:00"> 2013/06/04 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-keflavichgmailcom.html">Adam (keflavich@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p><a class="reference external" href="http://adsabs.harvard.edu/abs/2013MNRAS.430.1880H">Hopkins 2013</a> presents a non-lognormal form of the probability distribution
function of density in turbulence, depending primarily on a parameter
<span class="math">\(T\)</span>.  I examine some of its properties here.  All of the equations shown
on this page are implemented in <a class="reference external" href="https://github.com/keflavich/turbulence_pdfs">https://github.com/keflavich/turbulence_pdfs</a>,
in particular the functions <tt class="docutils literal">moments_theoretical_hopkins</tt> and <tt class="docutils literal">moments</tt> in
<a class="reference external" href="https://github.com/keflavich/turbulence_pdfs/blob/master/hopkins_pdf.py">hopkins_pdf.py</a>.</p>
<p>The conservation equations, conservation of probability and mass</p>
<div class="math">
\begin{equation*}
\int_{-\infty}^\infty P_V(\ln \rho) d \ln \rho \equiv 1
\end{equation*}
</div>
<div class="math">
\begin{equation*}
\int_{-\infty}^\infty\rho P_V(\ln \rho) d \ln \rho \equiv \rho_0 = 1
\end{equation*}
</div>
<p><span class="math">\(\rho_0=1\)</span> is the definition used by <a class="reference external" href="http://adsabs.harvard.edu/abs/2013MNRAS.430.1880H">Hopkins 2013</a>.  Part of the goal
of this document is to generalize to <span class="math">\(\rho_0 &lt;&gt; 1\)</span></p>
<p>The most important thing to do is determine the values of the moments of the
distribution, including the integral corrections for the Dirac Delta function
component of the PDF.</p>
<div class="section" id="the-pdf">
<h2>The PDF</h2>
<p>The full form of the Hopkins PDF is</p>
<div class="math">
\begin{equation*}
P_V(\ln \rho/\rho_0) d \ln \rho =  \left[I_1(2\sqrt{\lambda u}) e^{-\lambda-u} \sqrt{\frac{\lambda}{u}} + e^{-\lambda} \delta(u)\right]du
\end{equation*}
</div>
<p>The mass-weighted PDF is</p>
<div class="math">
\begin{equation*}
P_M(\ln \rho/\rho_0) d \ln \rho =  \frac{\rho}{\rho_0} \left[I_1(2\sqrt{\lambda u}) e^{-\lambda-u} \sqrt{\frac{\lambda}{u}} + e^{-\lambda} \delta(u)\right]du
\end{equation*}
</div>
<p>With definitions:</p>
<div class="math">
\begin{equation*}
u\equiv \frac{\lambda}{1+T} - \frac{\ln \rho/\rho_0}{T}  ;  (u \geq 0)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
\lambda \equiv \frac{S_{\ln \rho,V}}{2 T^2}
\end{equation*}
</div>
<p>The ratio <span class="math">\(\rho/\rho_0\)</span> is needed to ensure self-consistency: the mass
PDF must also conserve probability, which means it must be scaled by
<span class="math">\(1/\rho_0\)</span>.</p>
<p>These distributions are slightly different than those shown in <a class="reference external" href="http://adsabs.harvard.edu/abs/2013MNRAS.430.1880H">Hopkins 2013</a>.
The <span class="math">\(m=0\)</span> term in the summation version of the PDF yields a Dirac
<span class="math">\(\delta\)</span> function in the integral form of the PDF.  To quote Phil:</p>
<pre class="literal-block">
If you check, the summation expression is exact, and does exactly integrate
to unity (and properly conserve mass) for any value of T or lambda (with
u&gt;0). But this is with the implicit understanding that the gamma-function
distribution with exponent &quot;m&quot; should be taken to go to a delta-function
about u=0 when m=0 (since otherwise it is ill defined; and physically this
is the &quot;no event/multiplication&quot; case, so that's the only allowed case for
the term in u).
</pre>
<!-- But note that both of these distributions can depend on :math:`\rho_0`, changing :math:`u` to be -->
<!--  -->
<!-- .. math:: u\equiv \frac{\lambda}{1+T} - \frac{\ln (\rho/\rho_0)}{T}  ;  (u \geq 0) -->
<div class="section" id="moment-equations">
<h3>Moment equations</h3>
<p>The important moments are the mean and variance of the volume and mass density
probability distribution and the volume and mass <em>log</em>-density probability
distribution.</p>
<p>The definitions used here are <span class="math">\(E[\rho] \equiv &lt;\rho&gt;_V\)</span>, etc.  The
variance is computed as <span class="math">\(V[x]=E[x^2]-E[x]^2\)</span>, which means we'll need to
compute the moments of various combinations of variables.</p>
<p>Also, <span class="math">\(S_{\ln \rho,V} \equiv V[\ln \rho_V]\)</span></p>
<div class="math">
\begin{equation*}
&lt;\rho&gt;_V \equiv \rho_0 \equiv \int_{-\infty}^{\infty} \rho P_V(\ln \rho/\rho_0) d \ln \rho
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\ln \rho&gt;_V \equiv \int_{-\infty}^{\infty} \ln \rho P_V(\ln \rho/\rho_0) d \ln \rho
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\rho&gt;_M \equiv \int_{-\infty}^{\infty} \rho (\rho P_V(\ln \rho/\rho_0)) d \ln \rho
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\ln \rho&gt;_M \equiv \int_{-\infty}^{\infty} \ln \rho (\rho P_V(\ln \rho/\rho_0)) d \ln \rho
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\rho^3&gt;_V \equiv \int_{-\infty}^{\infty} \rho^3 P_V(\ln \rho/\rho_0) d \ln \rho
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\ln^2 \rho&gt;_V \equiv \int_{-\infty}^{\infty} (\ln \rho)^2 P_V(\ln \rho/\rho_0)d \ln \rho
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\ln^2 \rho&gt;_M \equiv \int_{-\infty}^{\infty} (\ln \rho)^2 \rho P_V(\ln \rho/\rho_0)d \ln \rho
\end{equation*}
</div>
<p>In the moment equations, only the input to the PDF is scaled by a mean density
<span class="math">\(\rho_0\)</span>; the &quot;weighting factors&quot; for the expectation value are not
(i.e., we are measuring <span class="math">\(E[\rho]\)</span>, not <span class="math">\(E[\rho/rho_0]\)</span>).</p>
</div>
<div class="section" id="delta-terms">
<h3>Delta terms</h3>
<p>These can be integrated analytically.  In this section, I am just computing the
means; the variances are more complicated.</p>
<div class="math">
\begin{equation*}
&lt;\rho&gt;_V \equiv \rho_0 \equiv \int_{-\infty}^{\infty} \rho e^{-\lambda} \delta(\frac{\lambda}{1+T} - \frac{\ln\rho/\rho_0}{T}) \frac{d \ln \rho}{T}
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\ln \rho&gt;_V \equiv \int_{-\infty}^{\infty} \ln \rho e^{-\lambda} \delta(\frac{\lambda}{1+T} - \frac{\ln\rho/\rho_0}{T}) \frac{d \ln \rho}{T}
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\rho&gt;_M \equiv \int_{-\infty}^{\infty} \rho (\frac{\rho}{\rho_0} e^{-\lambda} \delta(\frac{\lambda}{1+T} - \frac{\ln\rho/\rho_0}{T})) \frac{d \ln \rho}{T}
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\ln \rho&gt;_M \equiv \int_{-\infty}^{\infty} \ln \rho (\frac{\rho}{\rho_0} e^{-\lambda} \delta(\frac{\lambda}{1+T} - \frac{\ln\rho/\rho_0}{T})) \frac{d \ln \rho}{T}
\end{equation*}
</div>
<p>Substitution: <span class="math">\(v=\frac{\ln \rho/\rho_0}{T}\)</span>,
<span class="math">\(dv = \frac{1}{T} d \ln \rho\)</span>, <span class="math">\(\rho=\rho_0 e^{v*T}\)</span>, <span class="math">\(\ln \rho = v T + \ln \rho_0\)</span></p>
<div class="math">
\begin{equation*}
&lt;\rho&gt;_{V\delta} \equiv \rho_0 \equiv \int_{-\infty}^{\infty} \rho_0 e^{vT} e^{-\lambda} \delta(\frac{\lambda}{1+T} - v) d v
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\ln \rho&gt;_{V\delta} \equiv \int_{-\infty}^{\infty} (vT + \ln \rho_0) e^{-\lambda} \delta(\frac{\lambda}{1+T} - v) d v
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\rho&gt;_{M\delta} \equiv \int_{-\infty}^{\infty} \rho_0 e^{2vT} ( e^{-\lambda} \delta(\frac{\lambda}{1+T} - v)) d v
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\ln \rho&gt;_{M\delta} \equiv \int_{-\infty}^{\infty} (vT + \ln \rho_0) e^{vT} ( e^{-\lambda} \delta(\frac{\lambda}{1+T} - v)) d v
\end{equation*}
</div>
<p>Solutions:</p>
<div class="math">
\begin{equation*}
&lt;\rho&gt;_{V\delta} =  \rho_0 \exp\left[\frac{T \lambda }{1+T} - \lambda\right] =  \rho_0 \exp\left[-\lambda \frac{1}{1+T}\right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\ln \rho&gt;_{V\delta} =  e^{-\lambda} \frac{\lambda T}{1+T} + e^{-\lambda} \ln \rho_0
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\rho&gt;_{M\delta} =  \rho_0 \exp\left[\frac{2 T \lambda }{1+T} - \lambda\right] = \rho_0 \exp\left[\lambda\frac{T-1}{T+1}\right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\ln \rho&gt;_{M\delta} = \left( \frac{\lambda T}{1+T} + \ln \rho_0 \right) \exp\left[\frac{T \lambda }{1+T} - \lambda\right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \left( \frac{\lambda T}{1+T} + \ln \rho_0 \right) \exp\left[\frac{ -\lambda }{T+1}\right]
\end{equation*}
</div>
<p>(for these next 3, I skipped intermediate steps)</p>
<div class="math">
\begin{equation*}
&lt;\rho^3&gt;_{V\delta} =  \rho_0^2 \exp\left[\frac{3 T \lambda }{1+T} - \lambda\right] = \rho_0^2 \exp\left[\lambda\frac{2T-1}{T+1}\right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\ln^2 \rho&gt;_{M\delta} = \left( \frac{\lambda T}{1+T} + \ln \rho_0 \right)^2 \exp\left[\frac{ -\lambda }{T+1}\right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
&lt;\ln^2 \rho&gt;_{V\delta} = \left( \frac{\lambda T}{1+T} + \ln \rho_0 \right)^2 e^{-\lambda}
\end{equation*}
</div>
<p>Using <span class="math">\(\rho_0=1\)</span> as defined in <a class="reference external" href="http://adsabs.harvard.edu/abs/2013MNRAS.430.1880H">Hopkins 2013</a> simplifies all of these a great deal.</p>
</div>
<div class="section" id="pdf-integrals">
<h3>PDF Integrals</h3>
<p>These cannot be integrated analytically.</p>
<p>However, we can work from a few simple mathematica/sympy results:</p>
<div class="math">
\begin{equation*}
\int_0^\infty I_1(x) e^{-x^2/(4L)} dx = e^L - 1
\end{equation*}
</div>
<div class="math">
\begin{equation*}
\int_0^\infty x^2 I_1(x) e^{-x^2/(4L)} dx = 4 L^2 * e^L
\end{equation*}
</div>
<div class="math">
\begin{equation*}
\int_0^\infty x^4 I_1(x) e^{-x^2/(4L)} dx = 16 L^3 (L+2) * e^L
\end{equation*}
</div>
<p>We use <span class="math">\(L\)</span> instead of <span class="math">\(\lambda\)</span> in these equations because it is often substituted in later equations.</p>
<div class="section" id="expectation-value-of-the-volume-weighted-density-e-rho">
<h4>Expectation Value of the Volume-Weighted Density <span class="math">\(E[\rho]\)</span></h4>
<div class="math">
\begin{equation*}
E[\rho] \equiv \int \rho P_v(\ln \rho/\rho_0) d \ln \rho = \int \rho \left[I_1(2\sqrt{\lambda u}) e^{-\lambda-u} \sqrt{\frac{\lambda}{u}} + e^{-\lambda} \delta(u)\right]du
\end{equation*}
</div>
<p>To get to the form of the above equations, we use the substitution</p>
<div class="math">
\begin{equation*}
x = 2\sqrt{\lambda u}
\end{equation*}
</div>
<p>which gives us <span class="math">\(\rho\)</span> in terms of <span class="math">\(x\)</span>:</p>
<div class="math">
\begin{equation*}
\rho = \rho_0 \exp\left[T\left(-\frac{x^2}{4\lambda} + \frac{\lambda}{1+T}\right)\right]
\end{equation*}
</div>
<p>and leads to the rearrangement:</p>
<div class="math">
\begin{equation*}
E[\rho] = \int \rho_0 \exp\left[T\left(-\frac{x^2}{4\lambda} + \frac{\lambda}{1+T}\right)\right] \left[I_1(x) e^{-x^2/(4\lambda)-\lambda} \right]dx + \rho_0 \exp\left(- \frac{\lambda}{1+T}\right)
\end{equation*}
</div>
<p>where the rightmost term is kept from the first moment above.  The integral
term can straightforwardly be broken apart into equations of the form shown
above.</p>
<div class="math">
\begin{equation*}
L \rightarrow \frac{\lambda}{1+T}
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E[\rho] = \rho_0 \left[ \exp \left(-\lambda+\frac{T\lambda}{1+T}\right) \int  \left[I_1(x) e^{-x^2/(4L)} \right]dx +\exp\left(- \frac{\lambda}{1+T}\right) \right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \rho_0 \left[ \exp \left(-\lambda+\frac{T\lambda}{1+T}\right)(e^L-1)  +\exp\left(- \frac{\lambda}{1+T}\right) \right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \rho_0 \left[ \exp \left(-\lambda+\frac{T\lambda}{1+T}\right)(e^{\lambda/1+T}-1)  +\exp\left(- \frac{\lambda}{1+T}\right) \right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \rho_0 \left[ e^{-\lambda/(1+T)}(e^{\lambda/1+T}-1)  +\exp\left(- \frac{\lambda}{1+T}\right) \right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \rho_0
\end{equation*}
</div>
<p>The same general approach can be followed for all expectation values, but we'll skip the detailed algebra.</p>
</div>
<div class="section" id="variance-of-the-volume-weighted-density-v-rho-s-ln-rho-v">
<h4>Variance of the Volume-Weighted Density <span class="math">\(V[\rho]=S_{\ln \rho,V}\)</span></h4>
<div class="math">
\begin{equation*}
V[\rho] = E[\rho^2] - E[\rho]^2 = \rho_0^2 \left[  \exp\left(\lambda\frac{2 T^2}{1+3T+2T^2}\right) - 1 \right]
\end{equation*}
</div>
<p>However, the &quot;correction factor&quot; is still important:</p>
<div class="math">
\begin{equation*}
V_\delta[\rho] = \rho_0^2 \left[ \exp\left(\lambda\frac{T-1}{T+1}\right) - \exp\left(-2\frac{\lambda}{1+T}\right) \right]
\end{equation*}
</div>
</div>
<div class="section" id="expectation-value-of-the-mass-weighted-density-e-m-rho">
<h4>Expectation Value of the Mass-Weighted Density <span class="math">\(E_M[\rho]\)</span></h4>
<p>Start from halfway through <span class="math">\(E[\rho]\)</span>, simply adding a factor of 2 in the exponent:</p>
<div class="math">
\begin{equation*}
E_M[\rho] = \int \rho_0 \exp\left[2T\left(-\frac{x^2}{4\lambda} + \frac{\lambda}{1+T}\right)\right] \left[I_1(x) e^{-x^2/(4\lambda)-\lambda} \right]dx + \rho_0 \exp\left(- \frac{\lambda(T-1)}{1+T}\right)
\end{equation*}
</div>
<p>Follow the same math, with <span class="math">\(L=\frac{\lambda}{1+2T}\)</span></p>
<div class="math">
\begin{equation*}
= \rho_0 \left[ \exp \left(-\lambda+\frac{2T\lambda}{1+T}\right)(e^L-1)  +\exp\left(- \frac{\lambda(T-1)}{1+T}\right) \right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \rho_0 \left[ \exp \left(\frac{(T-1)\lambda}{1+T}\right)(e^{\lambda/(1+2T)}-1)  +\exp\left(- \frac{\lambda}{1+T}\right) \right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_M[\rho] = \rho_0 \left[ \exp\left(\lambda\frac{2 T^2}{1+3T+2T^2}\right) - \exp\left(\lambda\frac{T-1}{T+1}\right) + \exp\left(\lambda\frac{T-1}{T+1}\right) \right]
\end{equation*}
</div>
<p>The right 2 terms cancel, yielding the value shown in Equation 7 of <a class="reference external" href="http://adsabs.harvard.edu/abs/2013MNRAS.430.1880H">Hopkins 2013</a>
scaled by <span class="math">\(\rho_0^2\)</span>.  However, the right-most term is the
correction factor from the Dirac Delta term needed to correct any
numerical computation of the mass-weighted density.</p>
<div class="math">
\begin{equation*}
E_{\delta,M}[\rho] = \exp\left(\lambda\frac{T-1}{T+1}\right)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_M[\rho] = \rho_0  \exp\left(\lambda\frac{2 T^2}{1+3T+2T^2}\right)
\end{equation*}
</div>
</div>
<div class="section" id="expectation-value-of-the-mass-weighted-density-squared-e-m-rho-2">
<h4>Expectation Value of the Mass-Weighted Density Squared <span class="math">\(E_M[\rho^2]\)</span></h4>
<div class="math">
\begin{equation*}
E_M[\rho^2] = \int \rho^2 \frac{\rho}{\rho_0} e^{-\lambda} \left[I_1(x) e^{-x^2/(4\lambda)} \right]dx + \int \rho^2 \frac{\rho}{\rho_0} e^{-\lambda} \delta(u) du
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{\delta,M}[\rho^2] = \rho_0^2 \exp\left[\lambda\frac{2T-1}{T+1}\right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{left}[\rho^2] = e^{-\lambda} \int
\rho_0^2 \exp\left[3T\left(-\frac{x^2}{4\lambda} + \frac{\lambda}{1+T}\right)\right]
\left[I_1(x) e^{-x^2/(4\lambda)} \right]
dx
\end{equation*}
</div>
<div class="math">
\begin{equation*}
 = \rho_0^2 \exp\left[\frac{(2T-1)\lambda}{1+T}\right]
\int I_1(x) e^{-(3T+1)x^2/(4\lambda)}  dx
\end{equation*}
</div>
<div class="math">
\begin{equation*}
 = \rho_0^2 \exp\left[\frac{(2T-1)\lambda}{1+T}\right]
\left( \exp\left[\frac{\lambda}{3T+1}\right] - 1\right)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \rho_0^2 \left(\exp\left[\frac{6\lambda T^2}{3T^2+4T+1}\right] - \exp\left[\frac{(2T-1)\lambda}{1+T}\right] \right)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{M}[\rho^2] = \rho_0^2 \exp\left[\frac{6\lambda T^2}{3T^2+4T+1}\right]
\end{equation*}
</div>
</div>
<div class="section" id="variance-of-the-mass-weighted-density-v-m-rho-e-m-rho-2-e-m-rho-2">
<h4>Variance of the Mass-Weighted Density <span class="math">\(V_M[\rho] = E_M[\rho^2] - E_M[\rho]^2\)</span></h4>
<p>Since correction factors are given for <span class="math">\(E_M[\rho^2]\)</span> and
<span class="math">\(E_M[\rho]\)</span>, they are not included separately here:</p>
<div class="math">
\begin{equation*}
V_M[\rho] = E_M[\rho^2] - E_M[\rho]^2
= \rho_0^2 \left( \exp\left[\frac{6\lambda T^2}{3T^2+4T+1}\right]
-\exp\left[\lambda\frac{4 T^2}{1+3T+2T^2}\right]
\right)
\end{equation*}
</div>
</div>
<div class="section" id="expectation-value-of-the-volume-weighted-log-density-e-ln-rho">
<h4>Expectation Value of the Volume-Weighted Log Density <span class="math">\(E[\ln \rho]\)</span></h4>
<div class="math">
\begin{equation*}
E[\ln \rho] = \int \ln \rho e^{-\lambda} \left[I_1(x) e^{-x^2/(4\lambda)} \right]dx + \int \ln \rho e^{-\lambda} \delta(u) du
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_\delta[\ln \rho] = e^{-\lambda} \left[ \frac{\lambda T}{1+T} + \ln \rho_0 \right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{left}[\ln \rho] = \int \left[\ln \rho_0 + T\left(-\frac{x^2}{4\lambda} + \frac{\lambda}{1+T}\right) \right] e^{-\lambda} \left[I_1(x) e^{-x^2/(4\lambda)} \right]dx
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= e^{-\lambda} \left( \int \left[\ln \rho_0 + \frac{T\lambda}{1+T}\right] \left[I_1(x) e^{-x^2/(4\lambda)} \right]dx
- \int \frac{T x^2}{4\lambda} \left[I_1(x) e^{-x^2/(4\lambda)} \right]dx \right)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= e^{-\lambda} \left( \int \left[\ln \rho_0 + \frac{T\lambda}{1+T}\right](e^{\lambda}-1)
- \frac{4 T \lambda^2 e^{\lambda}}{4\lambda} \right)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \left( \left[\ln \rho_0 + \frac{T\lambda}{1+T}\right](1-e^{-\lambda})
- T \lambda  \right)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E[\ln \rho] = \ln \rho_0 + \frac{T\lambda}{1+T} - T \lambda
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \ln \rho_0 - \frac{T^2\lambda}{1+T}
\end{equation*}
</div>
</div>
<div class="section" id="expectation-value-of-the-mass-weighted-log-density-e-m-ln-rho">
<h4>Expectation Value of the Mass-Weighted Log Density <span class="math">\(E_M[\ln \rho]\)</span></h4>
<div class="math">
\begin{equation*}
E_M[\ln \rho] = \int \ln \rho \frac{\rho}{\rho_0} e^{-\lambda} \left[I_1(x) e^{-x^2/(4\lambda)} \right]dx + \int \ln \rho \frac{\rho}{\rho_0} e^{-\lambda} \delta(u) du
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_\delta[\ln \rho] = \left( \frac{\lambda T}{1+T} + \ln \rho_0 \right) \exp\left[\frac{ -\lambda }{T+1}\right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{left}[\ln \rho] = e^{-\lambda} \int \left[
\left(\ln \rho_0 + T\left(-\frac{x^2}{4\lambda} + \frac{\lambda}{1+T}\right) \right)
\exp\left(T\left(-\frac{x^2}{4\lambda} + \frac{\lambda}{1+T}\right)\right) \right]
\left[I_1(x) e^{-x^2/(4\lambda)} \right]dx
\end{equation*}
</div>
<p>Again, separate into integrable terms:</p>
<div class="math">
\begin{equation*}
= \exp\left(\frac{T\lambda}{1+T} -\lambda\right) \left[
\left(\ln \rho_0 + \frac{T\lambda}{1+T} \right)  \left[I_1(x) e^{-(1+T)x^2/(4\lambda)} \right] +
\left(-\frac{Tx^2}{4\lambda} \right)  \left[I_1(x) e^{-(1+T)x^2/(4\lambda)} \right]
\right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
L = \frac{\lambda}{1+T}
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{left}[\ln \rho] = \exp\left(\frac{T\lambda}{1+T} -\lambda\right) \left[
\left(\ln \rho_0 + \frac{T\lambda}{1+T} \right)  \left(\exp\left[\frac{\lambda}{1+T}\right]-1\right) +
\left(-\frac{T}{4\lambda} \right)  \left(\frac{4  \lambda^2}{(1+T)^2}  \exp\left[\frac{\lambda}{1+T}\right]\right)
\right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{left}[\ln \rho] = \exp\left(\frac{-\lambda}{1+T}\right) \left[
\left(\ln \rho_0 + \frac{T\lambda}{1+T} \right)  \left(\exp\left[\frac{\lambda}{1+T}\right]-1\right) +
\left(-\frac{T}{4\lambda} \right)  \left(\frac{4  \lambda^2}{(1+T)^2}  \exp\left[\frac{\lambda}{1+T}\right]\right)
\right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{left}[\ln \rho] =
\left(\ln \rho_0 + \frac{T\lambda}{1+T} \right)  \left(1-\exp\left[\frac{-\lambda}{1+T}\right]\right) -
\left(\frac{ T \lambda}{(1+T)^2}  \right)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_M[\ln \rho] = \left(\ln \rho_0 + \frac{T\lambda}{1+T} \right) -
\left(\frac{ T \lambda}{(1+T)^2}  \right)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \ln \rho_0 + \frac{T^2\lambda}{(1+T)^2}
\end{equation*}
</div>
</div>
<div class="section" id="expectation-value-of-the-mass-weighted-log-density-squared-e-m-ln-2-rho">
<h4>Expectation Value of the Mass-Weighted Log Density Squared <span class="math">\(E_M[\ln^2 \rho]\)</span></h4>
<div class="math">
\begin{equation*}
E_M[\ln^2 \rho] = \int (\ln \rho)^2 \frac{\rho}{\rho_0} e^{-\lambda} \left[I_1(x) e^{-x^2/(4\lambda)} \right]dx + \int (\ln \rho)^2 \frac{\rho}{\rho_0} e^{-\lambda} \delta(u) du
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_\delta[\ln^2 \rho] = \left( \frac{\lambda T}{1+T} + \ln \rho_0 \right)^2 \exp\left[\frac{ -\lambda }{T+1}\right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{left}[\ln^2 \rho] = e^{-\lambda} \int \left[
\left(\ln \rho_0 + T\left(-\frac{x^2}{4\lambda} + \frac{\lambda}{1+T}\right) \right)^2
\exp\left(T\left(-\frac{x^2}{4\lambda} + \frac{\lambda}{1+T}\right)\right) \right]
\left[I_1(x) e^{-x^2/(4\lambda)} \right]dx
\end{equation*}
</div>
<p>This time it's just too ugly.  Define a new variable:</p>
<div class="math">
\begin{equation*}
Q = \ln \rho_0 + \frac{T\lambda}{1+T}
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{left}[\ln^2 \rho] = e^{-\lambda/(1+T)} \int \left[
\left(Q  -\frac{T x^2}{4\lambda} \right)^2
\exp\left(-\frac{Tx^2}{4\lambda} \right) \right]
\left[I_1(x) e^{-x^2/(4\lambda)} \right]dx
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{left}[\ln^2 \rho] = e^{-\lambda/(1+T)} \int \left[
\left(Q^2  - 2 Q \frac{T x^2}{4\lambda} + \frac{T^2 x^4}{16\lambda^2} \right)
\left[I_1(x) e^{-(1+T)x^2/(4\lambda)} \right]
\right]dx
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{left}[\ln^2 \rho] = e^{-\lambda/(1+T)}  \left[
Q^2 (e^{\lambda/(1+T)}-1)
- 2 Q \frac{T}{4\lambda} \left(\frac{4\lambda^2}{(1+T)^2} e^{\lambda/(1+T)}\right)
+ \frac{T^2}{16\lambda^2} \left(16 \frac{\lambda^3}{(1+T)^3} (\frac{\lambda}{1+T}+2) e^{\lambda/(1+T)} \right)
\right]
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_{left}[\ln^2 \rho] =
Q^2 (1-e^{-\lambda/(1+T)})
- 2 Q \frac{T\lambda}{(1+T)^2}
+ \frac{\lambda T^2}{(1+T)^3} \left(\frac{\lambda}{1+T}+2\right)
\end{equation*}
</div>
<p>Add back the <span class="math">\(\delta\)</span> termG</p>
<div class="math">
\begin{equation*}
E_M[\ln^2 \rho] =
Q^2
- 2 Q \frac{T\lambda}{(1+T)^2}
+ \frac{\lambda T^2}{(1+T)^3} \left(\frac{\lambda}{1+T}+2\right)
\end{equation*}
</div>
<p>Re-expand to see if it's simplifiable....</p>
<div class="math">
\begin{equation*}
E_M[\ln^2 \rho] =
\left(\ln \rho_0 + \frac{T\lambda}{1+T}\right)^2
- 2 \left(\ln \rho_0 + \frac{T\lambda}{1+T}\right) \frac{T\lambda}{(1+T)^2}
+ \frac{\lambda T^2}{(1+T)^3} \left(\frac{\lambda}{1+T}+2\right)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_M[\ln^2 \rho] =
\ln^2 \rho_0 + 2 \ln \rho_0 \frac{T\lambda}{1+T} + \frac{T^2\lambda^2}{(1+T)^2}
- 2 \ln \rho_0 \frac{T\lambda}{(1+T)^2} - 2 \frac{T\lambda}{1+T} \frac{T\lambda}{(1+T)^2}
+ 2 \frac{\lambda T^2}{(1+T)^3}
+ \frac{\lambda T^2}{(1+T)^3} \frac{\lambda}{1+T}
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_M[\ln^2 \rho] =
\ln^2 \rho_0 + 2 \ln \rho_0 \left(\frac{T\lambda}{1+T} - \frac{T\lambda}{(1+T)^2}\right)
+ \frac{T^2\lambda^2(1+T)}{(1+T)^3}
- 2 \frac{T^2\lambda^2}{(1+T)^3}
+ 2 \frac{\lambda T^2}{(1+T)^3}
+ \frac{\lambda^2 T^2}{(1+T)^4}
\end{equation*}
</div>
<div class="math">
\begin{equation*}
E_M[\ln^2 \rho] =
\ln^2 \rho_0 + 2 \ln \rho_0 \left(\frac{T^2\lambda}{1+T}\right)
+ \frac{T^2\lambda^2(1+T)}{(1+T)^3}
- 2 \frac{T^2\lambda^2}{(1+T)^3}
+ 2 \frac{\lambda T^2}{(1+T)^3}
+ \frac{\lambda^2 T^2}{(1+T)^4}
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \ln^2 \rho_0 + 2 \ln \rho_0 \frac{T^2 \lambda}{(1+T)^2}
+ \left(\frac{\lambda T^2}{(1+T)^2}\right)^2
+ \frac{2\lambda T^2}{(1+T)^3}
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \left(\ln \rho_0 + \frac{T^2\lambda}{(1+T)^2}\right)^2 +
\frac{2\lambda T^2}{(1+T)^3}
\end{equation*}
</div>
<p>As expected, we recover the correct relation from <a class="reference external" href="http://adsabs.harvard.edu/abs/2013MNRAS.430.1880H">Hopkins 2013</a>:</p>
<div class="math">
\begin{equation*}
S_{\ln \rho,M} = E_M[\ln \rho^2] - E_M[\ln \rho]^2 =
\ln^2 \rho_0 + 2 \ln \rho_0 \frac{T^2 \lambda}{(1+T)^2}
+ \left(\frac{\lambda T^2}{(1+T)^2}\right)^2 + \frac{2\lambda T^2}{(1+T)^3}
- \left(\ln \rho_0 + \frac{T^2\lambda}{(1+T)^2}\right)^2
\end{equation*}
</div>
<div class="math">
\begin{equation*}
= \frac{2\lambda T^2}{(1+T)^3}
\end{equation*}
</div>
<p><em>independent</em> of <span class="math">\(\rho_0\)</span>.</p>
<div class="section" id="properties-of-the-hopkins-pdf">
<h5>Properties of the Hopkins PDF</h5>
<p>I began this investigation in order to find out whether a different parameter,
i.e. something related to the compressiveness of the turbulent driving, could
be responsible for the &quot;discrepancy&quot; between the Formaldehyde-derived density
and the volume-averaged density of some clouds.</p>
<p>I naively expected that, in compressive turbulence, more of the mass will be
concentrated at higher density, which should drive up the mass-weighted mean
density.</p>
<p><a class="reference external" href="http://adsabs.harvard.edu/abs/2013MNRAS.430.1880H">Hopkins 2013</a> showed that <span class="math">\(T\sim\mathcal{M}_C\)</span>.  If this is taken on
face value, without recognizing the relation between <span class="math">\(T\)</span> and
<span class="math">\(\sigma\)</span>, it means that for <em>fixed</em> <span class="math">\(\sigma\)</span>,
<span class="math">\(&lt;\rho&gt;_M\propto e^{-T^2}\)</span>.</p>
<p>This figure shows the relation of the various moments and <span class="math">\(T\)</span>.  The plots
show both the &quot;theoretical&quot; result (i.e., doing the integral by hand) and the
numerical result with 50,000 data points plus a correction for the
<span class="math">\(\delta\)</span> terms; the agreement is essentially perfect excepting some
numerical noise (the only visible discrepancy is for a perfect lognormal at
high <span class="math">\(\sigma_V\)</span>):</p>
<img alt="" src="https://keflavich.github.io/blog/images/rho1_varyT_colorSigma.png" style="width: 800px;" />
<p>However, <a class="reference external" href="http://adsabs.harvard.edu/abs/2013MNRAS.430.1880H">Hopkins 2013</a> also found that simulations generally produced
<span class="math">\(T\sim0.1\sigma_{s,M}^2\)</span> (though a relation of the form <span class="math">\(T\sim 0.25
\ln(1+0.25\sigma_{s,M}^4)\)</span> is also a good fit).</p>
<p>If you use the simpler of these relations, the expected relationship (mean mass
increasing with increasing &quot;compressiveness&quot;) is recovered.  However, it comes
with an increasing <span class="math">\(\sigma_s\)</span>.  In these plots, half are labeled with
<span class="math">\(\sigma\)</span> and the others are labeled with <span class="math">\(T\)</span>, though the two are
equivalent.  The highest <span class="math">\(\sigma_s\)</span> observed in any of the simulations
shown in <a class="reference external" href="http://adsabs.harvard.edu/abs/2013MNRAS.430.1880H">Hopkins 2013</a> was about <span class="math">\(\sigma_s=4\)</span> (marked with a black
square below), so the maximum <span class="math">\(\rho_M/\rho_V \sim 10^2\)</span>.</p>
<img alt="" src="https://keflavich.github.io/blog/images/TSigma.png" style="width: 800px;" />
</div>
</div>
</div>
</div>
<script type='text/javascript'>if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script> </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/bgps-point-source-recovery-experiment-23-results.html" rel="bookmark" title="Permalink to BGPS Point Source Recovery - Experiment 23 results">
                    BGPS Point Source Recovery - Experiment 23 results</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2013-05-20T14:45:00-06:00"> 2013/05/20 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-keflavichgmailcom.html">Adam (keflavich@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>Experiment 23, run in mid-May 2013, created power-law synthetic astrophysical
sky maps with added point sources in order to examine the pipeline + bolocat's
ability to recover point source flux densities accurately.</p>
<p>For the purpose of the BGPS v2 paper, this data is incorporated into Section
5.3: the angular transfer function and comparison with other data sets.</p>
<p>The parameter space explored includes 3 steps in power-spectrum background,
$\alpha_{ps}=1,1.5,2$, which is the major parameter being explored.  A
background with $\alpha_{ps}=2$ is approximately what we measure in both HiGal
and the reproduced regions of the BGPS power-spectrum, so it's probably the
most realistic, but it is also very bad for the pipeline: most of the power is
on the largest angular scales.  $\alpha_{ps}=1$, on the other hand,
beautifully creates point-source-like structures.</p>
<p>These two images show the results of $\alpha_{ps}=2$ and $\alpha_{ps}=1$
skies respectively with faint point sources on top.  The point sources are more
pointy and stick out more in the $\alpha_{ps}=1$ situation, but the
$\alpha_{ps}=1$ map also looks more generally point-like, so there is greater
confusion.  If you believe that there are genuine point sources in the 1.1 mm
maps, the $\alpha_{ps}=1$ would actually be very difficult to deal with since
many extracted sources would actually be part of the background.</p>
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/exp23_faint_ds2_astrosky_arrang45_atmotest_amp5.0E-05_sky-2.0_seed00_peak5.0E-03_smooth_withptsrc_label_compare.png" style="width: 800px;" />
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/exp23_faint_ds2_astrosky_arrang45_atmotest_amp5.0E-05_sky-1.0_seed00_peak5.0E-03_smooth_withptsrc_label_compare.png" style="width: 800px;" />
<p>We also explored two different sets of source brightnesses, 0.1-1 and 1-10
Jy/beam, uniformly distributed.  We picked a high source density, 500 in a
512x512 pixel map, to get decent source extraction statistics - the crowding is
still fairly low and does not significantly affect the extracted source
properties (only a few source overlap with others).  The bright sources are
obviously better-recovered than the faint, with good recovery for all of the
backgrounds explored.  The faint sources, on the other hand, were fairly
sensitive to the background.</p>
<p>The background levels used were $\sim1,2,10$ Jy/beam at the peak for the
$\alpha=2$ maps (they were lower for the other power-laws, so those will be
ignored from now on).  As described in the paper, the faint source recovery was
good for the low peak backgrounds, but recovery was essentially nonexistent for
the 10 Jy/beam background - point sources were not detected at all.</p>
<p>Despite the relative simplicity of this experiment, the data took 51 GB of
storage and took about half a day to run.</p>
<p>In principle, one would like to examine a range of different source
distributions (power-law flux distribution, upper/lower limits, sizes) on a
range of different power-spectrum backgrounds - for the purpose of the v2
paper, this approach would be thoroughly excessive.  However, I expect Tim will
be taking this sort of approach for the next paper.</p>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/bgps-point-source-recovery.html" rel="bookmark" title="Permalink to BGPS Point Source Recovery">
                    BGPS Point Source Recovery</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2013-05-16T12:21:00-06:00"> 2013/05/16 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-keflavichgmailcom.html">Adam (keflavich@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>In the last couple drafts of the BGPS paper (e.g. <a class="reference external" href="https://github.com/keflavich/bgpsv2/blob/master/v2_draft0515.pdf?raw=true">the May 15, 2013 draft</a>),
we've included a single simulation demonstrating the flux recovery of the
Bolocat:</p>
<img alt="" src="https://raw.github.com/keflavich/bgpsv2/master/figures/in_vs_out_bolocat_FLUX_40.png?login=keflavich&amp;token=8ff3096beef7bf15627a7a6b7363cb49" style="width: 800px;" />
<img alt="" src="https://raw.github.com/keflavich/bgpsv2/master/figures/in_vs_out_bolocat_FLUX_120.png?login=keflavich&amp;token=2c6e9896c5df6824e9881c94d6af542f" style="width: 800px;" />
<p>These figures are regarded as very important, as they demonstrate the
capability of recovering accurate flux density measurements from a realistic
sky using bolocat.</p>
<p>However, the above figures show a simulation only for one set of parameters,
with <span class="math">\(\alpha=1\)</span> in the power-law flux distribution, which unfortunately
is not realistic according to &quot;Figure 8&quot;:</p>
<img alt="" src="https://raw.github.com/keflavich/bgpsv2/master/figures/l030_higal_bgps_powerspec_compare.png?login=keflavich&amp;token=fa363ee3e28903c751c2a3c9f2b318a0" style="width: 800px;" />
<p>So I've started up a new experiment, experiment #23, to examine this problem.</p>
<p>The problem has a few layers:</p>
<ol class="arabic simple">
<li>The reason I used <span class="math">\(\alpha=1\)</span> is that it looks much like a realistic
BGPS map after processing, in the sense that most of the field is empty
but there are a few hundred sources in the map.  However, <span class="math">\(\alpha=1\)</span>
is not a realistic representation of the measured power spectra.</li>
<li><span class="math">\(\alpha=2\)</span> maps with the previous normalization had a peak value of
18 Jy, which resulted in heavily signal-dominated output maps that did not
resemble BGPS maps.</li>
<li>The normalization is tricky.  One of the key goals of the simulations was to
test the effect of different atmospheric to astrophysical signal ratios on
the angular transfer function; in order to accomplish this, it was necessary
to scale the atmospheric power based on the astrophysical power at its peak
in fourier space.  i.e., in real timestreams, we can measure the astrophysical
to atmospheric power ratio, but we have to perform that measurement somewhere
that the angular transfer function is known to be reliable.  This is done at
about 1 Hz.</li>
<li>The normalization is important because of the noise level.  In the
simulations, we use a fixed noise level of about 30 mJy in the timestreams
to match our best observations (though it is not difficult to scale this to
other levels).  This fixed noise level means that, for some normalizations,
all pixels are statistically significant.  Also, even though the noise level
is fixed, it will be higher because of intrinsic noise in a power-law
distributed map.</li>
<li>The normalizations used in experiment #21, the angular transfer function
measurement, were selected such that there would be high signal-to-noise at
all angular scales.  This means that white noise would not be dominant on
any angular scale, since white noise is equivalent to <span class="math">\(\alpha=0\)</span>.  So
it wasn't crazy to use these ridiculously high-flux maps, but it is not
feasible to use the same maps for analysis of point sources.  In maps for
which we're interested in small-angular-scale features (&lt;100&quot;), we want the
maps to be primarily noise-dominated with a handful of bright features
either caused by adding point sources directly or from the local peaks in
the power-law distributed flux.</li>
</ol>
<p>Some notes along the way:</p>
<blockquote>
<ul class="simple">
<li>Using a power-law background, the point-source sensitivity is much worse
than without a power-law background.   This is intuitive: a 100 mJy source
on a 200 mJy background (which may easily include power fluctuations on the
smallest scales of comparable magnitude) is not going to be recovered.</li>
<li>Doubly important: a 1 Jy source should have <em>peak</em> amplitude 1 Jy, but the
current method of adding point sources adds them as delta functions that are
later convolved, conserving the <em>total flux</em> rather than the <em>peak flux</em>.
This needs to be changed! (has been now)</li>
</ul>
</blockquote>
<p>Here are some examples of what the before/after look like with point sources added.
The first has bright sources, the second faint sources:</p>
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/BGPS_exp23_bright.png" style="width: 800px;" />
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/BGPS_exp23_missingsrcs.png" style="width: 800px;" />
<p>With these new figures, the 40&quot; apertures work fine, but the 120&quot; apertures are
still utterly junk.  This does not make sense.</p>
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/in_vs_out_bolocat_FLUX_40_testexp23.png" style="width: 800px;" />
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/in_vs_out_bolocat_FLUX_80_testexp23.png" style="width: 800px;" />
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/in_vs_out_bolocat_FLUX_120_testexp23.png" style="width: 800px;" />
<p>A careful analysis of a single source shows that something is wrong.  Here are some annular extractions
followed by the image:</p>
<pre class="literal-block">
Input Map:
reg sum npix    mean    median  min         max     var         stddev      rms
--- --- ----    ----    ------  ---         ---     ---         ------      ---
1   26.3323 22  1.19692 1.18083 1.10787     1.28825 0.00208826  0.0456975   1.1978
2   77.8553 74  1.0521  1.047   1.00426     1.123   0.000929507 0.0304878   1.05254
3   124.868 122 1.02351 1.02869 0.996566    1.04427 0.000260295 0.0161337   1.02363

Output Map:
reg sum         npix    mean        median      min         max         var         stddev      rms
--- ---         ----    ----        ------      ---         ---         ---         ------      ---
1   3.89157     23      0.169199    0.175204    0.086872    0.255151    0.00206254  0.0454152   0.175188
2   2.06843     74      0.0279517   0.0275116   -0.0695484  0.155258    0.00210834  0.0459167   0.0537554
3   0.502601    123     0.00408619  0.00629906  -0.121023   0.0834974   0.00143969  0.0379432   0.0381626

Backgrounds:
Input Map:
reg  sum      npix  mean      median    min       max      var          stddev     rms
---  ---      ----  ----      ------    ---       ---      ---          ------     ---
1    297.054  291   1.0208    1.02293   0.98094   1.05234  0.000313419  0.0177037  1.02096
3    2538.6   2618  0.969671  0.972413  0.859551  1.12495  0.0015557    0.0394423  0.970473

Output Map:
reg  sum      npix  mean        median      min        max       var         stddev     rms
---  ---      ----  ----        ------      ---        ---       ---         ------     ---
1    1.49461  291   0.00513613  0.00729431  -0.121023  0.133141  0.001586    0.0398247  0.0401545
3    5.83372  2618  0.00222831  0.00194597  -0.195075  0.181155  0.00211747  0.046016   0.0460699

Bolocat for this source:
In [200]: fields
Out[200]: ['FLUX_40', 'FLUX_40_NOBG', 'BG_40', 'FLUX_120', 'FLUX_120_NOBG', 'BG_120']

In [198]: [inp[61][f] for f in fields]
Out[198]: [0.1896538, 1.3536235, 0.38071653, 0.83893013, 10.77737, 0.42352486]

In [199]: [m20[61][f] for f in fields]
Out[199]: [0.18015364, 0.18674377, -0.016305592, 0.2868295, 0.29759517, -0.00027596406]
</pre>
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/annulus_exam.png" style="width: 800px;" />
<p>With background apertures:</p>
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/annulus_exam_bgapers.png" style="width: 800px;" />
<p>However, note that the background are computed using the <tt class="docutils literal">mmm.pro</tt>
sky-background estimation procedure over a range <span class="math">\(2r\)</span> to <span class="math">\(4r\)</span>
(i.e., 40-80&quot; and 120-240&quot; radius for the 40&quot; and 120&quot; diameter apertures).</p>
<p>The numbers shown by ds9 disagree fairly severely with those from bolocat.
In particular, it appears that the background estimate returned by <tt class="docutils literal">mmm.pro</tt>
is off by a factor of 2, in this case giving 0.42 instead of 0.97.  Turns out
this was due to an indexing error that did not affect the pipeline results in
any way.</p>
<p>Out of date analysis:
Bolocat's flux total in the 120&quot; aperture is 10.77 Jy/beam, background is 0.42
Jy/beam.  There are 218 pixels.  The resulting flux should be
(10.77-0.42*218/23.8), but this gives 6.9 instead of the expected 0.84.  Why?</p>
<p>If we do the same with the ds9 numbers, we get a total of 9.62 Jy/beam,
background 0.97 Jy/beam average, so: (9.62 - 0.97*218/23.8) = 0.74.
This is consistent with bolocat, and very very wrong.</p>
<p>If we take our background to be 1.02 instead of 0.97, we get 0.28 Jy/beam,
which is exactly the right answer according to the pipeline.  1.02 comes from
taking a much more local background subtraction from r=40 to r=80 arcsec,
which isn't really acceptable.  If we go from r=60 to r=120, the disagreement remains
fairly bad, with f=0.38 Jy/beam, but certainly a lot better.</p>
<pre class="literal-block">
Bolocat after the correction:
In [297]: [m20[61][f] for f in fields]
Out[297]: [0.18015364, 0.18674377, 0.00578439, 0.25477698, 0.29759517, 0.0041758944]

In [298]: [inp[61][f] for f in fields]
Out[298]: [0.1896538, 1.3536235, 1.0216572, 0.40137589, 10.77737, 1.0119308]
</pre>
<p>This may mean that we'll need to re-do aperture extraction with a tighter
background region everywhere.  I made the change to <tt class="docutils literal">object_photometry</tt>.</p>
<p>However, even with the change, even in the best case, <tt class="docutils literal">FLUX_120</tt> appears to
be totally unreliable.  <tt class="docutils literal">FLUX_80</tt> is acceptable with the change, but only for
bright sources (for faint sources, &lt;1 Jy, there is no recovery at all - I think this
must be an issue of the source brightness still not being calculated correctly):</p>
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/in_vs_out_bolocat_FLUX_80_bright_1.0E-05.png" style="width: 800px;" />
<p>I'll have to continue this analysis tomorrow once the full suite of simulations
has completed, but I strongly suspect that we'll have to recommend strictly
against using <tt class="docutils literal">FLUX_120</tt> if the background is expected to be <span class="math">\(\alpha=2\)</span>
distributed.</p>
<div class="section" id="day-2">
<h2>Day 2</h2>
<p>The simulations have partly completed.  After correcting the error with
convolved point sources vs.  delta functions, I reset the flux distributions to
be 0.05 to 1.0 Jy for the &quot;faint&quot; distribution and 0.1 to 50.0 Jy for the
&quot;bright&quot; distribution (both with power-law distributions <span class="math">\(\alpha=2\)</span>).</p>
<p>The results can be summarized:</p>
<blockquote>
<ol class="arabic simple">
<li>In the presence of complex background, i.e power-law distributed flux density
with amplitude comparable to the detected source brightness, only the smallest
aperture (40&quot;) is reliable (i.e., recovers a flux in the input and
processed map).</li>
<li>The recovered flux density has a very high dispersion in the presence of
high-amplitude power-law flux.  &quot;Very high&quot; = <span class="math">\(\sigma \gtrsim 1\)</span>
around a mean of 1.</li>
<li>There is no evident dependence of the maps on the atmospheric properties.
Therefore, there's no sense in varying the atmospheric properties in the
simulations.</li>
</ol>
</blockquote>
<p>I decided the simulations needed changing again.  First, there was excessive
sampling in astro/atmo parameter space; this is not needed (see point 3).  More
important is the power-law distribution map's peak flux.  Also, it is more
important to get decent sampling of bright-ish sources than to have a
&quot;physically accurate&quot; point source distribution; the distribution of sources
does not affect the recovery, but it does affect the signal-to-noise of the
recovery <em>measurement</em>.  Please don't ask me to defend this statement; it would
require another 10 hours of computer time + me time that I really don't want to
allocate, but I'm confident that it is true.</p>
<p>The essential conclusion is that, for <span class="math">\(\alpha=2\)</span>, point source recovery
is only possible if the point source is brighter than the background, which is
a very intuitive result.  Background annulus subtraction isn't very effective
at pulling out sources.</p>
<p>Conclusions:</p>
<blockquote>
<ol class="arabic simple">
<li>These experiments show that source recovery is very poor in the presence of a
bright power-law background: it is not possible to reliably extract point
sources from a map filled with power-law distributed emission brighter than or
comparable to the point sources.</li>
<li>The 120&quot; apertures aren't really good for anything.</li>
<li>There is so much source-extraction parameter space out there that any
further study would really deserve its own paper.</li>
</ol>
</blockquote>
<p>Additional plots of interest:</p>
<p>40&quot; aperture in the presence of a bright background with faint sources:</p>
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/in_vs_out_bolocat_FLUX_40_faint_5.0E-03.png" style="width: 800px;" />
<p>Versus the same with a faint background:</p>
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/in_vs_out_bolocat_FLUX_40_faint_1.0E-03.png" style="width: 800px;" />
<p>Compare these to the 120&quot; equivalents (bright then faint background):</p>
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/in_vs_out_bolocat_FLUX_120_faint_p5.0E-03.png" style="width: 800px;" />
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/in_vs_out_bolocat_FLUX_120_faint_p1.0E-03.png" style="width: 800px;" />
<p>It's fairly easy to see why there are issues with the bright background and the
120&quot; apertures.  In this image, bright background on the left, faint background
on the right, with faint sources (0.1-1 Jy).</p>
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/faint_vs_bright_background.png" style="width: 800px;" />
<p>It's more helpful to look at that previous image with the source contours
superposed.  These images really give a nice feel for what it means to have
point sources subsumed in <span class="math">\(\alpha=2\)</span> background.</p>
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/exp23_faint_ds2_astrosky_arrang45_atmotest_amp5.0E-05_sky-2.0_seed00_peak5.0E-03_smooth_withptsrc_label_compare.png" style="width: 800px;" />
<img alt="" src="https://keflavich.github.io/blog/bgps/images/bgps-point-source-recovery/exp23_faint_ds2_astrosky_arrang45_atmotest_amp3.2E-05_sky-2.0_seed00_peak1.0E-03_smooth_withptsrc_label_compare.png" style="width: 800px;" />
</div>
<script type='text/javascript'>if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script> </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/recovering-from-startup-drive-out-of-memory.html" rel="bookmark" title="Permalink to Recovering from "Startup drive out of memory"">
                    Recovering from &quot;Startup drive out of memory&quot;</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2013-05-13T09:26:00-06:00"> 2013/05/13 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-keflavichgmailcom.html">Adam (keflavich@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>To continue frozen processes, you need to find all sleeping procs and restart them with <tt class="docutils literal">kill <span class="pre">-CONT</span></tt>.</p>
<p>In principle, this command should do that:</p>
<p><tt class="docutils literal">ps <span class="pre">-A</span> <span class="pre">-o</span> tpgid,uid,pid,state,flags | awk <span class="pre">'$1!=&quot;0&quot;</span> &amp;&amp; <span class="pre">$2==501</span> &amp;&amp; <span class="pre">$4==&quot;S&quot;</span> &amp;&amp; <span class="pre">$5!=&quot;4000410c&quot;</span> {print &quot;kill <span class="pre">-CONT</span> &quot; $3}' | bash</tt></p>
<p>Without the flags exclusion, this failed for me on apple's VNC server:
<tt class="docutils literal">ps <span class="pre">-A</span> <span class="pre">-o</span> tpgid,uid,pid,state,flags | awk <span class="pre">'$2==501</span> &amp;&amp; <span class="pre">$4==&quot;S&quot;</span> &amp;&amp; <span class="pre">$5!=&quot;4000410c&quot;</span> {print &quot;kill <span class="pre">-CONT</span> &quot; $3}' | bash</tt></p>
<p>This is necessary for recovering mac processes:
<tt class="docutils literal"><span class="pre">-A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Display information about other users' processes, including those without controlling terminals.</tt></p>
<p>The outputs from the <tt class="docutils literal">ps</tt> process are:</p>
<blockquote>
<ul class="simple">
<li>tpgid      control terminal process group ID</li>
<li>pid        process ID</li>
<li>uid        effective user ID</li>
</ul>
</blockquote>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/bolocam-mass-calculations.html" rel="bookmark" title="Permalink to Bolocam Mass Calculations">
                    Bolocam Mass Calculations</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2013-03-25T11:14:00-06:00"> 2013/03/25 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-keflavichgmailcom.html">Adam (keflavich@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>Adopt an effective Bolocam center frequency,  f = 271.1 GHz</p>
<p>Use Ossenkopf, V. &amp; Henning, Th. 1994, A&amp;A, 291, 943 Table 1. [<a class="reference external" href="http://adsabs.harvard.edu/abs/1994A%26A...291..943O">http://adsabs.harvard.edu/abs/1994A%26A...291..943O</a>]
Interpolate last two entries (lambda = 1.0 mm and 1.3 mm to f)</p>
<p>This gives <span class="math">\(\kappa = 0.01166 cm^2 g^{-1}\)</span> (or round to 0.0117)
for gas-to-dust = 100.
But the slope between these 2 points is only 1.61!</p>
<p>The points in OH94 table 1 jump around and locally give a variety of
slopes around 1.8.  A fit to kappa longward of 100 microns
gives a slope of 1.8.</p>
<p>Interpolating kappa from 1.00 mm where OH5 gives <span class="math">\(\kappa(1.00) = 0.0137\)</span>
(for a gas-to-dust ratio = 100) to 271.1 GHz (= 1.1058 mm)
using a slope of 1.8 gives:</p>
<p><span class="math">\(\kappa = 0.01143 cm^{2} g^{-1}\)</span></p>
<p>This is the same as the value used by Enoch, so let's adopt it
(round to 0.0114), but note that this was calculated for 271.1 GHz.</p>
<p>For the v1.0 data, the BGPS has the following properties:</p>
<p>effective beam FWHM = 33&quot;</p>
<p>gaussian beam <span class="math">\(\sigma = 14.01\)</span>&quot;    (= FWHM / <span class="math">\(\sqrt{(8*\ln(2))}\)</span>)</p>
<p>effective beam radius = 19.82&quot;    (= FWHM / <span class="math">\(\sqrt{(4*\ln(2))}\)</span>)</p>
<p>This is the radius of a circular top-hat function that has the
same solid angle as a gaussian.  At a distance of
D = 1 kpc, this radius corresponds to a length  = <span class="math">\(2.97 x 10^{17}\)</span> cm.
The effective beam solid angle is <span class="math">\(\Omega = 2.902 x 10^{-8}\)</span> sr.</p>
<p>Adopt a fiducial dust temperature for mass calculations, <span class="math">\(T_d = 20K\)</span></p>
<p>The total mass per Jy at <span class="math">\(D_{kpc}\)</span> = 1 kpc is given by</p>
<div class="math">
\begin{equation*}
M = 1.0 x 10^{-23} * S(Jy) * D^2 / \kappa * B_{\nu}(T)
\end{equation*}
</div>
<div class="math">
\begin{equation*}
=  14.30 * [e^{13.01/T(K) - 1}] * S(Jy) * D^2_{kpc}   M_{\odot}
\end{equation*}
</div>
<p>For <span class="math">\(T = 20 K\)</span>:</p>
<div class="math">
\begin{equation*}
M = 13.07 * S(Jy) * D^2_{kpc} M_{\odot}
\end{equation*}
</div>
<p>This corresponds to a beam-filling column density of <span class="math">\(H_2\)</span>,</p>
<div class="math">
\begin{equation*}
N(H2) = 2.19e+22 * [e^{13.01/T(K) - 1}] * S(Jy)             (cm^{-2})
\end{equation*}
</div>
<p>For <span class="math">\(T = 20 K\)</span>:</p>
<div class="math">
\begin{equation*}
N(H2) = 2.01 x 10^{22} * S(Jy)    (cm^{-2})
A_V = 21.1 \mathrm{magnitudes} Jy^{-1}
\end{equation*}
</div>
<p>where we use the Bohlin &amp; Savage calibration</p>
<div class="math">
\begin{equation*}
A_V = 1 mag. &lt;=&gt; N(H) = 1.9 x 10^{20} cm^{-2} \mathrm{and}
N(H_2) = N(H) / 2
\end{equation*}
</div>
<script type='text/javascript'>if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script> </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/arecibo-mapping-total-power-measurements.html" rel="bookmark" title="Permalink to Arecibo Mapping: Total Power Measurements">
                    Arecibo Mapping: Total Power Measurements</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2013-03-22T22:50:00-06:00"> 2013/03/22 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-keflavichgmailcom.html">Adam (keflavich@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>Worked on reducing the Arecibo continuum data.  There were some serious
problems with the off positions previously, in particular generating weird
slopes.</p>
<p>I suspect the problem was with these lines</p>
<!-- this is really IDL but there's no pygment for IDL -->
<div class="highlight"><pre><span></span><span class="n">sorted1</span> <span class="o">=</span> <span class="n">sort</span><span class="p">(</span><span class="n">totals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
<span class="n">sorted2</span> <span class="o">=</span> <span class="n">sort</span><span class="p">(</span><span class="n">totals</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
<p>since the indexing is wrong, but I'm not sure yet.  I re-wrote the whole
off-position measurement to average over all scans.  Still in progress, but the
fitting works now. Here's an example:</p>
<div class="figure">
<img alt="" src="static/images/total_vs_integnum.png" style="width: 800px;" />
</div>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
</ul><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 19
        <a href="https://keflavich.github.io/blog/author/adam-keflavichgmailcom2.html">&raquo;</a>
</p>
</section><!-- /#content -->
  </div>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37306139-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37306139-1');
    ga('send', 'pageview');
</script>
<script type="text/javascript">
  var disqus_shortname = 'adamginsburgsblog';
  (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();
</script>
</body>
</html>
