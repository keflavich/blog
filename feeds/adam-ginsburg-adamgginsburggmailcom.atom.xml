<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Adam Ginsburg's blog - Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</title><link href="https://keflavich.github.io/blog/" rel="alternate"></link><link href="https://keflavich.github.io/blog/feeds/adam-ginsburg-adamgginsburggmailcom.atom.xml" rel="self"></link><id>https://keflavich.github.io/blog/</id><updated>2025-03-15T00:00:00-06:00</updated><entry><title>Pushing to a pull request</title><link href="https://keflavich.github.io/blog/pushing-to-a-pull-request.html" rel="alternate"></link><published>2025-03-15T00:00:00-06:00</published><updated>2025-03-15T00:00:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2025-03-15:/blog/pushing-to-a-pull-request.html</id><summary type="html">&lt;p&gt;A very common workflow in open source development is for someone to open a pull request onto your (or the upstream) repository from their fork, and then if &amp;quot;Maintainers are allowed to edit this pull request.&amp;quot; is checked, you want to edit their PR.&lt;/p&gt;
&lt;p&gt;This is a pain in the …&lt;/p&gt;</summary><content type="html">&lt;p&gt;A very common workflow in open source development is for someone to open a pull request onto your (or the upstream) repository from their fork, and then if &amp;quot;Maintainers are allowed to edit this pull request.&amp;quot; is checked, you want to edit their PR.&lt;/p&gt;
&lt;p&gt;This is a pain in the ass if you try to use any documented command line tools.  Github docs tell you how to check out the PR, but not how to push it back - all of the online docs I found, and both chatGPT and Claude, require that you add the PR's fork as a remote.   That's stupid.&lt;/p&gt;
&lt;p&gt;The better way is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git&lt;span class="w"&gt; &lt;/span&gt;fetch&lt;span class="w"&gt; &lt;/span&gt;origin&lt;span class="w"&gt; &lt;/span&gt;pull/&amp;lt;PULL_REQUEST_NUMBER&amp;gt;/head:&amp;lt;LOCAL_BRANCH_NAME&amp;gt;
&lt;span class="c1"&gt;# ... make edits ...&lt;/span&gt;
git&lt;span class="w"&gt; &lt;/span&gt;commit&lt;span class="w"&gt; &lt;/span&gt;-am&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;I edited the PR&amp;#39;&lt;/span&gt;
git&lt;span class="w"&gt; &lt;/span&gt;push&lt;span class="w"&gt; &lt;/span&gt;git@github.com:&amp;lt;contributor-name&amp;gt;/&amp;lt;repo-name&amp;gt;.git&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;LOCAL_BRANCH_NAME&amp;gt;:&amp;lt;REMOTE_BRANCH_NAME&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;so, for example, we tried this on my CV from &lt;tt class="docutils literal"&gt;alissapajer&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git&lt;span class="w"&gt; &lt;/span&gt;fetch&lt;span class="w"&gt; &lt;/span&gt;origin&lt;span class="w"&gt; &lt;/span&gt;pull/1/head:alissapajer-patch-1
git&lt;span class="w"&gt; &lt;/span&gt;checkout&lt;span class="w"&gt; &lt;/span&gt;alissapajer-patch-1
git&lt;span class="w"&gt; &lt;/span&gt;commit&lt;span class="w"&gt; &lt;/span&gt;-am&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;blah&amp;#39;&lt;/span&gt;
git&lt;span class="w"&gt; &lt;/span&gt;push&lt;span class="w"&gt; &lt;/span&gt;git@github.com:alissapajer/keflavich-cv.git&lt;span class="w"&gt; &lt;/span&gt;HEAD:alissapajer-patch-1
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;(&lt;cite&gt;HEAD&lt;/cite&gt; works here b/c I was still on that branch)&lt;/p&gt;
&lt;p&gt;It would also work, and be more explicit, to use the remote name:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git&lt;span class="w"&gt; &lt;/span&gt;fetch&lt;span class="w"&gt; &lt;/span&gt;git@github.com:alissapajer/keflavich-cv.git&lt;span class="w"&gt; &lt;/span&gt;alissapajer-patch-1
&lt;/pre&gt;&lt;/div&gt;
</content><category term="misc"></category><category term="github"></category></entry><entry><title>Editing metadata in measurement sets</title><link href="https://keflavich.github.io/blog/editing-metadata-in-measurement-sets.html" rel="alternate"></link><published>2023-08-11T15:34:00-06:00</published><updated>2023-08-11T15:34:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2023-08-11:/blog/editing-metadata-in-measurement-sets.html</id><summary type="html">&lt;p&gt;I needed to update the position of VLA phase calibrator &lt;a class="reference external" href="http://simbad.u-strasbg.fr/simbad/sim-id?Ident=%402384864&amp;amp;Name=QSO%20J1744-3116&amp;amp;submit=submit"&gt;J1744-3116&lt;/a&gt; in my measurement sets.  The VLA coordinate is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;tt class="docutils literal"&gt;17:33:02.705790 &lt;span class="pre"&gt;-13.04.49.54823&lt;/span&gt; J2000&lt;/tt&gt;&lt;/blockquote&gt;
&lt;p&gt;while the ALMA coordinate is&lt;/p&gt;
&lt;blockquote&gt;
&lt;tt class="docutils literal"&gt;17:44:23.578227 &lt;span class="pre"&gt;-31.16.36.29204&lt;/span&gt; ICRS&lt;/tt&gt;&lt;/blockquote&gt;
&lt;p&gt;and the SIMBAD coordinate is&lt;/p&gt;
&lt;blockquote&gt;
&lt;tt class="docutils literal"&gt;17 44 23 …&lt;/tt&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;I needed to update the position of VLA phase calibrator &lt;a class="reference external" href="http://simbad.u-strasbg.fr/simbad/sim-id?Ident=%402384864&amp;amp;Name=QSO%20J1744-3116&amp;amp;submit=submit"&gt;J1744-3116&lt;/a&gt; in my measurement sets.  The VLA coordinate is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;tt class="docutils literal"&gt;17:33:02.705790 &lt;span class="pre"&gt;-13.04.49.54823&lt;/span&gt; J2000&lt;/tt&gt;&lt;/blockquote&gt;
&lt;p&gt;while the ALMA coordinate is&lt;/p&gt;
&lt;blockquote&gt;
&lt;tt class="docutils literal"&gt;17:44:23.578227 &lt;span class="pre"&gt;-31.16.36.29204&lt;/span&gt; ICRS&lt;/tt&gt;&lt;/blockquote&gt;
&lt;p&gt;and the SIMBAD coordinate is&lt;/p&gt;
&lt;blockquote&gt;
&lt;tt class="docutils literal"&gt;17 44 23.57824 &lt;span class="pre"&gt;-31&lt;/span&gt; 16 36.2943 ICRS&lt;/tt&gt;&lt;/blockquote&gt;
&lt;p&gt;These are separated by a significant amount:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;units&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;coordinates&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;

&lt;span class="n"&gt;vla_coord&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;coordinates&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SkyCoord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;17:33:02.705790 -13:04:49.54823&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;unit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deg&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;fk5&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;alma_coord&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;coordinates&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SkyCoord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;17:44:23.578227 -31:16:36.29204&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;unit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deg&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;icrs&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;simbad_coord&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;coordinates&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SkyCoord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;17 44 23.57824 -31 16 36.2943&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;unit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deg&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;icrs&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;alma_coord&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;separation&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vla_coord&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arcsec&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# &amp;lt;Angle 0.28848595 arcsec&amp;gt;&lt;/span&gt;

&lt;span class="n"&gt;simbad_coord&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;separation&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vla_coord&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arcsec&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# &amp;lt;Angle 0.29071513 arcsec&amp;gt;&lt;/span&gt;

&lt;span class="n"&gt;simbad_coord&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;separation&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;alma_coord&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arcsec&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# &amp;lt;Angle 0.00226614 arcsec&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is caused by a typo in the VLA calibrator catalog (Lorant Sjouwerman, private communication).&lt;/p&gt;
&lt;p&gt;To fix it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;22A-020.sb41257746.eb41788351.59700.31502699074/22A-020.sb41257746.eb41788351.59700.31502699074.ms/FIELD&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# get the existing PHASE_DIR.  Shape is [coordinates, ?, sourceID]&lt;/span&gt;
&lt;span class="n"&gt;phasedir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getcol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;PHASE_DIR&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# figure out which row contains the to-be-modified source&lt;/span&gt;
&lt;span class="n"&gt;rownr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argmax&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getcol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;NAME&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;J1744-3116&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# modify the phasedir.  CASA expects coordinates to be wrapped at 180 deg&lt;/span&gt;
&lt;span class="n"&gt;phasedir&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rownr&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;simbad_coord&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fk5&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ra&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wrap_at&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;180&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rad&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;simbad_coord&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fk5&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dec&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rad&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;shutil&lt;/span&gt;
&lt;span class="n"&gt;shutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copytree&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;22A-020.sb41257746.eb41788351.59700.31502699074/22A-020.sb41257746.eb41788351.59700.31502699074.ms/FIELD&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;22A-020.sb41257746.eb41788351.59700.31502699074/22A-020.sb41257746.eb41788351.59700.31502699074.ms/FIELD.backup&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;22A-020.sb41257746.eb41788351.59700.31502699074/22A-020.sb41257746.eb41788351.59700.31502699074.ms/FIELD&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;nomodify&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;putcol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columnname&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;PHASE_DIR&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;phasedir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;flush&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Put all together:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;units&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;coordinates&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;

&lt;span class="n"&gt;simbad_coord&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;coordinates&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SkyCoord&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;17 44 23.57824 -31 16 36.2943&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;unit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deg&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;icrs&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;glob&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nn"&gt;shutil&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;vis&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;glob&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;glob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;*/*.ms&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;shutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copytree&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/FIELD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;vis&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/FIELD.backup&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/FIELD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;phasedir&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getcol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;PHASE_DIR&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;rownr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argmax&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getcol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;NAME&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;J1744-3116&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="n"&gt;rownr&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
    &lt;span class="n"&gt;phasedir&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rownr&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;simbad_coord&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fk5&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ra&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wrap_at&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;180&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;deg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rad&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;simbad_coord&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fk5&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dec&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rad&lt;/span&gt;
    &lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/FIELD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;nomodify&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;putcol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columnname&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;PHASE_DIR&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;phasedir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;flush&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content><category term="misc"></category><category term="casa"></category></entry><entry><title>CASA MPI debugging cont'd</title><link href="https://keflavich.github.io/blog/casa-mpi-debugging-contd.html" rel="alternate"></link><published>2022-05-06T09:08:00-06:00</published><updated>2022-05-06T09:08:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2022-05-06:/blog/casa-mpi-debugging-contd.html</id><summary type="html">&lt;p&gt;I continue to try to get MPI to run to completion.&lt;/p&gt;
&lt;p&gt;Using casa-6.5.0-9-py3.8, the latest error on the W51 B3 mosaic (biggest in ALMA-IMF, approximately):
2022-05-03 06:36:06     SEVERE  MPICommandServer::command_request_handler_service::CubeMajorCycleAlgorithm::task::MPIServer-2 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 137 …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I continue to try to get MPI to run to completion.&lt;/p&gt;
&lt;p&gt;Using casa-6.5.0-9-py3.8, the latest error on the W51 B3 mosaic (biggest in ALMA-IMF, approximately):
2022-05-03 06:36:06     SEVERE  MPICommandServer::command_request_handler_service::CubeMajorCycleAlgorithm::task::MPIServer-2 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 137)      Exception (std): ArrayBase::validateConformance shape [3] differs from [4]&lt;/p&gt;
&lt;p&gt;This leads to a lot of frozen nodes:
2022-05-03 19:29:17     SEVERE  MPIMonitorClient::monitor_status_service::MPIMonitorClient::monitor_status_service::casa        Ping status response from server 1 not received in the last 420s. Setting its status to 'timeout'&lt;/p&gt;
&lt;p&gt;This happens during the MakePSF stage.&lt;/p&gt;
&lt;p&gt;On G333.60 B6, which is smaller, the first exception I see is:
2022-05-05 17:31:47     SEVERE  MPIMonitorClient::monitor_status_service::MPIMonitorClient::monitor_status_service::casa        Ping status response from server 4 not received in the last 85s. Setting its status to 'timeout'
but... it looks like the clean actually finished!&lt;/p&gt;
&lt;p&gt;This is an odd one that happened during a major cycle, I think:&lt;/p&gt;
&lt;p&gt;2022-05-13 17:47:25     WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-19 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)        Exception for chan range [144, 151] ---   Setting masked pixels to zero for input startmodel : Er
ror (Resource deadlock avoided) when acquiring lock on /blue/adamginsburg/adamginsburg/almaimf/workdir/G328.25_B6_spw4_12M_spw4.contcube.model/table.lock&lt;/p&gt;
&lt;p&gt;This one resulted in the residual and image being identical past some point in the spectrum, i.e., it gave up partway through writing to disk.  There was NO CASA error!  Just a miserable segfault&lt;/p&gt;
&lt;p&gt;[c0711a-s25:60411] &lt;strong&gt;* Process received signal *&lt;/strong&gt;
[c0711a-s25:60411] Signal: Segmentation fault (11)
[c0711a-s25:60411] Signal code: Address not mapped (1)
[c0711a-s25:60411] Failing at address: 0x2d867e04f000&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category></entry><entry><title>CO2 Monitoring at Conferences: Update in 2022</title><link href="https://keflavich.github.io/blog/co2-monitoring-at-conferences-update-in-2022.html" rel="alternate"></link><published>2022-05-01T09:15:00-06:00</published><updated>2022-05-01T09:15:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2022-05-01:/blog/co2-monitoring-at-conferences-update-in-2022.html</id><summary type="html">&lt;p&gt;I started monitoring CO2 levels at conferences a couple years back, and now
that we're having in-person conferences again, I'm doing more monitoring.&lt;/p&gt;
&lt;p&gt;The last I attended was &lt;a class="reference external" href="https://www2.mpia-hd.mpg.de/homes/stein/EPoS/2022/epos2022.php"&gt;EPOS 2022&lt;/a&gt;, which is
probably my favorite recurring conference because of its venue, size, and schedule.
There is time to talk to …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I started monitoring CO2 levels at conferences a couple years back, and now
that we're having in-person conferences again, I'm doing more monitoring.&lt;/p&gt;
&lt;p&gt;The last I attended was &lt;a class="reference external" href="https://www2.mpia-hd.mpg.de/homes/stein/EPoS/2022/epos2022.php"&gt;EPOS 2022&lt;/a&gt;, which is
probably my favorite recurring conference because of its venue, size, and schedule.
There is time to talk to everyone you want to about all topics.&lt;/p&gt;
&lt;p&gt;I gave a &lt;a class="reference external" href="https://keflavich.github.io/talks/EPOS_2022.html"&gt;talk&lt;/a&gt; on the
small disks in Orion.&lt;/p&gt;
&lt;p&gt;The monitoring results are here:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/EPOS2022.png" style="width: 600px;" /&gt;
&lt;p&gt;I missed day 1 because I forgot the USB cable in my room, then I had some
electrical connection problems day 2 (the USB-C port on my computer is...
finnicky).  But besides that, you can see clear trends on day 1 and part of
day 2 where the CO2 was rapidly rising to uncomfortable levels.&lt;/p&gt;
&lt;p&gt;The blue zones are the scheduled breaks.  During the breaks, the room was
almost totally empty and we usually opened the doors and windows.&lt;/p&gt;
&lt;p&gt;I shared the day 2 data with the conference organizers and they then
prioritized opening the windows.  There was one period I think we opted
not to because it started snowing for a few minutes.&lt;/p&gt;
&lt;p&gt;On the last day, I'm not sure why the CO2 didn't go down during the break - it
may be that windows were open only one one side of the room, so there was only
diffusion, not flow.&lt;/p&gt;
</content><category term="misc"></category><category term="CO2"></category><category term="conferences"></category></entry><entry><title>ALMA Cycle 9 corrupted zip fix</title><link href="https://keflavich.github.io/blog/alma-cycle-9-corrupted-zip-fix.html" rel="alternate"></link><published>2022-04-14T09:18:00-06:00</published><updated>2022-04-14T09:18:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2022-04-14:/blog/alma-cycle-9-corrupted-zip-fix.html</id><summary type="html">&lt;p&gt;If you encounter a bug like this:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/ALMAC9ZipBug.png" style="width: 600px;" /&gt;
&lt;p&gt;&amp;quot;XML (syntax or validity) error&amp;quot; because you hit issue &lt;a class="reference external" href="https://almascience.eso.org/documents-and-tools/cycle9/known-issues"&gt;C1_032&lt;/a&gt;,
the fix is really easy:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;zipfile&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;

&lt;span class="c1"&gt;# not strictly necessary, but important if you want to avoid filling your directory with files&lt;/span&gt;
&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mkdir&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;recovery&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;chdir&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;recovery&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# replace with …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;If you encounter a bug like this:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/ALMAC9ZipBug.png" style="width: 600px;" /&gt;
&lt;p&gt;&amp;quot;XML (syntax or validity) error&amp;quot; because you hit issue &lt;a class="reference external" href="https://almascience.eso.org/documents-and-tools/cycle9/known-issues"&gt;C1_032&lt;/a&gt;,
the fix is really easy:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;zipfile&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;

&lt;span class="c1"&gt;# not strictly necessary, but important if you want to avoid filling your directory with files&lt;/span&gt;
&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mkdir&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;recovery&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;chdir&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;recovery&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# replace with your AOT file name&lt;/span&gt;
&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;zipfile&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ZipFile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;../corrupted.aot&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;aot&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c1"&gt;# this will extract all the files into the current directory&lt;/span&gt;
    &lt;span class="n"&gt;aot&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extractall&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;files&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;aot&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filelist&lt;/span&gt;

&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;zipfile&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ZipFile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;../recovered.aot&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;w&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;aot&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;fh&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;files&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;aot&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fh&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;filename&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;At least, this worked on the one case where I got bitten.&lt;/p&gt;
&lt;p&gt;This fix is based on &lt;a class="reference external" href="https://github.com/low-sky/alma_proposal_tools"&gt;Erik Rosolowsky's ALMA proposal tools&lt;/a&gt;&lt;/p&gt;
</content><category term="misc"></category><category term="alma"></category><category term="proposals"></category></entry><entry><title>Hacking plotms to let pipeline run</title><link href="https://keflavich.github.io/blog/hacking-plotms-to-let-pipeline-run.html" rel="alternate"></link><published>2022-04-11T08:02:00-06:00</published><updated>2022-04-11T08:02:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2022-04-11:/blog/hacking-plotms-to-let-pipeline-run.html</id><summary type="html">&lt;p&gt;For the ACES project, I'm re-running the ALMA pipeline using MPI.&lt;/p&gt;
&lt;p&gt;However, this results in all runs crashing with the following error:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;2022-04-06 04:22:43 INFO: Executing plotms(vis=&amp;#39;uid___A002_Xf512ae_X2626.ms&amp;#39;, xaxis=&amp;#39;azimuth&amp;#39;, yaxis=&amp;#39;elevation&amp;#39;, spw=&amp;#39;25:0~0,27:0~0,29:0~0,31 …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;For the ACES project, I'm re-running the ALMA pipeline using MPI.&lt;/p&gt;
&lt;p&gt;However, this results in all runs crashing with the following error:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;2022-04-06 04:22:43 INFO: Executing plotms(vis=&amp;#39;uid___A002_Xf512ae_X2626.ms&amp;#39;, xaxis=&amp;#39;azimuth&amp;#39;, yaxis=&amp;#39;elevation&amp;#39;, spw=&amp;#39;25:0~0,27:0~0,29:0~0,31:0~0,33:0~0,35:0~0&amp;#39;, antenna=&amp;#39;0&amp;amp;&amp;amp;*&amp;#39;, avgchannel=&amp;#39;9000&amp;#39;, avgtime=&amp;#39;10&amp;#39;, coloraxis=&amp;#39;field&amp;#39;, customflaggedsymbol=True, flaggedsymbolshape=&amp;#39;autoscaling&amp;#39;, title=&amp;#39;Elevation vs Azimuth for uid___A002_Xf512ae_X2626.ms&amp;#39;, plotfile=&amp;#39;azel.png&amp;#39;, showgui=False, clearplots=True)
fuse: failed to exec fusermount: No such file or directory

Cannot mount AppImage, please check your FUSE setup.
You might still be able to extract the contents of this AppImage
if you run it with the --appimage-extract option.
See https://github.com/AppImage/AppImageKit/wiki/FUSE
for more information
open dir error: No such file or directory
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This fails even if I set the global APPIMAGE_EXTRACT_AND_RUN as &lt;a class="reference external" href="https://docs.appimage.org/user-guide/troubleshooting/fuse.html#extract-and-run-type-2-appimages"&gt;directed&lt;/a&gt;
on the appimage.org docs.&lt;/p&gt;
&lt;p&gt;This indicates that the appimage is older than the environmental variable.&lt;/p&gt;
&lt;p&gt;Running the full command &amp;quot;works&amp;quot;:
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;/orange/adamginsburg/casa/casa-6.2.1-7-pipeline-2021.2.0.128/lib/py/lib/python3.6/site-packages/casaplotms/__bin__/casaplotms-x86_64.AppImage&lt;/span&gt; &lt;span class="pre"&gt;--appimage-extract&lt;/span&gt;&lt;/tt&gt;
but &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--appimage-extract-and-run&lt;/span&gt;&lt;/tt&gt; gives &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--appimage-extract-and-run&lt;/span&gt; is not yet implemented in version &lt;span class="pre"&gt;continuous-1-g6f3138f&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;So to run plotms, we need to use the &lt;tt class="docutils literal"&gt;AppRun&lt;/tt&gt; executable in the extracted &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;squashfs-root&lt;/span&gt;&lt;/tt&gt; directory.&lt;/p&gt;
&lt;p&gt;My original hack was to just tell plotms not to run at all, which I accomplished by editing the
&lt;tt class="docutils literal"&gt;plotmstool.py&lt;/tt&gt; file (&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;lib/py/lib/python3.6/site-packages/casaplotms/private/plotmstool.py&lt;/span&gt;&lt;/tt&gt;) to
just skip the &lt;tt class="docutils literal"&gt;__launch&lt;/tt&gt; command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__launch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;None&lt;/span&gt; &lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;However, in writing this post, I've changed to instead modifying the &lt;tt class="docutils literal"&gt;app_path&lt;/tt&gt; to this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;app_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/tmp/casaplotms/squashfs-root/AppRun&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;__os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;app_path&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Did not find extracted path &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;app_path&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;app_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;__os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;__os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abspath&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;__os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;__os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dirname&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="vm"&gt;__file__&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;..&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__bin__/casaplotms-x86_64.AppImage&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I haven't tried it but I'm slightly hopeful.&lt;/p&gt;
</content><category term="misc"></category><category term="casa"></category></entry><entry><title>Astronomical Software Development &amp; Career</title><link href="https://keflavich.github.io/blog/astronomical-software-development-career.html" rel="alternate"></link><published>2022-03-19T13:04:00-06:00</published><updated>2022-03-19T13:04:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2022-03-19:/blog/astronomical-software-development-career.html</id><summary type="html">&lt;p&gt;I recently visited the &lt;a class="reference external" href="https://www.astro.umd.edu/"&gt;University of Maryland&lt;/a&gt;
to give a &lt;a class="reference external" href="https://www.astro.umd.edu/events/colloquia/colloquium/cal.0316.html"&gt;colloquium&lt;/a&gt;
(&lt;a class="reference external" href="https://keflavich.github.io/talks/colloquium_Mar2022_UMD.html"&gt;slides here&lt;/a&gt;).
This was my first in-person colloquium as faculty because of COVID.&lt;/p&gt;
&lt;p&gt;I had a great meeting with the grad students over lunch, and they asked several good
questions.  I've thought over some of them a little more …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I recently visited the &lt;a class="reference external" href="https://www.astro.umd.edu/"&gt;University of Maryland&lt;/a&gt;
to give a &lt;a class="reference external" href="https://www.astro.umd.edu/events/colloquia/colloquium/cal.0316.html"&gt;colloquium&lt;/a&gt;
(&lt;a class="reference external" href="https://keflavich.github.io/talks/colloquium_Mar2022_UMD.html"&gt;slides here&lt;/a&gt;).
This was my first in-person colloquium as faculty because of COVID.&lt;/p&gt;
&lt;p&gt;I had a great meeting with the grad students over lunch, and they asked several good
questions.  I've thought over some of them a little more and wanted to fill out my answers.
I'll paraphrase two questions:&lt;/p&gt;
&lt;p&gt;&amp;quot;How do you balance coding work with other research work?&amp;quot;&lt;/p&gt;
&lt;p&gt;My answer was essentially, &amp;quot;All of my coding work is research work - I don't write
code that doesn't contribute to my research.&amp;quot;  That is broadly true, but not exclusively
so, and there are some exceptions.&lt;/p&gt;
&lt;p&gt;All of the coding work I have done has been either to enable my research, support
someone else's research, enable my research career, or (in theory) make my life easier.&lt;/p&gt;
&lt;p&gt;The research stuff is mostly obvious - my work on and with data reduction software
(see all the CASA-tagged blog posts here, all development on radio-astro-tools, etc),
pyspeckit, and most of astroquery.  On the astroquery side, a lot of my research work
wasn't directly going to papers, but was instead to dig through the archives to see
if data were available, or if I needed to obtain new data.  It was then useful
for supporting observing proposal writing.&lt;/p&gt;
&lt;p&gt;The &amp;quot;enable my research career&amp;quot; component included a lot of side-work on things
that aren't directly research, but are research-adjacent.  These projects
included building tools to deploy my papers to github (which was a bit
obsoleted by overleaf), automatically &lt;a class="reference external" href="https://github.com/keflavich/cv/blob/master/update_journals.py"&gt;updating reference lists&lt;/a&gt; (it turns
out I often cite 5-10 arXiv papers in an article, but by publication time, I
need to update them to official journal article citations), assemble lists of
coauthors, &lt;a class="reference external" href="https://github.com/keflavich/cv/blob/master/add_citations.py"&gt;add citation counts to the CV&lt;/a&gt;, writing this
blog, etc.&lt;/p&gt;
&lt;p&gt;The exceptions are some of the 'pure service' coding.  This necessarily had to
be the lowest priority most of the time, but this is still career-motivated.
Some of the contributions I've made to astropy &amp;amp; other open-source projects are
just to improve their code bases, either with bugfixes, added features, or
things to improve robustness.  Most of my contributions were directly motivated
by need, of course - either there was something basic missing, or I was the
expert in that particular subtopic.  A good example is the &lt;a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.units.brightness_temperature.html"&gt;J-to-K equivalency&lt;/a&gt;;
it wasn't directly research-motivated, but was something I found myself needing
in day-to-day work.&lt;/p&gt;
&lt;p&gt;The 'pure service' coding also entails maintaining projects.  There is still a
selfish motivation here: if the code is maintained (if other people are using
iti and finding bugs), it is more likely to be functional when I need it next.
But, most of this work isn't triggered by my own needs, but by others.
The astropy Moore grant now funds some of this work, which helps ensure that
I'm motivated to continue the maintenance - but I was doing a lot of this work
as a postdoc long before I could be directly paid for it.&lt;/p&gt;
&lt;p&gt;&amp;quot;How do you avoid being typecast as a coder?&amp;quot;&lt;/p&gt;
&lt;p&gt;This question came from students who got to be known in their research
collaborations as &amp;quot;good at coding&amp;quot;.  My answer was basically, &amp;quot;learn to say
no&amp;quot;, but there's more nuance to add.&lt;/p&gt;
&lt;p&gt;First, there are some solid career paths to follow by being the science coder
in a group.  Many observatory jobs, for example, would prioritize this coding
experience.  There are a lot of positions in observatory jobs at places
like STSCI, NRAO, NOAO, etc. that value this sort of skill over many others.
So if you want to pursue one of these paths, or an industry path, because
you &amp;lt;i&amp;gt; enjoy &amp;lt;/i&amp;gt; the coding, then great!  Do it!&lt;/p&gt;
&lt;p&gt;If you really enjoy the coding, you'll get to do a lot more of it in a job
focused on software development than in an R1 research job.&lt;/p&gt;
&lt;p&gt;That said, if you are interested in pursuing an R1 faculty job, you need to
strike a more careful balance.  It's fine if you're the coder in the group -
that can land you a coauthorship on a lot of papers, which is a good thing!
However, first and foremost, you need to publish your own (first-author)
papers, which means prioritizing your work over collaborative work.  Ideally,
you'd just do both - that's what's expected of faculty members (faculty members
can't choose to prioritize teaching or research, really - they have to do well
at both, which often means just putting in more hours).  But if you're faced
with the choice, a few first-author papers are more important than many
co-author papers.&lt;/p&gt;
&lt;p&gt;The way I struck the balance was to focus entirely on research papers during my
grad school career, but still do a lot of software support work on the side - I
put in more time, but it was all stuff that was useful both for me and for
collaborators.  Later, in my second postdoc, I started publishing code-only
papers; I would advise grad students to do this sooner, though.  Since AAS
journals now accept code papers, if you want coding to be a big part of your
research portfolio, it's a good idea to have a refereed paper on a piece of
software.  Note that some of the most highly-cited papers in astronomy are code
papers, like the DAOPHOT, SEXTRACTOR, and astropy papers.&lt;/p&gt;
&lt;p&gt;Last bit of advice closing this out: Avoid GUI development.  That way lays madness.&lt;/p&gt;
</content><category term="misc"></category><category term="career"></category><category term="colloquium"></category></entry><entry><title>My blog is now deployed with gh-actions</title><link href="https://keflavich.github.io/blog/my-blog-is-now-deployed-with-gh-actions.html" rel="alternate"></link><published>2022-02-23T20:21:00-07:00</published><updated>2022-02-23T20:21:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2022-02-23:/blog/my-blog-is-now-deployed-with-gh-actions.html</id><content type="html">&lt;p&gt;This is mostly a test post to prove it.&lt;/p&gt;
&lt;p&gt;I'm now using this gh-deployment script:
&lt;a class="reference external" href="https://github.com/keflavich/gh-pages-pelican-action"&gt;https://github.com/keflavich/gh-pages-pelican-action&lt;/a&gt; (forked from &lt;a class="reference external" href="https://github.com/nelsonjchen/gh-pages-pelican-action"&gt;https://github.com/nelsonjchen/gh-pages-pelican-action&lt;/a&gt;)
in conjunction with gh-actions.&lt;/p&gt;
</content><category term="misc"></category><category term="blog deployment"></category></entry><entry><title>CASA MPI Errors continued in early 2022</title><link href="https://keflavich.github.io/blog/casa-mpi-errors-continued-in-early-2022.html" rel="alternate"></link><published>2022-01-23T07:54:00-07:00</published><updated>2022-01-23T07:54:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2022-01-23:/blog/casa-mpi-errors-continued-in-early-2022.html</id><summary type="html">&lt;p&gt;Running 7m+12m combination, the following errors show up:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
Exception: Error in making PSF : Invalid Table operation: Rows cannot be removed from table /blue/adamginsburg/adamginsburg/almaimf/workdir/G333.60_spw5_12M_B6/IMAGING_WEIGHT_1390794_230801956263_230804885819_bwtaper_0_interp_1; its storage managers do not support it
&lt;/pre&gt;
&lt;p&gt;This …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Running 7m+12m combination, the following errors show up:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
Exception: Error in making PSF : Invalid Table operation: Rows cannot be removed from table /blue/adamginsburg/adamginsburg/almaimf/workdir/G333.60_spw5_12M_B6/IMAGING_WEIGHT_1390794_230801956263_230804885819_bwtaper_0_interp_1; its storage managers do not support it
&lt;/pre&gt;
&lt;p&gt;This turns up several times repeatedly:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
G333.60_B6_fullcube_7M12M_5_15827045.log:2022-01-21 18:05:38  WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-25 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)      Exception for chan range [496, 499] ---   Error in making PSF : Interpolate1D::operator() data has repeated x values
G333.60_B6_fullcube_7M12M_5_15868985.log:2022-01-22 00:01:20  WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-19 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)      Exception for chan range [496, 499] ---   Error in making PSF : Invalid Table operation: Rows cannot be removed from table /blue/adamginsburg/adamginsburg/almaimf/workdir/G333.60_spw5_12M_B6/IMAGING_WEIGHT_1390794_230801956263_230804885819_bwtaper_0_interp_1; its storage managers do not support it
G333.60_B6_fullcube_7M12M_5_15891690.log:2022-01-22 14:37:39  WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-23 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)      Exception for chan range [496, 499] ---   Error in making PSF : Invalid Table operation: Rows cannot be removed from table /blue/adamginsburg/adamginsburg/almaimf/workdir/G333.60_spw5_12M_B6/IMAGING_WEIGHT_1390794_230801956263_230804885819_bwtaper_0_interp_1; its storage managers do not support it
G333.60_B6_fullcube_7M12M_5_15914880.log:2022-01-23 02:21:24  WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-25 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)      Exception for chan range [496, 499] ---   Error in making PSF : Invalid Table operation: Rows cannot be removed from table /blue/adamginsburg/adamginsburg/almaimf/workdir/G333.60_spw5_12M_B6/IMAGING_WEIGHT_1390794_230801956263_230804885819_bwtaper_0_interp_1; its storage managers do not support it
&lt;/pre&gt;
&lt;p&gt;Looks like it's always the same few channels failing.&lt;/p&gt;
&lt;p&gt;Errors like this one:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-17 (file src/
code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)        Exception for chan range [1152, 1153] ---   Programmer error: sumwt disk image is non existant
&lt;/pre&gt;
&lt;p&gt;are probably cauased by deleting the .sumwt file in the middle of a tclean run -
so that is genuine &amp;quot;user error&amp;quot; (I was deleting the sumwt, psf, and weight
files occasionally b/c they are the 'leftovers' when a tclean run fails for
bad reasons)&lt;/p&gt;
&lt;p&gt;There are some others that don't have obvious explanations:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
casa_log_line_G010.62_B3_fullcube_7M12M_1_2022-01-21_08_17_16.log:2022-01-21 15:29:42   WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-15 (file src/ code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)        Exception for chan range [534, 535] ---   FilebufIO::readBlock - incorrect number of bytes read for file /blue/adamginsburg/adamgins burg/almaimf/workdir/G010.62_B3_spw1_7M12M_spw1.sumwt/table.f0
casa_log_line_G010.62_B3_fullcube_7M12M_1_2022-01-21_08_17_16.log:2022-01-21 17:07:41   WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-31 (file src/ code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)        Exception for chan range [1596, 1597] ---   FilebufIO::readBlock - incorrect number of bytes read for file /blue/adamginsburg/adamgi nsburg/almaimf/workdir/G010.62_B3_spw1_7M12M_spw1.sumwt/table.f0
&lt;/pre&gt;
&lt;p&gt;and this:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
casa_log_line_G333.60_B6_fullcube_7M12M_5_2022-01-21_08_17_16.log:2022-01-21 18:05:38   WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-25 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)        Exception for chan range [496, 499] ---   Error in making PSF : Interpolate1D::operator() data has repeated x values
&lt;/pre&gt;
&lt;p&gt;This is an old one that remains unsolved:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
casa_log_line_G338.93_B3_fullcube_7M12M_1_2022-01-22_20_25_52.log:2022-01-23 04:59:57   WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-8 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336) Exception for chan range [2049, 2049] ---   Error in making PSF : A nasty Visbuffer2 error occured...wait
&lt;/pre&gt;
&lt;p&gt;Got this real nice one after the .image was created:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
*** Error in `/blue/adamginsburg/adamginsburg/casa/casa-6.4.3-4/lib/py/bin/python3': malloc(): smallbin double linked list corrupted: 0x00002af7a40d8000 ***
======= Backtrace: =========
/lib64/libc.so.6(+0x7f804)[0x2af73aa03804]
/lib64/libc.so.6(+0x82f40)[0x2af73aa06f40]
/lib64/libc.so.6(__libc_malloc+0x4c)[0x2af73aa09b1c]
/apps/compilers/gcc/9.3.0/lib64/libstdc++.so.6(_Znwm+0x15)[0x2af751076395]
&lt;/pre&gt;
&lt;p&gt;That happened in the middle of major cycle 1, so the data were probably fine, but I'm just going to restart it&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category></entry><entry><title>CASA Errors encountered while imaging LB data</title><link href="https://keflavich.github.io/blog/casa-errors-encountered-while-imaging-lb-data.html" rel="alternate"></link><published>2021-12-08T09:37:00-07:00</published><updated>2021-12-08T09:37:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2021-12-08:/blog/casa-errors-encountered-while-imaging-lb-data.html</id><summary type="html">&lt;p&gt;I'm trying to reduce some new data from ALMA's longest baselines (C10, B6).&lt;/p&gt;
&lt;p&gt;There are several exciting errors:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;The lines were all flagged out.  Thankfully, there is a &lt;tt class="docutils literal"&gt;calibrated_final.ms.backup&lt;/tt&gt;
file that does not have the lines flagged out.  &lt;tt class="docutils literal"&gt;flagmanager&lt;/tt&gt; was unable to restore
the flags.  The flagging …&lt;/li&gt;&lt;/ol&gt;</summary><content type="html">&lt;p&gt;I'm trying to reduce some new data from ALMA's longest baselines (C10, B6).&lt;/p&gt;
&lt;p&gt;There are several exciting errors:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;The lines were all flagged out.  Thankfully, there is a &lt;tt class="docutils literal"&gt;calibrated_final.ms.backup&lt;/tt&gt;
file that does not have the lines flagged out.  &lt;tt class="docutils literal"&gt;flagmanager&lt;/tt&gt; was unable to restore
the flags.  The flagging comes from the manual flagging done by the QA2 reducer,
which was used to make the continuum image.  That's fine, but the unflagging step
didn't work.  The uvcontsub data, as a result, contain no line data.  ?????&lt;/li&gt;
&lt;li&gt;I can't image the full cube because of errors like this:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;defineImage&lt;/span&gt;         &lt;span class="n"&gt;Shape&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;9600&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9600&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1920&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="n"&gt;Spectral&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mf"&gt;2.31563e+11&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;increment&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;976510&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;defineImage&lt;/span&gt;         &lt;span class="n"&gt;Set&lt;/span&gt; &lt;span class="n"&gt;Gridding&lt;/span&gt; &lt;span class="n"&gt;options&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;S255IR&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;SMA1_sci&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;spw1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;manual&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;ftmachine&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;gridft&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;nSubCubeFitInMemory&lt;/span&gt; &lt;span class="n"&gt;Required&lt;/span&gt; &lt;span class="n"&gt;memory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;5.468e+05&lt;/span&gt; &lt;span class="n"&gt;GB&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Available&lt;/span&gt; &lt;span class="n"&gt;mem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;166.3&lt;/span&gt; &lt;span class="n"&gt;GB&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;fraction&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;70&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;memory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Subcubes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;1920.&lt;/span&gt; &lt;span class="n"&gt;Processes&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;64.&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;    &lt;span class="n"&gt;Set&lt;/span&gt; &lt;span class="n"&gt;imaging&lt;/span&gt; &lt;span class="n"&gt;weights&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Briggs&lt;/span&gt; &lt;span class="n"&gt;weighting&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;sidelobes&lt;/span&gt; &lt;span class="n"&gt;will&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;suppressed&lt;/span&gt; &lt;span class="n"&gt;over&lt;/span&gt; &lt;span class="n"&gt;full&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;    &lt;span class="n"&gt;Doing&lt;/span&gt; &lt;span class="n"&gt;spectral&lt;/span&gt; &lt;span class="n"&gt;cube&lt;/span&gt; &lt;span class="n"&gt;Briggs&lt;/span&gt; &lt;span class="n"&gt;weighting&lt;/span&gt; &lt;span class="n"&gt;formula&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;  &lt;span class="n"&gt;norm&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;task_tclean&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisDeconvolver&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;setupDeconvolution&lt;/span&gt;   &lt;span class="n"&gt;Set&lt;/span&gt; &lt;span class="n"&gt;Deconvolution&lt;/span&gt; &lt;span class="n"&gt;Options&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;S255IR&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;SMA1_sci&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;spw1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;manual&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;hogbom&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;     &lt;span class="n"&gt;WARN&lt;/span&gt;    &lt;span class="n"&gt;tclean&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;  &lt;span class="n"&gt;Memory&lt;/span&gt; &lt;span class="n"&gt;available&lt;/span&gt; &lt;span class="mi"&gt;187904819&lt;/span&gt; &lt;span class="n"&gt;kB&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;very&lt;/span&gt; &lt;span class="n"&gt;close&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;amount&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;required&lt;/span&gt; &lt;span class="n"&gt;memory&lt;/span&gt; &lt;span class="mi"&gt;3982754512&lt;/span&gt; &lt;span class="n"&gt;kB&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;task_tclean&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisImager&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;makePSF&lt;/span&gt;   &lt;span class="o"&gt;-----------------------------------------------------------&lt;/span&gt; &lt;span class="n"&gt;Make&lt;/span&gt; &lt;span class="n"&gt;PSF&lt;/span&gt; &lt;span class="o"&gt;---------------------------------------------&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;task_tclean&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;nSubCubeFitInMemory&lt;/span&gt;    &lt;span class="n"&gt;Required&lt;/span&gt; &lt;span class="n"&gt;memory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;5.468e+05&lt;/span&gt; &lt;span class="n"&gt;GB&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Available&lt;/span&gt; &lt;span class="n"&gt;mem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;166.3&lt;/span&gt; &lt;span class="n"&gt;GB&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;fraction&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;70&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;memory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Subcubes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;1920.&lt;/span&gt; &lt;span class="n"&gt;Processes&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;64.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Well, there's no error there, but the PSF maker can't handle making even a
single frame.  It had no trouble making a 9600x9600 MTMFS image for the
continuum, though, so it's pretty unclear to me why the cube is getting
OOM-killed.  My best guess is that the 64 processes are too much for CASA to
handle, and I need to run with fewer to &amp;quot;trick&amp;quot; it into not using up that much
memory at once.   Maybe I just need to make the PSFs in serial mode.  I don't
want to wait around to make the cubes, let alone clean them, in serial mode.&lt;/p&gt;
&lt;ol class="arabic simple" start="3"&gt;
&lt;li&gt;Parallel failed with this:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;tclean&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;  &lt;span class="c1"&gt;##########################################&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;tclean&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;  &lt;span class="c1"&gt;##### Begin Task: tclean             #####&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;tclean&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;  &lt;span class="n"&gt;tclean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;vis&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;calibrated_final.ms&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;selectdata&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;field&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;S255IR-SMA1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;spw&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timerange&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uvrange&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;antenna&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;observation&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;intent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;datacolumn&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;corrected&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;imagename&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;S255IR-SMA1_sci.spw1.cube.I.zoom.manual&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;imsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;cell&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;0.0042arcsec&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;phasecenter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stokes&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;I&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;projection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;SIN&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;startmodel&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;specmode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;cube&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;reffreq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;nchan&lt;/span&gt;&lt;span class="o"&gt;=-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;outframe&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;lsrk&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;veltype&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;radio&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;restfreq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt; &lt;span class="n"&gt;interpolation&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;linear&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;perchanweightdensity&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gridder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;standard&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;facets&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;psfphasecenter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;wprojplanes&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;vptable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mosweight&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;aterm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;psterm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;wbawp&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;conjbeams&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cfcache&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;usepointing&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;computepastep&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;360.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;rotatepastep&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;360.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pointingoffsetsigdev&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt; &lt;span class="n"&gt;pblimit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;normtype&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;flatnoise&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;deconvolver&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;hogbom&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;scales&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt; &lt;span class="n"&gt;nterms&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;smallscalebias&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;restoration&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;restoringbeam&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt; &lt;span class="n"&gt;pbcor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;outlierfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;weighting&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;briggs&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;robust&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;noise&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1.0Jy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;npixels&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;uvtaper&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt; &lt;span class="n"&gt;niter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;10000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;gain&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;threshold&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;10mJy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;nsigma&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cycleniter&lt;/span&gt;&lt;span class="o"&gt;=-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cyclefactor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;1.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;minpsffraction&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.05&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;maxpsffraction&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;interactive&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;usemask&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;user&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mask&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pbmask&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sidelobethreshold&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;3.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;noisethreshold&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;5.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lownoisethreshold&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;1.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;negativethreshold&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;smoothfactor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;1.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;minbeamfrac&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cutthreshold&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.01&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;growiterations&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;75&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dogrowprune&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;minpercentchange&lt;/span&gt;&lt;span class="o"&gt;=-&lt;/span&gt;&lt;span class="mf"&gt;1.0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;verbose&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fastnoise&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;restart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;savemodel&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;none&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;calcres&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;calcpsf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;psfcutoff&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.35&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;parallel&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;tclean&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;  &lt;span class="n"&gt;Verifying&lt;/span&gt; &lt;span class="n"&gt;Input&lt;/span&gt; &lt;span class="n"&gt;Parameters&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;selectData&lt;/span&gt;  &lt;span class="n"&gt;MS&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;calibrated_final&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ms&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Selecting&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;fields&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;S255IR&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;SMA1&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;Selecting&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;spw&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Opened&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;readonly&lt;/span&gt; &lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;selectData&lt;/span&gt;    &lt;span class="n"&gt;NRows&lt;/span&gt; &lt;span class="n"&gt;selected&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;tclean&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;  &lt;span class="n"&gt;Task&lt;/span&gt; &lt;span class="n"&gt;tclean&lt;/span&gt; &lt;span class="n"&gt;raised&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;exception&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RuntimeError&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;following&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Parallel&lt;/span&gt; &lt;span class="n"&gt;transport&lt;/span&gt; &lt;span class="n"&gt;layer&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;initialized&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;tclean&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;  &lt;span class="n"&gt;Task&lt;/span&gt; &lt;span class="n"&gt;tclean&lt;/span&gt; &lt;span class="n"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Start&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;19.103483&lt;/span&gt; &lt;span class="n"&gt;End&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;09&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;19.314353&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;tclean&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;  &lt;span class="c1"&gt;##### End Task: tclean               #####&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;tclean&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;  &lt;span class="c1"&gt;##########################################&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I'm guessing this is a bad error message and the real error is that the data
selection failed.  Probably when I copied over the &lt;tt class="docutils literal"&gt;continuum_final.ms.backup&lt;/tt&gt;
file, it uses the original numbering (spw 25, 27, etc.) instead of the new
numbering.  I guess the renumbering is cased by &lt;tt class="docutils literal"&gt;uvcontsub&lt;/tt&gt;, which I'm now
skipping because it may have broken my data and because I'd rather image the
continuum.  That proved correct; the error message above just means that I
selected a nonexistent SPW.&lt;/p&gt;
&lt;div class="section" id="flagged-out-lines"&gt;
&lt;h2&gt;Flagged Out Lines&lt;/h2&gt;
&lt;p&gt;After re-copying over the calibrated MS and confirming that &lt;cite&gt;no&lt;/cite&gt; lines were flagged out,
I re-imaged... and the lines are again missing.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# show the flags graphically&lt;/span&gt;
&lt;span class="n"&gt;flagdata&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;calibrated_final.ms&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;summary&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;spwchan&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;display&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;both&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;img alt="Flag data plot showing evidence of the flagged-out lines" src="https://keflavich.github.io/blog/images/flagdataplot.png" style="width: 600px;" /&gt;
&lt;p&gt;The flags are coming from tclean, which makes no sense.&lt;/p&gt;
&lt;p&gt;There are messages like these:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2021-12-08 15:27:19     WARN    MPICommandServer::command_request_handler_service::SIImageStore::getPSFGaussian::MPIServer-51 (file src/code/synthesis/ImagerObjects/SIImageStore.cc, line 2037)        PSF is blank for[C9:P0] [C10:P0] [C11:P0] [C12:P0] [C13:P0] [C14:P0] [C15:P0] [C16:P0] [C17:P0] [C23:P0] [C24:P0] [C25:P0] [C26:P0]
&lt;/pre&gt;
&lt;p&gt;scattered throughout the PSF making.&lt;/p&gt;
&lt;p&gt;The PSF spectrum ends up like this:&lt;/p&gt;
&lt;img alt="PSF vs frequency showing flagged out channels" src="https://keflavich.github.io/blog/images/PSF_vs_Frq.png" style="width: 600px;" /&gt;
&lt;p&gt;Channels are totally flagged out.  But in the data, they are not:&lt;/p&gt;
&lt;img alt="The data not flagged out" src="https://keflavich.github.io/blog/images/notflagged_data.png" style="width: 600px;" /&gt;
&lt;p&gt;Running the &lt;tt class="docutils literal"&gt;tclean&lt;/tt&gt; without parallel, i.e. with &lt;tt class="docutils literal"&gt;parallel=False&lt;/tt&gt;, resulted
in a smooth, unbroken PSF.&lt;/p&gt;
&lt;p&gt;So, if we dig back into what happened in the parallel tclean....&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;selectData&lt;/span&gt;    &lt;span class="n"&gt;NRows&lt;/span&gt; &lt;span class="n"&gt;selected&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;848700&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;defineImage&lt;/span&gt;         &lt;span class="n"&gt;Define&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="n"&gt;coordinates&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;S255IR&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;SMA1_sci&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;spw0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;zoom&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;manual&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MSTransformRegridder&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;calcChanFreqs&lt;/span&gt;      &lt;span class="n"&gt;phaseCenter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Direction: [-0.0535075, 0.949606, 0.308847]&amp;#39;&lt;/span&gt;  &lt;span class="n"&gt;Channels&lt;/span&gt; &lt;span class="n"&gt;equidistant&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;freq&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MSTransformRegridder&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;calcChanFreqs&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;     &lt;span class="n"&gt;Central&lt;/span&gt; &lt;span class="n"&gt;frequency&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;output&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;2.345e+11&lt;/span&gt; &lt;span class="n"&gt;Hz&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MSTransformRegridder&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;calcChanFreqs&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;     &lt;span class="n"&gt;Width&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;central&lt;/span&gt; &lt;span class="n"&gt;channel&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;output&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;976510&lt;/span&gt; &lt;span class="n"&gt;Hz&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MSTransformRegridder&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;calcChanFreqs&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;     &lt;span class="n"&gt;Number&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;channels&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1920&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MSTransformRegridder&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;calcChanFreqs&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;     &lt;span class="n"&gt;Total&lt;/span&gt; &lt;span class="n"&gt;width&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;SPW&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;output&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;1.8749e+09&lt;/span&gt; &lt;span class="n"&gt;Hz&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MSTransformRegridder&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;calcChanFreqs&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;     &lt;span class="n"&gt;Lower&lt;/span&gt; &lt;span class="n"&gt;edge&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;2.33563e+11&lt;/span&gt; &lt;span class="n"&gt;Hz&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;upper&lt;/span&gt; &lt;span class="n"&gt;edge&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;2.35437e+11&lt;/span&gt; &lt;span class="n"&gt;Hz&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;defineImage&lt;/span&gt;         &lt;span class="n"&gt;Impars&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;defineImage&lt;/span&gt;         &lt;span class="n"&gt;Shape&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1920&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="n"&gt;Spectral&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mf"&gt;2.33563e+11&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;increment&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;976510&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;defineImage&lt;/span&gt;         &lt;span class="n"&gt;Set&lt;/span&gt; &lt;span class="n"&gt;Gridding&lt;/span&gt; &lt;span class="n"&gt;options&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;S255IR&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;SMA1_sci&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;spw0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;zoom&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;manual&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;ftmachine&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;gridft&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;nSubCubeFitInMemory&lt;/span&gt; &lt;span class="n"&gt;Required&lt;/span&gt; &lt;span class="n"&gt;memory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1483&lt;/span&gt; &lt;span class="n"&gt;GB&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Available&lt;/span&gt; &lt;span class="n"&gt;mem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;173.6&lt;/span&gt; &lt;span class="n"&gt;GB&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mem&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;fraction&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;70&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;memory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Subcubes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;9.&lt;/span&gt; &lt;span class="n"&gt;Processes&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;node&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;64.&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;    &lt;span class="n"&gt;Set&lt;/span&gt; &lt;span class="n"&gt;imaging&lt;/span&gt; &lt;span class="n"&gt;weights&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Briggs&lt;/span&gt; &lt;span class="n"&gt;weighting&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;sidelobes&lt;/span&gt; &lt;span class="n"&gt;will&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;suppressed&lt;/span&gt; &lt;span class="n"&gt;over&lt;/span&gt; &lt;span class="n"&gt;full&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;    &lt;span class="n"&gt;Doing&lt;/span&gt; &lt;span class="n"&gt;spectral&lt;/span&gt; &lt;span class="n"&gt;cube&lt;/span&gt; &lt;span class="n"&gt;Briggs&lt;/span&gt; &lt;span class="n"&gt;weighting&lt;/span&gt; &lt;span class="n"&gt;formula&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;  &lt;span class="n"&gt;norm&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;task_tclean&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisDeconvolver&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;setupDeconvolution&lt;/span&gt;   &lt;span class="n"&gt;Set&lt;/span&gt; &lt;span class="n"&gt;Deconvolution&lt;/span&gt; &lt;span class="n"&gt;Options&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;S255IR&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;SMA1_sci&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;spw0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;zoom&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;manual&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;hogbom&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;task_tclean&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisImager&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;makePSF&lt;/span&gt;   &lt;span class="o"&gt;-----------------------------------------------------------&lt;/span&gt; &lt;span class="n"&gt;Make&lt;/span&gt; &lt;span class="n"&gt;PSF&lt;/span&gt; &lt;span class="o"&gt;---------------------------------------------&lt;/span&gt;

&lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;bunch&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;stuff&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;

&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;makePrimaryBeam&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt;    &lt;span class="n"&gt;vi2&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Evaluating&lt;/span&gt; &lt;span class="n"&gt;Primary&lt;/span&gt; &lt;span class="n"&gt;Beam&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt; &lt;span class="n"&gt;onto&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="n"&gt;grid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;makePrimaryBeam&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;38&lt;/span&gt;    &lt;span class="n"&gt;vi2&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Evaluating&lt;/span&gt; &lt;span class="n"&gt;Primary&lt;/span&gt; &lt;span class="n"&gt;Beam&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt; &lt;span class="n"&gt;onto&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="n"&gt;grid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SIImageStore&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;calcSensitivity&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt;  &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;S255IR&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;SMA1_sci&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;spw0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;I&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;zoom&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;manual&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="n"&gt;Theoretical&lt;/span&gt; &lt;span class="n"&gt;sensitivity&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Jy&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bm&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;span class="n"&gt;c0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c4&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c5&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c7&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c9&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c10&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c11&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c12&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c13&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.00121258&lt;/span&gt; &lt;span class="n"&gt;c14&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.00121257&lt;/span&gt; &lt;span class="n"&gt;c15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.00121255&lt;/span&gt; &lt;span class="n"&gt;c16&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c17&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c18&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c19&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c20&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c21&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c22&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c23&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c24&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c25&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;none&lt;/span&gt; &lt;span class="n"&gt;c26&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.00121253&lt;/span&gt; &lt;span class="n"&gt;c27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.00121253&lt;/span&gt; &lt;span class="n"&gt;c28&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.00121252&lt;/span&gt; &lt;span class="n"&gt;c29&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.00121251&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;     &lt;span class="n"&gt;WARN&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SIImageStore&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;getPSFGaussian&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;synthesis&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ImagerObjects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;SIImageStore&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;2037&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;        &lt;span class="n"&gt;PSF&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;blank&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C2&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C3&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C4&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C5&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C6&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C7&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C9&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C10&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C11&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C12&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C16&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C17&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C18&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C19&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C20&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C21&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C22&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C23&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C24&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;C25&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;P0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SIImageStore&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;getPSFGaussian&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt;   &lt;span class="n"&gt;Time&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;fit&lt;/span&gt; &lt;span class="n"&gt;Gaussian&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;PSF&lt;/span&gt; &lt;span class="mf"&gt;0.12&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SIImageStore&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;printBeamSet&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt;     &lt;span class="n"&gt;Restoring&lt;/span&gt; &lt;span class="n"&gt;Beams&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SIImageStore&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;printBeamSet&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt;   &lt;span class="n"&gt;Pol&lt;/span&gt;   &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="n"&gt;Chan&lt;/span&gt;         &lt;span class="n"&gt;Freq&lt;/span&gt;     &lt;span class="n"&gt;Vel&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SIImageStore&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;printBeamSet&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt;     &lt;span class="n"&gt;I&lt;/span&gt;    &lt;span class="n"&gt;Max&lt;/span&gt;    &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="mf"&gt;2.351450e+11&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;824.59&lt;/span&gt;    &lt;span class="mf"&gt;0.0254&lt;/span&gt; &lt;span class="n"&gt;arcsec&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;    &lt;span class="mf"&gt;0.0197&lt;/span&gt; &lt;span class="n"&gt;arcsec&lt;/span&gt; &lt;span class="n"&gt;pa&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;6.8506&lt;/span&gt; &lt;span class="n"&gt;deg&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SIImageStore&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;printBeamSet&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt;     &lt;span class="n"&gt;I&lt;/span&gt;    &lt;span class="n"&gt;Min&lt;/span&gt;    &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="mf"&gt;2.351460e+11&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;825.84&lt;/span&gt;    &lt;span class="mf"&gt;0.0000&lt;/span&gt; &lt;span class="n"&gt;arcsec&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;    &lt;span class="mf"&gt;0.0000&lt;/span&gt; &lt;span class="n"&gt;arcsec&lt;/span&gt; &lt;span class="n"&gt;pa&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="mf"&gt;0.0000&lt;/span&gt; &lt;span class="n"&gt;deg&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SIImageStore&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;printBeamSet&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;54&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt;     &lt;span class="n"&gt;I&lt;/span&gt; &lt;span class="n"&gt;Median&lt;/span&gt;    &lt;span class="mi"&gt;9&lt;/span&gt; &lt;span class="mf"&gt;2.351538e+11&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;835.82&lt;/span&gt;    &lt;span class="mf"&gt;0.0254&lt;/span&gt; &lt;span class="n"&gt;arcsec&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;    &lt;span class="mf"&gt;0.0197&lt;/span&gt; &lt;span class="n"&gt;arcsec&lt;/span&gt; &lt;span class="n"&gt;pa&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;6.8506&lt;/span&gt; &lt;span class="n"&gt;deg&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;These blank psfs are &lt;cite&gt;wrong&lt;/cite&gt;, there are no flagged data in this data set (no flagged channels).
Something about the parallel version of clean is reading the data wrong.&lt;/p&gt;
&lt;div class="section" id="solution"&gt;
&lt;h3&gt;Solution&lt;/h3&gt;
&lt;p&gt;I finally solved this by manually unflagging the channels.  Thanks to Brian
Svoboda for helping with the antenna selection syntax.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;flagdata&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;linevis&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;spw&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;orig_spw&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;antenna&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;*&amp;amp;*&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;unflag&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I don't understand why flagdata was showing the channels as being unflagged,
as they were clearly flagged in all data sets (original &amp;amp; backup).
I don't understand _when_ they were flagged, either, as it seems they were
flagged even before continuum imaging was done.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="data reduction"></category></entry><entry><title>CASA reading incorrect number of bytes w/MPI</title><link href="https://keflavich.github.io/blog/casa-reading-incorrect-number-of-bytes-wmpi.html" rel="alternate"></link><published>2021-12-02T08:15:00-07:00</published><updated>2021-12-02T08:15:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2021-12-02:/blog/casa-reading-incorrect-number-of-bytes-wmpi.html</id><summary type="html">&lt;p&gt;Running big MPI runs again, I encounter errors like these one:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2021-12-02 07:02:26      WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-25 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)        Exception for chan range [1434, 1445] ---   FilebufIO::readBlock - incorr
ect number of bytes read for file /blue …&lt;/pre&gt;</summary><content type="html">&lt;p&gt;Running big MPI runs again, I encounter errors like these one:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2021-12-02 07:02:26      WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-25 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)        Exception for chan range [1434, 1445] ---   FilebufIO::readBlock - incorr
ect number of bytes read for file /blue/adamginsburg/adamginsburg/almaimf/workdir/G327.29_B6_spw7_12M_spw7.sumwt/table.f0
##################################
#############################
Exception: FilebufIO::readBlock - incorrect number of bytes read for file /blue/adamginsburg/adamginsburg/almaimf/workdir/G327.29_B6_spw7_12M_spw7.sumwt/table.f0


2021-12-02 06:03:53        WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-13 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)        Exception for chan range [550, 560] ---   FilebufIO::readBlock - incorrect number
 of bytes read for file /blue/adamginsburg/adamginsburg/almaimf/workdir/G327.29_B6_spw4_12M_spw4.sumwt/table.f0
##################################
#############################
Exception: FilebufIO::readBlock - incorrect number of bytes read for file /blue/adamginsburg/adamginsburg/almaimf/workdir/G327.29_B6_spw4_12M_spw4.sumwt/table.f0

2021-12-02 04:57:21 WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-9 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336) Exception for chan range [1563, 1574] ---   FilebufIO::readBlock
- incorrect number of bytes read for file /blue/adamginsburg/adamginsburg/almaimf/workdir/G327.29_B6_spw0_12M_spw0.sumwt/table.f0
##################################
#############################
Exception: FilebufIO::readBlock - incorrect number of bytes read for file /blue/adamginsburg/adamginsburg/almaimf/workdir/G327.29_B6_spw0_12M_spw0.sumwt/table.f0
&lt;/pre&gt;
&lt;p&gt;This is only quasi-repeatable.  For spw4, it happened after the 8th Major Cycle
the first time, then the 6th Major Cycle the second time.  By repeating the
cleans over and over, I was able to eventually get the results to converge.
It looks like these crashes are sporadic but don't affect the data.&lt;/p&gt;
</content><category term="misc"></category><category term="casa"></category></entry><entry><title>CASA table locking with MPI</title><link href="https://keflavich.github.io/blog/casa-table-locking-with-mpi.html" rel="alternate"></link><published>2021-11-11T15:53:00-07:00</published><updated>2021-11-11T15:53:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2021-11-11:/blog/casa-table-locking-with-mpi.html</id><summary type="html">&lt;p&gt;A bunch of CASA MPI runs have race conditioned themselves into a corner, apparently:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt; &lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;     &lt;span class="n"&gt;WARN&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;CubeMajorCycle&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;synthesis&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ImagerObjects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;CubeMajorCycleAlgorithm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;336&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;chan&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;104&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;129&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;---&lt;/span&gt;   &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;masked&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;zero …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;A bunch of CASA MPI runs have race conditioned themselves into a corner, apparently:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt; &lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;     &lt;span class="n"&gt;WARN&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;CubeMajorCycle&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;synthesis&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ImagerObjects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;CubeMajorCycleAlgorithm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;336&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;chan&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;104&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;129&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;---&lt;/span&gt;   &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;masked&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;zero&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt; &lt;span class="n"&gt;startmodel&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Resource&lt;/span&gt; &lt;span class="n"&gt;deadlock&lt;/span&gt; &lt;span class="n"&gt;avoided&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;when&lt;/span&gt; &lt;span class="n"&gt;acquiring&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;almaimf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;workdir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;G351&lt;/span&gt;&lt;span class="mf"&gt;.77&lt;/span&gt;&lt;span class="n"&gt;_B6_spw1_12M_sio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contcube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;
&lt;span class="c1"&gt;##################################&lt;/span&gt;
&lt;span class="c1"&gt;#############################&lt;/span&gt;
&lt;span class="ne"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;masked&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;zero&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt; &lt;span class="n"&gt;startmodel&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Resource&lt;/span&gt; &lt;span class="n"&gt;deadlock&lt;/span&gt; &lt;span class="n"&gt;avoided&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;when&lt;/span&gt; &lt;span class="n"&gt;acquiring&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;almaimf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;workdir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;G351&lt;/span&gt;&lt;span class="mf"&gt;.77&lt;/span&gt;&lt;span class="n"&gt;_B6_spw1_12M_sio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contcube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt; &lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;     &lt;span class="n"&gt;WARN&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;CubeMajorCycle&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;synthesis&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ImagerObjects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;CubeMajorCycleAlgorithm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;336&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;        &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;chan&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;234&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;258&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;---&lt;/span&gt;   &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;masked&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;zero&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt; &lt;span class="n"&gt;startmodel&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Resource&lt;/span&gt; &lt;span class="n"&gt;deadlock&lt;/span&gt; &lt;span class="n"&gt;avoided&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;when&lt;/span&gt; &lt;span class="n"&gt;acquiring&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;almaimf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;workdir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;G351&lt;/span&gt;&lt;span class="mf"&gt;.77&lt;/span&gt;&lt;span class="n"&gt;_B6_spw1_12M_sio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contcube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;
&lt;span class="c1"&gt;##################################&lt;/span&gt;
&lt;span class="c1"&gt;#############################&lt;/span&gt;
&lt;span class="ne"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;masked&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;zero&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt; &lt;span class="n"&gt;startmodel&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Resource&lt;/span&gt; &lt;span class="n"&gt;deadlock&lt;/span&gt; &lt;span class="n"&gt;avoided&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;when&lt;/span&gt; &lt;span class="n"&gt;acquiring&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;almaimf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;workdir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;G351&lt;/span&gt;&lt;span class="mf"&gt;.77&lt;/span&gt;&lt;span class="n"&gt;_B6_spw1_12M_sio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contcube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt; &lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;     &lt;span class="n"&gt;WARN&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;CubeMajorCycle&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;synthesis&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ImagerObjects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;CubeMajorCycleAlgorithm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;336&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;chan&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;208&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;233&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;---&lt;/span&gt;   &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;masked&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;zero&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt; &lt;span class="n"&gt;startmodel&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Resource&lt;/span&gt; &lt;span class="n"&gt;deadlock&lt;/span&gt; &lt;span class="n"&gt;avoided&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;when&lt;/span&gt; &lt;span class="n"&gt;acquiring&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;almaimf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;workdir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;G351&lt;/span&gt;&lt;span class="mf"&gt;.77&lt;/span&gt;&lt;span class="n"&gt;_B6_spw1_12M_sio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contcube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;
&lt;span class="c1"&gt;##################################&lt;/span&gt;
&lt;span class="c1"&gt;#############################&lt;/span&gt;
&lt;span class="ne"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;masked&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;zero&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt; &lt;span class="n"&gt;startmodel&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Resource&lt;/span&gt; &lt;span class="n"&gt;deadlock&lt;/span&gt; &lt;span class="n"&gt;avoided&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;when&lt;/span&gt; &lt;span class="n"&gt;acquiring&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;almaimf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;workdir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;G351&lt;/span&gt;&lt;span class="mf"&gt;.77&lt;/span&gt;&lt;span class="n"&gt;_B6_spw1_12M_sio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contcube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt; &lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;     &lt;span class="n"&gt;WARN&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;CubeMajorCycle&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;synthesis&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ImagerObjects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;CubeMajorCycleAlgorithm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;336&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;chan&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;51&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;---&lt;/span&gt;   &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;masked&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;zero&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt; &lt;span class="n"&gt;startmodel&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Resource&lt;/span&gt; &lt;span class="n"&gt;deadlock&lt;/span&gt; &lt;span class="n"&gt;avoided&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;when&lt;/span&gt; &lt;span class="n"&gt;acquiring&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;almaimf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;workdir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;G351&lt;/span&gt;&lt;span class="mf"&gt;.77&lt;/span&gt;&lt;span class="n"&gt;_B6_spw1_12M_sio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contcube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;
&lt;span class="c1"&gt;##################################&lt;/span&gt;
&lt;span class="c1"&gt;#############################&lt;/span&gt;
&lt;span class="ne"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;masked&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;zero&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt; &lt;span class="n"&gt;startmodel&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Resource&lt;/span&gt; &lt;span class="n"&gt;deadlock&lt;/span&gt; &lt;span class="n"&gt;avoided&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;when&lt;/span&gt; &lt;span class="n"&gt;acquiring&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;almaimf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;workdir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;G351&lt;/span&gt;&lt;span class="mf"&gt;.77&lt;/span&gt;&lt;span class="n"&gt;_B6_spw1_12M_sio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contcube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;07&lt;/span&gt; &lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;33&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;     &lt;span class="n"&gt;WARN&lt;/span&gt;    &lt;span class="n"&gt;MPICommandServer&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;command_request_handler_service&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;SynthesisImagerVi2&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;CubeMajorCycle&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;MPIServer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;synthesis&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ImagerObjects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;CubeMajorCycleAlgorithm&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;336&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;        &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;chan&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;359&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;383&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;---&lt;/span&gt;   &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;masked&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;zero&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt; &lt;span class="n"&gt;startmodel&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Resource&lt;/span&gt; &lt;span class="n"&gt;deadlock&lt;/span&gt; &lt;span class="n"&gt;avoided&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;when&lt;/span&gt; &lt;span class="n"&gt;acquiring&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;almaimf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;workdir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;G351&lt;/span&gt;&lt;span class="mf"&gt;.77&lt;/span&gt;&lt;span class="n"&gt;_B6_spw1_12M_sio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contcube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;
&lt;span class="c1"&gt;##################################&lt;/span&gt;
&lt;span class="c1"&gt;#############################&lt;/span&gt;
&lt;span class="ne"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Setting&lt;/span&gt; &lt;span class="n"&gt;masked&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;zero&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;input&lt;/span&gt; &lt;span class="n"&gt;startmodel&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Resource&lt;/span&gt; &lt;span class="n"&gt;deadlock&lt;/span&gt; &lt;span class="n"&gt;avoided&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;when&lt;/span&gt; &lt;span class="n"&gt;acquiring&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;almaimf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;workdir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;G351&lt;/span&gt;&lt;span class="mf"&gt;.77&lt;/span&gt;&lt;span class="n"&gt;_B6_spw1_12M_sio&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contcube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This shows up in ~10 runs that I started around the same time, but I don't usually see it.&lt;/p&gt;
&lt;p&gt;This looks like a serious bug having to do with using a startmodel: there is a line earlier copying the startmodel to the model:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2021-11-07 23:27:44     INFO    SIImageStore::setModelImageOne  Copying input model /blue/adamginsburg/adamginsburg/almaimf/workdir//G351.77_B6_spw1_12M_sio.contcube.model to /blue/adamginsburg/adamginsburg/almaimf/workdir/G351.77_B6_spw1_12M_sio.model
&lt;/pre&gt;
&lt;p&gt;but MPI seems to have gotten mixed up and is sill trying to write to the contcube.model&lt;/p&gt;
</content><category term="misc"></category><category term="casa"></category></entry><entry><title>CASA doesn't like VaryingResolutionSpectralCubes</title><link href="https://keflavich.github.io/blog/casa-doesnt-like-varyingresolutionspectralcubes.html" rel="alternate"></link><published>2021-11-09T19:53:00-07:00</published><updated>2021-11-09T19:53:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2021-11-09:/blog/casa-doesnt-like-varyingresolutionspectralcubes.html</id><summary type="html">&lt;p&gt;I get this from trying to run &lt;tt class="docutils literal"&gt;makemask&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;copy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="n"&gt;inpimage&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;lineimagename&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.image&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="n"&gt;inpmask&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;lineimagename&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.image:mask0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;lineimagename&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.mask&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;        &lt;span class="c1"&gt;##########################################&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;        &lt;span class="c1"&gt;##### Begin Task: makemask           #####&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;makemask …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;I get this from trying to run &lt;tt class="docutils literal"&gt;makemask&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;copy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="n"&gt;inpimage&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;lineimagename&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.image&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="n"&gt;inpmask&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;lineimagename&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.image:mask0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;lineimagename&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.mask&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;        &lt;span class="c1"&gt;##########################################&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;        &lt;span class="c1"&gt;##### Begin Task: makemask           #####&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;        &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;copy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;inpimage&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/blue/adamginsburg/adamginsburg/almaimf/workdir/G353.41_B6_spw5_12M_spw5.image&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;inpmask&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/blue/adamginsburg/adamginsburg/almaimf/workdir/G353.41_B6_spw5_12M_spw5.image:mask0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/blue/adamginsburg/adamginsburg/almaimf/workdir/G353.41_B6_spw5_12M_spw5.mask&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;overwrite&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;inpfreqs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[],&lt;/span&gt; &lt;span class="n"&gt;outfreqs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[]&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;ImageFactory&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;createImage&lt;/span&gt;     &lt;span class="n"&gt;Created&lt;/span&gt; &lt;span class="n"&gt;Paged&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__tmp_outputmask_22199&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;shape&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1080&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;900&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;480&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;float&lt;/span&gt; &lt;span class="n"&gt;valued&lt;/span&gt; &lt;span class="n"&gt;pixels&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;        &lt;span class="n"&gt;Summing&lt;/span&gt; &lt;span class="nb"&gt;all&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;F&lt;/span&gt; &lt;span class="n"&gt;mask&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;inpmask&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;normalized&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;mask&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;51&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;regrid&lt;/span&gt;   &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="n"&gt;Reported&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ne"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;An&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;multiple&lt;/span&gt; &lt;span class="n"&gt;beams&lt;/span&gt; &lt;span class="n"&gt;cannot&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;regridded&lt;/span&gt; &lt;span class="n"&gt;along&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;spectral&lt;/span&gt; &lt;span class="n"&gt;axis&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;You&lt;/span&gt; &lt;span class="n"&gt;may&lt;/span&gt; &lt;span class="n"&gt;wish&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;convolve&lt;/span&gt; &lt;span class="nb"&gt;all&lt;/span&gt; &lt;span class="n"&gt;channels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;common&lt;/span&gt; &lt;span class="n"&gt;resolution&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;retry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;51&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;regrid&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="n"&gt;thrown&lt;/span&gt; &lt;span class="n"&gt;by&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;shared_ptr&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;casa6core&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;ImageInterface&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;casa&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;ImageRegridder&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;regrid&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="n"&gt;const&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;float&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;File&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;imageanalysis&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ImageAnalysis&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ImageRegridder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tcc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;102&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;52&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;            &lt;span class="n"&gt;deleted&lt;/span&gt; &lt;span class="n"&gt;table&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;blue&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;adamginsburg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;almaimf&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;workdir&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;G353&lt;/span&gt;&lt;span class="mf"&gt;.41&lt;/span&gt;&lt;span class="n"&gt;_spw5_12M_B6&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;_tmp_copy___tmp_frominmask_22199&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;calc&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tools&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;image_cmpt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;553&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;      &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="n"&gt;Reported&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;ImageExprParse&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__tmp_fromTFmask_22199&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;unknown&lt;/span&gt; &lt;span class="n"&gt;lattice&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;unqualified&lt;/span&gt; &lt;span class="n"&gt;region&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;calc&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tools&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;image_cmpt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;553&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;     &lt;span class="n"&gt;Scanned&lt;/span&gt; &lt;span class="n"&gt;so&lt;/span&gt; &lt;span class="n"&gt;far&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;iif&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;__tmp_fromTFmask_22199&amp;quot;&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;        &lt;span class="n"&gt;Task&lt;/span&gt; &lt;span class="n"&gt;makemask&lt;/span&gt; &lt;span class="n"&gt;raised&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;exception&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RuntimeError&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;following&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;***&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;mode&lt;/span&gt; &lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;***&lt;/span&gt; &lt;span class="n"&gt;ImageExprParse&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__tmp_fromTFmask_22199&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;unknown&lt;/span&gt; &lt;span class="n"&gt;lattice&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;unqualified&lt;/span&gt; &lt;span class="n"&gt;region&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;       &lt;span class="n"&gt;Scanned&lt;/span&gt; &lt;span class="n"&gt;so&lt;/span&gt; &lt;span class="n"&gt;far&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;iif&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;__tmp_fromTFmask_22199&amp;quot;&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;        &lt;span class="n"&gt;Task&lt;/span&gt; &lt;span class="n"&gt;makemask&lt;/span&gt; &lt;span class="n"&gt;complete&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;Start&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;09.614534&lt;/span&gt; &lt;span class="n"&gt;End&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt; &lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;56.399654&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;        &lt;span class="c1"&gt;##### End Task: makemask             #####&lt;/span&gt;
 &lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;     &lt;span class="n"&gt;INFO&lt;/span&gt;    &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;        &lt;span class="c1"&gt;##########################################&lt;/span&gt;


&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;51&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;regrid&lt;/span&gt;   &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="n"&gt;Reported&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ne"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;An&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;multiple&lt;/span&gt; &lt;span class="n"&gt;beams&lt;/span&gt; &lt;span class="n"&gt;cannot&lt;/span&gt; &lt;span class="n"&gt;be&lt;/span&gt; &lt;span class="n"&gt;regridded&lt;/span&gt; &lt;span class="n"&gt;along&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;spectral&lt;/span&gt; &lt;span class="n"&gt;axis&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;You&lt;/span&gt; &lt;span class="n"&gt;may&lt;/span&gt; &lt;span class="n"&gt;wish&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;convolve&lt;/span&gt; &lt;span class="nb"&gt;all&lt;/span&gt; &lt;span class="n"&gt;channels&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;common&lt;/span&gt;
 &lt;span class="n"&gt;resolution&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;retry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;51&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;regrid&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;  &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="n"&gt;thrown&lt;/span&gt; &lt;span class="n"&gt;by&lt;/span&gt; &lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;shared_ptr&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;casa6core&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;ImageInterface&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;casa&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;ImageRegridder&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;regrid&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="n"&gt;const&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;float&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;File&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;code&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;imageanalysis&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;Imag&lt;/span&gt;
&lt;span class="n"&gt;eAnalysis&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;ImageRegridder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tcc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;102&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;calc&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tools&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;image_cmpt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;553&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;      &lt;span class="ne"&gt;Exception&lt;/span&gt; &lt;span class="n"&gt;Reported&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;ImageExprParse&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__tmp_fromTFmask_22199&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;unknown&lt;/span&gt; &lt;span class="n"&gt;lattice&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;it&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;un&lt;/span&gt;
&lt;span class="n"&gt;qualified&lt;/span&gt; &lt;span class="n"&gt;region&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;calc&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;tools&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;image_cmpt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;553&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;     &lt;span class="n"&gt;Scanned&lt;/span&gt; &lt;span class="n"&gt;so&lt;/span&gt; &lt;span class="n"&gt;far&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;iif&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;__tmp_fromTFmask_22199&amp;quot;&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;        &lt;span class="n"&gt;Task&lt;/span&gt; &lt;span class="n"&gt;makemask&lt;/span&gt; &lt;span class="n"&gt;raised&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;exception&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RuntimeError&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;following&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;***&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;mode&lt;/span&gt; &lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;***&lt;/span&gt; &lt;span class="n"&gt;ImageExprParse&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__tmp_fromTF&lt;/span&gt;
&lt;span class="n"&gt;mask_22199&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; is an unknown lattice or image or it is an unqualified region&lt;/span&gt;
&lt;span class="mi"&gt;2021&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;09&lt;/span&gt; &lt;span class="mi"&gt;02&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;     &lt;span class="n"&gt;SEVERE&lt;/span&gt;  &lt;span class="n"&gt;makemask&lt;/span&gt;&lt;span class="p"&gt;::::&lt;/span&gt;&lt;span class="n"&gt;casa&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;       &lt;span class="n"&gt;Scanned&lt;/span&gt; &lt;span class="n"&gt;so&lt;/span&gt; &lt;span class="n"&gt;far&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;iif&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;__tmp_fromTFmask_22199&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I'm pretty sure the complaint is caused by the top line: there are multiple
beams in the image.  This is _absurd_, though, because the &lt;cite&gt;makemask&lt;/cite&gt; command
should not care at all about beams, there is no spectral regridding happening.&lt;/p&gt;
&lt;p&gt;This might be new to CASA 6.4, not sure.&lt;/p&gt;
&lt;p&gt;EDIT 2021-11-11 15:51:
The workaround is easy and maybe better:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ia&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lineimagename&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.image&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;shape&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ia&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;csys&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ia&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;coordsys&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;torecord&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;ia&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;ia&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fromshape&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;outfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;lineimagename&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.mask&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;csys&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;csys&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content><category term="misc"></category><category term="casa"></category><category term="bug"></category></entry><entry><title>Walkthrough of PSF characterization</title><link href="https://keflavich.github.io/blog/walkthrough-of-psf-characterization.html" rel="alternate"></link><published>2021-11-06T17:37:00-06:00</published><updated>2021-11-06T17:37:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2021-11-06:/blog/walkthrough-of-psf-characterization.html</id><summary type="html">&lt;p&gt;For ALMA-IMF, we want to characterize the PSF shapes and the recovered
beam sizes.&lt;/p&gt;
&lt;p&gt;We showed the beams and a few features of the PSFs, but they were only
described tersely in the paper. This document goes through what we did
in a little more detail&lt;/p&gt;
&lt;div class="section" id="front-matter-imports"&gt;
&lt;h2&gt;Front matter (imports)&lt;/h2&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;matplotlib …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;For ALMA-IMF, we want to characterize the PSF shapes and the recovered
beam sizes.&lt;/p&gt;
&lt;p&gt;We showed the beams and a few features of the PSFs, but they were only
described tersely in the paper. This document goes through what we did
in a little more detail&lt;/p&gt;
&lt;div class="section" id="front-matter-imports"&gt;
&lt;h2&gt;Front matter (imports)&lt;/h2&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;matplotlib&lt;/span&gt; &lt;span class="n"&gt;inline&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pylab&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pl&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="c1"&gt;# for display within notebook&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rcParams&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'figure.facecolor'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'w'&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;spectral_cube&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;SpectralCube&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;units&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="c1"&gt;# Debuggy loading: this approach needed b/c the code isn't properly packaged&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;imp&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/orange/adamginsburg/ALMA_IMF/reduction/analysis'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;imstats&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;imp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;imstats&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;imstats&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;get_psf_secondpeak&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="n2h"&gt;
&lt;h2&gt;N2H+&lt;/h2&gt;
&lt;p&gt;I chose to do this only for an N&lt;span class="math"&gt;\(_2\)&lt;/span&gt;H+ example; the
N&lt;span class="math"&gt;\(_2\)&lt;/span&gt;H+ line cubes seem to have the worst-behaved beams in our
samples.&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;basename&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'/orange/adamginsburg/ALMAIMF_Images/G327.29/B3/linecubes_12m/G327.29_B3_spw0_12M_n2hp'&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;img&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SpectralCube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;basename&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt;.image'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;psf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SpectralCube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;basename&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt;.psf'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'casa_image'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;The code &lt;tt class="docutils literal"&gt;get_psf_secondpeak&lt;/tt&gt; does all of the work, we’re just going
to talk about what gets plotted.&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;psffn&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;basename&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt;.psf'&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;psf_secondpeak&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;psf_secondpeak_loc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;psf_sidelobe1_fraction&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;epsilon&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;firstnull&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;r_sidelobe&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pixscale&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cutout&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;beam&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fullbeam&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;view&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bmfit_residual&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; \
        &lt;span class="n"&gt;get_psf_secondpeak&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;psffn&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;show_image&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;min_radial_extent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;2.5&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arcsec&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;                   &lt;span class="n"&gt;max_radial_extent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arcsec&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;                           &lt;span class="n"&gt;specslice&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;50&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;51&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;                  &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;pre class="literal-block"&gt;
INFO: first_sidelobe_ind=44, first_min_ind = 43 [imstats]
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_6_1.png" /&gt;
&lt;p&gt;The plot is showing:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;in red contours, the 10th, 50th, and 90th percentile of the Gaussian
synthesized beam&lt;/li&gt;
&lt;li&gt;in grayscale, the &lt;em&gt;residual&lt;/em&gt; of the dirty beam minus the synthesized
beam&lt;/li&gt;
&lt;li&gt;in green dashed (faint, outermost ellipse), the location of the first
sidelobe peak. The first sidelobe is defined as the first peak
outside of the first null.&lt;/li&gt;
&lt;li&gt;in blue dashed (inner ellipse), the location of the first null. This
may not be a true null: it is the first minimum of the radial profile&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Next, we show the radial profile. The radial profile is an &lt;em&gt;elliptical&lt;/em&gt;
profile, which is why the elliptical synthesized beam has a single
profile.&lt;/p&gt;
&lt;p&gt;The X-axis is calculated as:&lt;/p&gt;
&lt;div class="math"&gt;
\begin{equation*}
r = \left(C^2 (x \cos \theta + y \sin \theta)^2 + (x \sin \theta - y \cos \theta)^2\right)^{1/2}
\end{equation*}
&lt;/div&gt;
&lt;p&gt;where &lt;span class="math"&gt;\(C = \theta_{min} / \theta_{maj}\)&lt;/span&gt;. So the radial axis is
scaled to the major axis of the beam; the true beam is smaller along one
axis than shown in these plots.&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="c1"&gt;# radial profile&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;figsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax1&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;


&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'G327 N2H+'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;rr_inds&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;rr&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ravel&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argsort&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;sorted_synth&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fullbeam&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ravel&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;fullbeam&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;())[&lt;/span&gt;&lt;span class="n"&gt;rr_inds&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;pixscale&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pixscale&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arcsec&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pixscale&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;rr&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ravel&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="n"&gt;rr_inds&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;sorted_synth&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'-'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'Synth'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pixscale&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;rr&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ravel&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;         &lt;span class="n"&gt;cutout&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ravel&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cutout&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'.'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'Dirty'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.75&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;markersize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;firstnull&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linestyle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'--'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'b'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_xlim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;firstnull&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="c1"&gt;# rr[view].max())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;firstnull&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mf"&gt;1.4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.9&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s1"&gt;'$\epsilon=&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;epsilon&lt;/span&gt;&lt;span class="si"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;0.2f&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt;$'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fontsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;firstnull&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mf"&gt;1.4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.85&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s1"&gt;'$&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s1"&gt;theta_&lt;/span&gt;&lt;span class="se"&gt;{{&lt;/span&gt;&lt;span class="s1"&gt;maj&lt;/span&gt;&lt;span class="se"&gt;}}&lt;/span&gt;&lt;span class="s1"&gt;=&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;beam&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;major&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="si"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;0.2f&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt;$&amp;quot;'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fontsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;firstnull&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mf"&gt;1.4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s1"&gt;'$&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s1"&gt;theta_&lt;/span&gt;&lt;span class="se"&gt;{{&lt;/span&gt;&lt;span class="s1"&gt;min&lt;/span&gt;&lt;span class="se"&gt;}}&lt;/span&gt;&lt;span class="s1"&gt;=&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;beam&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;minor&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="si"&gt;:&lt;/span&gt;&lt;span class="s1"&gt;0.2f&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s1"&gt;$&amp;quot;'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fontsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;psf_secondpeak_loc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linestyle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;':'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'k'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r_sidelobe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linestyle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;':'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'g'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;beam&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;major&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;beam&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;major&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;         &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;         &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'k'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;


&lt;/span&gt;&lt;span class="n"&gt;ax1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'G327 N2H+'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pixscale&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;rr&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ravel&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="n"&gt;rr_inds&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;sorted_synth&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'-'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'Synth'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pixscale&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;rr&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ravel&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;         &lt;span class="n"&gt;cutout&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ravel&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cutout&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'.'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'Dirty'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.75&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;markersize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;firstnull&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linestyle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'--'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'b'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;psf_secondpeak_loc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linestyle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;':'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'k'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;axvline&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r_sidelobe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;linestyle&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;':'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'g'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="n"&gt;ax1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_xlim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;firstnull&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="c1"&gt;# rr[view].max())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_ylim&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;0.035&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mf"&gt;0.2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="n"&gt;ax1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Radius along PSF (&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Radius along PSF (&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ax1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Normalized PSF profile&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;pre class="literal-block"&gt;
Text(0, 0.5, 'Normalized PSF profile')
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_9_1.png" /&gt;
&lt;p&gt;The right plot is a vertical zoom-in of the left plot.&lt;/p&gt;
&lt;p&gt;The light blue line shows the synthesized beam.&lt;/p&gt;
&lt;p&gt;The orange dots are the individual pixel values from the dirty beam.&lt;/p&gt;
&lt;p&gt;The vertical dotted black line shows the peak of the residual - it’s not
used for anything, it just highlights where the “shelf” is most
prominent (and it is &lt;em&gt;very&lt;/em&gt; prominent in this example).&lt;/p&gt;
&lt;p&gt;The blue vertical dashed line shows the location of the first null.&lt;/p&gt;
&lt;p&gt;The green vertical dotted line shows the location of the first sidelobe.&lt;/p&gt;
&lt;p&gt;&lt;span class="math"&gt;\(\epsilon\)&lt;/span&gt; is the ratio of the integral of the synthesized beam to
the integral of the dirty beam out to the first null. It is the
correction factor to apply to the residuals (multiply the residuals by
this number) to convert the residuals from Jy/dirtybeam to
Jy/synthesizedbeam.&lt;/p&gt;
&lt;p&gt;&lt;span class="math"&gt;\(\theta_{min}\)&lt;/span&gt; and &lt;span class="math"&gt;\(\theta_{maj}\)&lt;/span&gt; are the FWHM widths of the
beam along the major and minor axes. The grey right-angle line is drawn
at &lt;span class="math"&gt;\(y=0.5\)&lt;/span&gt; out to &lt;span class="math"&gt;\(\theta = \theta_{maj}/2\)&lt;/span&gt; (the half-width
half-max)&lt;/p&gt;
&lt;/div&gt;
&lt;script type='text/javascript'&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="misc"></category><category term="casa"></category><category term="psf"></category></entry><entry><title>CASA MPI problems</title><link href="https://keflavich.github.io/blog/casa-mpi-problems.html" rel="alternate"></link><published>2021-10-17T20:40:00-06:00</published><updated>2021-10-17T20:40:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2021-10-17:/blog/casa-mpi-problems.html</id><summary type="html">&lt;p&gt;There are several CASA MPI errors I encounter regularly.&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
2021-10-17 15:56:06     SEVERE  task_tclean::SynthesisImagerVi2::runCubeGridding (file src/code/synthesis/ImagerObjects/SynthesisImagerVi2.cc, line 1579)       remainder rank 7 failed
master 1 init 1
2021-10-17 15:59:21     SEVERE  tclean::::casa  Task tclean raised an exception of class RuntimeError …&lt;/pre&gt;</summary><content type="html">&lt;p&gt;There are several CASA MPI errors I encounter regularly.&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
2021-10-17 15:56:06     SEVERE  task_tclean::SynthesisImagerVi2::runCubeGridding (file src/code/synthesis/ImagerObjects/SynthesisImagerVi2.cc, line 1579)       remainder rank 7 failed
master 1 init 1
2021-10-17 15:59:21     SEVERE  tclean::::casa  Task tclean raised an exception of class RuntimeError with the following message: Error in making PSF : One or more  of the cube section failed in de/grid
ding. Return values for the sections: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]

 Traceback (most recent call last):
   File &amp;quot;/blue/adamginsburg/adamginsburg/casa/casa-6.4.0-12/lib/py/lib/python3.6/site-packages/casashell/private/init_system.py&amp;quot;, line 238, in __evprop__
     exec(stmt)
   File &amp;quot;&amp;lt;string&amp;gt;&amp;quot;, line 1, in &amp;lt;module&amp;gt;
   File &amp;quot;/blue/adamginsburg/adamginsburg/casa/casa-6.4.0-12/lib/py/lib/python3.6/site-packages/casashell/private/init_system.py&amp;quot;, line 175, in execfile
     newglob = run_path( filename, init_globals=globals )
   File &amp;quot;/blue/adamginsburg/adamginsburg/casa/casa-6.4.0-12/lib/py/lib/python3.6/runpy.py&amp;quot;, line 263, in run_path
     pkg_name=pkg_name, script_name=fname)
   File &amp;quot;/blue/adamginsburg/adamginsburg/casa/casa-6.4.0-12/lib/py/lib/python3.6/runpy.py&amp;quot;, line 96, in _run_module_code
     mod_name, mod_spec, pkg_name, script_name)
   File &amp;quot;/blue/adamginsburg/adamginsburg/casa/casa-6.4.0-12/lib/py/lib/python3.6/runpy.py&amp;quot;, line 85, in _run_code
     exec(code, run_globals)
   File &amp;quot;/orange/adamginsburg/ALMA_IMF/reduction/reduction/line_imaging.py&amp;quot;, line 935, in &amp;lt;module&amp;gt;
     **impars
   File &amp;quot;/blue/adamginsburg/adamginsburg/casa/casa-6.4.0-12/lib/py/lib/python3.6/site-packages/casatasks/tclean.py&amp;quot;, line 1660, in __call__
     task_result = _tclean_t( _pc.document['vis'], _pc.document['selectdata'], _pc.document['field'], _pc.document['spw'], _pc.document['timerange'], _pc.document['uvrange'], _pc.document['antenna'], _pc.document['scan'], _pc.document['observation'], _pc.document['intent'], _pc.document['datacolumn'], _pc.document['imagename'], _pc.document['imsize'], _pc.document['cell'], _pc.document['phasecenter'], _pc.document['stokes'], _pc.document['projection'], _pc.document['startmodel'], _pc.document['specmode'], _pc.document['reffreq'], _pc.document['nchan'], _pc.document['start'], _pc.document['width'], _pc.document['outframe'], _pc.document['veltype'], _pc.document['restfreq'], _pc.document['interpolation'], _pc.document['perchanweightdensity'], _pc.document['gridder'], _pc.document['facets'], _pc.document['psfphasecenter'], _pc.document['wprojplanes'], _pc.document['vptable'], _pc.document['mosweight'], _pc.document['aterm'], _pc.document['psterm'], _pc.document['wbawp'], _pc.document['conjbeams'], _pc.document['cfcache'], _pc.document['usepointing'], _pc.document['computepastep'], _pc.document['rotatepastep'], _pc.document['pointingoffsetsigdev'], _pc.document['pblimit'], _pc.document['normtype'], _pc.document['deconvolver'], _pc.document['scales'], _pc.document['nterms'], _pc.document['smallscalebias'], _pc.document['restoration'], _pc.document['restoringbeam'], _pc.document['pbcor'], _pc.document['outlierfile'], _pc.document['weighting'], _pc.document['robust'], _pc.document['noise'], _pc.document['npixels'], _pc.document['uvtaper'], _pc.document['niter'], _pc.document['gain'], _pc.document['threshold'], _pc.document['nsigma'], _pc.document['cycleniter'], _pc.document['cyclefactor'], _pc.document['minpsffraction'], _pc.document['maxpsffraction'], _pc.document['interactive'], _pc.document['usemask'], _pc.document['mask'], _pc.document['pbmask'], _pc.document['sidelobethreshold'], _pc.document['noisethreshold'], _pc.document['lownoisethreshold'], _pc.document['negativethreshold'], _pc.document['smoothfactor'], _pc.document['minbeamfrac'], _pc.document['cutthreshold'], _pc.document['growiterations'], _pc.document['dogrowprune'], _pc.document['minpercentchange'], _pc.document['verbose'], _pc.document['fastnoise'], _pc.document['restart'], _pc.document['savemodel'], _pc.document['calcres'], _pc.document['calcpsf'], _pc.document['psfcutoff'], _pc.document['parallel'] )
   File &amp;quot;/blue/adamginsburg/adamginsburg/casa/casa-6.4.0-12/lib/py/lib/python3.6/site-packages/casatasks/private/task_tclean.py&amp;quot;, line 364, in tclean
     imager.makePSF()
   File &amp;quot;/blue/adamginsburg/adamginsburg/casa/casa-6.4.0-12/lib/py/lib/python3.6/site-packages/casatasks/private/imagerhelpers/imager_base.py&amp;quot;, line 344, in makePSF
     self.makePSFCore()
   File &amp;quot;/blue/adamginsburg/adamginsburg/casa/casa-6.4.0-12/lib/py/lib/python3.6/site-packages/casatasks/private/imagerhelpers/imager_base.py&amp;quot;, line 496, in makePSFCore
     self.SItool.makepsf()
   File &amp;quot;/blue/adamginsburg/adamginsburg/casa/casa-6.4.0-12/lib/py/lib/python3.6/site-packages/casatools/synthesisimager.py&amp;quot;, line 70, in makepsf
     return self._swigobj.makepsf()
   File &amp;quot;/blue/adamginsburg/adamginsburg/casa/casa-6.4.0-12/lib/py/lib/python3.6/site-packages/casatools/__casac__/synthesisimager.py&amp;quot;, line 322, in makepsf
     return _synthesisimager.synthesisimager_makepsf(self)
 RuntimeError: Error in making PSF : One or more  of the cube section failed in de/gridding. Return values for the sections: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
&lt;/pre&gt;
&lt;p&gt;That one appears to be caused by:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
2021-10-17 15:53:34     WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-7 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line
 A) Exception for chan range [1921, 1924] ---   Error in making PSF : Interpolate1D::operator() data has repeated x values
##################################
#############################
Exception: Error in making PSF : Interpolate1D::operator() data has repeated x values
&lt;/pre&gt;
&lt;p&gt;This happened after a lot of apparently successful cleaning, as an .image was created.  However, the failure caused
CASA to exit.&lt;/p&gt;
&lt;p&gt;This tclean command:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
2021-10-17 15:19:43     INFO    tclean::::casa  tclean( vis='/blue/adamginsburg/adamginsburg/almaimf/workdir/G008.67_B3_spw2_12M.concat.ms', selectdata=True, field='G008.67', spw='', timerange='', uvrange='', antenna='', scan='', observation='', intent='', datacolumn='corrected', imagename='/blue/adamginsburg/adamginsburg/almaimf/workdir/G008.67_B3_spw2_12M_spw2', imsize=[2880, 2250], cell=['0.08arcsec', '0.08arcsec'], phasecenter='ICRS 271.5877979623041deg -21.620789662367244deg', stokes='I', projection='SIN', startmodel='', specmode='cube', reffreq='', nchan=-1, start='', width='', outframe='LSRK', veltype='radio', restfreq=[], interpolation='linear', perchanweightdensity=True, gridder='mosaic', facets=1, psfphasecenter='', wprojplanes=1, vptable='', mosweight=True, aterm=True, psterm=False, wbawp=True, conjbeams=False, cfcache='', usepointing=False, computepastep=360.0, rotatepastep=360.0, pointingoffsetsigdev=[], pblimit=0.05, normtype='flatnoise', deconvolver='multiscale', scales=[0, 4, 8, 16, 32], nterms=2, smallscalebias=0.5, restoration=True, restoringbeam='', pbcor=False, outlierfile='', weighting='briggsbwtaper', robust=0.0, noise='1.0Jy', npixels=0, uvtaper=[''], niter=5000000, gain=0.1, threshold='0.0168Jy', nsigma=0.0, cycleniter=-1, cyclefactor=2.0, minpsffraction=0.05, maxpsffraction=0.8, interactive=0, usemask='user', mask='', pbmask=0.1, sidelobethreshold=3.0, noisethreshold=5.0, lownoisethreshold=1.5, negativethreshold=0.0, smoothfactor=1.0, minbeamfrac=0.3, cutthreshold=0.01, growiterations=75, dogrowprune=True, minpercentchange=-1.0, verbose=False, fastnoise=True, restart=True, savemodel='none', calcres=False, calcpsf=True, psfcutoff=0.35, parallel=True )
&lt;/pre&gt;
&lt;p&gt;using concatenated data caused the failure.  It was run as an MPI job with 32 cores and 128 GB RAM.
The same issue recurred for the next MS (spw3), but not for spw0 or spw1 - yet, they're still running.&lt;/p&gt;
&lt;p&gt;This: &amp;quot;Exception for chan range [1921, 1924] ---   Error in making PSF : Interpolate1D::operator() data has repeated x values&amp;quot; suggests to me that there's
a problem with the gridder thinking there are more channels than there actually are; &lt;tt class="docutils literal"&gt;tclean&lt;/tt&gt;'s behavior is not consistent between operating on concatenated
data sets and on lists of data sets.  This issue may be a manifestation of tclean misunderstanding the grid when operating with MPI enabled.
This could also prove not to be an MPI error, but one that is only encountered if MPI is enabled b/c MPI gets to channel 1921 while non-MPI never gets
there before the job is canceled for time.&lt;/p&gt;
&lt;p&gt;W51 spw2 had similar:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-21 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336)        Exception for chan range [1269, 1277] ---   FilebufIO::readBlock - incorrect number of bytes read for file /blue/adamginsburg/adamginsburg/almaimf/workdir/W51-E_B3_spw2_12M_spw2.sumwt/table.f0
Exception: FilebufIO::readBlock - incorrect number of bytes read for file /blue/adamginsburg/adamginsburg/almaimf/workdir/W51-E_B3_spw2_12M_spw2.sumwt/table.f0
WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-9 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336) Exception for chan range [1314, 1322] ---   FilebufIO::readBlock - incorrect number of bytes read for file /blue/adamginsburg/adamginsburg/almaimf/workdir/W51-E_B3_spw2_12M_spw2.sumwt/table.f0
Exception: FilebufIO::readBlock - incorrect number of bytes read for file /blue/adamginsburg/adamginsburg/almaimf/workdir/W51-E_B3_spw2_12M_spw2.sumwt/table.f0
&lt;/pre&gt;
&lt;p&gt;I have not found solutions to any of these; the workaround appears to be just to not use MPI.&lt;/p&gt;
&lt;p&gt;EDIT: here's another one&lt;/p&gt;
&lt;pre class="code literal-block"&gt;
2021-10-22 22:36:53     WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-2 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336) Exception for chan range [55, 109] ---   Setting masked pixels to zero for input startmodel : Error (Resource deadlock avoided) when acquiring lock on /blue/adamginsburg/adamginsburg/almaimf/workdir/G327.29_B6_spw1_12M_sio.contcube.model/table.lock
##################################
#############################
Exception: Setting masked pixels to zero for input startmodel : Error (Resource deadlock avoided) when acquiring lock on /blue/adamginsburg/adamginsburg/almaimf/workdir/G327.29_B6_spw1_12M_sio.contcube.model/table.lock
2021-10-22 22:36:54     WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-4 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336) Exception for chan range [165, 219] ---   Setting masked pixels to zero for input startmodel : Error (Resource deadlock avoided) when acquiring lock on /blue/adamginsburg/adamginsburg/almaimf/workdir/G327.29_B6_spw1_12M_sio.contcube.model/table.lock
##################################
#############################
Exception: Setting masked pixels to zero for input startmodel : Error (Resource deadlock avoided) when acquiring lock on /blue/adamginsburg/adamginsburg/almaimf/workdir/G327.29_B6_spw1_12M_sio.contcube.model/table.lock
2021-10-22 22:36:57     WARN    MPICommandServer::command_request_handler_service::SynthesisImagerVi2::CubeMajorCycle::MPIServer-1 (file src/code/synthesis/ImagerObjects/CubeMajorCycleAlgorithm.cc, line 336) Exception for chan range [0, 54] ---   Setting masked pixels to zero for input startmodel : Error (Resource deadlock avoided) when acquiring lock on /blue/adamginsburg/adamginsburg/almaimf/workdir/G327.29_B6_spw1_12M_sio.contcube.model/table.lock
##################################
#############################
Exception: Setting masked pixels to zero for input startmodel : Error (Resource deadlock avoided) when acquiring lock on /blue/adamginsburg/adamginsburg/almaimf/workdir/G327.29_B6_spw1_12M_sio.contcube.model/table.lock
&lt;/pre&gt;
</content><category term="misc"></category><category term="tags"></category></entry><entry><title>Confetti artifacts in clean</title><link href="https://keflavich.github.io/blog/confetti-artifacts-in-clean.html" rel="alternate"></link><published>2021-10-15T10:21:00-06:00</published><updated>2021-10-15T10:21:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2021-10-15:/blog/confetti-artifacts-in-clean.html</id><summary type="html">&lt;p&gt;We have noted a “confetti” problem in some of the ALMA-IMF cube images.
It is called confetti because &lt;em&gt;one&lt;/em&gt; of its manifestations is individual
bright pixels in the model image.&lt;/p&gt;
&lt;p&gt;This notebook shows where confetti is - and is not a problem.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/ALMA-IMF/notebooks/blob/master/ConfettiQA.ipynb"&gt;https://github.com/ALMA-IMF/notebooks/blob/master/ConfettiQA.ipynb …&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;We have noted a “confetti” problem in some of the ALMA-IMF cube images.
It is called confetti because &lt;em&gt;one&lt;/em&gt; of its manifestations is individual
bright pixels in the model image.&lt;/p&gt;
&lt;p&gt;This notebook shows where confetti is - and is not a problem.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/ALMA-IMF/notebooks/blob/master/ConfettiQA.ipynb"&gt;https://github.com/ALMA-IMF/notebooks/blob/master/ConfettiQA.ipynb&lt;/a&gt;&lt;/p&gt;
&lt;div class="section" id="preliminaries-skip-this"&gt;
&lt;h2&gt;Preliminaries: skip this&lt;/h2&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;spectral_cube&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;SpectralCube&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;warnings&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;warnings&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;simplefilter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'ignore'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;matplotlib&lt;/span&gt; &lt;span class="n"&gt;inline&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pylab&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pl&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy.visualization&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;simple_norm&lt;/span&gt;
&lt;/pre&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;units&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="g008-67-continuum"&gt;
&lt;h2&gt;G008.67 Continuum&lt;/h2&gt;
&lt;p&gt;This is the G008.67 continuum image in Band 3.&lt;/p&gt;
&lt;p&gt;It has “confetti” pieces in the model image, but there is no problem: no
artificial point sources are introduced.&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;contmodel&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SpectralCube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/orange/adamginsburg/ALMA_IMF/2017.1.01355.L/imaging_results/G008.67_B3_uid___A001_X1296_X1c1_continuum_merged_12M_robust-0.5_selfcal5_finaliter.model.tt0'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'casa_image'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;contimage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SpectralCube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/orange/adamginsburg/ALMA_IMF/2017.1.01355.L/imaging_results/G008.67_B3_uid___A001_X1296_X1c1_continuum_merged_12M_robust-0.5_selfcal5_finaliter.image.tt0'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'casa_image'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;contresid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SpectralCube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/orange/adamginsburg/ALMA_IMF/2017.1.01355.L/imaging_results/G008.67_B3_uid___A001_X1296_X1c1_continuum_merged_12M_robust-0.5_selfcal5_finaliter.residual.tt0'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'casa_image'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="c1"&gt;# zoom in&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;contslc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;950&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1050&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="nb"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1900&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2050&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;figsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;contmodel&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;contslc&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;norm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;simple_norm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;contmodel&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;contslc&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;max_percent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;99.995&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stretch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'asinh'&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;interpolation&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'none'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'lower'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;model&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_8_0.png" /&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;figsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;im&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;contimage&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;contslc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:]]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;norm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;simple_norm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stretch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'log'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;max_percent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;99.995&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;interpolation&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'none'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  &lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'lower'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;image&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_9_0.png" /&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;figsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;im&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;contresid&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;contslc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:]]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;imshow&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;norm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;simple_norm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;im&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stretch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'linear'&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;interpolation&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'none'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  &lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'lower'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Residual&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_10_0.png" /&gt;
&lt;div class="section" id="g008-67-cube"&gt;
&lt;h3&gt;G008.67 Cube&lt;/h3&gt;
&lt;p&gt;The G008.67 cube &lt;em&gt;does&lt;/em&gt; have a problem!&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;cube&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SpectralCube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/orange/adamginsburg/ALMA_IMF/2017.1.01355.L/imaging_results/G008.67_B3_spw0_12M_n2hp.image'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'casa_image'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;with_spectral_unit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;km&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;velocity_convention&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'radio'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;resid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SpectralCube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/orange/adamginsburg/ALMA_IMF/2017.1.01355.L/imaging_results/G008.67_B3_spw0_12M_n2hp.residual'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'casa_image'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;with_spectral_unit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;km&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;velocity_convention&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'radio'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;SpectralCube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/orange/adamginsburg/ALMA_IMF/2017.1.01355.L/imaging_results/G008.67_B3_spw0_12M_n2hp.model'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'casa_image'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;with_spectral_unit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;km&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;velocity_convention&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'radio'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;xslc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1620&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1654&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;yslc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;709&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;743&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;cubeslice&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;yslc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;xslc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;cube1slice&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;98&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;yslc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;xslc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="confetti-a-false-point-source"&gt;
&lt;h2&gt;Confetti: a false (?) point source&lt;/h2&gt;
&lt;p&gt;In the image below, we see a new source introduced in the 35.140 km/s
panel.&lt;/p&gt;
&lt;p&gt;There is no comparable source in either of the adjacent panels!&lt;/p&gt;
&lt;p&gt;That means either there is a genuinely pointlike source with linewidth
much narrower than 0.77 km/s, or this source is fake.&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;specpix&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;94&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;94&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;panels&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cubeslice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot_channel_maps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;specpix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fig_smallest_dim_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;norm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;simple_norm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cube1slice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_15_0.png" /&gt;
&lt;p&gt;It is caused by one hot (bright) pixel surrounded by many faint pixels&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;panels&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cubeslice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot_channel_maps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;specpix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fig_smallest_dim_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;norm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;simple_norm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cube1slice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stretch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'log'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;max_percent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;99.93&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_17_0.png" /&gt;
&lt;p&gt;There is no sign of it in the residual - it is apparently canceled out
between positive and negative components added to the model&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;panels&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;resid&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cubeslice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot_channel_maps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;specpix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fig_smallest_dim_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_19_0.png" /&gt;
&lt;p&gt;The manifestation in the spectra is a very sharp peak at just one pixel.&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;figsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;xx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;yy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1638&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;725&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt;&lt;span class="n"&gt;yy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xx&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;quicklook&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;resid&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt;&lt;span class="n"&gt;yy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xx&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;quicklook&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;modspec&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt;&lt;span class="n"&gt;yy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xx&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;spectral_axis&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;modspec&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pixels_per_beam&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'model'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_21_1.png" /&gt;
&lt;p&gt;Pixels to either side look fine&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;figsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ii&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;dx&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;dy&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ii&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;ii&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt;&lt;span class="n"&gt;yy&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;dy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xx&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;dx&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;quicklook&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;resid&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt;&lt;span class="n"&gt;yy&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;dy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xx&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;dx&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;quicklook&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;modspec&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt;&lt;span class="n"&gt;yy&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;dy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xx&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;dx&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;spectral_axis&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;modspec&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pixels_per_beam&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'model'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dx=&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;dx&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; dy=&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;dy&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_23_0.png" /&gt;
&lt;div class="section" id="when-is-confetti-not-a-problem"&gt;
&lt;h3&gt;When is confetti &lt;em&gt;not&lt;/em&gt; a problem?&lt;/h3&gt;
&lt;p&gt;Here is an example you might think is “confetti”, but is a &lt;em&gt;real&lt;/em&gt; source&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;xc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;yc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1812&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;905&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;xslc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;xc&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xc&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;yslc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;yc&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;yc&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;cubeslice&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;94&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;94&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;yslc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;xslc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;cube1slice&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;94&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;yslc&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;xslc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;specpix&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;panels&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cubeslice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot_channel_maps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;specpix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fig_smallest_dim_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;norm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;simple_norm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cube1slice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;min_cut&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cubeslice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;min&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;max_cut&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cubeslice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stretch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'linear'&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_26_0.png" /&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;panels&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cubeslice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot_channel_maps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;specpix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fig_smallest_dim_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;norm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;simple_norm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cube1slice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;stretch&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'asinh'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;max_percent&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;99.9&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;min_cut&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cubeslice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;min&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;max_cut&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cubeslice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_27_0.png" /&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;panels&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;resid&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;cubeslice&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot_channel_maps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;specpix&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fig_smallest_dim_inches&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_28_0.png" /&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;figsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;ii&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;dx&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;dy&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;ax&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;subplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ii&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;ii&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt;&lt;span class="n"&gt;yc&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;dy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xc&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;dx&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;quicklook&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;resid&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt;&lt;span class="n"&gt;yc&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;dy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xc&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;dx&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;quicklook&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;modspec&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;model&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt;&lt;span class="n"&gt;yc&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;dy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;xc&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;dx&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;spectral_axis&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;modspec&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;cube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pixels_per_beam&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'model'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;ax&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dx=&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;dx&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; dy=&lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;dy&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/output_29_0.png" /&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;“Confetti” is a problem, but it is not trivial to find in the model data
alone. It exhibits no features in the residual.&lt;/p&gt;
&lt;p&gt;Key features to look out for are:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Narrow-line features (single channel)&lt;/li&gt;
&lt;li&gt;Extremely bright pointlike peaks in the model (note that this is
&lt;em&gt;not&lt;/em&gt; independent evidence of a problem! All point sources occupy
single pixels in the model image by definition!)&lt;/li&gt;
&lt;li&gt;Bright pointlike peaks sitting on top of slightly extended negative
backgrounds in the model (this is how the model is “canceled out” in
the residual)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
</content><category term="misc"></category><category term="CASA"></category></entry><entry><title>casa's plotms in a notebook</title><link href="https://keflavich.github.io/blog/casas-plotms-in-a-notebook.html" rel="alternate"></link><published>2021-06-14T12:30:00-06:00</published><updated>2021-06-14T12:30:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2021-06-14:/blog/casas-plotms-in-a-notebook.html</id><summary type="html">&lt;p&gt;CASA's plotms requires an X11 frontend to work properly, so you either need to run it with xvfb or
with X.&lt;/p&gt;
&lt;p&gt;I want to just make UV data plots in jupyter notebooks.&lt;/p&gt;
&lt;p&gt;This is harder than it sounds, particularly for concatenated data sets.&lt;/p&gt;
&lt;p&gt;First step is that you need to …&lt;/p&gt;</summary><content type="html">&lt;p&gt;CASA's plotms requires an X11 frontend to work properly, so you either need to run it with xvfb or
with X.&lt;/p&gt;
&lt;p&gt;I want to just make UV data plots in jupyter notebooks.&lt;/p&gt;
&lt;p&gt;This is harder than it sounds, particularly for concatenated data sets.&lt;/p&gt;
&lt;p&gt;First step is that you need to assemble the metadata:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;msmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scvis&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;scsum&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;msmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;msmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The resulting &lt;tt class="docutils literal"&gt;scsum&lt;/tt&gt; is a nested dictionary containing a ton of information.
We need only some of it.&lt;/p&gt;
&lt;p&gt;To get out some flattened information, such as the &amp;quot;data description IDs&amp;quot; associated
with data that are actually in my concatenated MS (in my case, 8 of 11 observation blocks
in the metadata are not present in the data), this tool gets and flattens the resulting
information:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;walk_summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;isinstance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;walk_summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;kk&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;kk&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
                &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unique&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
                    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
                &lt;span class="k"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ne"&gt;KeyError&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="ne"&gt;TypeError&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we grab the usable observation and data description IDs:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;obsids&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;scsum&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;observationID&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;scsum&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="p"&gt;{}]&lt;/span&gt;
&lt;span class="n"&gt;ddids&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;walk_summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scsum&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;data description IDs&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we have to load the actual data.  I needed to create new versions of the &lt;tt class="docutils literal"&gt;mstool&lt;/tt&gt; each time
because I was getting weird errors where &lt;tt class="docutils literal"&gt;ms.close()&lt;/tt&gt; followed by &lt;tt class="docutils literal"&gt;ms.open(fn)&lt;/tt&gt; was not properly
resetting, which resulted in &lt;tt class="docutils literal"&gt;ms.getdata&lt;/tt&gt; returning the same data for two different MSes - BAD!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ms6&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mstool&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;ms6&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scvis&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;scdata_all&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;ddid&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;ddids&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;ms6&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;selectinit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ddid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;reset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;ms6&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;selectinit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ddid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;scdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;ddid&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ms6&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getdata&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;amplitude&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;weight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;uvdist&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;axis_info&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;flag&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;corrected_amplitude&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;ifraxis&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms6&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then plotting is a hassle, but at least is not insane - it's just normal array manipulation:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;figsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;colors&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;itertools&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cycle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rcParams&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;axes.prop_cycle&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;by_key&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;color&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;scdata_all&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="c1"&gt;# the keys are SPW numbers from the multi-MS file&lt;/span&gt;
    &lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;scdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;weight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;uvd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;scdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;uvdist&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;semilogy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uvd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ravel&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reshape&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;uvd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;best&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;UV Distance (m)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Weight&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That is basically equivalent to &lt;tt class="docutils literal"&gt;plotms(vis, &lt;span class="pre"&gt;xaxis='uvdist',&lt;/span&gt; &lt;span class="pre"&gt;yaxis='weight',&lt;/span&gt; &lt;span class="pre"&gt;coloraxis='spw')&lt;/span&gt;&lt;/tt&gt;.  It's just slightly more flexible, since
you can also make waterfall plots, etc.&lt;/p&gt;
&lt;p&gt;Selecting along various axes, like antenna, gets tricky.  You'd rather not go back to &lt;tt class="docutils literal"&gt;ms.getdata&lt;/tt&gt; because it is _slow_.&lt;/p&gt;
&lt;p&gt;The &amp;quot;identifying baselines&amp;quot; step that you can do in plotms can be achieved through normal boolean array selection, with a result that's somewhat easier to read than CASA's logger:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;highwt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;weight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mf"&gt;1e5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;scdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;56&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;axis_info&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ifr_axis&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ifr_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;highwt&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;axis&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;))]&lt;/span&gt;
&lt;span class="c1"&gt;# array([&amp;#39;DA41-DV12&amp;#39;, &amp;#39;DA42-DV12&amp;#39;, &amp;#39;DA43-DV12&amp;#39;, &amp;#39;DA44-DV12&amp;#39;, &amp;#39;DA45-DV12&amp;#39;,&lt;/span&gt;
&lt;span class="c1"&gt;#  &amp;#39;DA46-DV12&amp;#39;, &amp;#39;DA47-DV12&amp;#39;, &amp;#39;DA48-DV12&amp;#39;, &amp;#39;DA49-DV12&amp;#39;, &amp;#39;DA50-DV12&amp;#39;,&lt;/span&gt;
&lt;span class="c1"&gt;#  &amp;#39;DA51-DV12&amp;#39;, &amp;#39;DA52-DV12&amp;#39;, &amp;#39;DA53-DV12&amp;#39;, &amp;#39;DA54-DV12&amp;#39;, &amp;#39;DA55-DV12&amp;#39;,&lt;/span&gt;
&lt;span class="c1"&gt;#  &amp;#39;DA56-DV12&amp;#39;, &amp;#39;DA57-DV12&amp;#39;, &amp;#39;DA58-DV12&amp;#39;, &amp;#39;DA60-DV12&amp;#39;, &amp;#39;DA61-DV12&amp;#39;,&lt;/span&gt;
&lt;span class="c1"&gt;#  &amp;#39;DA62-DV12&amp;#39;, &amp;#39;DA63-DV12&amp;#39;, &amp;#39;DA64-DV12&amp;#39;, &amp;#39;DA65-DV12&amp;#39;, &amp;#39;DV01-DV12&amp;#39;,&lt;/span&gt;
&lt;span class="c1"&gt;#  &amp;#39;DV02-DV12&amp;#39;, &amp;#39;DV03-DV12&amp;#39;, &amp;#39;DV04-DV12&amp;#39;, &amp;#39;DV05-DV12&amp;#39;, &amp;#39;DV06-DV12&amp;#39;,&lt;/span&gt;
&lt;span class="c1"&gt;#  &amp;#39;DV07-DV12&amp;#39;, &amp;#39;DV08-DV12&amp;#39;, &amp;#39;DV09-DV12&amp;#39;, &amp;#39;DV10-DV12&amp;#39;, &amp;#39;DV11-DV12&amp;#39;,&lt;/span&gt;
&lt;span class="c1"&gt;#  &amp;#39;DV12-DV14&amp;#39;, &amp;#39;DV12-DV16&amp;#39;, &amp;#39;DV12-DV17&amp;#39;, &amp;#39;DV12-DV19&amp;#39;, &amp;#39;DV12-DV20&amp;#39;,&lt;/span&gt;
&lt;span class="c1"&gt;#  &amp;#39;DV12-DV21&amp;#39;, &amp;#39;DV12-DV22&amp;#39;, &amp;#39;DV12-DV23&amp;#39;, &amp;#39;DV12-DV24&amp;#39;, &amp;#39;DV12-DV25&amp;#39;],&lt;/span&gt;
&lt;span class="c1"&gt;# dtype=&amp;#39;&amp;lt;U16&amp;#39;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;in this case, the output shows that DV12 is clearly the antenna that's overweighted.&lt;/p&gt;
&lt;p&gt;Handling flags is tricky.  The 'weight' array has shape &lt;tt class="docutils literal"&gt;[2,nbaseline,ntime]&lt;/tt&gt;, but I don't know if that 2 refers to frequency
or polarization, since I have two of each and there is no information about this in the &lt;tt class="docutils literal"&gt;axis_info&lt;/tt&gt; dictionary.  So... I'm
doing the conservative thing and ignoring any row of frequency or polarization if _any_ of the data are flagged.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;figsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;colors&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;itertools&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cycle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rcParams&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;axes.prop_cycle&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;by_key&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;color&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;scdata_all&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;scdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;weight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;uvd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;scdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;uvdist&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;flag&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;scdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;flag&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;okflag&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;axis&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;semilogy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uvd&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;okflag&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reshape&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;uvd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;okflag&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ravel&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="p"&gt;:],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;best&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;UV Distance (m)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Weight&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And, indeed, doing this revealed that the super-high-weight antenna was already flagged out.&lt;/p&gt;
&lt;p&gt;This has been a demo of how to do some stuff with CASA to replicate plotms&lt;/p&gt;
&lt;div class="section" id="errors"&gt;
&lt;h2&gt;Errors&lt;/h2&gt;
&lt;p&gt;Along the way, I hit a ton of errors I didn't understand, so I need a record of what they mean.&lt;/p&gt;
&lt;div class="section" id="data-shape-varies-selecting-first-data-desc-id-only"&gt;
&lt;h3&gt;&amp;quot;Data shape varies, selecting first data desc id only&amp;quot;&lt;/h3&gt;
&lt;p&gt;This is the worst.  It means that you have a multi-ms file (mms) that has been produced by &lt;tt class="docutils literal"&gt;concat&lt;/tt&gt;.  It is therefore doing something &lt;em&gt;explicitly wrong&lt;/em&gt; and returning only the first data description ID.&lt;/p&gt;
&lt;p&gt;Data description IDs are super counterintuitive.  They refer, afaict, to SPW numbers.  If you have an MMS with unmerged SPWs (same frequency, but you didn't merge them because of tolerances or something),
each SPW will correspond to a single observation ID.&lt;/p&gt;
&lt;p&gt;The solution is to explicitly &lt;tt class="docutils literal"&gt;ms.selectinit&lt;/tt&gt;, i.e.:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;selectinit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datadescid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# note: &amp;quot;reset=True&amp;quot; appears to _override_ the selection&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# use this as needed&lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getdata&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;but &lt;tt class="docutils literal"&gt;datadescid&lt;/tt&gt; is _not_ the observation ID.  It's just... some number you need to get from the metadata.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="mismatched-data-shapes-when-comparing-two-mses"&gt;
&lt;h3&gt;Mismatched data shapes when comparing two MSes&lt;/h3&gt;
&lt;p&gt;I got into this whole thing because I wanted to compare the data in two MSes to determine where we went wrong (we did go wrong).&lt;/p&gt;
&lt;p&gt;Unfortunately, somewhere along the way, the autocorrelations got dropped.  I don't know how it happened because I never did it
(but I wish I had earlier), but that means that now the data shapes are mismatched.&lt;/p&gt;
&lt;p&gt;The solution was to use &lt;tt class="docutils literal"&gt;ms.select&lt;/tt&gt; and explicitly downselect to the baselines from MS #1 in MS #2 using MS #1's &lt;tt class="docutils literal"&gt;axis_info&lt;/tt&gt;: &lt;tt class="docutils literal"&gt;{'ifr_number': &lt;span class="pre"&gt;scdata['axis_info']['ifr_axis']['ifr_number']}&lt;/span&gt;&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ms3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mstool&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;ms3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;newvis&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;selectinit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# 80? what the hell kind of datadescid is that?!&lt;/span&gt;
&lt;span class="n"&gt;ms3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;select&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ifr_number&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;scdata&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;axis_info&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ifr_axis&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ifr_number&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]})&lt;/span&gt;
&lt;span class="n"&gt;newdata&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ms3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getdata&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;amplitude&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;uvdist&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;axis_info&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;corrected_amplitude&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;ifraxis&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;newdata&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;keys&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That downselected the baselines to match the baselines present in &lt;tt class="docutils literal"&gt;scdata&lt;/tt&gt;, which was MS 1.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="the-wrong-data-are-showing-up-when-i-open-a-new-ms"&gt;
&lt;h3&gt;The wrong data are showing up when I open a new MS&lt;/h3&gt;
&lt;p&gt;I was comparing several MSes, and sometimes the data looked the same for MSes I was &lt;em&gt;dead certain&lt;/em&gt; were different.
I was right, and the problem was apparently reusing the ms tool.&lt;/p&gt;
&lt;p&gt;I didn't show the import statement above, but it was this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;casatools&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;msmetadata&lt;/span&gt;
&lt;span class="n"&gt;mstool&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ms&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;msmd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;msmetadata&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If I tried to reuse &lt;tt class="docutils literal"&gt;ms&lt;/tt&gt; as normal, like so:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;selectinit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;data1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getdata&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;selectinit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;data2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getdata&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;then I can't say exactly what &lt;tt class="docutils literal"&gt;data1&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;data2&lt;/tt&gt; are, but they weren't the same.&lt;/p&gt;
&lt;p&gt;So, instead, I created a new &lt;tt class="docutils literal"&gt;mstool&lt;/tt&gt; instance each time:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ms&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mstool&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;selectinit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;data1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getdata&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;ms&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mstool&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;selectinit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;data2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getdata&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="put-all-together"&gt;
&lt;h2&gt;Put all together...&lt;/h2&gt;
&lt;p&gt;Here's some code to loop over a list of MSes and plot both amp and weight vs. uvdist for the field W43-MM3.&lt;/p&gt;
&lt;p&gt;Of course this crashed immediately because it exceeded the available memory.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;vis&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;mses&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;msmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;vissum&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;msmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;msmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="n"&gt;vobsids&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;vissum&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;observationID&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;vissum&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="p"&gt;{}]&lt;/span&gt;
    &lt;span class="n"&gt;vddids&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;walk_summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vissum&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;data description IDs&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;fids&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vissum&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;fields&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;W43-MM3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;obsids: &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;vobsids&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;, ddids: &lt;/span&gt;&lt;span class="si"&gt;{&lt;/span&gt;&lt;span class="n"&gt;vddids&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;ms&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mstool&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;msdata_all&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;ddid&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;vddids&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;selectinit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ddid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;reset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;selectinit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ddid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;select&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;field_id&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;fids&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
        &lt;span class="n"&gt;msdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;ddid&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getdata&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;amplitude&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;weight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;uvdist&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;axis_info&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;flag&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;corrected_amplitude&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;ifraxis&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;ms&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="n"&gt;colors&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;itertools&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cycle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rcParams&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;axes.prop_cycle&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;by_key&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;color&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;figsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;msdata_all&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;weight&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;msdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;weight&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;uvd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;msdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;uvdist&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;flag&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;msdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;flag&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;okflag&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;axis&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;semilogy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uvd&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;okflag&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reshape&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;weight&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;uvd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;okflag&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ravel&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="p"&gt;:],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;best&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;UV Distance (m)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Weight&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;colors&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;itertools&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cycle&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rcParams&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;axes.prop_cycle&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;by_key&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;color&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
    &lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;figsize&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;msdata_all&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;amp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;msdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;amplitude&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;uvd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;msdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;uvdist&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;flag&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;msdata_all&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;flag&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;okflag&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;axis&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uvd&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;okflag&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;amp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reshape&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;amp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;amp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;uvd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;okflag&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ravel&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="p"&gt;:],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;,&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;colors&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;legend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;best&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;set_title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;UV Distance (m)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Amplitude&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
</content><category term="misc"></category><category term="casa"></category></entry><entry><title>Reading a getsf catalog</title><link href="https://keflavich.github.io/blog/reading-a-getsf-catalog.html" rel="alternate"></link><published>2021-05-15T21:23:00-06:00</published><updated>2021-05-15T21:23:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2021-05-15:/blog/reading-a-getsf-catalog.html</id><content type="html">&lt;p&gt;To read a &lt;a class="reference external" href="http://irfu.cea.fr/Pisp/alexander.menshchikov/#method"&gt;getsf&lt;/a&gt; catalog, you can do:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy.io&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;ascii&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;cat&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ascii&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'getsf.cat'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data_start&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'commented_header'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;header_start&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;110&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;comment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;\&lt;span class="s2"&gt;&amp;quot;!&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;though &lt;tt class="docutils literal"&gt;header_start&lt;/tt&gt; may be different; I've seen 110 and 120 at least.&lt;/p&gt;
</content><category term="misc"></category><category term="getsf"></category></entry><entry><title>Determing ALMA Array Configurations</title><link href="https://keflavich.github.io/blog/determing-alma-array-configurations.html" rel="alternate"></link><published>2021-04-27T08:51:00-06:00</published><updated>2021-04-27T08:51:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2021-04-27:/blog/determing-alma-array-configurations.html</id><summary type="html">&lt;p&gt;ALMA's named array configurations are not accessible through CASA.
They are available from &lt;a class="reference external" href="https://almascience.eso.org/observing/observing-configuration-schedule/prior-cycle-observing-and-configuration-schedule"&gt;https://almascience.eso.org/observing/observing-configuration-schedule/prior-cycle-observing-and-configuration-schedule&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This snippet will let you grab the tables and create a mapping from date to array config name.&lt;/p&gt;
&lt;p&gt;However, it's a HUGE waste of time, because these data are stored …&lt;/p&gt;</summary><content type="html">&lt;p&gt;ALMA's named array configurations are not accessible through CASA.
They are available from &lt;a class="reference external" href="https://almascience.eso.org/observing/observing-configuration-schedule/prior-cycle-observing-and-configuration-schedule"&gt;https://almascience.eso.org/observing/observing-configuration-schedule/prior-cycle-observing-and-configuration-schedule&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This snippet will let you grab the tables and create a mapping from date to array config name.&lt;/p&gt;
&lt;p&gt;However, it's a HUGE waste of time, because these data are stored directly in the MS!&lt;/p&gt;
&lt;p&gt;This is the right way:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vis&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s1"&gt;'/ASDM_EXECBLOCK'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;tb&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getcol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'configName'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="c1"&gt;# array(['C43-3'], dtype='&amp;lt;U16')&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;This is the hacky, reconstructed from the website, bad way:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;bs4&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;BeautifulSoup&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy.table&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Table&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;vstack&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy.io&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;ascii&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy.time&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Time&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://almascience.eso.org/observing/observing-configuration-schedule/prior-cycle-observing-and-configuration-schedule&amp;quot;&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raise_for_status&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;soup&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BeautifulSoup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;soup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;findAll&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'table'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;class_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;grid listing&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;clean_lines&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;soup&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;badrows&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'Long Baseline Campaign'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;                               &lt;span class="s1"&gt;'February Maintenance Period'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;                               &lt;span class="s1"&gt;'End of Cycle'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;                               &lt;span class="s1"&gt;'Engineering/Software'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;                               &lt;span class="s1"&gt;'Engineering/Software Time'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;                                   &lt;span class="p"&gt;]):&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;tr&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;soup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'tr'&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bad&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;bad&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;badrows&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;             &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;tr&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extract&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;soup&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;soup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;findAll&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'table'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;class_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;grid listing&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;ascii&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clean_lines&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tbl&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt; &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'html'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;tbl&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;][:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;'Block'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;'Block'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;astype&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'int'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;'maximumrecoverablescale2(&amp;quot;)'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;'maximumrecoverablescale2(&amp;quot;)'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;astype&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'str'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="n"&gt;stacked&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vstack&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tables&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;start_times&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Time&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stacked&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'Start date'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;end_times&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Time&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stacked&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'End date'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;Then, say you have a list of measurement sets &lt;tt class="docutils literal"&gt;mses&lt;/tt&gt;, you can look up the
array configuration for each date and field.  The choice of &lt;tt class="docutils literal"&gt;fields[0]&lt;/tt&gt; here
only makes sense if your data had a single target; it's a bad choice if there
are multiple targets in a scheduling block:&lt;/p&gt;
&lt;pre class="code python literal-block"&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;json&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;casatools&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;msmetadata&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;span class="n"&gt;msmd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;msmetadata&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="n"&gt;results&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;vis&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;mses&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;    &lt;span class="n"&gt;msmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mses&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;    &lt;span class="n"&gt;obstime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Time&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timerangeforobs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="s1"&gt;'begin'&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;'m0'&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s1"&gt;'value'&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;format&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'mjd'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;    &lt;span class="n"&gt;fieldnames&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;msmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fieldnames&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;    &lt;span class="n"&gt;fields&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;unique&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fieldnames&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;msmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fieldsforintent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'OBSERVE_TARGET#ON_SOURCE'&lt;/span&gt;&lt;span class="p"&gt;)])&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;    &lt;span class="n"&gt;msmd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;    &lt;span class="n"&gt;array_config&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stacked&lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;obstime&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;start_times&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;obstime&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;end_times&lt;/span&gt;&lt;span class="p"&gt;)][&lt;/span&gt;&lt;span class="s1"&gt;'Approx&lt;/span&gt;&lt;span class="se"&gt;\xa0&lt;/span&gt;&lt;span class="s1"&gt;Config.'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]][&lt;/span&gt;&lt;span class="n"&gt;obstime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'%Y-%m-&lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;array_config&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;        &lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;obstime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'%Y-%m-&lt;/span&gt;&lt;span class="si"&gt;%d&lt;/span&gt;&lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt; &lt;span class="n"&gt;array_config&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]}&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'array_configurations.json'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'w'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;fh&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;    &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dump&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fh&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;
</content><category term="misc"></category><category term="alma"></category></entry><entry><title>CASA: Logfiles &amp; tclean from pysynthesisimager</title><link href="https://keflavich.github.io/blog/casa-logfiles-tclean-from-pysynthesisimager.html" rel="alternate"></link><published>2020-05-09T14:59:00-06:00</published><updated>2020-05-09T14:59:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2020-05-09:/blog/casa-logfiles-tclean-from-pysynthesisimager.html</id><summary type="html">&lt;p&gt;A few brief notes I don't want to forget, so I'm posting them here:&lt;/p&gt;
&lt;p&gt;The name of the log file being used by the currently active CASA session is in &lt;tt class="docutils literal"&gt;casalog.logfile()&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;I'm trying to get the pysynthesisimager version of tclean to work.  This is, in
theory, &amp;quot;exactly the same …&lt;/p&gt;</summary><content type="html">&lt;p&gt;A few brief notes I don't want to forget, so I'm posting them here:&lt;/p&gt;
&lt;p&gt;The name of the log file being used by the currently active CASA session is in &lt;tt class="docutils literal"&gt;casalog.logfile()&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;I'm trying to get the pysynthesisimager version of tclean to work.  This is, in
theory, &amp;quot;exactly the same thing as tclean&amp;quot;, except you (the user) have the
ability to control individual steps.  The process is documented in the &lt;a class="reference external" href="https://casa.nrao.edu/casadocs-devel/stable/global-task-list/task_tclean/examples"&gt;tclean documentation
under examples&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;However, it is not a one-to-one mapping.  &lt;tt class="docutils literal"&gt;tclean&lt;/tt&gt; is not implemented using the exact script quoted
in the examples.  The differences are the variety that shouldn't matter but inevitably do.&lt;/p&gt;
&lt;p&gt;I'm working on a translation of &lt;tt class="docutils literal"&gt;tclean&lt;/tt&gt;'s input parameters to
&lt;tt class="docutils literal"&gt;pysynthesisimager&lt;/tt&gt;'s, but it's not complete:
&lt;a class="reference external" href="https://gist.github.com/keflavich/a9953c88cbe098b5e9bb4bdac6485f09"&gt;https://gist.github.com/keflavich/a9953c88cbe098b5e9bb4bdac6485f09&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;That was dumb anyway, because
&lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/master/gcwrap/python/scripts/task_tclean.py"&gt;https://github.com/radio-astro/casa/blob/master/gcwrap/python/scripts/task_tclean.py&lt;/a&gt;
does everything I really needed.&lt;/p&gt;
&lt;p&gt;My version saves the image, residual, and model at each major cycle.&lt;/p&gt;
</content><category term="misc"></category><category term="casa"></category></entry><entry><title>CASA Cross-Calibration Application</title><link href="https://keflavich.github.io/blog/casa-cross-calibration-application.html" rel="alternate"></link><published>2019-08-22T13:06:00-06:00</published><updated>2019-08-22T13:06:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2019-08-22:/blog/casa-cross-calibration-application.html</id><summary type="html">&lt;p&gt;On several independent occasions, I've had data where the continuum is bright
enough to self-calibrate, but the lines aren't.  In these cases, I want to apply
the continuum-derived selfcal solutions to the line data.&lt;/p&gt;
&lt;p&gt;In all of these cases, I have several independent execution blocks that I've
split and downsampled …&lt;/p&gt;</summary><content type="html">&lt;p&gt;On several independent occasions, I've had data where the continuum is bright
enough to self-calibrate, but the lines aren't.  In these cases, I want to apply
the continuum-derived selfcal solutions to the line data.&lt;/p&gt;
&lt;p&gt;In all of these cases, I have several independent execution blocks that I've
split and downsampled before combining to make the continuum image.&lt;/p&gt;
&lt;p&gt;I got stuck trying to make this happen, but we reconvened on the topic in early
2021, and Manuel Fernandez and Roberto Galvan-Madrid and I came up with this
tool to match spectral windows in a concatenated data set to the appropriate
windows in the original:
&lt;a class="reference external" href="https://github.com/ALMA-IMF/reduction/blob/master/misc/applycal_tests.py"&gt;https://github.com/ALMA-IMF/reduction/blob/master/misc/applycal_tests.py&lt;/a&gt;&lt;/p&gt;
</content><category term="misc"></category><category term="tags"></category></entry><entry><title>CASA corrupted measurement sets</title><link href="https://keflavich.github.io/blog/casa-corrupted-measurement-sets.html" rel="alternate"></link><published>2019-07-23T13:11:00-06:00</published><updated>2019-07-23T13:11:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2019-07-23:/blog/casa-corrupted-measurement-sets.html</id><summary type="html">&lt;p&gt;Over the weekend, I had a huge quantity of ALMA data get corrupted. The
corruption appears to have been caused by an incorrectly-mounted lustre system
that had &amp;quot;flock&amp;quot; disabled.  When they re-mounted the filesystem, every
measurement set I had touched was unreadable.&lt;/p&gt;
&lt;p&gt;Corrupted data sets had messages like this when …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Over the weekend, I had a huge quantity of ALMA data get corrupted. The
corruption appears to have been caused by an incorrectly-mounted lustre system
that had &amp;quot;flock&amp;quot; disabled.  When they re-mounted the filesystem, every
measurement set I had touched was unreadable.&lt;/p&gt;
&lt;p&gt;Corrupted data sets had messages like this when opened with &lt;tt class="docutils literal"&gt;msmd.open&lt;/tt&gt;:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
RuntimeError: Exception: Illegal DATA_DESC_ID value 30 found in main table. /lustre/cv/projects/ALMA_IMF/2017.1.01355.L/science_goal.uid___A001_X1296_X211/group.uid___A001_X1296_X212/member.uid___A001_X1296_X217/calibrated/uid___A002_Xcbdb2a_X6e67.ms.split.cal/DATA_DESCRIPTION only has 0 rows (IDs).
... thrown by void casa::MSChecker::checkReferentialIntegrity() const at File: ../../msvis/MSVis/MSChecker.cc, line: 78
&lt;/pre&gt;
&lt;p&gt;The solution was to replace all of the &lt;tt class="docutils literal"&gt;table.dat&lt;/tt&gt; files in the
&lt;tt class="docutils literal"&gt;DATA_DESCRIPTION&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;POLARIZATION&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;STATE&lt;/tt&gt;, and &lt;tt class="docutils literal"&gt;PROCESSOR&lt;/tt&gt; folders
with &amp;quot;backups&amp;quot; from the parent measurement set.  Luckily, all of my data were
split from other measurement sets that still existed, and they were split with
&lt;tt class="docutils literal"&gt;reindex=False&lt;/tt&gt;, which meant that these tables were actually usable.  There's
no guarantee they would be in general.&lt;/p&gt;
&lt;p&gt;My fix script is this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;getdata&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rb&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;fh&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;fh&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;diff&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;ii&lt;/span&gt;&lt;span class="p"&gt;:(&lt;/span&gt;&lt;span class="n"&gt;xx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;yy&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;ii&lt;/span&gt;&lt;span class="p"&gt;,(&lt;/span&gt;&lt;span class="n"&gt;xx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;yy&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;enumerate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;zip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;xx&lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="n"&gt;yy&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fix_bad_mses&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;dirpath&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dirnames&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;filenames&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;walk&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;fn&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dirnames&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;fn&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;:]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;.split.cal&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;ffn&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dirpath&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fn&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="n"&gt;workingfn&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dirpath&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;working&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fn&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;workingfn&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                    &lt;span class="c1"&gt;#print(&amp;quot;Working on files {0} and {1}&amp;quot;.format(ffn, workingfn))&lt;/span&gt;
                    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ffn&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

                    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;dn&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;POLARIZATION&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;PROCESSOR&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;DATA_DESCRIPTION&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;STATE&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
                        &lt;span class="n"&gt;tbpth1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ffn&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dn&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;table.dat&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                        &lt;span class="n"&gt;tbpth2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;workingfn&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dn&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;table.dat&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

                        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tbpth1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exists&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tbpth2&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
                            &lt;span class="n"&gt;d1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getdata&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tbpth1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                            &lt;span class="n"&gt;d2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getdata&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tbpth2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                            &lt;span class="n"&gt;delta&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;diff&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;d2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                            &lt;span class="c1"&gt;#print(&amp;quot;Diff from {0} to {1} is {2}&amp;quot;.format(tbpth1, tbpth2, delta))&lt;/span&gt;

                            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;delta&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                                &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;FIXING: Diff for &lt;/span&gt;&lt;span class="si"&gt;{0}&lt;/span&gt;&lt;span class="s2"&gt; is &lt;/span&gt;&lt;span class="si"&gt;{1}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dn&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;delta&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
                                &lt;span class="n"&gt;shutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tbpth1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tbpth1&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.bck&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                                &lt;span class="n"&gt;shutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tbpth2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tbpth1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;which spewed out a bunch of messages like this:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
FIXING: Diff for POLARIZATION is {24: ('\x00', '\x01'), 1059: ('\x00', '\x01')}
FIXING: Diff for PROCESSOR is {24: ('\x00', '\x03'), 1078: ('\x00', '\x03')}
FIXING: Diff for DATA_DESCRIPTION is {24: ('\x00', '\x18'), 772: ('\x00', '\x18')}
FIXING: Diff for STATE is {24: ('\x00', '\x1d'), 1699: ('\x00', '\x1d')}
&lt;/pre&gt;
&lt;p&gt;showing that for each bad file, two bytes were flipped.  I don't know how or why.  Notably, though,
the byte flips that corrupted the data did &lt;em&gt;not&lt;/em&gt; change the file modification date - somehow CASA
hid this operation from the filesystem.&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category></entry><entry><title>FeO Nondetection in Orion</title><link href="https://keflavich.github.io/blog/feo-nondetection-in-orion.html" rel="alternate"></link><published>2018-10-14T15:09:00-06:00</published><updated>2018-10-14T15:09:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2018-10-14:/blog/feo-nondetection-in-orion.html</id><summary type="html">&lt;p&gt;I had a Cycle 3 ALMA program &lt;a class="reference external" href="https://almascience.nrao.edu/observing/highest-priority-projects"&gt;2015.1.00262.S:
Digging for rusty bullets at an explosion site&lt;/a&gt;
that aimed to detect &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Iron(II)_oxide"&gt;ferrous oxide, FeO&lt;/a&gt;
in the shocked outflows of the Orion nebula.&lt;/p&gt;
&lt;p&gt;I haven't published anything on this data set because it resulted in a fairly
boring non-detection …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I had a Cycle 3 ALMA program &lt;a class="reference external" href="https://almascience.nrao.edu/observing/highest-priority-projects"&gt;2015.1.00262.S:
Digging for rusty bullets at an explosion site&lt;/a&gt;
that aimed to detect &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Iron(II)_oxide"&gt;ferrous oxide, FeO&lt;/a&gt;
in the shocked outflows of the Orion nebula.&lt;/p&gt;
&lt;p&gt;I haven't published anything on this data set because it resulted in a fairly
boring non-detection.  You can find the source code to retrieve and process
the data from &lt;a class="reference external" href="https://github.com/keflavich/FeO_2015.1.00262.S"&gt;here&lt;/a&gt;.
The nondetection is several orders of magnitude deeper than previous
ones, but to demonstrate this definitively, we need to do some more modeling
work, which my co-I's and I have decided isn't worth the time, since we're
all flooded with very exciting new ALMA data that has interesting detections
in it (see salts soon).&lt;/p&gt;
&lt;p&gt;In brief, we were looking at a location where we know molecules (H2, molecular
hydrogen) and gas-phase iron (Fe II, as seen in in the [Fe II] 1.64 micron lines)
are approximately coincident.  The most likely (and broadly accepted)
explanation is that dust particles are being destroyed (sputtered) in the
high-velocity ($&amp;gt;30$ km/s, up to about $100-200$ km/s) shocks produced in an
outflow.  Since iron in the interstellar medium mostly lives in the cores of
dust grains, we thought it might be released in a molecular form detectable by
ALMA before being split into an atomic, ionized form.&lt;/p&gt;
&lt;p&gt;Despite having a good location and a sensitive observation, we didn't detect
any.  It might mean that iron is mostly in a different molecular form, or it
might mean that when iron gets sputtered out of grains, it never goes into
a molecular form at all, instead dissociating straight into atomic form.&lt;/p&gt;
&lt;p&gt;There are a few things that, with infinite time, I would do with this data set:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Come up with a formal upper limit on the FeO abundance.&lt;/li&gt;
&lt;li&gt;Compare the lines we did detect to the outflows and see if we can better
constrain their physical conditions&lt;/li&gt;
&lt;li&gt;Catalog the stars and publish the catalog for comparison to other data sets.
(actually, this is done: &lt;a class="reference external" href="https://github.com/keflavich/FeO_2015.1.00262.S/blob/master/tables/gaussian_fit_table.ipac"&gt;this table&lt;/a&gt;
contains Gaussian fits to each of the stars in the continuum image (&lt;a class="reference external" href="https://github.com/keflavich/FeO_2015.1.00262.S/blob/master/analysis/contsource_centroids.py"&gt;source&lt;/a&gt;).)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;These figure show the apertures we used to extract spectra and search for the
lines, then the spectra of different species for one of the apertures.  The
background image is the H2 (orange) + FeII (cyan) + K-band (mostly white) I
made for my &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2015A%26A...579A.130B"&gt;2015 paper with John Bally&lt;/a&gt;.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/feo/aperture_overlays.png" style="width: 600px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/feo/BulletHeads4_alllines.png" style="width: 600px;" /&gt;
</content><category term="misc"></category><category term="alma"></category></entry><entry><title>Talks: Now using revealjs</title><link href="https://keflavich.github.io/blog/talks-now-using-revealjs.html" rel="alternate"></link><published>2018-07-08T12:37:00-06:00</published><updated>2018-07-08T12:37:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2018-07-08:/blog/talks-now-using-revealjs.html</id><summary type="html">&lt;p&gt;I'm attempting to wean myself off of Mac-specific technology, inspired by some
impending hardware failures (see below), the not-falling cost of not-improving
hardware, and the lack of budget growth.&lt;/p&gt;
&lt;p&gt;Following a suggestion from &lt;a class="reference external" href="https://github.com/pkgw/"&gt;Peter Williams&lt;/a&gt;, I'm
using reveal.js based on &lt;a class="reference external" href="https://github.com/pkgw/htmltalk"&gt;Peter's template&lt;/a&gt;, which I have previously played with a …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I'm attempting to wean myself off of Mac-specific technology, inspired by some
impending hardware failures (see below), the not-falling cost of not-improving
hardware, and the lack of budget growth.&lt;/p&gt;
&lt;p&gt;Following a suggestion from &lt;a class="reference external" href="https://github.com/pkgw/"&gt;Peter Williams&lt;/a&gt;, I'm
using reveal.js based on &lt;a class="reference external" href="https://github.com/pkgw/htmltalk"&gt;Peter's template&lt;/a&gt;, which I have previously played with a
little with mixed success.  The slid.es editor seems nearly fully featured as a
replacement for keynote, but I quickly dropped it because of its
subscription-only paid features; the cost-benefit analysis is that Keynote is
much cheaper than slid.es for someone like me, since Keynote cost
30 dollars one-time for ~10 years of use, while the minimum usable plan
for slid.es is 10 dollars/month,
or 1200 dollars over the same
period.  If that was the tradeoff I was considering, mac+keynote would be about
the same as linux+slid.es, since I'd be paying a few thousand dollars for the mac.&lt;/p&gt;
&lt;p&gt;I'm taking the somewhat ridiculous approach of raw HTML/CSS editing with the
Chrome inspector as my interactive testing tool.  This is a little tedious
because of the html tagging, but that's honestly not so bad; it lets me do the
hard work with the keyboard instead of the mouse.  The biggest problem is the
learning curve of css, but I look at that as skill and knowledge worth having.
If you don't, this is probably not the approach for you.  I hope, though, that
some day there is a slid.es-like solution that is reasonably priced.&lt;/p&gt;
&lt;p&gt;Another problem is image editing, which was pretty convenient in keynote, but
there are plenty of other decent-to-good image editors out there, e.g., gimp,
preview, etc.  For cropping and opacity, which are most of what you want to do,
css works and can even be tested interactively in the browser.  But, this
should also give more motivation to just make the figures presentation-ready in
the code.&lt;/p&gt;
&lt;p&gt;Anyway, the talks I've created are hosted at github, and they're fully-featured:
you should be able to just click these links and walk through the talks.&lt;/p&gt;
&lt;p&gt;My &amp;quot;Tracing the Flow&amp;quot; invited talk on High Mass Cluster Formation:
&lt;a class="reference external" href="https://keflavich.github.io/talks/HighMassClusterFormation_TracingTheFlow2018.html"&gt;https://keflavich.github.io/talks/HighMassClusterFormation_TracingTheFlow2018.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Some slides for a work meeting on the ALMA-IMF project, with a technical bent:
&lt;a class="reference external" href="https://keflavich.github.io/talks/ALMA_IMF_W51_SgrB2.html"&gt;https://keflavich.github.io/talks/ALMA_IMF_W51_SgrB2.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;If you want the pdf version of either of these, add &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;?print_pdf&lt;/span&gt;&lt;/tt&gt; to the end
of the URL, then use your browser to print and save to pdf.&lt;/p&gt;
&lt;p&gt;Some pictures of the impending failure.  My mac doesn't close any more, and
the charger cable has frayed severely:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/frayed_adapter.jpg" style="width: 600px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/lappy_wont_close.jpg" style="width: 600px;" /&gt;
</content><category term="misc"></category><category term="talks"></category><category term="w51"></category><category term="sgrb2"></category><category term="clusters"></category></entry><entry><title>Brief review of cluster formation simulations</title><link href="https://keflavich.github.io/blog/brief-review-of-cluster-formation-simulations.html" rel="alternate"></link><published>2018-06-18T10:32:00-06:00</published><updated>2018-06-18T10:32:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2018-06-18:/blog/brief-review-of-cluster-formation-simulations.html</id><summary type="html">&lt;p&gt;In preparing for an upcoming talk, I'm taking some notes on cluster formation
simulations, and I want to keep these notes available &amp;amp; public so others can
correct anything that's missing.  In particular, I want to note the resolution of
these simulations.&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;First, Jim Dale has several long series of papers …&lt;/dt&gt;&lt;/dl&gt;</summary><content type="html">&lt;p&gt;In preparing for an upcoming talk, I'm taking some notes on cluster formation
simulations, and I want to keep these notes available &amp;amp; public so others can
correct anything that's missing.  In particular, I want to note the resolution of
these simulations.&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;First, Jim Dale has several long series of papers on cluster formation simulations:&lt;/dt&gt;
&lt;dd&gt;&lt;ul class="first last simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2015NewAR..68....1D"&gt;Review Article&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2012MNRAS.427.2852D"&gt;Ionization-induced star formation - IV. Triggering in bound clusters&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2013MNRAS.431.1062D"&gt;Ionization-induced star formation - V. Triggering in partially unbound clusters&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2018arXiv180404664K"&gt;Kim, Kim, Ostriker 2018&lt;/a&gt; ~240 Msun&lt;/li&gt;
&lt;/ul&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;Unfortunately, I stopped taking notes and started focusing on just the talk, so
this ended up quite incomplete.  I'm not going to try to archive this any further...&lt;/p&gt;
&lt;p&gt;If you're interested, instead just see my talk: &lt;a class="reference external" href="https://keflavich.github.io/talks/HighMassClusterFormation_TracingTheFlow2018.html"&gt;https://keflavich.github.io/talks/HighMassClusterFormation_TracingTheFlow2018.html&lt;/a&gt;&lt;/p&gt;
</content><category term="misc"></category><category term="cluster formation"></category></entry><entry><title>Derivation of CO Column Density</title><link href="https://keflavich.github.io/blog/derivation-of-co-column-density.html" rel="alternate"></link><published>2018-04-18T11:10:00-06:00</published><updated>2018-04-18T11:10:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2018-04-18:/blog/derivation-of-co-column-density.html</id><summary type="html">&lt;p&gt;I've regularly had to calculate masses and column densities from CO
isotopologues, as have many others.  I found a textbooklike derivation in my
old notes, so I figured I'd publish them.&lt;/p&gt;
&lt;p&gt;I don't have time to nicely format things now, but the code, associated figures,
and a 3-page tex document …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I've regularly had to calculate masses and column densities from CO
isotopologues, as have many others.  I found a textbooklike derivation in my
old notes, so I figured I'd publish them.&lt;/p&gt;
&lt;p&gt;I don't have time to nicely format things now, but the code, associated figures,
and a 3-page tex document with equations are all here:
&lt;a class="reference external" href="https://github.com/keflavich/co_properties"&gt;https://github.com/keflavich/co_properties&lt;/a&gt;
I'm pretty sure this all comes from a homework assignment in 2007 or 2008, so
it's likely there are errors.&lt;/p&gt;
</content><category term="misc"></category><category term="co"></category><category term="column"></category><category term="calculation"></category></entry><entry><title>The extragalactic view of W51 at 220 and 290 GHz</title><link href="https://keflavich.github.io/blog/the-extragalactic-view-of-w51-at-220-and-290-ghz.html" rel="alternate"></link><published>2017-12-01T11:23:00-07:00</published><updated>2017-12-01T11:23:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2017-12-01:/blog/the-extragalactic-view-of-w51-at-220-and-290-ghz.html</id><summary type="html">&lt;p&gt;These are APEX data covering 5.5' x 5.5' centered on W51 Main:
&lt;a class="reference external" href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/RYEANM"&gt;https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/RYEANM&lt;/a&gt;
These are calibrated to T_A* units.  APEX telescope efficiencies can be found
here: &lt;a class="reference external" href="http://www.apex-telescope.org/telescope/efficiency/"&gt;http://www.apex-telescope.org/telescope/efficiency/&lt;/a&gt; and are approximately
0 …&lt;/p&gt;</summary><content type="html">&lt;p&gt;These are APEX data covering 5.5' x 5.5' centered on W51 Main:
&lt;a class="reference external" href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/RYEANM"&gt;https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/RYEANM&lt;/a&gt;
These are calibrated to T_A* units.  APEX telescope efficiencies can be found
here: &lt;a class="reference external" href="http://www.apex-telescope.org/telescope/efficiency/"&gt;http://www.apex-telescope.org/telescope/efficiency/&lt;/a&gt; and are approximately
0.75 at the observed frequencies.&lt;/p&gt;
&lt;p&gt;W51 is at a distance of 5.1 kpc, so this field of view is equivalent to 8.1 pc, or 1.7&amp;quot; at
1 Mpc or 0.33&amp;quot; at 5 Mpc.&lt;/p&gt;
&lt;p&gt;The linewidth is 12.7-15.2 km/s (H2CO 4-3, CO 2-1) FWHM averaged over this full field.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/gaussfit_h2co4-3_velocity.png" style="width: 200px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/gaussfit_12co2-1_velocity.png" style="width: 200px;" /&gt;
&lt;p&gt;Images of the spectra, with some lines identified, are shown here (open them in
a new tab to see the full resolution).  The baselines aren't great, but it's
easy to fit a local linear baseline around any of the fairly narrow lines.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/lineid_avg_W51_12CO_merge.png" style="width: 200px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/lineid_avg_W51_217GHz_merge.png" style="width: 200px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/lineid_avg_W51_218GHz_merge.png" style="width: 200px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/lineid_avg_W51_232GHz_merge.png" style="width: 200px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/lineid_avg_W51_291GHz_merge.png" style="width: 200px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/lineid_avg_W51_293GHz_merge.png" style="width: 200px;" /&gt;
&lt;p&gt;The same images, but not zoomed in the y-direction.  Note that 12CO 2-1 is very
near the edge of the band; it peaks around 20 K:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/avg_W51_12CO_merge.png" style="width: 200px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/avg_W51_217GHz_merge.png" style="width: 200px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/avg_W51_218GHz_merge.png" style="width: 200px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/avg_W51_232GHz_merge.png" style="width: 200px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/avg_W51_291GHz_merge.png" style="width: 200px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/avg_W51_293GHz_merge.png" style="width: 200px;" /&gt;
&lt;p&gt;Scripts to obtain the data and process them are here:
&lt;a class="reference external" href="https://github.com/keflavich/W51_APEX_H2CO"&gt;https://github.com/keflavich/W51_APEX_H2CO&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;See the related project by Watanabe et al looking at W51 in the 3mm band:
&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2017ApJ...845..116W"&gt;http://adsabs.harvard.edu/abs/2017ApJ...845..116W&lt;/a&gt;&lt;/p&gt;
</content><category term="misc"></category><category term="w51"></category><category term="alma"></category><category term="synthetic extragalactic"></category></entry><entry><title>Understanding Millimeter Source Counts</title><link href="https://keflavich.github.io/blog/understanding-millimeter-source-counts.html" rel="alternate"></link><published>2017-10-07T14:48:00-06:00</published><updated>2017-10-07T14:48:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2017-10-07:/blog/understanding-millimeter-source-counts.html</id><summary type="html">&lt;p&gt;A few recent projects (&lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S"&gt;ALMA W51&lt;/a&gt; and &lt;a class="reference external" href="https://github.com/keflavich/SgrB2_ALMA_3mm_Mosaic/"&gt;ALMA Sgr B2&lt;/a&gt;) have raised
the question: How do we interpret unresolved millimeter sources?&lt;/p&gt;
&lt;p&gt;In the two linked works, I concluded that most of the 1mm and 3mm point sources
we detected with ALMA at D&amp;gt;5 kpc are protostars with dust envelopes …&lt;/p&gt;</summary><content type="html">&lt;p&gt;A few recent projects (&lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S"&gt;ALMA W51&lt;/a&gt; and &lt;a class="reference external" href="https://github.com/keflavich/SgrB2_ALMA_3mm_Mosaic/"&gt;ALMA Sgr B2&lt;/a&gt;) have raised
the question: How do we interpret unresolved millimeter sources?&lt;/p&gt;
&lt;p&gt;In the two linked works, I concluded that most of the 1mm and 3mm point sources
we detected with ALMA at D&amp;gt;5 kpc are protostars with dust envelopes - i.e.,
they are &amp;quot;Class 0/I&amp;quot;-like sources, but they are generally more luminous (and
therefore more massive) than their local analogs.&lt;/p&gt;
&lt;p&gt;One of the appeals of the dust continuum, the wavelength range from about 0.5
to 2 mm, for studying star formation is that we usually assume that the source
brightness is proportional to the source mass.  For optically thin dust, this
assumption is pretty good.  The (systematic, unmeasurable) uncertainty is, to
first order, just the uncertainty in the dust temperature.&lt;/p&gt;
&lt;p&gt;However, protostellar cores - dust cores that contain a YSO or any luminous
object (whether the luminosity is nuclear or gravitational in nature doesn't
matter) - violate those assumptions.  First, the dust is not isothermal, so the
emission is weighted toward the hotter dust that represents less of the total
mass.  Second, the dust is not necessarily optically thin - a centrally
concentrated source is likely to have a significant optical depth, particularly
at the shorter wavelengths.  Third, once the optically thin assumption is
broken, the source geometry matters; there may be some axes along which the
source is substantially brighter.&lt;/p&gt;
&lt;p&gt;The &lt;a class="reference external" href="https://almascience.nrao.edu/observing/highest-priority-projects#flyout_2017.1.01355.L"&gt;ALMA-IMF program&lt;/a&gt;,
which I am co-leading with Frederique Motte, Patricio Sanhueza, and Fabien Louvet, has the broad goal of
understanding the formation of the IMF in the Galaxy.  In practice, we will
measure some form of 1 mm luminosity function.  In the long term, we may be
able to obtain some additional constraints on the internal temperature
structures of the sources.  The imminence of this large data set motivates the
development of a general systematic analysis tool for assessing the
implications of the mm luminosity function on the underlying mass function.&lt;/p&gt;
&lt;p&gt;In the related &lt;a class="reference external" href="blog/protostellar-mass-functions.html"&gt;Protostellar Mass Functions&lt;/a&gt; post, I implemented the
protostellar mass functions described by &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2010ApJ...716..167M"&gt;McKee and Offner&lt;/a&gt;.  These functions
provide the mapping between a stellar mass function and a protostellar mass
function given some assumed accretion history.  The assumed accretion histories
for the stars are very simple (in reality, accretion is probably quite
stochastic), but that's fine since it provides something testable.&lt;/p&gt;
&lt;p&gt;I've then tried to follow up by implementing the next step toward producing
something comparable to observables as defined in &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2011ApJ...736...53O"&gt;Offner and McKee&lt;/a&gt;, but
unfortunately this is a good deal more challenging.  We need a means to map a
protostellar mass to a luminosity, and there is no simple one-to-one function
to do this.&lt;/p&gt;
&lt;div class="section" id="protostellar-evolution-models"&gt;
&lt;h2&gt;Protostellar Evolution Models&lt;/h2&gt;
&lt;p&gt;Several authors have described protostellar evolution models.  They mostly
refer back to &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/1991ApJ...375..288P"&gt;Palla &amp;amp; Stahler I&lt;/a&gt; and &lt;a class="reference external" href="Palla&amp;amp;StahlerII"&gt;II&lt;/a&gt;.  The &lt;a class="reference external" href="Offner+2009"&gt;Offner
&amp;amp; McKee model&lt;/a&gt; is based on &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2004ApJ...603..383T"&gt;Tan &amp;amp; McKee 2004&lt;/a&gt;.  There is a
similar model by &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2009ApJ...691..823H"&gt;Hosokawa &amp;amp; Omukai&lt;/a&gt;, who have shown that high-mass stars can
have substantially varying structures (radii -&amp;gt; luminosities) depending on
their accretion rates.  Mikhail Klassen implemented the &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2009ApJ...703..131O"&gt;Offner+ 2009&lt;/a&gt;
protostellar evolution models &lt;a class="reference external" href="MikhailKlassen"&gt;in fortran&lt;/a&gt; in &lt;a class="reference external" href="Klassen+2012"&gt;this paper&lt;/a&gt;, with only slight differences assumed in the polytropic
parameters and the accretion luminosity (&lt;a class="reference external" href="Offner+2009"&gt;Offner+&lt;/a&gt; assumed 25%
of the accretion energy is lost to wind and treated the disk and star accretion
luminosity separately, according to &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2012MNRAS.421.2861K"&gt;Klassen+ 2012&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;The Klassen implementation is the best immediately available to me.  Both they
and &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2011ApJ...736...53O"&gt;Offner and McKee&lt;/a&gt; compared their results to &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2009ApJ...691..823H"&gt;Hosokawa &amp;amp; Omukai&lt;/a&gt;,
considering the latter to be more accurate, and found &amp;quot;good&amp;quot; agreement (&amp;lt;2x
disagreement) in the radius as a function of mass.  The same comparison is
shown below; these figures match &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2012MNRAS.421.2861K"&gt;Klassen+ 2012&lt;/a&gt; Figures 1 and 2 (though I
don't plot exactly the same things).&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/Klassen_vs_Hosokawa_model_comparison.png" style="width: 600px;" /&gt;
&lt;p&gt;At least in priniple, these tools give us a mechanism to determine L(M, M_f),
the luminosity as a function of the current mass and the final mass of a star.
Alternatively, that can be written as L(t, M_f), the luminosity as a function
of time and final mass.  However, there is at least one major practical concern:
the protostellar evolution models have the free variable mdot, not M_f, so
in order to use these models, we need to populate a 'fully sampled' L(M, M_f) table.
Offner et al computed such a table, but then used an approximation for
R(M) - the stellar radius as a function of its mass - for their calculations.&lt;/p&gt;
&lt;!-- There are two types of accretion histories considered by Offner.  First, they --&gt;
&lt;!-- consider a series of constant (time-independent) accretion histories with mdot --&gt;
&lt;!-- determined by the final mass.  Second, they consider an accelerating --&gt;
&lt;!-- (time-dependent) accretion history.  Grids based on the former are easier to build; --&gt;
&lt;!-- grids based on the latter require modification of the Klassen code. --&gt;
&lt;p&gt;Following Offner, though, the accretion histories are not constant.  Instead,
they use a variety of accretion histories: isothermal sphere, turbulent core,
and competitive accretion.
To compute the L(M, M_f) tables, we need to run a
modified version of the Klassen code with a variable accretion history.&lt;/p&gt;
&lt;p&gt;The isothermal sphere case is actually a constant accretion rate, so that one is
pretty easy.  The turbulent core and competitive accretion models have an accretion
rate that depends on time or mass.&lt;/p&gt;
&lt;div class="section" id="turbulent-core-protostellar-evolution"&gt;
&lt;h3&gt;Turbulent Core Protostellar Evolution&lt;/h3&gt;
&lt;p&gt;I've implemented the turbulent core accretion history in my &lt;a class="reference external" href="https://github.com/keflavich/protostellar_evolution"&gt;fork&lt;/a&gt; of Mikhail
Klassen's repository.  The modification is fairly straightforward: the
accretion rate is set at each timestep according to Equation 23 of &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2010ApJ...716..167M"&gt;McKee and
Offner&lt;/a&gt; using the numerical constants they computed.  Then, if the stellar
mass has reached (or exceeds) the target stellar mass, set the accretion rate
to zero.  The stellar evolution code can then proceed with no further
accretion.&lt;/p&gt;
&lt;p&gt;I've run this using the default initial conditions, a clump surface density
$Sigma_{cl} = 0.1$ g cm$^{-2}$.  The results are in the next figure: nearly
all of the interesting evolution happens before the stars reach 10 Msun.  The
accretion luminosity is almost always subdominant, at least once anything
reaches 10 Lsun.  The most massive star seems to shrink below its main sequence
size prior to reaching the main sequence, which is a little weird.  I'm not
sure if I trust that.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/Klassen_turbulentcore_model.png" style="width: 600px;" /&gt;
&lt;p&gt;Further exploration of accretion history parameter space is future work.
I now at least know how to set up the basic models and assemble lookup
tables for L(mf,t).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="protostellar-sed-models"&gt;
&lt;h2&gt;Protostellar SED Models&lt;/h2&gt;
&lt;p&gt;The next step in computing a millimeter luminosity distribution is to convert
from stellar luminosity to the reprocessed flux at a given wavelength.  This
step has an enormous number of free parameters, since the surrounding structure
may include both a disk and a core whose shapes will both vary.&lt;/p&gt;
&lt;p&gt;There are two large grids of radiative transfer models that have been computed
for this purpose.  The &lt;a class="reference external" href="https://zenodo.org/record/166732#.WdlXwmK3xcw"&gt;Robitaille grid&lt;/a&gt; is complete and open, and it should
cover all stellar masses.  The &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2017arXiv170808853Z"&gt;Zhang+ 2017&lt;/a&gt; grid is not yet available, but it
may be more self-consistent.&lt;/p&gt;
&lt;p&gt;I plan to use the protostellar evolutionary model parameters, i.e., the radius
and luminosity, to select models from this grid.  However, the Robitaille grid
uses surface temperature and radius, not luminosity and radius.  So we either
need to compute the stellar luminosity in the Robitaille models assuming the
stars are perfect blackbodies, then use the stellar luminosity to select from
that grid, or we need to compute the stellar surface temperature from
the evolutionary model.&lt;/p&gt;
&lt;p&gt;Since the Robitaille models cover a large number of parameters, but do so in a
fairly sparse grid, it is not trivial to map from radius+luminosity to the
models.  For example, for a $2-3x10^5$ Lsun star with radius 40-50 Rsun,
there are 860 models in the &lt;tt class="docutils literal"&gt;spubhmi&lt;/tt&gt; grid, most of which lack flux measurements
in many apertures.&lt;/p&gt;
&lt;div class="section" id="example-model-selection"&gt;
&lt;h3&gt;Example Model Selection&lt;/h3&gt;
&lt;p&gt;For this example, I'm looking at an mf=10 Msun star at t=0.58 Myr, at which
point it has m=6.5 Msun.  Its radius at this time is 9.0 Rsun and &lt;em&gt;stellar&lt;/em&gt;
luminosity 1300 Lsun.  This is the line of output from the Klassen model:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
            Time        Stellar_Mass      Accretion_Rate      Stellar_Radius    Polytropic_Index      Deuterium_Mass       Intrinsic_Lum    Total_Luminosity    Stage
0.1842924478E+14    0.1300261603E+35    0.1404188516E+22    0.6278790980E+12    0.3000000000E+01    0.0000000000E+00    0.5084830934E+37    0.6525577133E+37        4
&lt;/pre&gt;
&lt;p&gt;I select models within 5% of this one's radius and luminosity:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;lum&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.5084830934E+37&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;erg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L_sun&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;rad&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.6278790980E+12&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cm&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;R_sun&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;selpars&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Luminosity&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;lum&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mf"&gt;0.95&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Luminosity&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;lum&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mf"&gt;1.05&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;star.radius&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;rad&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mf"&gt;0.95&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;star.radius&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;rad&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mf"&gt;1.05&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;My first attempt at this, with the &lt;tt class="docutils literal"&gt;spubhmi&lt;/tt&gt; model, resulted in one that has
no flux in small (4000 AU) aperture, which I don't yet know how to interpret -
it is certainly possible for such a source, with a non-negligible envelope, to
exist, and it would certainly produce some flux.&lt;/p&gt;
&lt;p&gt;More lenient parameters are needed:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;lum&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.5084830934E+37&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;erg&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;L_sun&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;rad&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.6278790980E+12&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cm&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;R_sun&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;apnum&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argmin&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;seds&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;apertures&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;2000&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;au&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;wav&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;95&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GHz&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mm&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;spectral&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;wavnum&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argmin&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;seds&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;wav&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;wav&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;ok&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;isfinite&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;seds&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;[:,&lt;/span&gt;&lt;span class="n"&gt;wavnum&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;apnum&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;selpars&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Luminosity&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;lum&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mf"&gt;0.9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Luminosity&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;lum&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mf"&gt;1.10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;star.radius&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;rad&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mf"&gt;0.9&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pars&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;star.radius&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;rad&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mf"&gt;1.10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;ok&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This one at least results in some hits.  There are three models with fluxes (at
Sgr B2, in a 2000 AU radius aperture, at 95 GHz) of 15-25, 155-170, and 55-60 mJy.
To build a model cluster, we would randomly select one of these models.
Robitaille notes, however, that some of the models are nonphysical; at the moment,
we have no way to assess that, so we have to do the selection blindly.  The brightest
model has a denser envelope and more massive disk.&lt;/p&gt;
&lt;p&gt;We can use this to make a model cluster, but this is a pretty discouraging first model
given my previous work; this is presently a low-luminosity source that is surprisingly
intense at 3mm.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="full-workflow"&gt;
&lt;h2&gt;Full Workflow&lt;/h2&gt;
&lt;p&gt;We first create a cluster by sampling from a stellar initial mass function.
This part is straightforward, at least.&lt;/p&gt;
&lt;p&gt;Then, for each source, we 'rewind' to a specific time and select model parameters
from the protostellar evolution models described above.  The 'rewind' could be
from the point at which the stars reach &amp;quot;stage 5&amp;quot;, main sequence, or we could
select some other criteria.&lt;/p&gt;
&lt;p&gt;Finally, we sample from the Robitaille parameters.  For this first example,
we just randomly select from some parameters that are within 5-10% of the target
parameters.  In the longer term, we'll want to be much more accurate
and find a way to interpolate the Robitaille models onto a &amp;quot;fully sampled&amp;quot; grid
of the parameter space we're interested in.  The Zhang models are probably
better to use once they become available since they may have accretion histories
consistent with those used for the evolutionary model.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="final-comments"&gt;
&lt;h2&gt;Final comments&lt;/h2&gt;
&lt;p&gt;For the next post, I hope to actually generate some clusters and see what sorts
of uncertainties we're dealing with.  The above examples suggest they could be
truly extreme, and perhaps that the Robitaille models will be inadequate for
this purpose.  We'll see.&lt;/p&gt;
&lt;/div&gt;
</content><category term="misc"></category><category term="plf"></category><category term="pmf"></category><category term="cmf"></category></entry><entry><title>Protostellar Mass Functions</title><link href="https://keflavich.github.io/blog/protostellar-mass-functions.html" rel="alternate"></link><published>2017-08-30T15:18:00-06:00</published><updated>2017-08-30T15:18:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2017-08-30:/blog/protostellar-mass-functions.html</id><summary type="html">&lt;p&gt;The stellar &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Initial_mass_function"&gt;initial mass function&lt;/a&gt; is important for a wide
variety of astronomical topics, and I'm interested in studying its formation.
The &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2010ApJ...716..167M"&gt;protostellar mass function&lt;/a&gt;, by contrast, is much
less well-studied, but understanding it can provide important insights into the
formation of the IMF.  In particular, we assume both for …&lt;/p&gt;</summary><content type="html">&lt;p&gt;The stellar &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Initial_mass_function"&gt;initial mass function&lt;/a&gt; is important for a wide
variety of astronomical topics, and I'm interested in studying its formation.
The &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2010ApJ...716..167M"&gt;protostellar mass function&lt;/a&gt;, by contrast, is much
less well-studied, but understanding it can provide important insights into the
formation of the IMF.  In particular, we assume both for simplicity and because
of a lack of contrary evidence, that the IMF is uniform in time in space.  In
other words, given that a star is going to form at some point, it has a
likelihood to become a star of a given mass described exclusively by the IMF.
While this assertion is entirely absurd - if you are &amp;quot;about to form&amp;quot; a star in
a blob of gas that only has 0.1 Msun in a 1 pc radius, it certainly cannot form
a 100 Msun star - it remains consistent with nearly all observations and is
therefore used in this time- and space-invariant form.&lt;/p&gt;
&lt;p&gt;It is likely that new studies of stellar populations, e.g., GAIA's observations
of a huge population of stars with well-determined distances (and therefore
luminosities), will reveal some variations in the IMF.  However, many studies
based on evolved stellar populations are subject to ambiguities in the initial
conditions.  So, it is still quite useful to study those initial conditions
directly.&lt;/p&gt;
&lt;p&gt;There has not been a huge amount of work on protostellar mass functions.
&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2010ApJ...716..167M"&gt;McKee and Offner&lt;/a&gt; defined the PMF as the distribution of masses of
protostellar sources that would produce a given IMF.  Their PMFs are therefore
strongly dependent on the underlying IMF assumed.&lt;/p&gt;
&lt;p&gt;I have implemented the mass functions they defined in &lt;a class="reference external" href="https://github.com/keflavich/imf/blob/master/imf/pmf.py"&gt;this code&lt;/a&gt;.  The code
is generalized such that you can input other mass functions.  McKee &amp;amp; Offner
only used the &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2005ASSL..327...41C"&gt;Chabrier 2005&lt;/a&gt; mass function; I include the &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2001MNRAS.322..231K"&gt;Kroupa 2001&lt;/a&gt; mass
function as well for comparison&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/steadystate_pmf_chabrier_mmax3.png" style="width: 400px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/steadystate_pmf_kroupa_mmax3.png" style="width: 400px;" /&gt;
&lt;p&gt;The comparison between the Chabrier and Kroupa mass functions is shown above.
Note that these are somewhat deceptive plots, since they show P(M) vs log(M).
The plot shows the most likely individual masses by number, but the plots are
actually quite squished to the left in linear space, such that the most common
range of stars (the integral of both functions) is closer to the same (~0.2-0.3
Msun).  The more commonly shown version of these plots is the integral form,
which has a positive power-law slope in the lowest bin in the Kroupa MF,
showing the usual peak at 0.3 Msun.  This version of the functions is
nontrivial to compute, especially for the modified PMFs.&lt;/p&gt;
&lt;p&gt;The mass-weighted versions of these may be more familiar, and they are more
similar to the P(log M) version used in &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2010ApJ...716..167M"&gt;McKee and Offner&lt;/a&gt; and &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2005ASSL..327...41C"&gt;Chabrier 2005&lt;/a&gt;:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/steadystate_pmf_chabrier_integral_mmax3.png" style="width: 400px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/steadystate_pmf_kroupa_integral_mmax3.png" style="width: 400px;" /&gt;
&lt;p&gt;The Chabrier version is a near-perfect match to Figure 3 of &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2010ApJ...716..167M"&gt;McKee and
Offner&lt;/a&gt;, with slightly different normalization (and I'm expressing P(M), not
P(log M); a previous version showed P(log M), but was incorrect).  A notable
feature of this plot is that it cuts off at 3 Msun.  I want to examine the same
distribution at higher masses.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/taperedaccretion_pmf_chabrier_mmax3.png" style="width: 400px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/taperedaccretion_pmf_kroupa_mmax3.png" style="width: 400px;" /&gt;
&lt;p&gt;The above plots are the same as before, but with tapered accretion following
the prescription in &lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2010ApJ...716..167M"&gt;McKee and Offner&lt;/a&gt;.  The tapering function is apparently
arbitrary, and picked purely to enforce smoothness (i.e., prevent a possibly
nonphysical instantaneous shutoff of accretion).&lt;/p&gt;
&lt;div class="section" id="extending-to-higher-masses"&gt;
&lt;h2&gt;Extending to higher masses&lt;/h2&gt;
&lt;p&gt;When we reevaluate the same functions with mmax=120 instead of 3, we can start
to see the high mass end, which is of course power-law dominated.   In all cases,
the PMF is dominated by the highest-mass sources, since in all cases they take
the longest to form.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/steadystate_pmf_chabrier_mmax120.png" style="width: 400px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/steadystate_pmf_kroupa_mmax120.png" style="width: 400px;" /&gt;
&lt;p&gt;The accretion model changes the slope and the overall ratio of high- to
low-mass stars.&lt;/p&gt;
&lt;p&gt;These are the mass fractions of various MFs:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Mass fraction for ChabrierIMF M&amp;gt;10 = 0.192&lt;/li&gt;
&lt;li&gt;Mass fraction for ChabrierPMF_2CTC M&amp;gt;10 = 0.334&lt;/li&gt;
&lt;li&gt;Mass fraction for ChabrierPMF_CA M&amp;gt;10 = 0.150&lt;/li&gt;
&lt;li&gt;Mass fraction for ChabrierPMF_IS M&amp;gt;10 = 0.765&lt;/li&gt;
&lt;li&gt;Mass fraction for ChabrierPMF_TC M&amp;gt;10 = 0.288&lt;/li&gt;
&lt;li&gt;Mass fraction for KroupaIMF M&amp;gt;10 = 0.185&lt;/li&gt;
&lt;li&gt;Mass fraction for KroupaPMF_2CTC M&amp;gt;10 = 0.348&lt;/li&gt;
&lt;li&gt;Mass fraction for KroupaPMF_CA M&amp;gt;10 = 0.148&lt;/li&gt;
&lt;li&gt;Mass fraction for KroupaPMF_IS M&amp;gt;10 = 0.781&lt;/li&gt;
&lt;li&gt;Mass fraction for KroupaPMF_TC M&amp;gt;10 = 0.294&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;The isothermal sphere case is pretty extremely top-heavy, but all except
competitive accretion result in a more top-heavy MF, which is a fairly neat
result - it means that simple binning can distinguish between these theories
(assuming the parametrization is right).  It also means that the SFRs
inferred from integrating the high-mass end of the mass function (as I have
done in &lt;a class="reference external" href="https://github.com/keflavich/SgrB2_ALMA_3mm_Mosaic/"&gt;my Sgr B2 paper&lt;/a&gt;) is subject to a factor of +/-2x uncertainty
depending on the accretion history if we assume steady state.&lt;/p&gt;
&lt;p&gt;The next step is to extend this to different accretion histories (tapered,
accelerating) and then possibly different star formation histories.
I will also create some 'synthetic clusters' using the &lt;a class="reference external" href="https://zenodo.org/record/166732"&gt;Robitaille&lt;/a&gt;
and &lt;a class="reference external" href="https://arxiv.org/abs/1708.08853"&gt;Zhang&lt;/a&gt; models.&lt;/p&gt;
&lt;/div&gt;
</content><category term="misc"></category><category term="imf"></category><category term="pmf"></category></entry><entry><title>A quick performance test on CASA cleaning</title><link href="https://keflavich.github.io/blog/a-quick-performance-test-on-casa-cleaning.html" rel="alternate"></link><published>2017-04-26T11:03:00-06:00</published><updated>2017-04-26T11:03:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2017-04-26:/blog/a-quick-performance-test-on-casa-cleaning.html</id><summary type="html">&lt;p&gt;I ran some speed tests to compare CASA's speed when imaging single channels vs
blocks of channels.  The tests were run with savemodel='none' on a lustre node&lt;/p&gt;
&lt;pre class="literal-block"&gt;
'speedtest_nchan1_concat': 249,
'speedtest_nchan1_individual': 523,
'speedtest_nchan5_concat': 803,
'speedtest_nchan5_individual': 916,
'speedtest_nchan20_concat': 2303,
'speedtest_nchan20 …&lt;/pre&gt;</summary><content type="html">&lt;p&gt;I ran some speed tests to compare CASA's speed when imaging single channels vs
blocks of channels.  The tests were run with savemodel='none' on a lustre node&lt;/p&gt;
&lt;pre class="literal-block"&gt;
'speedtest_nchan1_concat': 249,
'speedtest_nchan1_individual': 523,
'speedtest_nchan5_concat': 803,
'speedtest_nchan5_individual': 916,
'speedtest_nchan20_concat': 2303,
'speedtest_nchan20_individual': 2346,
'speedtest_nchan40_concat': 4010,
'speedtest_nchan40_individual': 4136,
'speedtest_nchan80_concat': 8101,
'speedtest_nchan80_individual': 9298,
&lt;/pre&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/cube_performance.png" style="width: 600px;" /&gt;
&lt;p&gt;The fit is y = 98x + 237&lt;/p&gt;
&lt;p&gt;So at least until swapping happens, there is no serious advantage or
disadvantage to running a different # of channels simultaneously.&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="clean"></category><category term="tclean"></category></entry><entry><title>High-mass Protostellar SiO Masers</title><link href="https://keflavich.github.io/blog/high-mass-protostellar-sio-masers.html" rel="alternate"></link><published>2017-01-30T12:26:00-07:00</published><updated>2017-01-30T12:26:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2017-01-30:/blog/high-mass-protostellar-sio-masers.html</id><summary type="html">&lt;p&gt;In working on a high-mass star formation proposal, I reviewed the discovery
of SiO vibrationally-excited masers toward high-mass star-forming regions.&lt;/p&gt;
&lt;p&gt;Known sources include (with discovery articles listed):&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Sgr B2 M (&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/1986mmmo.conf..275H"&gt;Hasegawa&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Sgr B2 N (&lt;a class="reference external" href="http://esoads.eso.org/abs/2015ApJ...815..106H"&gt;Higuchi&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;W51N (&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/1986mmmo.conf..275H"&gt;Hasegawa&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Orion BN/KL (&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/1974ApJ...189L..31S"&gt;Snyder&lt;/a&gt;, first mm maser)&lt;/li&gt;
&lt;li&gt;G19.61-0.23 (&lt;a class="reference external" href="http://esoads.eso.org/abs/2016ApJ...826..157C"&gt;Cho&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;G75.78 …&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;In working on a high-mass star formation proposal, I reviewed the discovery
of SiO vibrationally-excited masers toward high-mass star-forming regions.&lt;/p&gt;
&lt;p&gt;Known sources include (with discovery articles listed):&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Sgr B2 M (&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/1986mmmo.conf..275H"&gt;Hasegawa&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Sgr B2 N (&lt;a class="reference external" href="http://esoads.eso.org/abs/2015ApJ...815..106H"&gt;Higuchi&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;W51N (&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/1986mmmo.conf..275H"&gt;Hasegawa&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Orion BN/KL (&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/1974ApJ...189L..31S"&gt;Snyder&lt;/a&gt;, first mm maser)&lt;/li&gt;
&lt;li&gt;G19.61-0.23 (&lt;a class="reference external" href="http://esoads.eso.org/abs/2016ApJ...826..157C"&gt;Cho&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;G75.78+0.34 (&lt;a class="reference external" href="http://esoads.eso.org/abs/2016ApJ...826..157C"&gt;Cho&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;G0.38+0.04 &amp;quot;Cloud C&amp;quot; (&lt;a class="reference external" href="http://esoads.eso.org/abs/2015A%26A...584L...7G"&gt;Ginsburg&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;IRAS 19312+1950 (&lt;a class="reference external" href="http://esoads.eso.org/abs/2016ApJ...828...51C"&gt;Cordiner&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;DR 21(OH) (&lt;a class="reference external" href="http://adsabs.harvard.edu/abs/2010ARep...54..295K"&gt;Kalenskii, tentative&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;If you know of any I missed, or have a better collection of these masers, let
me know.&lt;/p&gt;
</content><category term="misc"></category><category term="SiO Masers"></category><category term="HMSF"></category></entry><entry><title>Publications from 2016</title><link href="https://keflavich.github.io/blog/publications-from-2016.html" rel="alternate"></link><published>2017-01-01T22:48:00-07:00</published><updated>2017-01-01T22:48:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2017-01-01:/blog/publications-from-2016.html</id><summary type="html">&lt;p&gt;I haven't updated the 'publications' subdirectory for a long time, mostly
because I forgot it existed.  I'd like to go through these and update them with
highlight figures etc, but there's no guarantee I'll find the time... this is
really the kind of thing that should be done &lt;em&gt;as the …&lt;/em&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;I haven't updated the 'publications' subdirectory for a long time, mostly
because I forgot it existed.  I'd like to go through these and update them with
highlight figures etc, but there's no guarantee I'll find the time... this is
really the kind of thing that should be done &lt;em&gt;as the papers are submitted&lt;/em&gt;.
But that checklist has been getting very long lately.&lt;/p&gt;
&lt;dt class="Key" id="Immer2016a"&gt;Immer2016a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Temperature structures in Galactic center clouds. Direct evidence for gas heating via turbulence&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;K. Immer and J. Kauffmann and T. Pillai and A. Ginsburg and K. M. Menten&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\aap&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;595&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;A94&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Galametz2016a"&gt;Galametz2016a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Water, methanol and dense gas tracers in the local ULIRG Arp 220: results from the new SEPIA Band 5 Science Verification campaign&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;M. Galametz and Z.-Y. Zhang and K. Immer and E. Humphreys and R. Aladro and C. De Breuck and A. Ginsburg and S. C. Madden and P. Møller and V. Arumugam&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\mnras&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;462&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;L36-L40&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Ginsburg2016b"&gt;Ginsburg2016b&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Toward gas exhaustion in the W51 high-mass protoclusters&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;A. Ginsburg and W. M. Goss and C. Goddi and R. Galván-Madrid and J. E. Dale and J. Bally and C. D. Battersby and A. Youngblood and R. Sankrit and R. Smith and J. Darling and J. M. D. Kruijssen and H. B. Liu&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\aap&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;595&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;A27&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Battersby2016a"&gt;Battersby2016a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;A Brief Update on the CMZoom Survey&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;C. Battersby and E. Keto and Q. Zhang and S. Longmore and J. M. D. Kruijssen and T. Pillai and J. Kauffmann and D. Walker and X. Lu and A. Ginsburg and J. Bally and E. C. Mills and J. Henshaw and K. Immer and N. Patel and V. Tolls and A. Walsh and K. Johnston and L. Ho&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Lin2016a"&gt;Lin2016a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Cloud Structure of Galactic OB Cluster-forming Regions from Combining Ground- and Space-based Bolometric Observations&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;Y. Lin and H. B. Liu and D. Li and Z.-Y. Zhang and A. Ginsburg and J. E. Pineda and L. Qian and R. Galván-Madrid and A. F. McLeod and E. Rosolowsky and J. E. Dale and K. Immer and E. Koch and S. Longmore and D. Walker and L. Testi&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\apj&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;828&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;32&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Eisner2016a"&gt;Eisner2016a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Protoplanetary Disks in the Orion OMC1 Region Imaged with ALMA&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;J. A. Eisner and J. M. Bally and A. Ginsburg and P. D. Sheehan&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\apj&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;826&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;16&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="McLeod2016b"&gt;McLeod2016b&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Connecting the dots: a correlation between ionising radiation and cloud mass-loss rate traced by optical integral field spectroscopy&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;A. F. McLeod and M. Gritschneder and J. E. Dale and A. Ginsburg and P. D. Klaassen and J. C. Mottram and T. Preibisch and S. Ramsay and M. Reiter and L. Testi&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;ArXiv e-prints&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Youngblood2016b"&gt;Youngblood2016b&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The Orion Fingers: Near-IR Spectral Imaging of an Explosive Outflow&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;A. Youngblood and A. Ginsburg and J. Bally&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\aj&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;151&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;173&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Svoboda2016a"&gt;Svoboda2016a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The Bolocam Galactic Plane Survey. XIV. Physical Properties of Massive Starless and Star-forming Clumps&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;B. E. Svoboda and Y. L. Shirley and C. Battersby and E. W. Rosolowsky and A. G. Ginsburg and T. P. Ellsworth-Bowers and M. R. Pestalozzi and M. K. Dunham and N. J. Evans, II and J. Bally and J. Glenn&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\apj&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;822&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;59&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Henshaw2016a"&gt;Henshaw2016a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Molecular gas kinematics within the central 250 pc of the Milky Way&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;J. D. Henshaw and S. N. Longmore and J. M. D. Kruijssen and B. Davies and J. Bally and A. Barnes and C. Battersby and M. Burton and M. R. Cunningham and J. E. Dale and A. Ginsburg and K. Immer and P. A. Jones and S. Kendrew and E. A. C. Mills and S. Molinari and T. J. T. Moore and J. Ott and T. Pillai and J. Rathborne and P. Schilke and A. Schmiedeke and L. Testi and D. Walker and A. Walsh and Q. Zhang&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\mnras&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;457&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;2675-2702&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Robitaille2016a"&gt;Robitaille2016a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Python in Astronomy 2016 Unproceedings&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;T. Robitaille and K. Cruz and P. Greenfield and E. Jeschke and M. Juric and S. Mumford and C. Prescod-Weinstein and M. Sosey and E. Tollerud and J. VanderPlas and J. Ford and D. Foreman-Mackey and T. Jenness and T. Aldcroft and M. Alexandersen and M. Bannister and K. Barbary and G. Barentsen and S. Bennett and M. Boquien and J. I. Campos Rozo and S. Christe and L. Corrales and M. Craig and C. Deil and N. Dencheva and A. Donath and S. Douglas and L. Ferreira and A. Ginsburg and N. Goldbaum and K. Gordon and A. Hearin and C. Hummels and D. Huppenkothen and E. Jennings and J. King and S. Lawler and A. Leonard and P. L. Lim and L. McBride and B. Morris and C. Nunez and R. Owen and J. Parejko and E. Patel and A. Price-Whelan and R. Ruggiero and B. Sipocz and A. Stevens and J. Turner and S. Tuttle and P. Yanchulova Merica-Jones and P. Yoachim&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;35&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="McLeod2016a"&gt;McLeod2016a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;A nebular analysis of the central Orion nebula with MUSE&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;A. F. Mc Leod and P. M. Weilbacher and A. Ginsburg and J. E. Dale and S. Ramsay and L. Testi&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\mnras&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;455&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;4057-4086&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Ginsburg2016a"&gt;Ginsburg2016a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Dense gas in the Galactic central molecular zone is warm and heated by turbulence&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;A. Ginsburg and C. Henkel and Y. Ao and D. Riquelme and J. Kauffmann and T. Pillai and E. A. C. Mills and M. A. Requena-Torres and K. Immer and L. Testi and J. Ott and J. Bally and C. Battersby and J. Darling and S. Aalto and T. Stanke and S. Kendrew and J. M. D. Kruijssen and S. Longmore and J. Dale and R. Guesten and K. M. Menten&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\aap&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;586&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;A50&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Ginsburg2016"&gt;Ginsburg2016&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;CAMELOT: the Cloud Archive for MEtadata, Library &amp; Online Toolkit&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;A. Ginsburg and J. M. D. Kruijssen and S. Longmore and E. Koch and S. Glover and J. Dale and B. Commercon and A. Giannetti and A. Mcleod and L. Testi and S. Zahorecz and J. Rathborne and Q. Zhang and F. Fontani and M. Beltran and V. Rivilla&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Goddi2016a"&gt;Goddi2016a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Hot ammonia around young O-type stars. III. High-mass star formation and hot core activity in W51~Main&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;C. Goddi and A. Ginsburg and Q. Zhang&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Longmore2016a"&gt;Longmore2016a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Using young massive star clusters to understand star formation and feedback in high-redshift-like environments&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;S. Longmore and A. Barnes and C. Battersby and J. Bally and J. M. D. Kruijssen and J. Dale and J. Henshaw and D. Walker and J. Rathborne and L. Testi and J. Ott and A. Ginsburg&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2016&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;</content><category term="publications"></category><category term="publications"></category></entry><entry><title>CASA synthetic observations</title><link href="https://keflavich.github.io/blog/casa-synthetic-observations.html" rel="alternate"></link><published>2016-08-15T09:36:00-06:00</published><updated>2016-08-15T09:36:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-08-15:/blog/casa-synthetic-observations.html</id><summary type="html">&lt;p&gt;To evaluate imaging robustness &amp;amp; quality, it is necessary to do some sort of
synthetic observation.  These synthetic observations can be done on real
images, e.g. Herschel data shifted to greater distances, or on simulated data.&lt;/p&gt;
&lt;p&gt;Some examples:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_perseus.py"&gt;https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master …&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;To evaluate imaging robustness &amp;amp; quality, it is necessary to do some sort of
synthetic observation.  These synthetic observations can be done on real
images, e.g. Herschel data shifted to greater distances, or on simulated data.&lt;/p&gt;
&lt;p&gt;Some examples:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_perseus.py"&gt;https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_perseus.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_perseus_2.py"&gt;https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_perseus_2.py&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_aquila.py"&gt;https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/analysis/synth_imaging_aquila.py&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;General process:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Import file into CASA .image form (e.g., &lt;tt class="docutils literal"&gt;importfits&lt;/tt&gt;)&lt;/li&gt;
&lt;li&gt;Load the .ms file and replace visibilities w/fourier transform of image&lt;/li&gt;
&lt;li&gt;Clean.&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;The hard part is setting up the files to be imported.&lt;/p&gt;
&lt;p&gt;For example, you can import a FITS file, which to me seems to be the most
straightforward approach:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
importfits(fitsimage=perseus_rescaled,
           imagename=perseus_casa_image,
           overwrite=True,
           defaultaxes=True,#['RA---TAN','DEC--TAN','FREQUENCY','STOKES'],
           defaultaxesvalues=['2.909234541667E+02deg',
                              '1.451177222222E+01deg',
                              '233.9468GHz','I'],
           # 18&amp;quot; = 1.22 lambda/D
           beam=[&amp;quot;{0}deg&amp;quot;.format(18/3600.*distance_scaling),
                 &amp;quot;{0}deg&amp;quot;.format(18/3600.*distance_scaling),
                 &amp;quot;0deg&amp;quot;],
          )
&lt;/pre&gt;
&lt;p&gt;The beam probably matters for Jy-&amp;gt;K, or Jy/beam-&amp;gt;Jy conversion.  The
&lt;tt class="docutils literal"&gt;defaultaxesvalues&lt;/tt&gt; should correspond to the pointing center of the
interferometer pointing or mosaic.&lt;/p&gt;
&lt;p&gt;Next is bringing this image - which we now pray is in the correct units - into UV space.:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
sm.openfromms(&amp;quot;continuum_7m12m_noflag.ms&amp;quot;)
sm.setvp()
success = sm.predict(perseus_casa_image)
assert success
# TODO: get these from ASDM_CALWVR and WEATHER
success2 = sm.setnoise(mode='tsys-atm', relhum=60.0, pwv='2mm', tatmos=265.0, )
success3 = sm.corrupt()
sm.done()
sm.close()
&lt;/pre&gt;
&lt;p&gt;This snippet loads the .ms file (the visibilities), then overwrites them with
the fourier transform of the image using &lt;tt class="docutils literal"&gt;sm.predict&lt;/tt&gt;.  It's not clear whether
&lt;tt class="docutils literal"&gt;setvp&lt;/tt&gt; is necessary.  &lt;tt class="docutils literal"&gt;setnoise&lt;/tt&gt; + &lt;tt class="docutils literal"&gt;corrupt&lt;/tt&gt; just adds &amp;quot;appropriate&amp;quot;
atmospheric noise to the visibilities.&lt;/p&gt;
&lt;p&gt;From there, you should just use the same &lt;tt class="docutils literal"&gt;clean&lt;/tt&gt; parameters as for the
original data, or try to optimize &lt;tt class="docutils literal"&gt;clean&lt;/tt&gt; here and use these parameters on
the real data.&lt;/p&gt;
&lt;p&gt;The result will be the 'perfect' (no phase error, no amplitude error)
interferometric image.&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="simulation"></category><category term="synthetic observation"></category></entry><entry><title>CASA clean: "splotchy" artifacts</title><link href="https://keflavich.github.io/blog/casa-clean-splotchy-artifacts.html" rel="alternate"></link><published>2016-06-14T09:31:00-06:00</published><updated>2016-06-14T09:31:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-06-14:/blog/casa-clean-splotchy-artifacts.html</id><summary type="html">&lt;p&gt;This image shows artifacts that look &amp;quot;splotchy&amp;quot;.  They are locations clean has
placed a negative model component where none belongs, so the residual is highly
positive and the resulting image is negative.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/splotchy.png" style="width: 600px;" /&gt;
&lt;p&gt;Discussing with others, it appears that this artifact may be unique to
multiscale clean and therefore may be …&lt;/p&gt;</summary><content type="html">&lt;p&gt;This image shows artifacts that look &amp;quot;splotchy&amp;quot;.  They are locations clean has
placed a negative model component where none belongs, so the residual is highly
positive and the resulting image is negative.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/splotchy.png" style="width: 600px;" /&gt;
&lt;p&gt;Discussing with others, it appears that this artifact may be unique to
multiscale clean and therefore may be a result of a too-strong component being
added on a large scale.  It is not yet clear how to suppress these artifacts,
but I'm attempting to change the scales included.  Other ideas would be welcome
in the comments.&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="clean"></category><category term="artifacts"></category></entry><entry><title>Single Dish Combination Continued</title><link href="https://keflavich.github.io/blog/single-dish-combination-continued.html" rel="alternate"></link><published>2016-06-02T16:59:00-06:00</published><updated>2016-06-02T16:59:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-06-02:/blog/single-dish-combination-continued.html</id><summary type="html">&lt;p&gt;Continuing from yesterday, I've done some more analysis of my HC3N data on
different scales.  The first critical note is that there appears to be
disagreement between the 7m and 12m data.
In principle, smoothing the 12m data to the 7m resolution should at most
recover the 7m brightness; instead …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Continuing from yesterday, I've done some more analysis of my HC3N data on
different scales.  The first critical note is that there appears to be
disagreement between the 7m and 12m data.
In principle, smoothing the 12m data to the 7m resolution should at most
recover the 7m brightness; instead it seems that the 12m data significantly
overpredict the 7m brightness.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/sgrb2/array_imagecomparison.png" style="width: 600px;" /&gt;
&lt;p&gt;This discrepancy is also evident in the power spectra, where there appears to be missing flux
on 20-100 arcsecond scales.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/sgrb2/array_pspeccomparison.png" style="width: 600px;" /&gt;
&lt;p&gt;So maybe it's just that the 7m data are bad?&lt;/p&gt;
&lt;p&gt;I discussed the image combination process with Baobab, and he suggested that it
may not be the flux calibration of the images (their absolute scaling) but the
relative weights used to combine them.  The default weights, and pretty much
all variants I had experimented with, use the single-dish beam as the starting
point: you weight the interferometer data by (1-SDbeam) in the fourier domain.&lt;/p&gt;
&lt;p&gt;It turns out that, while this weighting scheme is the obvious thing to do
because the single-dish beam is well-characterized, it may not be the best.
The interferometer data may lose sensitivity on larger scales much faster than
(1-SDbeam) would suggest.&lt;/p&gt;
&lt;p&gt;Carrying the single-dish weight down to smaller angular scales does a better
job of ensuring there are no negatives, but is it really &amp;quot;right&amp;quot;?
Unfortunately, there's no good answer to this; the process is essentially the
same as modifying the Briggs parameter when weighting intereferometric clean
data.  You just have to choose a scale, or a weighting function, and go with
it.  As long as the weights are conservative (i.e., sum to 1), the resulting
image should in some sense be correct.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/sgrb2/combination_weighting_scales.png" style="width: 600px;" /&gt;
&lt;p&gt;In that figure, the weighting scheme for the large angular scale data was set
to a series of different Gaussians.  The resolution of the 7m+TP data is
(theoretically) 24x11 arcseconds, but preserving the large angular scales below
the major beam axis seems to do a better job of preserving the image's
positivity.&lt;/p&gt;
&lt;p&gt;The effect is more pronounced if we just combine the 12m+TP data, ignoring the
7m data (which might be wrong anyway).  For weighting FWHM above 30 arcseconds,
the interferometric data dominates the map.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/sgrb2/combination_weighting_scales_no7m.png" style="width: 600px;" /&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="data"></category></entry><entry><title>Single Dish - Interferometer Combination Experiments</title><link href="https://keflavich.github.io/blog/single-dish-interferometer-combination-experiments.html" rel="alternate"></link><published>2016-06-01T11:17:00-06:00</published><updated>2016-06-01T11:17:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-06-01:/blog/single-dish-interferometer-combination-experiments.html</id><summary type="html">&lt;p&gt;I spent 3 days in Köln with Alvaro Sanchez-Mongé, Peter Schilke, Fanyi Meng,
and Anika Schmiedeke working on Sgr B2 data and specifically on trying to
combine the single dish (total power) data with my merged ACA+12m data from
ALMA program 2013.1.00269.S.&lt;/p&gt;
&lt;p&gt;tl;dr: feathering appears …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I spent 3 days in Köln with Alvaro Sanchez-Mongé, Peter Schilke, Fanyi Meng,
and Anika Schmiedeke working on Sgr B2 data and specifically on trying to
combine the single dish (total power) data with my merged ACA+12m data from
ALMA program 2013.1.00269.S.&lt;/p&gt;
&lt;p&gt;tl;dr: feathering appears to work fine, and many other methods work equally
well (assuming they can be implemented, which is uniformly harder).  Negative
bowls persisting after feathering are an indication of a problem with the input
data.&lt;/p&gt;
&lt;div class="section" id="feathering"&gt;
&lt;h2&gt;Feathering&lt;/h2&gt;
&lt;p&gt;Fourier space combination of the single-dish and interferometric data is by
far the most straightforward to implement and the fastest.  However, in the HC3N
data, it left strong negative bowls, which should not be possible.&lt;/p&gt;
&lt;p&gt;On the Einstein image, the image quality from feathering was not great, but
there were no negative bowls left.  The dynamic range is lower in the Einstein
data, but this still hints that there is a problem with the HC3N images.  We're
investigating the possibility that the 7m data are improperly calibrated or
weighted.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="miriad"&gt;
&lt;h2&gt;Miriad&lt;/h2&gt;
&lt;p&gt;We never managed to create UV data from the single dish data because of complaints about
the pointing information.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="cleaning-with-a-single-dish-image-as-an-input-model"&gt;
&lt;h2&gt;Cleaning with a single dish image as an input model&lt;/h2&gt;
&lt;p&gt;We attempted to clean the data using the single dish image as an input model.&lt;/p&gt;
&lt;p&gt;On the real data, this failed with both tclean and clean.  With &lt;tt class="docutils literal"&gt;tclean&lt;/tt&gt;, there
was no error message, it just hung indefinitely.
With &lt;tt class="docutils literal"&gt;clean&lt;/tt&gt;, the error message is:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
*** Error ***  LatticeExprNode - coordinates of operands mismatch
Scanned so far: modelos_0 + __temp_model2

2016-06-01 10:35:05     SEVERE  clean::::       An error occurred running task clean.
&lt;/pre&gt;
&lt;p&gt;Changing CDELT to 1 GHz, which solved a previous issue, had no effect here.&lt;/p&gt;
&lt;p&gt;It turns out &lt;tt class="docutils literal"&gt;tclean&lt;/tt&gt; will fail silently if it doesn't find the
&lt;tt class="docutils literal"&gt;startmodel&lt;/tt&gt;, which has to be specified as an image &lt;em&gt;prefix&lt;/em&gt; for version
&amp;lt;=4.6, and the image has to exist as a &lt;tt class="docutils literal"&gt;.model&lt;/tt&gt; file.  For higher versions, 4.6+,
the model can be directly referenced (as in clean).  Eventually, tclean seems to have
completed, though the results indicate that it does not treat the units as I expected;
the total power data seems to be over-weighted by a factor of 10^3+, probably by the ratio
of the beam areas:&lt;/p&gt;
&lt;img alt="" src="http://i.imgur.com/8dW7t8I.png" style="width: 600px;" /&gt;
&lt;p&gt;For the simulated images (einstein), we get the error:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2016-06-01 10:55:11 SEVERE  SynthesisImager::defineImage (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/ImagerObjects/SynthesisImager.cc, line 668)    Error in adding Mapper : Error in createImStore : ::operator!= (const IPosition&amp;amp;, const IPosition&amp;amp;) - left and right operand do not conform
2016-06-01 10:55:11 SEVERE  tclean::task_tclean::   Exception from task_tclean : 2016-06-01 10:55:11        SEVERE  SynthesisImager::defineImage (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/ImagerObjects/SynthesisImager.cc, line 668)    Error in adding Mapper : Error in createImStore : ::operator!= (const IPosition&amp;amp;, const IPosition&amp;amp;) - left and right operand do not conform
&lt;/pre&gt;
&lt;p&gt;This is probably an issue with regridding.  &lt;tt class="docutils literal"&gt;imregrid&lt;/tt&gt; doesn't like our data:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2016-06-01 11:00:41 SEVERE  imregrid::image::regrid Exception Reported: Exception: The number of pixel axes in the output shape and Coordinate System must be the same. Shape has size 4. Output coordinate system has 3 axes.
2016-06-01 11:00:41 SEVERE  imregrid::image::regrid+        ... thrown by SPIIF casa::ImageRegridder::_regrid() const at File: /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/imageanalysis/ImageAnalysis/ImageRegridder.cc, line: 138
&lt;/pre&gt;
&lt;p&gt;Adding a frequency axis to the FITS data (which was missing before...) seems to
have fixed this error for the Einstein data, but not for the real HC3N data.&lt;/p&gt;
&lt;!-- (this is now incorporated in an above paragraph) --&gt;
&lt;!-- tclean appears to use the wrong units for the input model, treating that model --&gt;
&lt;!-- very differently than ``clean`` does.  This error may be limited to CASA &lt;= --&gt;
&lt;!-- 4.5, since the tclean documentation regarding models changed substantially from --&gt;
&lt;!-- 4.5 to 4.6. --&gt;
&lt;/div&gt;
&lt;div class="section" id="linear-combination-in-image-space"&gt;
&lt;h2&gt;Linear Combination in Image Space&lt;/h2&gt;
&lt;p&gt;Linear combination of the single dish and interferometer data in image space,
followed by image-space deconvolution, has been used successfully on HI data.
In principle, this is very straightforward, except for the need for
deconvolution.  CASA now has an image-space deconvolution program
(&lt;tt class="docutils literal"&gt;deconvolve&lt;/tt&gt;), so I was able to implement this approach.  However, the
deconvolver seems to only work on the inner 1/4 of the image in each dimension,
which left incomplete images that were difficult to compare.  Additionally,
CASA does not (obviously) carry the appropriate machinery for computing the
residual image and adding the convolved model back to the residual image.
Still, this is a promising route forward as it is computationally relatively
cheap and mostly easy to implement.&lt;/p&gt;
&lt;p&gt;Linear combination is partly implemented now using the CASA &lt;tt class="docutils literal"&gt;deconvolve&lt;/tt&gt; task;
it hasn't been generalized but you can see the outline / single working case at
&lt;a class="reference external" href="https://github.com/radio-astro-tools/uvcombine/blob/master/uvcombine/realspace_combine.py"&gt;this link&lt;/a&gt;.&lt;/p&gt;
&lt;!-- this is how you include images --&gt;
&lt;!-- .. image:: |static|/images/psfFfftF.png --&gt;
&lt;!-- :width: 600px --&gt;
&lt;/div&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="uv combination"></category></entry><entry><title>What does feather do?</title><link href="https://keflavich.github.io/blog/what-does-feather-do.html" rel="alternate"></link><published>2016-05-26T08:29:00-06:00</published><updated>2016-05-26T08:29:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-05-26:/blog/what-does-feather-do.html</id><summary type="html">&lt;p&gt;This is an examination of the 'feather' task in CASA.&lt;/p&gt;
&lt;p&gt;First we have to track down what code is actually called.&lt;/p&gt;
&lt;p&gt;On mac, this is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;/Applications/CASA.app/Contents/Resources/python/feather_cli.py -&amp;gt; feather_cli&lt;/li&gt;
&lt;li&gt;/Applications/CASA.app/Contents/Resources/python/task_feather.py -&amp;gt; feather&lt;/li&gt;
&lt;li&gt;/Applications/CASA.app/Contents …&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;This is an examination of the 'feather' task in CASA.&lt;/p&gt;
&lt;p&gt;First we have to track down what code is actually called.&lt;/p&gt;
&lt;p&gt;On mac, this is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;/Applications/CASA.app/Contents/Resources/python/feather_cli.py -&amp;gt; feather_cli&lt;/li&gt;
&lt;li&gt;/Applications/CASA.app/Contents/Resources/python/task_feather.py -&amp;gt; feather&lt;/li&gt;
&lt;li&gt;/Applications/CASA.app/Contents/Resources/python/taskinit.py -&amp;gt; imtool-&amp;gt;imager-&amp;gt;casac.imager-&amp;gt;/Applications/CASA.app/Contents/Resources/python/feather_cli.py&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Imager.cc#L2257"&gt;Imager.cc&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;Within the imager, &lt;cite&gt;setvp&lt;/cite&gt; is used to do something with the primary beam.  As
far as I can tell, this function spews a lot of text into the logger, sets
local variables, sets one larger-scope variable &lt;cite&gt;BeamSquint::&lt;/cite&gt;, then does
&lt;cite&gt;destroySkyEquation();&lt;/cite&gt;.  In short, I don't know what this does.  Probably my
reading of the C code is incorrect and these variables are &lt;em&gt;not&lt;/em&gt; local, in
which case it is just setting a bunch of default beam parameters.&lt;/p&gt;
&lt;p&gt;Then, &lt;cite&gt;Imager.cc&lt;/cite&gt; calls &lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L1211"&gt;Feather.cc&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Feather sets parameters based on the effective dish diameter.  It uses
&lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L244"&gt;1.22*(speed of light)/frequency/dish_diameter&lt;/a&gt;,
so it is retrieving the FWHM
assuming a Gaussian beam by default.&lt;/p&gt;
&lt;p&gt;A lovely aside: &lt;cite&gt;Imager.cc&lt;/cite&gt; passes the local variable &lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Imager.cc#L2320"&gt;lowPassFilterSD&lt;/a&gt;
to &lt;cite&gt;Feather.cc&lt;/cite&gt;, which is read in to the input boolean parameter
&lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L244"&gt;doHiPassFilterOnSD&lt;/a&gt;.
That seems like a potential place for confusion.&lt;/p&gt;
&lt;p&gt;If &lt;cite&gt;doHiPassFilterOnSD&lt;/cite&gt; is set &lt;em&gt;or&lt;/em&gt; the effective beam diameter is set as a
parameter, the single dish image is deconvolved with its beam using the
GaussianDeconvolver.  This is actually disabled by default, though.&lt;/p&gt;
&lt;p&gt;The low resolution image is &lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L142"&gt;regridded&lt;/a&gt;
to match the high resolution image.&lt;/p&gt;
&lt;p&gt;The &lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L375"&gt;applyFeather&lt;/a&gt;
command seems to do the actual work.
It starts with &lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L414"&gt;calcCWeightImage&lt;/a&gt;,
which sets the &amp;quot;weight&amp;quot; to one minus the peak-normalized fourier transform of
the low-resolution (single-dish) beam
&lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L427"&gt;Feather.cc line 427&lt;/a&gt;,
with the result stored in the variable &lt;cite&gt;cwImage_p&lt;/cite&gt;.
&lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L408"&gt;applyFeather&lt;/a&gt; then just
multiplies the high-resolution image by this weight.&lt;/p&gt;
&lt;p&gt;Back in the &lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L695"&gt;saveFeatheredImage&lt;/a&gt;
task, the single-dish data are fourier transformed, then a scaling factor, the ratio
between the low and high beam areas, is computed.  Finally, the single-dish
(scaled) and interferometer &lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L694"&gt;fourier-transformed&lt;/a&gt; images are &lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L703"&gt;added&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Is the single-dish image weighted by the beam at all?  The single-dish image will
be convolved with a kernel only if &lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L1235"&gt;doHighPassFilterOnSD&lt;/a&gt; is set
or if the effective dish diameter is set.  If the beam is the same size as the original
beam, nothing will happen.
In &lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/synthesis/MeasurementEquations/Feather.cc#L256"&gt;setEffectiveDishDiam&lt;/a&gt;
the low-resolution image is convolved with the &lt;a class="reference external" href="https://github.com/radio-astro/casa/blob/160955adf4de4ee561cfc691904317953e08d7d6/code/components/ComponentModels/GaussianDeconvolver.cc#L34"&gt;*deconvolved*&lt;/a&gt;
beam.&lt;/p&gt;
&lt;p&gt;The most important note in this post is that the single-dish image is &lt;em&gt;not&lt;/em&gt;
weighted unless &lt;cite&gt;doHighPassFilterOnSD&lt;/cite&gt; is set, and even then nothing will be
done if the single-dish beam size passed as a parameter is the same as the beam
size specified in the header.  That means only the interferometer image is
weighted.  Maybe that is the correct behavior?  By weighting by (1-convolved
beam), which means setting the total flux in the interferometer image to zero,
the process is guaranteed to be flux conserving.&lt;/p&gt;
&lt;!-- this is how you include images --&gt;
&lt;!-- .. image:: |static|/images/psfFfftF.png --&gt;
&lt;!-- :width: 600px --&gt;
</content><category term="misc"></category><category term="casa"></category></entry><entry><title>CASA coordinate defaults</title><link href="https://keflavich.github.io/blog/casa-coordinate-defaults.html" rel="alternate"></link><published>2016-05-19T09:31:00-06:00</published><updated>2016-05-19T09:31:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-05-19:/blog/casa-coordinate-defaults.html</id><summary type="html">&lt;p&gt;A brief public service announcement: CASA coordinate strings follow a
convention of their own making that I at least find thoroughly
counterintuitive.  If you specify a sexagesimal coordinate, e.g. 05:12:15.3
-5:10:20.5 or something similar, CASA interprets that as 5 hours, -5 hours.
The …&lt;/p&gt;</summary><content type="html">&lt;p&gt;A brief public service announcement: CASA coordinate strings follow a
convention of their own making that I at least find thoroughly
counterintuitive.  If you specify a sexagesimal coordinate, e.g. 05:12:15.3
-5:10:20.5 or something similar, CASA interprets that as 5 hours, -5 hours.
The declination is interpreted as being in hours.  Those are units no one has
ever used.  The CASA version requires the second half of the sexagesimal string
to be decimal separated:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2016-05-19 00:45:13     WARN    SynthesisParams::stringToMDirection (file /var/rpmbuild/BUILD/casa-prerelease/casa-prerelease-4.6.0/code/synthesis/ImagerObjects/SynthesisUtilMethods.cc, line 786)     You provided the Declination/Latitude value &amp;quot;-28:23:29.22&amp;quot; which is understood to be in units of hours.
2016-05-19 00:45:13     WARN    SynthesisParams::stringToMDirection (file /var/rpmbuild/BUILD/casa-prerelease/casa-prerelease-4.6.0/code/synthesis/ImagerObjects/SynthesisUtilMethods.cc, line 786)+    If you meant degrees, please replace &amp;quot;:&amp;quot; by &amp;quot;.&amp;quot;.
&lt;/pre&gt;
&lt;p&gt;This has broken my scripts more than a handful of times now, since copying &amp;amp;
pasting coordinates from any other program inevitably has the &amp;quot;wrong&amp;quot;
units.&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category></entry><entry><title>CASA tclean adds negative components</title><link href="https://keflavich.github.io/blog/casa-tclean-adds-negative-components.html" rel="alternate"></link><published>2016-05-01T10:21:00-06:00</published><updated>2016-05-01T10:21:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-05-01:/blog/casa-tclean-adds-negative-components.html</id><summary type="html">&lt;p&gt;I'm trying to examine some of my 7m+12m combined data and have run into yet another
mysterious behavior of CASA.  &lt;tt class="docutils literal"&gt;tclean&lt;/tt&gt; is adding negative components in regions with
exclusively positive emission.&lt;/p&gt;
&lt;p&gt;In this image, the &lt;em&gt;left&lt;/em&gt; is the clean image, which doesn't make any sense; it
looks like it …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I'm trying to examine some of my 7m+12m combined data and have run into yet another
mysterious behavior of CASA.  &lt;tt class="docutils literal"&gt;tclean&lt;/tt&gt; is adding negative components in regions with
exclusively positive emission.&lt;/p&gt;
&lt;p&gt;In this image, the &lt;em&gt;left&lt;/em&gt; is the clean image, which doesn't make any sense; it
looks like it should be a residual image but it is not.  2nd image is the clean
components (negative!!), 3rd is the residual, 4th is the dirty map.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/bad_cleancomps.png" style="width: 600px;" /&gt;
&lt;p&gt;One tricky thing for this particular image is that the emission is real, BUT it
is also directly on top of a major sidelobe of the brightest source in the
region.  Nonetheless, I cannot imagine any way to explain the negative
component.  I don't really understand when a negative component is added, but
presumably it ought to happen when the residual has a negative value but also
the highest amplitude in the map; this obviously never happens here since the
residual in fact has one of the highest &lt;em&gt;positive&lt;/em&gt; amplitudes in the map.&lt;/p&gt;
&lt;p&gt;The imaging parameters seem not to affect this problem. I attempted reducing the
gain to 0.05 to no avail.  Changing from natural to robust weighting actually
removed most of the negative components.&lt;/p&gt;
&lt;div class="section" id="failed-combination-of-7m-and-12m-data"&gt;
&lt;h2&gt;Failed combination of 7m and 12m data&lt;/h2&gt;
&lt;p&gt;The above was a tangent.  The real reason I was working on this data set was to
combine the 7m and 12m spectral data.  The problem I keep seeing is very large,
smooth blobs that are spatially distinct from the more compact emission.  It's
as if someone took the two independent cubes (12m and 7m) and just added them
together; it looks like flux is not being conserved.&lt;/p&gt;
&lt;p&gt;The UV plots, especially weight vs uvdist, look fine.  The 7m antenna are
downweighted relative to the 7m antennae by a factor ~2.&lt;/p&gt;
&lt;p&gt;One of the bigger problems is that I have a vague - possibly not justified -
sense that there is a velocity offset of ~1 km/s between the 7m and 12m data.
If this is the case, there's no wonder the combination isn't working.
However, it's nearly inconceivable.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="followup-feb-2017"&gt;
&lt;h2&gt;Followup Feb 2017&lt;/h2&gt;
&lt;p&gt;That vague fear turned out to be entirely justified.  It turned out that the 7m
and 12m array data sets were not in a common frame, and they were therefore
offset by something like the Earth's change in velocity between the observation
dates.  The solution was to cvel the data sets to the LSRK frame prior to
concatenating them.  While I know I made these changes, I unfortunately can't
find the specific commit where I made them.&lt;/p&gt;
&lt;/div&gt;
</content><category term="misc"></category><category term="casa"></category><category term="tclean"></category></entry><entry><title>CASA simulated imaging: now FTMachine is whining</title><link href="https://keflavich.github.io/blog/casa-simulated-imaging-now-ftmachine-is-whining.html" rel="alternate"></link><published>2016-04-26T15:12:00-06:00</published><updated>2016-04-26T15:12:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-04-26:/blog/casa-simulated-imaging-now-ftmachine-is-whining.html</id><summary type="html">&lt;p&gt;&lt;a class="reference external" href="https://keflavich.github.io/blog/casa_simulation_debugging.rst"&gt;A few days ago&lt;/a&gt;
I apparently got my broken simulator working again.  Today, in my first
attempt to repeat those results, I... have broken it again.:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
WARN        FTMachine::initMaps     No overlap in frequency between image channels and selected data found for this FTMachine
WARN        FTMachine::initMaps+     Check your data selection …&lt;/pre&gt;</summary><content type="html">&lt;p&gt;&lt;a class="reference external" href="https://keflavich.github.io/blog/casa_simulation_debugging.rst"&gt;A few days ago&lt;/a&gt;
I apparently got my broken simulator working again.  Today, in my first
attempt to repeat those results, I... have broken it again.:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
WARN        FTMachine::initMaps     No overlap in frequency between image channels and selected data found for this FTMachine
WARN        FTMachine::initMaps+     Check your data selection and image parameters if you end up with a blank image
&lt;/pre&gt;
&lt;p&gt;This warning is not a simple warning, it means nothing is being done.  My
images are empty, pure noise (which, interestingly enough, is far from
gaussian).&lt;/p&gt;
&lt;p&gt;I have encountered these errors &lt;cite&gt;before
&amp;lt;|static|/separating_line_and_continuum.rst&amp;gt;&lt;/cite&gt;, but unfortunately did not
resolve the issue.&lt;/p&gt;
&lt;p&gt;Turns out, the difference was the .ms file I used,
&lt;tt class="docutils literal"&gt;continuum_7m12m_noflag.ms&lt;/tt&gt;, which works, vs the useful one,
&lt;tt class="docutils literal"&gt;w51_contvis_selfcal_3.ms&lt;/tt&gt;, which doesn't.&lt;/p&gt;
&lt;p&gt;Checking out their headers, the continuum image does overlap with the
data but the selfcal version doesn't.  Wonderful.  Now I'll bet it's only
populating one channel at a time when I invert too...&lt;/p&gt;
&lt;p&gt;This leads me to try:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
split(vis='w51_contvis_selfcal_3.ms', outputvis='simulation_continuum.ms', datacolumn='data', width=100)
&lt;/pre&gt;
&lt;p&gt;then use (borrowed from &lt;a class="reference external" href="https://github.com/radio-astro-tools/sandbox/blob/master/casa_7m12m_tools/weight_density_uv_plot.py"&gt;this tool&lt;/a&gt;):&lt;/p&gt;
&lt;pre class="literal-block"&gt;
mymsmd = msmdtool()
mymsmd.open(vis)

reffreq = &amp;quot;{value}{unit}&amp;quot;.format(**mymsmd.reffreq(spw)['m0'])
&lt;/pre&gt;
&lt;p&gt;to get the frequency to write into the header each time.&lt;/p&gt;
&lt;p&gt;At a glance, just changing the frequency of the FITS file to match the first
SPW seems to work.  However, I haven't yet examined whether the other SPWs
are populated.&lt;/p&gt;
&lt;p&gt;This assumption proved wrong.  No, it simply doesn't work.  The warnings went away,
but the output images are empty.  Also, the noise went up, which I don't understand.&lt;/p&gt;
&lt;p&gt;Imaging just spw1 kind of worked, but resulted in an image with the wrong
resolution by factors of many.&lt;/p&gt;
&lt;p&gt;Trying to loop over all spws failed miserably, resulting in &lt;em&gt;nothing&lt;/em&gt; being done by
predict and &lt;em&gt;no warning&lt;/em&gt; being given.&lt;/p&gt;
&lt;p&gt;OK, finally, solution is to make sure CDELT is large enough to cover &lt;em&gt;all&lt;/em&gt; SPWs.&lt;/p&gt;
&lt;p&gt;Another important note: Jy/beam and Jy/pixel inputs into CASA result in identical images.
In both cases, they are wrong images: they correspond to multiplying the input data by
factors of at least 100.  Therefore, my conclusion now is that I have to divide everything
by some fact, which I &lt;em&gt;sincerely&lt;/em&gt; hope is ppbeam, to correct the data.&lt;/p&gt;
&lt;p&gt;It looked vaguely like the divide-by-ppbeam trick worked, but my tests kept coming up funny
because the &lt;em&gt;original&lt;/em&gt; images were scaled down.  So I tried unscaling them.  Somehow,
without changing anything about the headers, I landed on another failed predict error:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2016-04-27 19:14:42 SEVERE  Simulator::createSkyEquation() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc, line 2200)        Caught exception: (/Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc : 2266) Failed AlwaysAssert spectralIndex&amp;gt;=0
2016-04-27 19:14:42 SEVERE  Simulator::predict() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc, line 2118)  Failed to create SkyEquation
&lt;/pre&gt;
&lt;p&gt;Spectral Index?  I encountered this &lt;a class="reference external" href="|static|/casa_simulating.rst"&gt;previously&lt;/a&gt;, but didn't record any solution.
After checking the header, it appears that my files are &lt;em&gt;now&lt;/em&gt; missing axes 3 and 4.
I didn't make any changes that should cause this; the axes are just not being added
on importfits despite being forcibly added in the command.&lt;/p&gt;
&lt;p&gt;The problem is unfortunately not in the FITS part, but again in the CASA part.
Re-importing the FITS file to .image without forcing &lt;tt class="docutils literal"&gt;defaultaxes&lt;/tt&gt; again just
broke it.&lt;/p&gt;
</content><category term="misc"></category><category term="casa"></category><category term="clean"></category><category term="simulation"></category></entry><entry><title>More CASA simulation &amp; debugging</title><link href="https://keflavich.github.io/blog/more-casa-simulation-debugging.html" rel="alternate"></link><published>2016-04-24T22:57:00-06:00</published><updated>2016-04-24T22:57:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-04-24:/blog/more-casa-simulation-debugging.html</id><summary type="html">&lt;p&gt;(this post written from snowy-ish ALMA; &lt;a class="reference external" href="https://goo.gl/photos/z3fUkCT6VVRzt8EW6"&gt;just cloudy at the OSF though&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;(tl; dr version: &lt;tt class="docutils literal"&gt;sm.setvp&lt;/tt&gt; doesn't work if you have &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;TELESCOP=&amp;quot;ALMA&amp;quot;&lt;/span&gt;&lt;/tt&gt; in
your header)&lt;/p&gt;
&lt;p&gt;I'm trying to repeat an experiment very similar to
&lt;a class="reference external" href="|static|/casa_simulating.rst"&gt;previous&lt;/a&gt;
&lt;a class="reference external" href="|static|/simulated_imaging.rst"&gt;simulation work&lt;/a&gt;
in order to quantify my completeness and largest angular scales
by …&lt;/p&gt;</summary><content type="html">&lt;p&gt;(this post written from snowy-ish ALMA; &lt;a class="reference external" href="https://goo.gl/photos/z3fUkCT6VVRzt8EW6"&gt;just cloudy at the OSF though&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;(tl; dr version: &lt;tt class="docutils literal"&gt;sm.setvp&lt;/tt&gt; doesn't work if you have &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;TELESCOP=&amp;quot;ALMA&amp;quot;&lt;/span&gt;&lt;/tt&gt; in
your header)&lt;/p&gt;
&lt;p&gt;I'm trying to repeat an experiment very similar to
&lt;a class="reference external" href="|static|/casa_simulating.rst"&gt;previous&lt;/a&gt;
&lt;a class="reference external" href="|static|/simulated_imaging.rst"&gt;simulation work&lt;/a&gt;
in order to quantify my completeness and largest angular scales
by injecting synthetic signal into the real UV data.&lt;/p&gt;
&lt;p&gt;However, as you might expect, it doesn't work as it did last time, even
when I (afaict) copy and paste the code directly.&lt;/p&gt;
&lt;p&gt;Here's the new error:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2016-04-25 02:57:21 SEVERE  Simulator::createSkyEquation() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc, line 2200)        Caught exception: Transformations to/from frame &amp;quot;Undefined&amp;quot; are not possible.
2016-04-25 02:57:21 SEVERE  Simulator::predict() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc, line 2118)  Failed to create SkyEquation
Result of predict: False
&lt;/pre&gt;
&lt;p&gt;It's strange because there is nothing obviously undefined.&lt;/p&gt;
&lt;p&gt;I'm comparing 2 FITS files that should behave identically.
The good header lacks these keywords that the bad header has:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
['PV2_1',
 'PV2_2',
 'OBSERVER',
 'DATE-OBS',
 'OBSRA',
 'OBSDEC',
 'OBSGEO-X',
 'OBSGEO-Y',
 'OBSGEO-Z']
&lt;/pre&gt;
&lt;p&gt;while the good header has these and the bad lacks them:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
['PC03_01',
 'PC04_01',
 'PC03_02',
 'PC04_02',
 'PC01_03',
 'PC02_03',
 'PC03_03',
 'PC04_03',
 'PC01_04',
 'PC02_04',
 'PC03_04',
 'PC04_04',
 'CREATOR',
 'INSTRUME',
 'BAND',
 'PROPOSAL',
 'PRTITLE',
 'OBSID001',
 'OBSID002',
 'HISTORY']
&lt;/pre&gt;
&lt;p&gt;The only significant difference is the &lt;tt class="docutils literal"&gt;PC&lt;/tt&gt; values, unless CASA
is doing something with the observatory location information.&lt;/p&gt;
&lt;p&gt;The only difference in common keywords is numerical, which seems
very unlikely to cause this issue.&lt;/p&gt;
&lt;p&gt;I cannot discern any useful difference between these two CASA .image headers:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2016-04-25 03:08:55 INFO imhead     ##########################################
2016-04-25 03:08:55 INFO imhead     ##### Begin Task: imhead             #####
2016-04-25 03:08:55 INFO imhead     imhead(imagename=&amp;quot;../perseus_synth/perseus_250_to_w51.image&amp;quot;,mode=&amp;quot;summary&amp;quot;,hdkey=&amp;quot;&amp;quot;,hdvalue=&amp;quot;&amp;quot;,verbose=True)
2016-04-25 03:08:55 INFO ImageAnalysis
2016-04-25 03:08:55 INFO ImageAnalysis      Image name       : perseus_250_to_w51.image
2016-04-25 03:08:55 INFO ImageAnalysis      Object name      : perseus 04
2016-04-25 03:08:55 INFO ImageAnalysis      Image type       : PagedImage
2016-04-25 03:08:55 INFO ImageAnalysis      Image quantity   : Intensity
2016-04-25 03:08:55 INFO ImageAnalysis      Pixel mask(s)    : mask0
2016-04-25 03:08:55 INFO ImageAnalysis      Region(s)        : None
2016-04-25 03:08:55 INFO ImageAnalysis      Image units      : Jy/pixel
2016-04-25 03:08:55 INFO ImageAnalysis      Restoring Beam   : 0.465804 arcsec, 0.465804 arcsec, 0 deg
2016-04-25 03:08:55 INFO ImageAnalysis
2016-04-25 03:08:55 INFO ImageAnalysis      Direction reference : J2000
2016-04-25 03:08:55 INFO ImageAnalysis      Spectral  reference : Undefined
2016-04-25 03:08:55 INFO ImageAnalysis      Velocity  type      : RADIO
2016-04-25 03:08:55 INFO ImageAnalysis      Rest frequency      : 2.33947e+11 Hz
2016-04-25 03:08:55 INFO ImageAnalysis      Telescope           : Herschel
2016-04-25 03:08:55 INFO ImageAnalysis      Observer            : UNKNOWN
2016-04-25 03:08:55 INFO ImageAnalysis      Date observation    : UNKNOWN
2016-04-25 03:08:55 INFO ImageAnalysis
2016-04-25 03:08:55 INFO ImageAnalysis      Axis Coord Type      Name             Proj Shape Tile   Coord value at pixel    Coord incr Units
2016-04-25 03:08:55 INFO ImageAnalysis      ------------------------------------------------------------------------------------------------
2016-04-25 03:08:55 INFO ImageAnalysis      0    0     Direction Right Ascension   TAN  2370  158  19:23:41.765  1099.00 -1.552680e-01 arcsec
2016-04-25 03:08:55 INFO ImageAnalysis      1    0     Direction Declination       TAN  2500  250 +14.30.45.850  1552.00  1.552680e-01 arcsec
2016-04-25 03:08:55 INFO ImageAnalysis      2    2     Spectral  Frequency                 1    1   2.33947e+11     0.00  1.000000e+09 Hz
2016-04-25 03:08:55 INFO ImageAnalysis                           Velocity                                     0     0.00 -1.281456e+03 km/s
2016-04-25 03:08:55 INFO ImageAnalysis      3    1     Stokes    Stokes                    1    1             I
2016-04-25 03:08:55 INFO imhead     ##### End Task: imhead               #####
2016-04-25 03:08:55 INFO imhead     ##########################################
2016-04-25 03:09:07 INFO imhead
2016-04-25 03:09:07 INFO imhead     ##########################################
2016-04-25 03:09:07 INFO imhead     ##### Begin Task: imhead             #####
2016-04-25 03:09:07 INFO imhead     imhead(imagename=&amp;quot;../simulations/simimage_firsttest.image&amp;quot;,mode=&amp;quot;summary&amp;quot;,hdkey=&amp;quot;&amp;quot;,hdvalue=&amp;quot;&amp;quot;,verbose=False)
2016-04-25 03:09:07 INFO ImageAnalysis
2016-04-25 03:09:07 INFO ImageAnalysis      Image name       : simimage_firsttest.image
2016-04-25 03:09:07 INFO ImageAnalysis      Object name      :
2016-04-25 03:09:07 INFO ImageAnalysis      Image type       : PagedImage
2016-04-25 03:09:07 INFO ImageAnalysis      Image quantity   : Intensity
2016-04-25 03:09:07 INFO ImageAnalysis      Pixel mask(s)    : None
2016-04-25 03:09:07 INFO ImageAnalysis      Region(s)        : None
2016-04-25 03:09:07 INFO ImageAnalysis      Image units      : Jy/beam
2016-04-25 03:09:07 INFO ImageAnalysis      Restoring Beam   : 0.21023 arcsec, 0.192666 arcsec, 79.8538 deg
2016-04-25 03:09:07 INFO ImageAnalysis
2016-04-25 03:09:07 INFO ImageAnalysis      Direction reference : J2000
2016-04-25 03:09:07 INFO ImageAnalysis      Spectral  reference : Undefined
2016-04-25 03:09:07 INFO ImageAnalysis      Velocity  type      : RADIO
2016-04-25 03:09:07 INFO ImageAnalysis      Rest frequency      : 2.33947e+11 Hz
2016-04-25 03:09:07 INFO ImageAnalysis      Pointing center     :  19:23:41.629000  +14.30.42.380000
2016-04-25 03:09:07 INFO ImageAnalysis      Telescope           : ALMA
2016-04-25 03:09:07 INFO ImageAnalysis      Observer            : keflavich
2016-04-25 03:09:07 INFO ImageAnalysis      Date observation    : 2015/04/23/09:47:44
2016-04-25 03:09:07 INFO ImageAnalysis      Telescope position: [2.22514e+06m, -5.44031e+06m, -2.48103e+06m] (ITRF)
2016-04-25 03:09:07 INFO ImageAnalysis
2016-04-25 03:09:07 INFO ImageAnalysis      Axis Coord Type      Name             Proj Shape Tile   Coord value at pixel    Coord incr Units
2016-04-25 03:09:07 INFO ImageAnalysis      ------------------------------------------------------------------------------------------------
2016-04-25 03:09:07 INFO ImageAnalysis      0    0     Direction Right Ascension   TAN  3072  192  19:23:41.629  1536.00 -5.000000e-02 arcsec
2016-04-25 03:09:07 INFO ImageAnalysis      1    0     Direction Declination       TAN  3072  192 +14.30.42.380  1536.00  5.000000e-02 arcsec
2016-04-25 03:09:07 INFO ImageAnalysis      2    1     Stokes    Stokes                    1    1             I
2016-04-25 03:09:07 INFO ImageAnalysis      3    2     Spectral  Frequency                 1    1   2.33947e+11     0.00  1.000000e+09 Hz
2016-04-25 03:09:07 INFO ImageAnalysis                           Velocity                                     0     0.00 -1.281456e+03 km/s
2016-04-25 03:09:07 INFO imhead     ##### End Task: imhead               #####
2016-04-25 03:09:07 INFO imhead     ##########################################
&lt;/pre&gt;
&lt;p&gt;if anything, the ALMA file includes &lt;em&gt;extra&lt;/em&gt; data. Removing this data has no
effect.&lt;/p&gt;
&lt;p&gt;The only really substantial difference left is the order of the axes, which
is &lt;em&gt;not what I put in&lt;/em&gt; for the ALMA data: it puts Stokes as 2 instead of 3
despite the fact that &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;CTYPE4='STOKES'&lt;/span&gt;&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;CTYPE3='FREQ'&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;By doing a round trip FITS-&amp;gt;image-&amp;gt;FITS-&amp;gt;image, I was able to fix the order,
but that is not the underlying problem, apparently.&lt;/p&gt;
&lt;p&gt;Could the missing pixel mask be at fault?  It doesn't jive at all with the
error message, so I doubt it.  &lt;tt class="docutils literal"&gt;OBSDATE&lt;/tt&gt; is not the problem.&lt;/p&gt;
&lt;p&gt;Turns out, the error is that ALMA is the telescope.  I added the header entry:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
ffile[0].header['TELESCOP'] = 'NotReal'
&lt;/pre&gt;
&lt;p&gt;and it Just Worked.  It is approaching the end of my shift, so I think it is
now acceptable to say &amp;quot;what kind of !#$&amp;#64;#$!&amp;#64;% up #&amp;#64;$$&amp;#64;% is that?!&amp;quot;.&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="ALMA"></category><category term="simulation"></category><category term="debuggin"></category></entry><entry><title>Which one is real?</title><link href="https://keflavich.github.io/blog/which-one-is-real.html" rel="alternate"></link><published>2016-03-12T10:25:00-07:00</published><updated>2016-03-12T10:25:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-03-12:/blog/which-one-is-real.html</id><summary type="html">&lt;p&gt;I've &amp;quot;successfully&amp;quot; combined 7m and 12m data, and I've also &amp;quot;successfully&amp;quot;
processed 12m data.  In both cases, I've self-calibrated the long-baseline 12m
data.&lt;/p&gt;
&lt;p&gt;The question now is: why are these images so different?  There are features
in the 12m-only data that are a factor of ~2 brighter than in the …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I've &amp;quot;successfully&amp;quot; combined 7m and 12m data, and I've also &amp;quot;successfully&amp;quot;
processed 12m data.  In both cases, I've self-calibrated the long-baseline 12m
data.&lt;/p&gt;
&lt;p&gt;The question now is: why are these images so different?  There are features
in the 12m-only data that are a factor of ~2 brighter than in the 12m+7m data.
That should not happen.&lt;/p&gt;
&lt;p&gt;This image shows the problem.  7m+12m left, 12m-only right:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/7m12m_vs_12m.png" style="width: 600px;" /&gt;
&lt;p&gt;Note the sharp features on the left and the small tail (filament) toward the
top right that appear in the 12m but not in the 7m+12m data.&lt;/p&gt;
&lt;p&gt;Which features are real?  How do we decide?&lt;/p&gt;
&lt;p&gt;I really want to believe the 12m-only data, but I am very worried that it is
artificially enhanced by sidelobes from the e8 filament:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/7m12m_vs_12m_zoomout.png" style="width: 600px;" /&gt;
&lt;p&gt;There is a ~20-sigma feature between e8 and e2 along the e8 filament axis,
but it is completely absent in the 7m+12m data.  That leads me to believe
that it is not real, but at such high significance that is very worrisome.
I'm also concerned by the loss of the compact source at the bottom of the e8
filament and to the left: these seem unlikely to be affected by the filament.&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="clean"></category></entry><entry><title>CLEAN has extreme sensitivity to the threshold</title><link href="https://keflavich.github.io/blog/clean-has-extreme-sensitivity-to-the-threshold.html" rel="alternate"></link><published>2016-03-10T10:12:00-07:00</published><updated>2016-03-10T10:12:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-03-10:/blog/clean-has-extreme-sensitivity-to-the-threshold.html</id><summary type="html">&lt;p&gt;CLEAN diverges sometimes.  The point at which divergence begins is very
difficult to identify and unfortunately it looks like the images get mostly
better as you slowly approach the toxic threshold:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/tclean_threshold_sensitivity.png" style="width: 600px;" /&gt;
&lt;p&gt;The precise clean command used, with only threshold changing, is:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2016-03-10 07:49:28     INFO    tclean::::      tclean(vis=&amp;quot;w51 …&lt;/pre&gt;</summary><content type="html">&lt;p&gt;CLEAN diverges sometimes.  The point at which divergence begins is very
difficult to identify and unfortunately it looks like the images get mostly
better as you slowly approach the toxic threshold:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/tclean_threshold_sensitivity.png" style="width: 600px;" /&gt;
&lt;p&gt;The precise clean command used, with only threshold changing, is:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2016-03-10 07:49:28     INFO    tclean::::      tclean(vis=&amp;quot;w51_contvis_selfcal_4.ms&amp;quot;,selectdata=True,field=&amp;quot;&amp;quot;,spw=&amp;quot;&amp;quot;,timerange=&amp;quot;&amp;quot;,
2016-03-10 07:49:28     INFO    tclean::::+             uvrange=&amp;quot;&amp;quot;,antenna=&amp;quot;&amp;quot;,scan=&amp;quot;&amp;quot;,observation=&amp;quot;&amp;quot;,intent=&amp;quot;&amp;quot;,
2016-03-10 07:49:28     INFO    tclean::::+             datacolumn=&amp;quot;corrected&amp;quot;,imagename=&amp;quot;selfcal_allspw_selfcal_4ampphase_mfs_tclean_deeper_4mJy&amp;quot;,imsize=[3072, 3072],cell=&amp;quot;0.05arcsec&amp;quot;,phasecenter=&amp;quot;J2000 19:23:41.629000 +14.30.42.38000&amp;quot;,
2016-03-10 07:49:28     INFO    tclean::::+             stokes=&amp;quot;I&amp;quot;,projection=&amp;quot;SIN&amp;quot;,startmodel=&amp;quot;&amp;quot;,specmode=&amp;quot;mfs&amp;quot;,reffreq=&amp;quot;&amp;quot;,
2016-03-10 07:49:28     INFO    tclean::::+             nchan=-1,start=&amp;quot;&amp;quot;,width=&amp;quot;&amp;quot;,outframe=&amp;quot;LSRK&amp;quot;,veltype=&amp;quot;radio&amp;quot;,
2016-03-10 07:49:28     INFO    tclean::::+             restfreq=[],interpolation=&amp;quot;linear&amp;quot;,gridder=&amp;quot;mosaic&amp;quot;,facets=1,wprojplanes=1,
2016-03-10 07:49:28     INFO    tclean::::+             aterm=True,psterm=False,wbawp=True,conjbeams=True,cfcache=&amp;quot;&amp;quot;,
2016-03-10 07:49:28     INFO    tclean::::+             computepastep=360.0,rotatepastep=360.0,pblimit=0.4,normtype=&amp;quot;flatnoise&amp;quot;,deconvolver=&amp;quot;clark&amp;quot;,
2016-03-10 07:49:28     INFO    tclean::::+             scales=[],nterms=2,restoringbeam=[],outlierfile=&amp;quot;&amp;quot;,weighting=&amp;quot;briggs&amp;quot;,
2016-03-10 07:49:28     INFO    tclean::::+             robust=-2.0,npixels=0,uvtaper=[],niter=100000,gain=0.1,
2016-03-10 07:49:28     INFO    tclean::::+             threshold=&amp;quot;4mJy&amp;quot;,cycleniter=-1,cyclefactor=1.0,minpsffraction=0.05,maxpsffraction=0.8,
2016-03-10 07:49:28     INFO    tclean::::+             interactive=False,mask=&amp;quot;&amp;quot;,overwrite=True,savemodel=&amp;quot;modelcolumn&amp;quot;,calcres=True,
2016-03-10 07:49:28     INFO    tclean::::+             calcpsf=True,parallel=False)
&lt;/pre&gt;
&lt;p&gt;It looks like CLEAN needs a different type of threshold to finish on, perhaps
something requiring each subsequent component to be some value less than the
previous component.  If each component is forced to be less than the previous
one, the clean can never diverge, though clean would stop unexpectedly if
subtracting a component increased the amplitude of some other part of the map
(i.e., if the next brightest source is sitting in a negative bowl).  Still,
this might be a rarer occurrence than the divergence that I see all the time,
which may be related to gridding (given the sharp grid pattern seen in panel 4
of the linked image).&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="clean"></category></entry><entry><title>Simulated Observations of Perseus in W51</title><link href="https://keflavich.github.io/blog/simulated-observations-of-perseus-in-w51.html" rel="alternate"></link><published>2016-02-27T10:40:00-07:00</published><updated>2016-02-27T10:40:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-02-27:/blog/simulated-observations-of-perseus-in-w51.html</id><summary type="html">&lt;p&gt;The W51 and Sgr B2 ALMA mosaics contain ~50 and ~150 pointlike sources,
respectively.  However, they have pretty miserable high-noise regions
such that determining completeness is a serious challenge.&lt;/p&gt;
&lt;p&gt;To determine completeness in a means comparable to other observations,
I have therefore been using the Gould's Belt Survey Perseus data …&lt;/p&gt;</summary><content type="html">&lt;p&gt;The W51 and Sgr B2 ALMA mosaics contain ~50 and ~150 pointlike sources,
respectively.  However, they have pretty miserable high-noise regions
such that determining completeness is a serious challenge.&lt;/p&gt;
&lt;p&gt;To determine completeness in a means comparable to other observations,
I have therefore been using the Gould's Belt Survey Perseus data
as an input to do synthetic observations.&lt;/p&gt;
&lt;p&gt;It turns out this is technically challenging because CASA does some
&lt;a class="reference external" href="|static|/casa_simulating.rst"&gt;strange things&lt;/a&gt; when importing files.&lt;/p&gt;
&lt;p&gt;I finally got a &lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/commit/b046ff5c82992ef44a1dbaac303fcc6497511142"&gt;version&lt;/a&gt;
working.&lt;/p&gt;
&lt;p&gt;Important details when reading in a FITS file:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;The header &lt;em&gt;must&lt;/em&gt; be fully populated with a 4-dimensional WCS.  If stokes or
frequency are missing, CASA will choke with uninformative errors such as:&lt;/p&gt;
&lt;p&gt;2016-02-26 11:25:24  SEVERE  Simulator::createSkyEquation() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc, line 2200)        Caught exception: (/Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc : 2266) Failed AlwaysAssert spectralIndex&amp;gt;=0
2016-02-26 11:25:24  SEVERE  Simulator::predict() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc, line 2118)  Failed to create SkyEquation&lt;/p&gt;
&lt;p&gt;and&lt;/p&gt;
&lt;p&gt;2016-02-26 11:27:36  SEVERE  Simulator::predict() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc, line 2118)  Caught exception: (/Users/rpmbuild/gradle/workdir/casasources/release-4_5/casacore/coordinates/Coordinates/CoordinateSystem.cc : 793) Failed AlwaysAssert which &amp;lt; nCoordinates() &amp;amp;&amp;amp; coordinates_p[which]-&amp;gt;type() == Coordinate::STOKES&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Flux units should be in Jy/beam.  Other flux units &lt;em&gt;may&lt;/em&gt; be acceptable (e.g.,
MJy/sr, Jy/pixel), but their behavior is not entirely predictable.  I did not
get out the expected values when I used MJy/sr as input, but I did not pursue
further why this happened.  Using Jy/beam, and ensuring that the units were correctly
set to Jy/beam in the file (by scaling them in the FITS image before importing),
I got the expected results.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;CASA apparently does not read beam information from headers.  You need to include the
beam information when doing importfits, e.g.:&lt;/p&gt;
&lt;blockquote&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;beam=[&amp;quot;{0}deg&amp;quot;.format(hdr['BMAJ']),&lt;/dt&gt;
&lt;dd&gt;&lt;p class="first last"&gt;&amp;quot;{0}deg&amp;quot;.format(hdr['BMIN']),
&amp;quot;{0}deg&amp;quot;.format(hdr['BPA'])]&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;CASA will happily read a FITS file into a &lt;tt class="docutils literal"&gt;.image&lt;/tt&gt; that cannot be used by
other casa routines.  You will not get an exception until you try a later
step.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;Once the FITS image is read into a CASA &lt;tt class="docutils literal"&gt;.image&lt;/tt&gt;, &lt;em&gt;if&lt;/em&gt; it has the CASA-expected
units and dimensions, you can use &lt;tt class="docutils literal"&gt;sm.predict&lt;/tt&gt; to fourier transform the data
and sample it onto the UV grid in your &lt;tt class="docutils literal"&gt;.ms&lt;/tt&gt; file:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
sm.openfromms(&amp;quot;file.ms&amp;quot;)
sm.setvp() # &amp;quot;set voltage pattern&amp;quot;: not clear if this is needed
success = sm.predict(&amp;quot;myfile.image&amp;quot;)
sm.done()
sm.close()
&lt;/pre&gt;
&lt;p&gt;This (seems to) populate the &lt;em&gt;data&lt;/em&gt; column, not the model column as I had
originally expected.  Therefore, be warned!  DO NOT DO THIS TO YOUR ORIGINAL
DATA!  It will probably overwrite it.&lt;/p&gt;
&lt;p&gt;Once your &lt;tt class="docutils literal"&gt;.ms&lt;/tt&gt; file is populated, you can clean it as normal.  Some
examples:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/perseus_in_w51_imaging.png" style="width: 600px;" /&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="ALMA"></category></entry><entry><title>CASA Simulation</title><link href="https://keflavich.github.io/blog/casa-simulation.html" rel="alternate"></link><published>2016-02-25T10:27:00-07:00</published><updated>2016-02-25T10:27:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-02-25:/blog/casa-simulation.html</id><summary type="html">&lt;p&gt;More frustration with CASA:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;If you try to load a FITS image into a CASA .image, beware that it is likely
to have incorrect units.  Round-tripping between .image and .fits doesn't
work well, because CASA always assumes that CDELT is in radians even when it
is explicitly set to be …&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;More frustration with CASA:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p class="first"&gt;If you try to load a FITS image into a CASA .image, beware that it is likely
to have incorrect units.  Round-tripping between .image and .fits doesn't
work well, because CASA always assumes that CDELT is in radians even when it
is explicitly set to be degrees.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;EDIT: OK, this isn't true in all cases, but if you use &lt;tt class="docutils literal"&gt;imhead&lt;/tt&gt; to &lt;tt class="docutils literal"&gt;put&lt;/tt&gt;
a keyword value, it will assume radians by default.  That can be overcome by explicitly setting the units:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;imhead(perseus_casa_image, mode='put', hdkey='CDELT1', hdvalue={'value':hdr['CDELT1'], 'unit':'deg'})&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I was able to produce this awkward behavior &lt;em&gt;without&lt;/em&gt; imhead as well, though
I cannot repeat that now.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;The simulator gives this error message if I try to load an image:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;sm.setvp()
sm.predict(perseus_casa_image)&lt;/p&gt;
&lt;p&gt;2016-02-25 09:26:34 SEVERE  Simulator::predict() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Simulator.cc, line 2118)  Caught exception: TiledShape: #elements in shape and tileShape differ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;My best guess is that CASA doesn't understand how to handle 2D images with 3D
headers.  However, the sensible workaround of expanding the image to 3D does
not work.&lt;/p&gt;
&lt;p&gt;Re-importing after exporting gets yet another different image.  After
re-importing an image that was exported to FITS, I get a new error:&lt;/p&gt;
&lt;blockquote&gt;
Failed AlwaysAssert spectralIndex&amp;gt;=0 2016-02-25 09:37:35&lt;/blockquote&gt;
&lt;p&gt;which is rather strange since the spectral index is a physical quantity.&lt;/p&gt;
&lt;p&gt;There is also the lovely message:&lt;/p&gt;
&lt;blockquote&gt;
2016-02-25 09:55:27 INFO importfits No usable restoring beam information found.&lt;/blockquote&gt;
&lt;p&gt;for a header that contains these lines:&lt;/p&gt;
&lt;blockquote&gt;
BMAJ    =   1.293900184840E-04
BMIN    =   1.293900184840E-04
BPA     =   0.000000000000E+00&lt;/blockquote&gt;
&lt;p&gt;The image might finally be right, but now I can't find any way to convert it to
a model.  If I try to &lt;tt class="docutils literal"&gt;ft&lt;/tt&gt; the model, I get:&lt;/p&gt;
&lt;blockquote&gt;
2016-02-25 10:54:54 SEVERE  ft::imager::ft() (file /Users/rpmbuild/gradle/workdir/casasources/release-4_5/code/synthesis/MeasurementEquations/Imager.cc, line 4488) Exception: (/Users/rpmbuild/gradle/workdir/casasources/release-4_5/casacore/coordinates/Coordinates/CoordinateSystem.cc : 777) Failed AlwaysAssert which &amp;lt; nCoordinates() &amp;amp;&amp;amp; coordinates_p[which]-&amp;gt;type() == Coordinate::SPECTRAL&lt;/blockquote&gt;
&lt;p&gt;which probably means that CASA doesn't know how to turn a single-band continuum
image into a model for a multi-frequency .ms (which is all .ms's, including
continuum, in the ALMA world).&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="ALMA"></category></entry><entry><title>Retrieving and Selecting Data in CASA</title><link href="https://keflavich.github.io/blog/retrieving-and-selecting-data-in-casa.html" rel="alternate"></link><published>2016-02-24T13:44:00-07:00</published><updated>2016-02-24T13:44:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-02-24:/blog/retrieving-and-selecting-data-in-casa.html</id><summary type="html">&lt;p&gt;I learned a few important things at the 7m+12m workshop in Garching:&lt;/p&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;tt class="docutils literal"&gt;clean&lt;/tt&gt; treats input models in Jy/beam and Jy/pixel qualitatively (not
just quantitatively) differently.  Jy/pixel images are taken to be model
images exactly, where Jy/beam are... somehow interpreted differently, maybe
as clean component assemblies …&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;</summary><content type="html">&lt;p&gt;I learned a few important things at the 7m+12m workshop in Garching:&lt;/p&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;p class="first"&gt;&lt;tt class="docutils literal"&gt;clean&lt;/tt&gt; treats input models in Jy/beam and Jy/pixel qualitatively (not
just quantitatively) differently.  Jy/pixel images are taken to be model
images exactly, where Jy/beam are... somehow interpreted differently, maybe
as clean component assemblies.  I don't know the details, but this is a
major caution.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;The &lt;tt class="docutils literal"&gt;tbtool&lt;/tt&gt; is not very good for extracting data for plotting.  The flags
are not guaranteed to be in a sane shape, which will lead to crashes if you
try &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;tb.getcolumn('FLAG')&lt;/span&gt;&lt;/tt&gt;.  &lt;tt class="docutils literal"&gt;ms.msselect&lt;/tt&gt;, however, allows you access
to most of the normal selection routines used in &lt;tt class="docutils literal"&gt;clean&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;split&lt;/tt&gt;, etc.
It is tricky, though, because &lt;tt class="docutils literal"&gt;ms.select&lt;/tt&gt; does &lt;em&gt;not&lt;/em&gt; allow you access to
the same selection.  Also, while &lt;tt class="docutils literal"&gt;spw&lt;/tt&gt;-based selection normally allows you
to select channels, in &lt;tt class="docutils literal"&gt;ms.msselect&lt;/tt&gt; it does not: instead you must use
&lt;tt class="docutils literal"&gt;ms.selectchannel&lt;/tt&gt;.  See &lt;a class="reference external" href="https://github.com/radio-astro-tools/sandbox/blob/master/casa_7m12m_tools/weight_density_uv_plot.py"&gt;this example&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Details about the selection are at this URL, but the documentation is
incomplete and, in places, incorrect:&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="http://www.aoc.nrao.edu/~sbhatnag/misc/msselection/FrequencySelection.html"&gt;http://www.aoc.nrao.edu/~sbhatnag/misc/msselection/FrequencySelection.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;(for example, &lt;tt class="docutils literal"&gt;chanspec&lt;/tt&gt; is not valid in &lt;tt class="docutils literal"&gt;msselect&lt;/tt&gt;, or at least
it doesn't do anything)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="ALMA"></category></entry><entry><title>A tclean vs clean comparison</title><link href="https://keflavich.github.io/blog/a-tclean-vs-clean-comparison.html" rel="alternate"></link><published>2016-02-22T11:23:00-07:00</published><updated>2016-02-22T11:23:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-02-22:/blog/a-tclean-vs-clean-comparison.html</id><summary type="html">&lt;p&gt;Comparing tclean to clean with the following parameters:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
clean(vis=vis0, imagename=myimagebase, field=&amp;quot;&amp;quot;, spw='',
      mode='mfs', outframe='LSRK', interpolation='linear',
      imagermode='mosaic', multiscale=multiscale, interactive=False,
      niter=1000, threshold='100mJy', imsize=imsize, minpb=0.5, cell=cell,
      phasecenter=phasecenter, weighting='briggs', usescratch=True,
      pbcor=True, robust=-2.0)

tclean …&lt;/pre&gt;</summary><content type="html">&lt;p&gt;Comparing tclean to clean with the following parameters:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
clean(vis=vis0, imagename=myimagebase, field=&amp;quot;&amp;quot;, spw='',
      mode='mfs', outframe='LSRK', interpolation='linear',
      imagermode='mosaic', multiscale=multiscale, interactive=False,
      niter=1000, threshold='100mJy', imsize=imsize, minpb=0.5, cell=cell,
      phasecenter=phasecenter, weighting='briggs', usescratch=True,
      pbcor=True, robust=-2.0)

tclean(vis=vis0, imagename=myimagebase, field=&amp;quot;&amp;quot;, spw='',
       outframe='LSRK', interpolation='linear', gridder='mosaic',
       scales=multiscale, interactive=False, niter=1000,
       threshold='100mJy', imsize=imsize, mask='auto-pb', specmode='mfs',
       cell=cell, phasecenter=phasecenter, weighting='briggs', robust=-2.0)
&lt;/pre&gt;
&lt;p&gt;Note the very bad cleaning instability creeping in in the clean image:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/tclean_vs_clean_7m12m.png" style="width: 600px;" /&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="ALMA"></category></entry><entry><title>CASA Selfcal: Good &amp; Awful</title><link href="https://keflavich.github.io/blog/casa-selfcal-good-awful.html" rel="alternate"></link><published>2016-01-28T09:20:00-07:00</published><updated>2016-01-28T09:20:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-01-28:/blog/casa-selfcal-good-awful.html</id><summary type="html">&lt;p&gt;Self-calibration is necessary for some images to get a decent dynamic range or
to see anything at all in the images.  So, I did some tests using self-cal on
the central field of Sgr B2 (&lt;a class="reference external" href="https://github.com/keflavich/SgrB2_ALMA_3mm_Mosaic/blob/master/script_12m_te/selfcal_centralfield.py"&gt;source&lt;/a&gt;)
and it worked great:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/sgrb2_selfcal_good.png" style="width: 600px;" /&gt;
&lt;p&gt;That image is actually from &lt;a class="reference external" href="https://github.com/keflavich/SgrB2_ALMA_3mm_Mosaic/blob/master/script_12m_te/selfcal_continuum.py"&gt;self-calibrating the whole field&lt;/a&gt;,
which …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Self-calibration is necessary for some images to get a decent dynamic range or
to see anything at all in the images.  So, I did some tests using self-cal on
the central field of Sgr B2 (&lt;a class="reference external" href="https://github.com/keflavich/SgrB2_ALMA_3mm_Mosaic/blob/master/script_12m_te/selfcal_centralfield.py"&gt;source&lt;/a&gt;)
and it worked great:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/sgrb2_selfcal_good.png" style="width: 600px;" /&gt;
&lt;p&gt;That image is actually from &lt;a class="reference external" href="https://github.com/keflavich/SgrB2_ALMA_3mm_Mosaic/blob/master/script_12m_te/selfcal_continuum.py"&gt;self-calibrating the whole field&lt;/a&gt;,
which also worked great.  Except, it deleted all the flux outside of the bright regions:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/sgrb2_selfcal_bad.png" style="width: 600px;" /&gt;
&lt;p&gt;This is awful.  It is just deleting flux!  I had previously thought that the
&lt;tt class="docutils literal"&gt;applyonly&lt;/tt&gt; option would only apply solutions that it actually found, but
that appears not to bt true.  Instead, it seems that even phase solutions with
&lt;em&gt;no&lt;/em&gt; signal are being applied, which effectively removes everything from the
image.  I could have understood if this was happening to amplitude
self-calibration, but I can't understand how it is happening with phase
self-cal.&lt;/p&gt;
</content><category term="misc"></category><category term="clean"></category><category term="selfcal"></category></entry><entry><title>CASA imaging of huge cube</title><link href="https://keflavich.github.io/blog/casa-imaging-of-huge-cube.html" rel="alternate"></link><published>2016-01-25T10:09:00-07:00</published><updated>2016-01-25T10:09:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-01-25:/blog/casa-imaging-of-huge-cube.html</id><summary type="html">&lt;p&gt;Imaging full cubes, i.e. every channel and every pixel, from ALMA data proved
too much for the first few machines I tried it on, so I then tried splitting
the cubes into chunks (&lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/script_12m/scriptForImaging_fullcube.py"&gt;source&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;For the most part, this works well, but there are some serious problems:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/spectrum_with_badchunk.png" style="width: 600px;" /&gt;
&lt;p&gt;Note the …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Imaging full cubes, i.e. every channel and every pixel, from ALMA data proved
too much for the first few machines I tried it on, so I then tried splitting
the cubes into chunks (&lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/script_12m/scriptForImaging_fullcube.py"&gt;source&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;For the most part, this works well, but there are some serious problems:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/spectrum_with_badchunk.png" style="width: 600px;" /&gt;
&lt;p&gt;Note the range from 233.8-234 GHz.  It has a continuum level way above the
rest.  This is utter nonsense, and turns out to be due to some imaging error.
The first image below shows a &amp;quot;good&amp;quot; chunk of the cube, the second image shows
a &amp;quot;bad&amp;quot; chunk.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/w51_cube_chunk_compare_good.png" style="width: 600px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/w51_cube_chunk_compare_bad.png" style="width: 600px;" /&gt;
&lt;p&gt;It is clear that the second image was restore using a too-large beam, and this is verified by examining the header:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;badcube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;beam&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;Beam&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;BMAJ&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;1.15963029861&lt;/span&gt; &lt;span class="n"&gt;arcsec&lt;/span&gt; &lt;span class="n"&gt;BMIN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.96223282814&lt;/span&gt; &lt;span class="n"&gt;arcsec&lt;/span&gt; &lt;span class="n"&gt;BPA&lt;/span&gt;&lt;span class="o"&gt;=-&lt;/span&gt;&lt;span class="mf"&gt;71.0310058594&lt;/span&gt; &lt;span class="n"&gt;deg&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;goodcube&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;beam&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;Beam&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;BMAJ&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.408393889665&lt;/span&gt; &lt;span class="n"&gt;arcsec&lt;/span&gt; &lt;span class="n"&gt;BMIN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.229679107666&lt;/span&gt; &lt;span class="n"&gt;arcsec&lt;/span&gt; &lt;span class="n"&gt;BPA&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;45.966835022&lt;/span&gt; &lt;span class="n"&gt;deg&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I don't yet know what is causing this error.  When I try re-doing the clean
with &lt;tt class="docutils literal"&gt;tclean&lt;/tt&gt;, I get the following message, which is a hint:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2016-01-25 09:13:04     WARN    task_tclean::SIImageStore::getPSFGaussian (file
/var/rpmbuild/BUILD/casa-prerelease/casa-prerelease-4.5.0/code/synthesis/ImagerObjects/SIImageStore.cc,
line 1262)      PSF is blank for[C139:P0] [C140:P0] [C141:P0] [C142:P0]
[C143:P0] [C144:P0] [C145:P0] [C146:P0] [C147:P0] [C148:P0] [C149:P0] [C150:P0]
[C151:P0] [C152:P0] [C153:P0] [C154:P0] [C155:P0] [C156:P0] [C157:P0] [C158:P0]
[C159:P0] [C160:P0] [C161:P0] [C162:P0] [C163:P0] [C164:P0] [C165:P0] [C166:P0]
[C167:P0] [C168:P0] [C169:P0] [C170:P0] [C171:P0] [C172:P0] [C173:P0] [C174:P0]
[C175:P0] [C176:P0] [C177:P0] [C178:P0] [C179:P0] [C180:P0] [C181:P0] [C182:P0]
[C183:P0] [C184:P0] [C185:P0] [C186:P0]
&lt;/pre&gt;
&lt;p&gt;Apparently tclean solves this problem!  Instead of using a single beam for all
channels, it creates a CASAMBM table in the FITS output and uses different
beams at each channel.  There must be genuinely bad data (probably an
atmospheric absorption line) at the specified frequencies.  At least now, that
will come up more naturally, rather than spiking the data.&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="imaging"></category><category term="cubes"></category></entry><entry><title>Comparing tclean parameters</title><link href="https://keflavich.github.io/blog/comparing-tclean-parameters.html" rel="alternate"></link><published>2016-01-14T09:57:00-07:00</published><updated>2016-01-14T09:57:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-01-14:/blog/comparing-tclean-parameters.html</id><summary type="html">&lt;p&gt;Comparing clean methods with identical data &amp;amp; parameters (as far as possible):
&lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/script_merge/clean_method_comparison.py"&gt;code&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;An example using natural weighting:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/tclean_compare.png" style="width: 600px;" /&gt;
&lt;p&gt;None of the methods are acceptable.  Multiscale is the worst, but hogbom is
extremely bad: there are major ringing artifacts (stripes parallel to the main
filament).&lt;/p&gt;
&lt;p&gt;Disturbingly, even though I have given multiple …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Comparing clean methods with identical data &amp;amp; parameters (as far as possible):
&lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/script_merge/clean_method_comparison.py"&gt;code&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;An example using natural weighting:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/tclean_compare.png" style="width: 600px;" /&gt;
&lt;p&gt;None of the methods are acceptable.  Multiscale is the worst, but hogbom is
extremely bad: there are major ringing artifacts (stripes parallel to the main
filament).&lt;/p&gt;
&lt;p&gt;Disturbingly, even though I have given multiple scales, there are clearly no
non-pointlike scales in any of the model images, including mem, so I think
there's a major problem with tclean:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/tclean_compare_models.png" style="width: 600px;" /&gt;
&lt;p&gt;I'm re-doing it with uniform weighting, because that's the case I was actually
interested in.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/casa/tclean_compare_uniform.png" style="width: 600px;" /&gt;
&lt;p&gt;The uniform tests come up with a clear and obvious answer: use clark clean, DO
NOT use any other methods as they are all unstable.&lt;/p&gt;
</content><category term="misc"></category><category term="casa"></category><category term="clean"></category><category term="tclean"></category></entry><entry><title>Self-cal with EVLA data</title><link href="https://keflavich.github.io/blog/self-cal-with-evla-data.html" rel="alternate"></link><published>2016-01-07T08:14:00-07:00</published><updated>2016-01-07T08:14:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-01-07:/blog/self-cal-with-evla-data.html</id><summary type="html">&lt;p&gt;I'm trying to self-calibrate my A+C array C-band data on W51, since we're in a
clearly dynamic-range-limited regime.  I've never had any luck with self-cal,
though.  The images &lt;em&gt;always&lt;/em&gt; get worse, and I still don't really understand
why.&lt;/p&gt;
&lt;p&gt;This is a clue, though:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/selfcal_phasecal_vs_time.png" style="width: 600px;" /&gt;
&lt;p&gt;For many of the antennae, especially …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I'm trying to self-calibrate my A+C array C-band data on W51, since we're in a
clearly dynamic-range-limited regime.  I've never had any luck with self-cal,
though.  The images &lt;em&gt;always&lt;/em&gt; get worse, and I still don't really understand
why.&lt;/p&gt;
&lt;p&gt;This is a clue, though:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/selfcal_phasecal_vs_time.png" style="width: 600px;" /&gt;
&lt;p&gt;For many of the antennae, especially those in C array, self-calibration results
in phase plots that look nice, with corrections confined to +/-30 degrees as
you would hope and expect.&lt;/p&gt;
&lt;p&gt;These plots show that some antennae are going through dozens or hundreds of
phase wraps.  That is obviously unacceptable and incorrect: the original images
actually looked pretty good, so it is obvious (to me, at least) that there
should be &lt;em&gt;no&lt;/em&gt; phase wrapping in the self-cal.  I'm surprised at this, since
each of these points should have S/N &amp;gt; 3 and there is a lot of consistency in
these large phase shifts.&lt;/p&gt;
&lt;p&gt;My suspicion is still that the clean process has failed.  I have been trying
multiscale clean, since the emission is completely dominated by extended
components.  However, even if I set smallscalebias to different values, there
are essentially no pointlike components being added to the clean model.  This
is wrong!  There are genuine point sources.  So I still suspect that this is a
modeling problem and the phase wraps are being caused by bad models.&lt;/p&gt;
&lt;p&gt;I'm trying again with smaller pixels in the hope that a better match between
the beam size and the pixel size will produce a better model.  The only other
thing I can think to try is increasing the solint, but given the high S/N
already present, I doubt that's an important factor.&lt;/p&gt;
&lt;p&gt;Smaller pixels didn't help, &lt;em&gt;but&lt;/em&gt; forcing clean to include point-source
components by performing a second round of clean with &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;multiscale=[]&lt;/span&gt;&lt;/tt&gt; worked!
The solutions are MUCH more reasonable (no more phase wrap every integration),
and selfcal no longer diverges.  I also increased the solution interval to 30s
since it seems that the phase change timescale is significantly longer than
an integration.  I increased the S/N cutoff to 5 too.&lt;/p&gt;
&lt;p&gt;There are still some &amp;quot;noisy&amp;quot; phases, even in the 3rd iteration:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/selfcal_phasecal_vs_time_3rditer.png" style="width: 600px;" /&gt;
&lt;p&gt;I think more iterations may be necessary, but I will also increase the S/N
threshold to 6 and solint to 60s to see if that helps.&lt;/p&gt;
&lt;p&gt;RMS improvements are evident but not spectacular:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
SPW4 Iteration 0: RMS=1.003e-04
SPW4 Iteration 1: RMS=6.009e-05
SPW4 Iteration 2: RMS=6.698e-05
SPW4 Iteration 3: RMS=7.061e-05
&lt;/pre&gt;
&lt;p&gt;The bump in the last one is because I forgot to add a point clean for the last
iteration.&lt;/p&gt;
&lt;p&gt;Perhaps not unfortunately, it looks like the improvements in image quality are
tiny when self-cal is added.  The only real hope now is that self-cal on all
bands will result in an artifact-free final combined image.&lt;/p&gt;
&lt;p&gt;On the &amp;quot;noisy&amp;quot; phases, now that it looks like there are decent solutions, it
may actually be worth keeping the flags generated by applycal.  &amp;lt;10% of the
data is being flagged out, which is negligible, and it probably is genuinely
bad (or signal-free, anyway) in that case.&lt;/p&gt;
&lt;p&gt;EDIT: Looks better... or at least different... now:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
SPW4 Iteration 0: RMS=1.003e-04
SPW4 Iteration 1: RMS=5.962e-05
SPW4 Iteration 2: RMS=6.817e-05
SPW4 Iteration 3: RMS=6.775e-05
&lt;/pre&gt;
</content><category term="misc"></category><category term="w51"></category><category term="evla"></category><category term="casa"></category></entry><entry><title>Publications from 2014</title><link href="https://keflavich.github.io/blog/publications-from-2014.html" rel="alternate"></link><published>2016-01-01T22:48:00-07:00</published><updated>2016-01-01T22:48:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-01-01:/blog/publications-from-2014.html</id><summary type="html">&lt;p&gt;Summary of publications from 2014 (just c&amp;amp;p'd from my bibdesk):&lt;/p&gt;
&lt;dt class="Key" id="Bally2014b"&gt;Bally2014b&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Outflows, Dusty Cores, and a Burst of Star Formation in the North America and Pelican Nebulae&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;J. Bally and A. Ginsburg and R. Probst and B. Reipurth and Y. L. Shirley and G. S. Stringfellow&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\aj&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;148&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;120 …&lt;/span&gt;&lt;/dd&gt;&lt;/dt&gt;</summary><content type="html">&lt;p&gt;Summary of publications from 2014 (just c&amp;amp;p'd from my bibdesk):&lt;/p&gt;
&lt;dt class="Key" id="Bally2014b"&gt;Bally2014b&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Outflows, Dusty Cores, and a Burst of Star Formation in the North America and Pelican Nebulae&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;J. Bally and A. Ginsburg and R. Probst and B. Reipurth and Y. L. Shirley and G. S. Stringfellow&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\aj&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;148&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;120&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2014&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Bally2014a"&gt;Bally2014a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Absorption Filaments toward the Massive Clump G0.253+0.016&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;J. Bally and J. M. Rathborne and S. N. Longmore and J. M. Jackson and J. F. Alves and E. Bressert and Y. Contreras and J. B. Foster and G. Garay and A. Ginsburg and K. G. Johnston and J. M. D. Kruijssen and L. Testi and A. J. Walsh&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\apj&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;795&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;28&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2014&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Ginsburg2014a"&gt;Ginsburg2014a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The dense gas mass fraction in the W51 cloud and its protoclusters&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;A. Ginsburg and J. Bally and C. Battersby and A. Youngblood and J. Darling and E. Rosolowsky and H. Arce and M. L. Santos&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2014&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Battersby2014b"&gt;Battersby2014b&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The Onset of Massive Star Formation: The Evolution of Temperature and Density Structure in an Infrared Dark Cloud&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;C. Battersby and A. Ginsburg and J. Bally and S. Longmore and M. Dunham and J. Darling&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\apj&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;787&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;113&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2014&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Battersby2014a"&gt;Battersby2014a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The Comparison of Physical Properties Derived from Gas and Dust in a Massive Star-forming Region&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;C. Battersby and J. Bally and M. Dunham and A. Ginsburg and S. Longmore and J. Darling&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\apj&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;786&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;116&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2014&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;</content><category term="publications"></category><category term="publications"></category></entry><entry><title>Publications from 2015</title><link href="https://keflavich.github.io/blog/publications-from-2015.html" rel="alternate"></link><published>2016-01-01T22:48:00-07:00</published><updated>2016-01-01T22:48:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2016-01-01:/blog/publications-from-2015.html</id><summary type="html">&lt;p&gt;Summary of publications from 2015 (just c&amp;amp;p'd from my bibdesk):&lt;/p&gt;
&lt;dt class="Key" id="Ginsburg2015b"&gt;Ginsburg2015b&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;High-mass star-forming cloud G0.38+0.04 in the Galactic center dust ridge contains H$_2$CO and SiO masers&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;A. Ginsburg and A. Walsh and C. Henkel and P. A. Jones and M. Cunningham and J. Kauffmann …&lt;/span&gt;&lt;/dd&gt;&lt;/dt&gt;</summary><content type="html">&lt;p&gt;Summary of publications from 2015 (just c&amp;amp;p'd from my bibdesk):&lt;/p&gt;
&lt;dt class="Key" id="Ginsburg2015b"&gt;Ginsburg2015b&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;High-mass star-forming cloud G0.38+0.04 in the Galactic center dust ridge contains H$_2$CO and SiO masers&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;A. Ginsburg and A. Walsh and C. Henkel and P. A. Jones and M. Cunningham and J. Kauffmann and T. Pillai and E. A. C. Mills and J. Ott and J. M. D. Kruijssen and K. M. Menten and C. Battersby and J. Rathborne and Y. Contreras and S. Longmore and D. Walker and J. Dawson and J. A. P. Lopez&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\aap&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;584&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;L7&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Colombo2015a"&gt;Colombo2015a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Graph-based interpretation of the molecular interstellar medium segmentation&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;D. Colombo and E. Rosolowsky and A. Ginsburg and A. Duarte-Cabral and A. Hughes&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\mnras&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;454&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;2067-2091&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Weilbacher2015a"&gt;Weilbacher2015a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;A MUSE map of the central Orion Nebula (M 42)&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;P. M. Weilbacher and A. Monreal-Ibero and W. Kollatschny and A. Ginsburg and A. F. McLeod and S. Kamann and C. Sandin and R. Palsa and L. Wisotzki and R. Bacon and F. Selman and J. Brinchmann and J. Caruana and A. Kelz and T. Martinsson and A. Pécontal-Rousset and J. Richard and M. Wendt&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\aap&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;582&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;A114&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Isella2015a"&gt;Isella2015a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Next Generation Very Large Array Memo No. 6, Science Working Group 1: The Cradle of Life&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;A. Isella and C. H. Hull and A. Moullet and R. Galván-Madrid and D. Johnstone and L. Ricci and J. Tobin and L. Testi and M. Beltran and J. Lazio and A. Siemion and H. Liu and F. Du and K. Öberg and T. Bergin and P. Caselli and T. Bourke and C. Carilli and L. Perez and B. Butler and I. Pater and C. Qi and M. Hofstadter and R. Moreno and D. Alexander and J. Williams and P. Goldsmith and M. Wyatt and L. Loinard and J. Francesco and D. Wilner and P. Schilke and A. Ginsburg and Á. Sánchez-Monge and Q. Zhang and H. Beuther&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Colombo2015b"&gt;Colombo2015b&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The road toward a full, high resolution Molecular Cloud catalog of the Galaxy&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;D. Colombo and E. Rosolowsky and A. Ginsburg and A. Duarte-Cabral and A. Hughes&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Ginsburg2015c"&gt;Ginsburg2015c&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Detecting Stars at the Galactic Centre via Synchrotron Emission&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;I. Ginsburg and X. Wang and A. Loeb and O. Cohen&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;ArXiv e-prints&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Wang2015a"&gt;Wang2015a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;Large-scale filaments associated with Milky Way spiral arms&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;K. Wang and L. Testi and A. Ginsburg and C. M. Walmsley and S. Molinari and E. Schisano&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\mnras&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;450&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;4043-4049&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Bally2015a"&gt;Bally2015a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The Orion fingers: Near-IR adaptive optics imaging of an explosive protostellar outflow&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;J. Bally and A. Ginsburg and D. Silvia and A. Youngblood&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\aap&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;579&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;A130&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="McLeod2015a"&gt;McLeod2015a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The Pillars of Creation revisited with MUSE: gas kinematics and high-mass stellar feedback traced by optical spectroscopy&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;A. F. McLeod and J. E. Dale and A. Ginsburg and B. Ercolano and M. Gritschneder and S. Ramsay and L. Testi&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\mnras&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;450&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;1057-1076&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Ellsworth-Bowers2015a"&gt;Ellsworth-Bowers2015a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The Bolocam Galactic Plane Survey. XIII. Physical Properties and Mass Functions of Dense Molecular Cloud Structures&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;T. P. Ellsworth-Bowers and J. Glenn and A. Riley and E. Rosolowsky and A. Ginsburg and N. J. Evans, II and J. Bally and C. Battersby and Y. L. Shirley and M. Merello&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\apj&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;805&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;157&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Merello2015a"&gt;Merello2015a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The Bolocam Galactic Plane Survey. XI. Temperatures and Substructure of Galactic Clumps Based On 350 $\mu$M Observations&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;M. Merello and N. J. Evans, II and Y. L. Shirley and E. Rosolowsky and A. Ginsburg and J. Bally and C. Battersby and M. M. Dunham&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\apjs&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;218&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;1&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Thompson2015c"&gt;Thompson2015c&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The ionised,radical and molecular Milky Way: spectroscopic surveys with the SKA&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;M. Thompson and H. Beuther and C. Dickinson and J. Mottram and P. Klaassen and A. Ginsburg and S. Longmore and A. Remijan and K. M. Menten&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;Advancing Astrophysics with the Square Kilometre Array (AASKA14)&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;126&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Ellsworth-Bowers2015b"&gt;Ellsworth-Bowers2015b&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The Bolocam Galactic Plane Survey. XII. Distance Catalog Expansion Using Kinematic Isolation of Dense Molecular Cloud Structures with $^13$CO(1-0)&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;T. P. Ellsworth-Bowers and E. Rosolowsky and J. Glenn and A. Ginsburg and N. J. Evans, II and C. Battersby and Y. L. Shirley and B. Svoboda&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\apj&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;799&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;29&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;&lt;dt class="Key" id="Ginsburg2015a"&gt;Ginsburg2015a&lt;dt /&gt;
&lt;dd class="Pub"&gt;
    &lt;span class="Title"&gt;The dense gas mass fraction in the W51 cloud and its protoclusters&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Author"&gt;A. Ginsburg and J. Bally and C. Battersby and A. Youngblood and J. Darling and E. Rosolowsky and H. Arce and M. E. Lebrón Santos&lt;/span&gt;&lt;br /&gt;
    &lt;span class="Journal"&gt;\aap&lt;/span&gt;&amp;nbsp;
    &lt;span class="Volume"&gt;573&lt;/span&gt;&amp;nbsp;
    &lt;span class="Pages"&gt;A106&lt;/span&gt;&amp;nbsp;
    (&lt;span class="Date"&gt;2015&lt;/span&gt;)&lt;br /&gt;
&lt;remoteURLs&gt;
    &lt;span class="URL"&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;/remoteURLs&gt;
&lt;dd /&gt;</content><category term="publications"></category><category term="publications"></category></entry><entry><title>FFT comparisons in python</title><link href="https://keflavich.github.io/blog/fft-comparisons-in-python.html" rel="alternate"></link><published>2015-12-07T11:24:00-07:00</published><updated>2015-12-07T11:24:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2015-12-07:/blog/fft-comparisons-in-python.html</id><summary type="html">&lt;p&gt;I'm trying to figure out which ffts are fastest, best, etc.&lt;/p&gt;
&lt;p&gt;First, it is difficult to get fftw3 + pyfftw installed into python.&lt;/p&gt;
&lt;p&gt;For pyfftw to install, you need to &lt;a class="reference external" href="http://www.fftw.org/doc/Installation-on-Unix.html"&gt;enable floats and every specific type&lt;/a&gt; when compiling &lt;a class="reference external" href="http://www.fftw.org/"&gt;fftw3&lt;/a&gt; (thanks to &lt;a class="reference external" href="http://linuxtoolkit.blogspot.de/2010/04/cant-find-fftw3f-library-when.html"&gt;linux toolkits blog&lt;/a&gt;).
Apparently you can't have &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--enable-long-double&lt;/span&gt;&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--enable-float …&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;I'm trying to figure out which ffts are fastest, best, etc.&lt;/p&gt;
&lt;p&gt;First, it is difficult to get fftw3 + pyfftw installed into python.&lt;/p&gt;
&lt;p&gt;For pyfftw to install, you need to &lt;a class="reference external" href="http://www.fftw.org/doc/Installation-on-Unix.html"&gt;enable floats and every specific type&lt;/a&gt; when compiling &lt;a class="reference external" href="http://www.fftw.org/"&gt;fftw3&lt;/a&gt; (thanks to &lt;a class="reference external" href="http://linuxtoolkit.blogspot.de/2010/04/cant-find-fftw3f-library-when.html"&gt;linux toolkits blog&lt;/a&gt;).
Apparently you can't have &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--enable-long-double&lt;/span&gt;&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--enable-float&lt;/span&gt;&lt;/tt&gt; simultaneously,
but pyfftw requires both, so you have to install twice or thrice?  Nope, four
times!!  Also, &lt;a class="reference external" href="https://github.com/hgomersall/pyFFTW/issues/16#issuecomment-19422752"&gt;my own post&lt;/a&gt;
indicates that I should install to a different path to avoid weird conflicts
with other libraries.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
./configure --enable-threads --enable-openmp --enable-mpi --enable-shared \
            --enable-fortran --enable-avx \
            CFLAGS=&amp;quot;-O3 -fno-common -fomit-frame-pointer -fstrict-aliasing&amp;quot;
make -j 4
sudo make install

./configure --enable-float --enable-threads --enable-openmp --enable-mpi --enable-shared \
            --enable-fortran --enable-avx \
            CFLAGS=&amp;quot;-O3 -fno-common -fomit-frame-pointer -fstrict-aliasing&amp;quot;
make -j 4
sudo make install

# quad precision is not supported in mpi
./configure --enable-quad-precision --enable-threads --enable-openmp --enable-shared \
            --enable-fortran --enable-avx \
             CFLAGS=&amp;quot;-O3 -fno-common -fomit-frame-pointer -fstrict-aliasing&amp;quot;
make -j 4
sudo make install

./configure --enable-long-double --enable-threads --enable-openmp --enable-mpi --enable-shared \
            --enable-fortran --enable-avx \
             CFLAGS=&amp;quot;-O3 -fno-common -fomit-frame-pointer -fstrict-aliasing&amp;quot;
make -j 4
sudo make install
&lt;/pre&gt;
&lt;p&gt;Onto speed test comparisons:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://gist.github.com/mperrin/5763120"&gt;Marshal Perrin's&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://gist.github.com/keflavich/5797994"&gt;my fork&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://code.google.com/p/agpy/source/browse/trunk/tests/test_ffts.py"&gt;speed tests on agpy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/astropy/astropy/pull/4374"&gt;profiling convolve_fft with different parameters&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;If you want to use &lt;tt class="docutils literal"&gt;fftw3&lt;/tt&gt; with astropy's &lt;a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.convolution.convolve_fft.html#astropy.convolution.convolve_fft"&gt;convolve_fft&lt;/a&gt;,
use &lt;a class="reference external" href="https://code.google.com/p/agpy/source/browse/trunk/AG_fft_tools/convolve_nd.py?r=479#8"&gt;this example&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Onto some comparisons from &lt;a class="reference external" href="https://github.com/astropy/astropy/pull/4374"&gt;astropy issue 4374&lt;/a&gt;:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/time_vs_mem.png" style="width: 600px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/psfTfftT.png" style="width: 600px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/psfTfftF.png" style="width: 600px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/psfFfftT.png" style="width: 600px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/psfFfftF.png" style="width: 600px;" /&gt;
&lt;p&gt;&lt;a class="reference external" href="https://gist.github.com/6a2d338830efdc02959a"&gt;Notebook containing comparisons between FFT and FFTW&lt;/a&gt;&lt;/p&gt;
</content><category term="misc"></category><category term="fft"></category><category term="convolution"></category></entry><entry><title>Separating Line from Continuum in CASA data</title><link href="https://keflavich.github.io/blog/separating-line-from-continuum-in-casa-data.html" rel="alternate"></link><published>2015-11-04T15:57:00-07:00</published><updated>2015-11-04T15:57:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2015-11-04:/blog/separating-line-from-continuum-in-casa-data.html</id><summary type="html">&lt;p&gt;I'm continuing to try to separate the line forest from the continuum data in my
W51 cube.  Some approaches 'kinda work', some don't.&lt;/p&gt;
&lt;p&gt;The iterative approach suggested in the &lt;a class="reference external" href="|static|cvel_w51_fail.rst"&gt;previous post&lt;/a&gt; &lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/630c60e7e57ea7b57877d66b15860b26419a5552/script_12m/uvcontsub_test.py"&gt;works reasonably well&lt;/a&gt;,
but results in oversubtraction of the continuum, even with
a few iterations.  Note that this approach …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I'm continuing to try to separate the line forest from the continuum data in my
W51 cube.  Some approaches 'kinda work', some don't.&lt;/p&gt;
&lt;p&gt;The iterative approach suggested in the &lt;a class="reference external" href="|static|cvel_w51_fail.rst"&gt;previous post&lt;/a&gt; &lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/630c60e7e57ea7b57877d66b15860b26419a5552/script_12m/uvcontsub_test.py"&gt;works reasonably well&lt;/a&gt;,
but results in oversubtraction of the continuum, even with
a few iterations.  Note that this approach requires &lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/630c60e7e57ea7b57877d66b15860b26419a5552/script_12m/uvcontsub_test.py#L17"&gt;copying columns between ms
files using the table toolkit&lt;/a&gt;.&lt;/p&gt;
&lt;img alt="Oversubtracted spectrum" src="https://keflavich.github.io/blog/images/w51/oversubtracted_spectrum.png" style="width: 400px;" /&gt;
&lt;p&gt;Another approach I wanted to try was to image the whole cube, take the minimum
value along the spectral axis, and subtract that.  This would avoid the
oversubtraction issue by force.  However, &lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/c58e4fdf755f85b163d1684cc7383ef31d6a1669/script_12m/mincontsub.py"&gt;this&lt;/a&gt;
leads to failures in the &lt;cite&gt;ft&lt;/cite&gt; task:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
CASA &amp;lt;85&amp;gt;: ft(vis='w51_test_small_imcont.ms', model='test_continuum_min.image', usescratch=True, nterms=1)
2015-11-04 15:01:29 WARN    ft::FTMachine::initMaps No overlap in frequency between image channels and selected data found for this FTMachine
2015-11-04 15:01:29 WARN    ft::FTMachine::initMaps+         Check your data selection and image parameters if you end up with a blank image
&lt;/pre&gt;
&lt;p&gt;which I don't understand.  I had to &lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/c58e4fdf755f85b163d1684cc7383ef31d6a1669/script_12m/mincontsub.py#L22"&gt;hack the header&lt;/a&gt;
just to get ft to load the file at all, and apparently my hack wasn't good enough.
It's really unclear to me now how to load a model from a FITS file.&lt;/p&gt;
&lt;p&gt;The next approach is to load the whole continuum-subtracted cube into a model,
subtract THAT, then make a continuum image, then subtract that, then maybe
we have line and continuum?  Maybe?  I suspect this approach will require
some sort of cube masking.&lt;/p&gt;
&lt;p&gt;Unfortunately, ft is again the problem:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2015-11-04 15:09:08 SEVERE  ft::imager::ft() (file /Users/rpmbuild/gradle/workdir/casaautobuild/release-4_5/code/synthesis/MeasurementEquations/Imager.cc, line 4488)       Exception: (/Users/rpmbuild/gradle/workdir/casaautobuild/release-4_5/darwin/include/casacore/lattices/Lattices/Lattice.tcc : 299) Failed AlwaysAssert shapeIn.isEqual (shapeOut)
&lt;/pre&gt;
&lt;p&gt;Followup in early 2017: a cube-based approach is generally more successful.
See Sanchez-Monge in prep and the related &lt;a class="reference external" href="https://github.com/radio-astro-tools/statcont"&gt;statcont&lt;/a&gt; software package.&lt;/p&gt;
</content><category term="misc"></category><category term="CASA"></category></entry><entry><title>CVEL errors</title><link href="https://keflavich.github.io/blog/cvel-errors.html" rel="alternate"></link><published>2015-11-02T20:50:00-07:00</published><updated>2015-11-02T20:50:00-07:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2015-11-02:/blog/cvel-errors.html</id><summary type="html">&lt;p&gt;I'm trying to get a good image of the W51 main sources that have line forests.
MFS clean does a pretty good job, but is very limited in dynamic range
presumably because the spectral lines manifest as amplitude errors.&lt;/p&gt;
&lt;p&gt;I tried splitting the data to merge my two spectral windows …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I'm trying to get a good image of the W51 main sources that have line forests.
MFS clean does a pretty good job, but is very limited in dynamic range
presumably because the spectral lines manifest as amplitude errors.&lt;/p&gt;
&lt;p&gt;I tried splitting the data to merge my two spectral windows using &lt;cite&gt;cvel&lt;/cite&gt;
(&lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/4c29c8dc763e3f994279d50db72b9a0dfc2a35b7/script_12m/split_for_localtests.py#L8"&gt;code&lt;/a&gt;),
but I see thousands of errors like this:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2015-11-02 19:52:15     WARN    SubMS::combineSpws()    Averaging failed for the following channel/correllation pairs from output row 44432 up to 44459. Corresponding visibilities will be flagged:
2015-11-02 19:52:15     WARN    SubMS::combineSpws()+   (60, 0) (60, 1) (1804, 0) (1804, 1) (1998, 0) (1998, 1)
&lt;/pre&gt;
&lt;p&gt;and when I image the cube, there is a jump at one channel that occurs because
the resolution suddenly changes either because SPW3 (the lo-res SPW) is not
included or because the hi-res one suddenly is.&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/w51/cvel_jump.png" style="width: 400px;" /&gt;
&lt;p&gt;It doesn't look like there's any obvious workaround at the moment, but I'll
probably try sending another helpdesk ticket about this.&lt;/p&gt;
&lt;p&gt;My best idea for getting a decent continuum out now is something like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;image the whole cube in frequency&lt;/li&gt;
&lt;li&gt;determine channels that can approximate the bright continuum&lt;/li&gt;
&lt;li&gt;use those to uvcontsub the data&lt;/li&gt;
&lt;li&gt;image the uvcontsub'd cube&lt;/li&gt;
&lt;li&gt;uvsub the imaged spectral line cube from the original data&lt;/li&gt;
&lt;li&gt;re-image the now-continuum-only cube using mfs&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;EDIT: Dirk replied to the helpdesk ticket, suggesting:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
Concerning cvel: try to process one SPW at a time. Otherwise cvel will
_combine_ the SPWs and if they are not observed at the same time, this will
lead to problems.
&lt;/pre&gt;
&lt;p&gt;So I've now &lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/2d15ce46f9ecd75d70ab7ac4ee8f91b272139d9e/script_12m/split_for_localtests.py#L8"&gt;split the cvel into two commands&lt;/a&gt;.
I also added &lt;cite&gt;outframe='bary'&lt;/cite&gt; because otherwise it's not obvious that the
frequency command is doing anything
sensible or useful.  That's actually probably why I was getting non-overlapping
segments before - it tried converting to barycentric, but maybe too late in the
process (i.e., it tried selecting in topo, then converting to bary for output).
I also added a phasecenter, because it was automatically selecting pointing 24
as the phasecenter for cvel before.&lt;/p&gt;
&lt;p&gt;This led to a new error:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
2015-11-03 14:38:27     WARN    cvel::SubMS::convertGridPars     *** Requested new channel width is smaller than smallest original channel width
2015-11-03 14:38:27     WARN    cvel::SubMS::convertGridPars+        which is 488319 Hz
&lt;/pre&gt;
&lt;p&gt;which I've fixed by setting the output width to be 0.5 MHz, just a simple round
number greater than the input even accounting for shift.  Unfortunately, this
seems to have produced a dramatically larger output MS, which cannot be
correct.... ahhh, it turns out that was temporary, once regridding was complete,
it turned small again.&lt;/p&gt;
</content><category term="misc"></category><category term="casa"></category><category term="cvel"></category></entry><entry><title>CASA clean errors related to channels</title><link href="https://keflavich.github.io/blog/casa-clean-errors-related-to-channels.html" rel="alternate"></link><published>2015-10-28T16:51:00-06:00</published><updated>2015-10-28T16:51:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2015-10-28:/blog/casa-clean-errors-related-to-channels.html</id><summary type="html">&lt;p&gt;When cleaning my ALMA data, especially when trying to &lt;a class="reference external" href="https://github.com/keflavich/SgrB2_ALMA_3mm_Mosaic/blob/master/script_12m/scriptForImaging.py#L120"&gt;image the full cube (all
channels)&lt;/a&gt;
when there are multiple SBs
with slightly different frequencies, I see this error frequently:&lt;/p&gt;
&lt;blockquote&gt;
No valid data, skip CLEANing this channel&lt;/blockquote&gt;
&lt;p&gt;It seems that the channel really is being skipped in many cases.  In the …&lt;/p&gt;</summary><content type="html">&lt;p&gt;When cleaning my ALMA data, especially when trying to &lt;a class="reference external" href="https://github.com/keflavich/SgrB2_ALMA_3mm_Mosaic/blob/master/script_12m/scriptForImaging.py#L120"&gt;image the full cube (all
channels)&lt;/a&gt;
when there are multiple SBs
with slightly different frequencies, I see this error frequently:&lt;/p&gt;
&lt;blockquote&gt;
No valid data, skip CLEANing this channel&lt;/blockquote&gt;
&lt;p&gt;It seems that the channel really is being skipped in many cases.  In the Sgr B2
cube, this wasn't a problem because I unintentionally cleaned only one of the
observations.  For the W51 and Orion data, I tried to &lt;a class="reference external" href="https://github.com/keflavich/W51_ALMA_2013.1.00308.S/blob/master/script_12m/scriptForImaging_fullcube.py"&gt;include all of the data&lt;/a&gt;,
but that is causing problems.  Perhaps CASA does not work at all when 'channel'
is specified and the channels aren't aligned?  Or maybe it only accepts channels
when all channels exist?&lt;/p&gt;
&lt;p&gt;I've now redone the 'full cube' imaging to separately image the two SBs in W51.
I'll see if that works...&lt;/p&gt;
&lt;p&gt;Nope, the resulting error is much worse:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
Log:
2015-10-28 15:49:01     INFO    imager::clean() Fitted beam used in restoration: 1.07809 by 0.913862 (arcsec) at pa -63.3899 (deg)
2015-10-28 15:49:01     INFO    imager::iClean()        Restoring Image(s) with the clean-beam
2015-10-28 15:49:02     SEVERE  clean::::       An error occurred running task clean.

Terminal:
*** Error ***  The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()
2015-10-28 15:49:02     SEVERE  clean::::       An error occurred running task clean.
&lt;/pre&gt;
&lt;p&gt;This is an indication of a major underlying python bug.&lt;/p&gt;
</content><category term="misc"></category><category term="clean"></category><category term="casa"></category></entry><entry><title>pyspeckit is py3-compatible</title><link href="https://keflavich.github.io/blog/pyspeckit-is-py3-compatible.html" rel="alternate"></link><published>2015-10-28T10:28:00-06:00</published><updated>2015-10-28T10:28:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2015-10-28:/blog/pyspeckit-is-py3-compatible.html</id><content type="html">&lt;p&gt;With PR &lt;a class="reference external" href="https://github.com/pyspeckit/pyspeckit/pull/110"&gt;#110&lt;/a&gt; and &lt;a class="reference external" href="https://github.com/pyspeckit/pyspeckit/pull/111"&gt;#111&lt;/a&gt;, pyspeckit is now (apparently)
fully python3-compatible.  The test suite passes, but that's not a guarantee
that I've caught all bugs in the translation.&lt;/p&gt;
</content><category term="misc"></category><category term="pyspeckit"></category><category term="python 3"></category></entry><entry><title>Self-calibration of Sgr B2 Mosaic</title><link href="https://keflavich.github.io/blog/self-calibration-of-sgr-b2-mosaic.html" rel="alternate"></link><published>2015-10-14T14:30:00-06:00</published><updated>2015-10-14T14:30:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2015-10-14:/blog/self-calibration-of-sgr-b2-mosaic.html</id><summary type="html">&lt;p&gt;The Sgr B2 ALMA data from project 2013.1.00269.S has imaging problems around
the brightest sources, especially Sgr B2 M.
Crystal Brogan &amp;amp; Todd Hunter gave some useful advice, essentially the following:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;the line forest is causing trouble, so line-containing regions of the spectrum
must be excluded when mapping …&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;The Sgr B2 ALMA data from project 2013.1.00269.S has imaging problems around
the brightest sources, especially Sgr B2 M.
Crystal Brogan &amp;amp; Todd Hunter gave some useful advice, essentially the following:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;the line forest is causing trouble, so line-containing regions of the spectrum
must be excluded when mapping&lt;/li&gt;
&lt;li&gt;there is some nasty curvature in the spectral baseline that needs to be removed
probably by flagging out some of the data&lt;/li&gt;
&lt;li&gt;Self-calibration is needed to exceed a dynamic range ~100&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;Todd developed a &lt;cite&gt;fitcontinuum.py&lt;/cite&gt; script to address the first point, but I ended up
doing this custom (&lt;a class="reference external" href="https://github.com/keflavich/SgrB2_ALMA_3mm_Mosaic/blob/master/script_12m/test_split_spw1.py"&gt;script&lt;/a&gt;) because of the problem introduced by the second point.&lt;/p&gt;
&lt;p&gt;To exclude the lines, I had to use &lt;em&gt;frequency-based&lt;/em&gt; selection, not channel based, because my
spectral windows from different dates were offset by 10 MHz.  The approach to use in CASA is
ugly: you flag the line-containing data, then split (and in splitting, average) the continuum
into another MS.  From there, a phase-only selfcal is straigtforward (&lt;a class="reference external" href="https://github.com/keflavich/SgrB2_ALMA_3mm_Mosaic/blob/master/script_12m/selfcal_spw1_center.py"&gt;script&lt;/a&gt;).&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/sgrb2/selfcal_compare.png" style="width: 800px;" /&gt;
</content><category term="misc"></category><category term="CASA"></category><category term="ALMA"></category><category term="Sgr B2"></category></entry><entry><title>Sensitivity Plots using astroquery NRAO tool</title><link href="https://keflavich.github.io/blog/sensitivity-plots-using-astroquery-nrao-tool.html" rel="alternate"></link><published>2015-10-09T14:00:00-06:00</published><updated>2015-10-09T14:00:00-06:00</updated><author><name>Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2015-10-09:/blog/sensitivity-plots-using-astroquery-nrao-tool.html</id><summary type="html">&lt;p&gt;I wanted to see what the approximate depth achieved by (repeated)
VLA observations of a few sources was, at least theoretically.
This is relatively easy to do:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;units&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astroquery.nrao&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Nrao&lt;/span&gt;
&lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Nrao&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;coordinates&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;coordinates&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SkyCoord&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_name&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Sgr B2(M)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
                      &lt;span class="n"&gt;radius …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;I wanted to see what the approximate depth achieved by (repeated)
VLA observations of a few sources was, at least theoretically.
This is relatively easy to do:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astropy&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;units&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;u&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;astroquery.nrao&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Nrao&lt;/span&gt;
&lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Nrao&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;coordinates&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;coordinates&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SkyCoord&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;from_name&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Sgr B2(M)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
                      &lt;span class="n"&gt;radius&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;arcmin&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pylab&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pl&lt;/span&gt;

&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loglog&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Observing Freq&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;1e3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;TOS&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Observed Frequency (GHz)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Time-on-Source (s)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;figure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loglog&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Observing Freq&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;1e3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;TOS&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Bandwidth&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xlabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Observed Frequency (GHz)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pl&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ylabel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Relative depth (Hz s)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/TOS_vs_freq.png" style="width: 800px;" /&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/depth_vs_freq.png" style="width: 800px;" /&gt;
</content><category term="misc"></category><category term="radio"></category><category term="astropy"></category><category term="python"></category><category term="astroquery"></category></entry><entry><title>Export to FITS with MIRIAD</title><link href="https://keflavich.github.io/blog/export-to-fits-with-miriad.html" rel="alternate"></link><published>2015-09-15T15:30:00-06:00</published><updated>2015-09-15T15:30:00-06:00</updated><author><name>Adam Ginsburg (adam.g.ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2015-09-15:/blog/export-to-fits-with-miriad.html</id><content type="html">&lt;p&gt;To convert from MIRIAD map files to FITS, use:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
miriad% fits in=h2comos1.clr out=h2comos1.fits op=xyout
&lt;/pre&gt;
&lt;p&gt;(see &lt;a class="reference external" href="converting-gildas-class-data-cubes-lmv-files-to-fits.rst"&gt;the CLASS conversion post&lt;/a&gt;)&lt;/p&gt;
</content><category term="misc"></category></entry><entry><title>Position-Velocity Diagrams</title><link href="https://keflavich.github.io/blog/position-velocity-diagrams.html" rel="alternate"></link><published>2013-09-24T00:00:00-06:00</published><updated>2013-09-24T00:00:00-06:00</updated><author><name>Adam Ginsburg (adam.g.ginsburg@gmail.com)</name></author><id>tag:keflavich.github.io,2013-09-24:/blog/position-velocity-diagrams.html</id><summary type="html">&lt;p&gt;tl;dr version: IPython notebook &lt;a class="reference external" href="http://keflavich.github.io/pvextractor/examples/IRAS05358Slicing.html"&gt;here&lt;/a&gt;, code &lt;a class="reference external" href="http://keflavich.github.io/pvextractor/"&gt;available on github&lt;/a&gt;&lt;/p&gt;
&lt;div class="section" id="current-state-of-affairs"&gt;
&lt;h2&gt;Current state of affairs&lt;/h2&gt;
&lt;p&gt;Position-velocity diagrams with arbitrary position axes have been a common tool
for studying spectra for a long time, probably because the &amp;quot;native&amp;quot; format of
long-slit spectra on CCDs is effectively a position-velocity diagram.&lt;/p&gt;
&lt;p&gt;It's becoming more …&lt;/p&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;tl;dr version: IPython notebook &lt;a class="reference external" href="http://keflavich.github.io/pvextractor/examples/IRAS05358Slicing.html"&gt;here&lt;/a&gt;, code &lt;a class="reference external" href="http://keflavich.github.io/pvextractor/"&gt;available on github&lt;/a&gt;&lt;/p&gt;
&lt;div class="section" id="current-state-of-affairs"&gt;
&lt;h2&gt;Current state of affairs&lt;/h2&gt;
&lt;p&gt;Position-velocity diagrams with arbitrary position axes have been a common tool
for studying spectra for a long time, probably because the &amp;quot;native&amp;quot; format of
long-slit spectra on CCDs is effectively a position-velocity diagram.&lt;/p&gt;
&lt;p&gt;It's becoming more common now to have data cubes (PPV) than 1D or 2D spectra.
But PV diagrams still have utility.  Unfortunately, there aren't very good
tools to produce them.&lt;/p&gt;
&lt;p&gt;There are plenty of tools that can slice along any of the native axes of a data
cube.  If you take your data cube in RA/Dec space, extracting along lines of
constant RA or Dec is trivial (&lt;a class="reference external" href="http://star-www.dur.ac.uk/~pdraper/gaia/gaia.html"&gt;GAIA&lt;/a&gt; can do it natively, but it's easy to
slice a cube in IDL or python).&lt;/p&gt;
&lt;p&gt;However, if you wanted to slice along lines of constant GLON or GLAT, you'd
have to reproject the cube to use this approach.  There are nice tools that
implement cube rotation: CASA has an &lt;a class="reference external" href="http://star-www.dur.ac.uk/~pdraper/gaia/gaia.html"&gt;imrebin recipe&lt;/a&gt; and STARLINK has a
rotation tool (though I can't find it now...).&lt;/p&gt;
&lt;p&gt;However, this approach is terribly inefficient if you want slices at multiple
different angles, and it's outright awful if you want to track a filament.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="an-alternative-approach"&gt;
&lt;h2&gt;An alternative approach&lt;/h2&gt;
&lt;p&gt;The alternative is to interpolate between pixels along a specified axis.  This
can be done very efficiently in python using scipy's &lt;a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.interpolation.map_coordinates.html"&gt;map_coordinates&lt;/a&gt;, which
by default does a cubic-spline interpolation at the specified points.&lt;/p&gt;
&lt;p&gt;I've started to build a tool to extract position-velocity diagrams on this
basis.  It's fully functional, but doesn't do anything interactive just yet.
&lt;a class="reference external" href="https://github.com/keflavich/pvextractor"&gt;pvextractor&lt;/a&gt; is &lt;a class="reference external" href="http://keflavich.github.io/pvextractor/"&gt;available on github&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There is a complete example demonstrating its use &lt;a class="reference external" href="http://keflavich.github.io/pvextractor/examples/IRAS05358Slicing.html"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In short, though, it allows you to describe paths like this:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/paths_i05358.png" style="width: 800px;" /&gt;
&lt;p&gt;and extract them into position-velocity diagrams like this:&lt;/p&gt;
&lt;img alt="" src="https://keflavich.github.io/blog/images/pv_i05358.png" style="width: 800px;" /&gt;
&lt;/div&gt;
&lt;div class="section" id="postscript-figshare"&gt;
&lt;h2&gt;Postscript: Figshare&lt;/h2&gt;
&lt;p&gt;(note: postscript as in &amp;quot;P.S.&amp;quot;, not &amp;quot;.ps&amp;quot;)&lt;/p&gt;
&lt;p&gt;In order to create the example document (&lt;a class="reference external" href="http://keflavich.github.io/pvextractor/examples/IRAS05358Slicing.html"&gt;here&lt;/a&gt;), I needed a small data cube
that could easily be downloaded. &lt;a class="reference external" href="theastrodata.org"&gt;Dataverse&lt;/a&gt; hosts the &lt;a class="reference external" href="http://www.cfa.harvard.edu/COMPLETE/"&gt;COMPLETE&lt;/a&gt; survey, but
they make you jump through a javascript hoop to download their data, which
means that it is not possible to write an easily reproducible script.  Too bad,
since I would have used them except for this minor interface issue.&lt;/p&gt;
&lt;p&gt;Instead, I've found that &lt;a class="reference external" href="http://figshare.com"&gt;figshare&lt;/a&gt; has fixed up their interface since I last
used them.  It was easy enough that I decided to upload my &lt;a class="reference external" href="http://figshare.com/articles/IRAS_05358_3543_Data_Cubes/806315"&gt;IRAS 05358+3543
data cubes&lt;/a&gt; and had no trouble at all.  I also posted an update to the &lt;a class="reference external" href="http://arxiv.org/abs/0910.2990"&gt;arxiv&lt;/a&gt;
page for the article indictating that the data are freely shared.  I'll do my
best to share the data for the rest of my papers too, though it will take some
time and I'll hit data limits for W5 pretty quickly.&lt;/p&gt;
&lt;/div&gt;
</content><category term="misc"></category><category term="python"></category><category term="spectra"></category></entry></feed>