<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" type="text/css" href="https://keflavich.github.io/blog/theme/css/style.css" />
<link rel="icon" type="image/gif" href="https://keflavich.github.io/blog/theme/favicon8.ico">
<head>
    <base href="https://keflavich.github.io/blog">
        <title>Adam Ginsburg's blog - data reduction</title>
        <meta charset="utf-8" />
        <link href="https://keflavich.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Adam Ginsburg's blog Full Atom Feed" />
<!-- Using MathJax, with the delimiters $ -->
<!-- Conflict with pygments for the .mo and .mi -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
    styles: {
    ".MathJax .mo, .MathJax .mi": {color: "inherit !important"}},
    'div.typeset': { 'text-align': 'left'}
    },
    tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']],processEscapes: true}
    });
    TeX: {
        extensions: ["AMSmath.js", "AMSsymbols.js"]
    }
    MathJax.Hub.Register.StartupHook("HTML-CSS Jax Ready",function () {
    var VARIANT = MathJax.OutputJax["HTML-CSS"].FONTDATA.VARIANT;
    VARIANT["normal"].fonts.unshift("MathJax_SansSerif");
    VARIANT["bold"].fonts.unshift("MathJax_SansSerif-bold");
    VARIANT["italic"].fonts.unshift("MathJax_SansSerif-italic");
    VARIANT["-tex-mathit"].fonts.unshift("MathJax_SansSerif-italic");
    });
    MathJax.Hub.Register.StartupHook("SVG Jax Ready",function () {
    var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;
    VARIANT["normal"].fonts.unshift("MathJax_SansSerif");
    VARIANT["bold"].fonts.unshift("MathJax_SansSerif-bold");
    VARIANT["italic"].fonts.unshift("MathJax_SansSerif-italic");
    VARIANT["-tex-mathit"].fonts.unshift("MathJax_SansSerif-italic");
    });
</script>

<script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>
        
</head>

<body id="base" class="home">


    <header id="banner" class="body" >
        <div id="header" style='background-image: url("https://keflavich.github.io/blog/images/GC_4096sq_bolo.png"); background-position:left; min-heigt: 200px;  background-repeat: no-repeat; max-width: 80%;'>
            <h1 style="color: #C4C4C4;"><a class="header" href="https://keflavich.github.io/blog">Adam Ginsburg's blog <strong></strong></a></h1>

            <nav id="menu"><ul id="menulist">
                <li><a href="https://www.adamgginsburg.com">Homepage</a></li>
                <li><a href="/index.html">Blog Index</a></li>
                <li><a href="/category/bgps.html">BGPS Blog</a></li>
                <li><a href="/category/publications.html">Publications</a></li>
                <li><a href="/archives.html">Archives</a></li>
                <li><a href="/tags.html">Tags</a></li>
            </ul></nav><!-- /#menu -->
        </div>
    </header><!-- /#banner -->

  <div id="sidebar">
    <ul>
      <li>
        <h3 id='recent_header'>Recent Posts</h3>
        <ul>
              <li class="post">
                  2021/12/08
                  <br>
                  <a href="https://keflavich.github.io/blog/casa-errors-encountered-while-imaging-lb-data.html">CASA Errors encountered while imaging LB data</a>
              </li>
        </ul>
      </li>
    
    </ul>
  </div><!-- end #sidebar -->

  <div id="content">
<section id="content">

<ul id="post-list">
    <li><article class="hentry">
        <header> 
            <h2 class="entry-title">
                <a href="https://keflavich.github.io/blog/casa-errors-encountered-while-imaging-lb-data.html" rel="bookmark" title="Permalink to CASA Errors encountered while imaging LB data">
                    CASA Errors encountered while imaging LB data</a>
            </h2> 
        </header>
        <footer class="post-info">
            <abbr class="published" title="2021-12-08T09:37:00-07:00"> 2021/12/08 </abbr>
            <!--<address class="vcard author"><a class="url fn" href="https://keflavich.github.io/blog/author/adam-ginsburg-adamgginsburggmailcom.html">Adam Ginsburg (Adam.G.Ginsburg@gmail.com)</a></address>-->
        </footer><!-- /.post-info -->
        <div class="entry-content"> <p>I'm trying to reduce some new data from ALMA's longest baselines (C10, B6).</p>
<p>There are several exciting errors:</p>
<ol class="arabic simple">
<li>The lines were all flagged out.  Thankfully, there is a <tt class="docutils literal">calibrated_final.ms.backup</tt>
file that does not have the lines flagged out.  <tt class="docutils literal">flagmanager</tt> was unable to restore
the flags.  The flagging comes from the manual flagging done by the QA2 reducer,
which was used to make the continuum image.  That's fine, but the unflagging step
didn't work.  The uvcontsub data, as a result, contain no line data.  ?????</li>
<li>I can't image the full cube because of errors like this:</li>
</ol>
<div class="highlight"><pre><span></span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">34</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">defineImage</span>         <span class="n">Shape</span> <span class="p">:</span> <span class="p">[</span><span class="mi">9600</span><span class="p">,</span> <span class="mi">9600</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1920</span><span class="p">]</span><span class="n">Spectral</span> <span class="p">:</span> <span class="p">[</span><span class="mf">2.31563e+11</span><span class="p">]</span> <span class="n">at</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">with</span> <span class="n">increment</span> <span class="p">[</span><span class="mi">976510</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">34</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">defineImage</span>         <span class="n">Set</span> <span class="n">Gridding</span> <span class="n">options</span> <span class="k">for</span> <span class="p">[</span><span class="n">S255IR</span><span class="o">-</span><span class="n">SMA1_sci</span><span class="o">.</span><span class="n">spw1</span><span class="o">.</span><span class="n">cube</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">manual</span><span class="p">]</span> <span class="k">with</span> <span class="n">ftmachine</span> <span class="p">:</span> <span class="n">gridft</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">34</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">nSubCubeFitInMemory</span> <span class="n">Required</span> <span class="n">memory</span><span class="p">:</span> <span class="mf">5.468e+05</span> <span class="n">GB</span><span class="o">.</span> <span class="n">Available</span> <span class="n">mem</span><span class="o">.</span><span class="p">:</span> <span class="mf">166.3</span> <span class="n">GB</span> <span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">mem</span><span class="o">.</span> <span class="n">fraction</span><span class="p">:</span> <span class="mi">70</span><span class="o">%</span><span class="p">,</span> <span class="n">memory</span><span class="p">:</span> <span class="o">-</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">Subcubes</span><span class="p">:</span> <span class="mf">1920.</span> <span class="n">Processes</span> <span class="n">on</span> <span class="n">node</span><span class="p">:</span> <span class="mf">64.</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">34</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">weight</span><span class="p">()</span>    <span class="n">Set</span> <span class="n">imaging</span> <span class="n">weights</span> <span class="p">:</span> <span class="n">Briggs</span> <span class="n">weighting</span><span class="p">:</span> <span class="n">sidelobes</span> <span class="n">will</span> <span class="n">be</span> <span class="n">suppressed</span> <span class="n">over</span> <span class="n">full</span> <span class="n">image</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">34</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">weight</span><span class="p">()</span>    <span class="n">Doing</span> <span class="n">spectral</span> <span class="n">cube</span> <span class="n">Briggs</span> <span class="n">weighting</span> <span class="n">formula</span> <span class="o">--</span>  <span class="n">norm</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">34</span>     <span class="n">INFO</span>    <span class="n">task_tclean</span><span class="p">::</span><span class="n">SynthesisDeconvolver</span><span class="p">::</span><span class="n">setupDeconvolution</span>   <span class="n">Set</span> <span class="n">Deconvolution</span> <span class="n">Options</span> <span class="k">for</span> <span class="p">[</span><span class="n">S255IR</span><span class="o">-</span><span class="n">SMA1_sci</span><span class="o">.</span><span class="n">spw1</span><span class="o">.</span><span class="n">cube</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">manual</span><span class="p">]</span> <span class="p">:</span> <span class="n">hogbom</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">34</span>     <span class="n">WARN</span>    <span class="n">tclean</span><span class="p">::::</span><span class="n">casa</span>  <span class="n">Memory</span> <span class="n">available</span> <span class="mi">187904819</span> <span class="n">kB</span> <span class="ow">is</span> <span class="n">very</span> <span class="n">close</span> <span class="n">to</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">required</span> <span class="n">memory</span> <span class="mi">3982754512</span> <span class="n">kB</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">34</span>     <span class="n">INFO</span>    <span class="n">task_tclean</span><span class="p">::</span><span class="n">SynthesisImager</span><span class="p">::</span><span class="n">makePSF</span>   <span class="o">-----------------------------------------------------------</span> <span class="n">Make</span> <span class="n">PSF</span> <span class="o">---------------------------------------------</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">34</span>     <span class="n">INFO</span>    <span class="n">task_tclean</span><span class="p">::</span><span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">nSubCubeFitInMemory</span>    <span class="n">Required</span> <span class="n">memory</span><span class="p">:</span> <span class="mf">5.468e+05</span> <span class="n">GB</span><span class="o">.</span> <span class="n">Available</span> <span class="n">mem</span><span class="o">.</span><span class="p">:</span> <span class="mf">166.3</span> <span class="n">GB</span> <span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">mem</span><span class="o">.</span> <span class="n">fraction</span><span class="p">:</span> <span class="mi">70</span><span class="o">%</span><span class="p">,</span> <span class="n">memory</span><span class="p">:</span> <span class="o">-</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">Subcubes</span><span class="p">:</span> <span class="mf">1920.</span> <span class="n">Processes</span> <span class="n">on</span> <span class="n">node</span><span class="p">:</span> <span class="mf">64.</span>
</pre></div>
<p>Well, there's no error there, but the PSF maker can't handle making even a
single frame.  It had no trouble making a 9600x9600 MTMFS image for the
continuum, though, so it's pretty unclear to me why the cube is getting
OOM-killed.  My best guess is that the 64 processes are too much for CASA to
handle, and I need to run with fewer to &quot;trick&quot; it into not using up that much
memory at once.   Maybe I just need to make the PSFs in serial mode.  I don't
want to wait around to make the cubes, let alone clean them, in serial mode.</p>
<ol class="arabic simple" start="3">
<li>Parallel failed with this:</li>
</ol>
<div class="highlight"><pre><span></span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">14</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">19</span>     <span class="n">INFO</span>    <span class="n">tclean</span><span class="p">::::</span><span class="n">casa</span>  <span class="c1">##########################################</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">14</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">19</span>     <span class="n">INFO</span>    <span class="n">tclean</span><span class="p">::::</span><span class="n">casa</span>  <span class="c1">##### Begin Task: tclean             #####</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">14</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">19</span>     <span class="n">INFO</span>    <span class="n">tclean</span><span class="p">::::</span><span class="n">casa</span>  <span class="n">tclean</span><span class="p">(</span> <span class="n">vis</span><span class="o">=</span><span class="s1">&#39;calibrated_final.ms&#39;</span><span class="p">,</span> <span class="n">selectdata</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;S255IR-SMA1&#39;</span><span class="p">,</span> <span class="n">spw</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">timerange</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">uvrange</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">antenna</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">scan</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">observation</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">intent</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">datacolumn</span><span class="o">=</span><span class="s1">&#39;corrected&#39;</span><span class="p">,</span> <span class="n">imagename</span><span class="o">=</span><span class="s1">&#39;S255IR-SMA1_sci.spw1.cube.I.zoom.manual&#39;</span><span class="p">,</span> <span class="n">imsize</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span> <span class="n">cell</span><span class="o">=</span><span class="s1">&#39;0.0042arcsec&#39;</span><span class="p">,</span> <span class="n">phasecenter</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">stokes</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;SIN&#39;</span><span class="p">,</span> <span class="n">startmodel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">specmode</span><span class="o">=</span><span class="s1">&#39;cube&#39;</span><span class="p">,</span> <span class="n">reffreq</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">nchan</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">outframe</span><span class="o">=</span><span class="s1">&#39;lsrk&#39;</span><span class="p">,</span> <span class="n">veltype</span><span class="o">=</span><span class="s1">&#39;radio&#39;</span><span class="p">,</span> <span class="n">restfreq</span><span class="o">=</span><span class="p">[],</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">perchanweightdensity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gridder</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">,</span> <span class="n">facets</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">psfphasecenter</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">wprojplanes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vptable</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">mosweight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">aterm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">psterm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wbawp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">conjbeams</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cfcache</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">usepointing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">computepastep</span><span class="o">=</span><span class="mf">360.0</span><span class="p">,</span> <span class="n">rotatepastep</span><span class="o">=</span><span class="mf">360.0</span><span class="p">,</span> <span class="n">pointingoffsetsigdev</span><span class="o">=</span><span class="p">[],</span> <span class="n">pblimit</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">normtype</span><span class="o">=</span><span class="s1">&#39;flatnoise&#39;</span><span class="p">,</span> <span class="n">deconvolver</span><span class="o">=</span><span class="s1">&#39;hogbom&#39;</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="p">[],</span> <span class="n">nterms</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">smallscalebias</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">restoration</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">restoringbeam</span><span class="o">=</span><span class="p">[],</span> <span class="n">pbcor</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outlierfile</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">weighting</span><span class="o">=</span><span class="s1">&#39;briggs&#39;</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="s1">&#39;1.0Jy&#39;</span><span class="p">,</span> <span class="n">npixels</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">uvtaper</span><span class="o">=</span><span class="p">[],</span> <span class="n">niter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="s1">&#39;10mJy&#39;</span><span class="p">,</span> <span class="n">nsigma</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">cycleniter</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">cyclefactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minpsffraction</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">maxpsffraction</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">usemask</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">pbmask</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sidelobethreshold</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">noisethreshold</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">lownoisethreshold</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">negativethreshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">smoothfactor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minbeamfrac</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">cutthreshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">growiterations</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">dogrowprune</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">minpercentchange</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fastnoise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">restart</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">savemodel</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">calcres</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">calcpsf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">psfcutoff</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">14</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">19</span>     <span class="n">INFO</span>    <span class="n">tclean</span><span class="p">::::</span><span class="n">casa</span>  <span class="n">Verifying</span> <span class="n">Input</span> <span class="n">Parameters</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">14</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">19</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">selectData</span>  <span class="n">MS</span> <span class="p">:</span> <span class="n">calibrated_final</span><span class="o">.</span><span class="n">ms</span> <span class="o">|</span> <span class="n">Selecting</span> <span class="n">on</span> <span class="n">fields</span> <span class="p">:</span> <span class="n">S255IR</span><span class="o">-</span><span class="n">SMA1</span> <span class="o">|</span> <span class="n">Selecting</span> <span class="n">on</span> <span class="n">spw</span> <span class="p">:</span><span class="mi">1</span> <span class="o">|</span> <span class="p">[</span><span class="n">Opened</span> <span class="ow">in</span> <span class="n">readonly</span> <span class="n">mode</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">14</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">19</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">selectData</span>    <span class="n">NRows</span> <span class="n">selected</span> <span class="p">:</span> <span class="mi">0</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">14</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">19</span>     <span class="n">SEVERE</span>  <span class="n">tclean</span><span class="p">::::</span><span class="n">casa</span>  <span class="n">Task</span> <span class="n">tclean</span> <span class="n">raised</span> <span class="n">an</span> <span class="n">exception</span> <span class="n">of</span> <span class="k">class</span> <span class="nc">RuntimeError</span> <span class="k">with</span> <span class="n">the</span> <span class="n">following</span> <span class="n">message</span><span class="p">:</span> <span class="n">Parallel</span> <span class="n">transport</span> <span class="n">layer</span> <span class="ow">not</span> <span class="n">initialized</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">14</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">19</span>     <span class="n">INFO</span>    <span class="n">tclean</span><span class="p">::::</span><span class="n">casa</span>  <span class="n">Task</span> <span class="n">tclean</span> <span class="n">complete</span><span class="o">.</span> <span class="n">Start</span> <span class="n">time</span><span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">09</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mf">19.103483</span> <span class="n">End</span> <span class="n">time</span><span class="p">:</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">09</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mf">19.314353</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">14</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">19</span>     <span class="n">INFO</span>    <span class="n">tclean</span><span class="p">::::</span><span class="n">casa</span>  <span class="c1">##### End Task: tclean               #####</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">14</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">19</span>     <span class="n">INFO</span>    <span class="n">tclean</span><span class="p">::::</span><span class="n">casa</span>  <span class="c1">##########################################</span>
</pre></div>
<p>I'm guessing this is a bad error message and the real error is that the data
selection failed.  Probably when I copied over the <tt class="docutils literal">continuum_final.ms.backup</tt>
file, it uses the original numbering (spw 25, 27, etc.) instead of the new
numbering.  I guess the renumbering is cased by <tt class="docutils literal">uvcontsub</tt>, which I'm now
skipping because it may have broken my data and because I'd rather image the
continuum.  That proved correct; the error message above just means that I
selected a nonexistent SPW.</p>
<div class="section" id="flagged-out-lines">
<h2>Flagged Out Lines</h2>
<p>After re-copying over the calibrated MS and confirming that <cite>no</cite> lines were flagged out,
I re-imaged... and the lines are again missing.</p>
<div class="highlight"><pre><span></span><span class="c1"># show the flags graphically</span>
<span class="n">flagdata</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="s1">&#39;calibrated_final.ms&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="n">spwchan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
</pre></div>
<img alt="Flag data plot showing evidence of the flagged-out lines" src="https://keflavich.github.io/blog/images/flagdataplot.png" style="width: 600px;" />
<p>The flags are coming from tclean, which makes no sense.</p>
<p>There are messages like these:</p>
<pre class="literal-block">
2021-12-08 15:27:19     WARN    MPICommandServer::command_request_handler_service::SIImageStore::getPSFGaussian::MPIServer-51 (file src/code/synthesis/ImagerObjects/SIImageStore.cc, line 2037)        PSF is blank for[C9:P0] [C10:P0] [C11:P0] [C12:P0] [C13:P0] [C14:P0] [C15:P0] [C16:P0] [C17:P0] [C23:P0] [C24:P0] [C25:P0] [C26:P0]
</pre>
<p>scattered throughout the PSF making.</p>
<p>The PSF spectrum ends up like this:</p>
<img alt="PSF vs frequency showing flagged out channels" src="https://keflavich.github.io/blog/images/PSF_vs_Frq.png" style="width: 600px;" />
<p>Channels are totally flagged out.  But in the data, they are not:</p>
<img alt="The data not flagged out" src="https://keflavich.github.io/blog/images/notflagged_data.png" style="width: 600px;" />
<p>Running the <tt class="docutils literal">tclean</tt> without parallel, i.e. with <tt class="docutils literal">parallel=False</tt>, resulted
in a smooth, unbroken PSF.</p>
<p>So, if we dig back into what happened in the parallel tclean....</p>
<div class="highlight"><pre><span></span><span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">12</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">selectData</span>    <span class="n">NRows</span> <span class="n">selected</span> <span class="p">:</span> <span class="mi">848700</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">15</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">defineImage</span>         <span class="n">Define</span> <span class="n">image</span> <span class="n">coordinates</span> <span class="k">for</span> <span class="p">[</span><span class="n">S255IR</span><span class="o">-</span><span class="n">SMA1_sci</span><span class="o">.</span><span class="n">spw0</span><span class="o">.</span><span class="n">cube</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">zoom</span><span class="o">.</span><span class="n">manual</span><span class="p">]</span> <span class="p">:</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">MSTransformRegridder</span><span class="p">::</span><span class="n">calcChanFreqs</span>      <span class="n">phaseCenter</span><span class="o">=</span><span class="s1">&#39;Direction: [-0.0535075, 0.949606, 0.308847]&#39;</span>  <span class="n">Channels</span> <span class="n">equidistant</span> <span class="ow">in</span> <span class="n">freq</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">MSTransformRegridder</span><span class="p">::</span><span class="n">calcChanFreqs</span><span class="o">+</span>     <span class="n">Central</span> <span class="n">frequency</span> <span class="p">(</span><span class="ow">in</span> <span class="n">output</span> <span class="n">frame</span><span class="p">)</span> <span class="o">=</span> <span class="mf">2.345e+11</span> <span class="n">Hz</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">MSTransformRegridder</span><span class="p">::</span><span class="n">calcChanFreqs</span><span class="o">+</span>     <span class="n">Width</span> <span class="n">of</span> <span class="n">central</span> <span class="n">channel</span> <span class="p">(</span><span class="ow">in</span> <span class="n">output</span> <span class="n">frame</span><span class="p">)</span> <span class="o">=</span> <span class="mi">976510</span> <span class="n">Hz</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">MSTransformRegridder</span><span class="p">::</span><span class="n">calcChanFreqs</span><span class="o">+</span>     <span class="n">Number</span> <span class="n">of</span> <span class="n">channels</span> <span class="o">=</span> <span class="mi">1920</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">MSTransformRegridder</span><span class="p">::</span><span class="n">calcChanFreqs</span><span class="o">+</span>     <span class="n">Total</span> <span class="n">width</span> <span class="n">of</span> <span class="n">SPW</span> <span class="p">(</span><span class="ow">in</span> <span class="n">output</span> <span class="n">frame</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.8749e+09</span> <span class="n">Hz</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">MSTransformRegridder</span><span class="p">::</span><span class="n">calcChanFreqs</span><span class="o">+</span>     <span class="n">Lower</span> <span class="n">edge</span> <span class="o">=</span> <span class="mf">2.33563e+11</span> <span class="n">Hz</span><span class="p">,</span> <span class="n">upper</span> <span class="n">edge</span> <span class="o">=</span> <span class="mf">2.35437e+11</span> <span class="n">Hz</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">defineImage</span>         <span class="n">Impars</span> <span class="p">:</span> <span class="n">start</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">defineImage</span>         <span class="n">Shape</span> <span class="p">:</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1920</span><span class="p">]</span><span class="n">Spectral</span> <span class="p">:</span> <span class="p">[</span><span class="mf">2.33563e+11</span><span class="p">]</span> <span class="n">at</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">with</span> <span class="n">increment</span> <span class="p">[</span><span class="mi">976510</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">defineImage</span>         <span class="n">Set</span> <span class="n">Gridding</span> <span class="n">options</span> <span class="k">for</span> <span class="p">[</span><span class="n">S255IR</span><span class="o">-</span><span class="n">SMA1_sci</span><span class="o">.</span><span class="n">spw0</span><span class="o">.</span><span class="n">cube</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">zoom</span><span class="o">.</span><span class="n">manual</span><span class="p">]</span> <span class="k">with</span> <span class="n">ftmachine</span> <span class="p">:</span> <span class="n">gridft</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">nSubCubeFitInMemory</span> <span class="n">Required</span> <span class="n">memory</span><span class="p">:</span> <span class="mi">1483</span> <span class="n">GB</span><span class="o">.</span> <span class="n">Available</span> <span class="n">mem</span><span class="o">.</span><span class="p">:</span> <span class="mf">173.6</span> <span class="n">GB</span> <span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">mem</span><span class="o">.</span> <span class="n">fraction</span><span class="p">:</span> <span class="mi">70</span><span class="o">%</span><span class="p">,</span> <span class="n">memory</span><span class="p">:</span> <span class="o">-</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">Subcubes</span><span class="p">:</span> <span class="mf">9.</span> <span class="n">Processes</span> <span class="n">on</span> <span class="n">node</span><span class="p">:</span> <span class="mf">64.</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">weight</span><span class="p">()</span>    <span class="n">Set</span> <span class="n">imaging</span> <span class="n">weights</span> <span class="p">:</span> <span class="n">Briggs</span> <span class="n">weighting</span><span class="p">:</span> <span class="n">sidelobes</span> <span class="n">will</span> <span class="n">be</span> <span class="n">suppressed</span> <span class="n">over</span> <span class="n">full</span> <span class="n">image</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">weight</span><span class="p">()</span>    <span class="n">Doing</span> <span class="n">spectral</span> <span class="n">cube</span> <span class="n">Briggs</span> <span class="n">weighting</span> <span class="n">formula</span> <span class="o">--</span>  <span class="n">norm</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">16</span>     <span class="n">INFO</span>    <span class="n">task_tclean</span><span class="p">::</span><span class="n">SynthesisDeconvolver</span><span class="p">::</span><span class="n">setupDeconvolution</span>   <span class="n">Set</span> <span class="n">Deconvolution</span> <span class="n">Options</span> <span class="k">for</span> <span class="p">[</span><span class="n">S255IR</span><span class="o">-</span><span class="n">SMA1_sci</span><span class="o">.</span><span class="n">spw0</span><span class="o">.</span><span class="n">cube</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">zoom</span><span class="o">.</span><span class="n">manual</span><span class="p">]</span> <span class="p">:</span> <span class="n">hogbom</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mi">17</span>     <span class="n">INFO</span>    <span class="n">task_tclean</span><span class="p">::</span><span class="n">SynthesisImager</span><span class="p">::</span><span class="n">makePSF</span>   <span class="o">-----------------------------------------------------------</span> <span class="n">Make</span> <span class="n">PSF</span> <span class="o">---------------------------------------------</span>

<span class="o">...</span> <span class="n">a</span> <span class="n">bunch</span> <span class="n">of</span> <span class="n">stuff</span> <span class="o">...</span>

<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">11</span>     <span class="n">INFO</span>    <span class="n">MPICommandServer</span><span class="p">::</span><span class="n">command_request_handler_service</span><span class="p">::</span><span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">makePrimaryBeam</span><span class="p">::</span><span class="n">MPIServer</span><span class="o">-</span><span class="mi">54</span>    <span class="n">vi2</span> <span class="p">:</span> <span class="n">Evaluating</span> <span class="n">Primary</span> <span class="n">Beam</span> <span class="n">model</span> <span class="n">onto</span> <span class="n">image</span> <span class="n">grid</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">12</span>     <span class="n">INFO</span>    <span class="n">MPICommandServer</span><span class="p">::</span><span class="n">command_request_handler_service</span><span class="p">::</span><span class="n">SynthesisImagerVi2</span><span class="p">::</span><span class="n">makePrimaryBeam</span><span class="p">::</span><span class="n">MPIServer</span><span class="o">-</span><span class="mi">38</span>    <span class="n">vi2</span> <span class="p">:</span> <span class="n">Evaluating</span> <span class="n">Primary</span> <span class="n">Beam</span> <span class="n">model</span> <span class="n">onto</span> <span class="n">image</span> <span class="n">grid</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">13</span>     <span class="n">INFO</span>    <span class="n">MPICommandServer</span><span class="p">::</span><span class="n">command_request_handler_service</span><span class="p">::</span><span class="n">SIImageStore</span><span class="p">::</span><span class="n">calcSensitivity</span><span class="p">::</span><span class="n">MPIServer</span><span class="o">-</span><span class="mi">54</span>  <span class="p">[</span><span class="n">S255IR</span><span class="o">-</span><span class="n">SMA1_sci</span><span class="o">.</span><span class="n">spw0</span><span class="o">.</span><span class="n">cube</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">zoom</span><span class="o">.</span><span class="n">manual</span><span class="p">]</span> <span class="n">Theoretical</span> <span class="n">sensitivity</span> <span class="p">(</span><span class="n">Jy</span><span class="o">/</span><span class="n">bm</span><span class="p">):</span><span class="n">c0</span><span class="p">:</span><span class="n">none</span> <span class="n">c1</span><span class="p">:</span><span class="n">none</span> <span class="n">c2</span><span class="p">:</span><span class="n">none</span> <span class="n">c3</span><span class="p">:</span><span class="n">none</span> <span class="n">c4</span><span class="p">:</span><span class="n">none</span> <span class="n">c5</span><span class="p">:</span><span class="n">none</span> <span class="n">c6</span><span class="p">:</span><span class="n">none</span> <span class="n">c7</span><span class="p">:</span><span class="n">none</span> <span class="n">c8</span><span class="p">:</span><span class="n">none</span> <span class="n">c9</span><span class="p">:</span><span class="n">none</span> <span class="n">c10</span><span class="p">:</span><span class="n">none</span> <span class="n">c11</span><span class="p">:</span><span class="n">none</span> <span class="n">c12</span><span class="p">:</span><span class="n">none</span> <span class="n">c13</span><span class="p">:</span><span class="mf">0.00121258</span> <span class="n">c14</span><span class="p">:</span><span class="mf">0.00121257</span> <span class="n">c15</span><span class="p">:</span><span class="mf">0.00121255</span> <span class="n">c16</span><span class="p">:</span><span class="n">none</span> <span class="n">c17</span><span class="p">:</span><span class="n">none</span> <span class="n">c18</span><span class="p">:</span><span class="n">none</span> <span class="n">c19</span><span class="p">:</span><span class="n">none</span> <span class="n">c20</span><span class="p">:</span><span class="n">none</span> <span class="n">c21</span><span class="p">:</span><span class="n">none</span> <span class="n">c22</span><span class="p">:</span><span class="n">none</span> <span class="n">c23</span><span class="p">:</span><span class="n">none</span> <span class="n">c24</span><span class="p">:</span><span class="n">none</span> <span class="n">c25</span><span class="p">:</span><span class="n">none</span> <span class="n">c26</span><span class="p">:</span><span class="mf">0.00121253</span> <span class="n">c27</span><span class="p">:</span><span class="mf">0.00121253</span> <span class="n">c28</span><span class="p">:</span><span class="mf">0.00121252</span> <span class="n">c29</span><span class="p">:</span><span class="mf">0.00121251</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">13</span>     <span class="n">WARN</span>    <span class="n">MPICommandServer</span><span class="p">::</span><span class="n">command_request_handler_service</span><span class="p">::</span><span class="n">SIImageStore</span><span class="p">::</span><span class="n">getPSFGaussian</span><span class="p">::</span><span class="n">MPIServer</span><span class="o">-</span><span class="mi">54</span> <span class="p">(</span><span class="n">file</span> <span class="n">src</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">synthesis</span><span class="o">/</span><span class="n">ImagerObjects</span><span class="o">/</span><span class="n">SIImageStore</span><span class="o">.</span><span class="n">cc</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2037</span><span class="p">)</span>        <span class="n">PSF</span> <span class="ow">is</span> <span class="n">blank</span> <span class="k">for</span><span class="p">[</span><span class="n">C0</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C1</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C2</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C3</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C4</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C5</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C6</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C7</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C8</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C9</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C10</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C11</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C12</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C16</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C17</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C18</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C19</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C20</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C21</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C22</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C23</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C24</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span> <span class="p">[</span><span class="n">C25</span><span class="p">:</span><span class="n">P0</span><span class="p">]</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">13</span>     <span class="n">INFO</span>    <span class="n">MPICommandServer</span><span class="p">::</span><span class="n">command_request_handler_service</span><span class="p">::</span><span class="n">SIImageStore</span><span class="p">::</span><span class="n">getPSFGaussian</span><span class="p">::</span><span class="n">MPIServer</span><span class="o">-</span><span class="mi">54</span>   <span class="n">Time</span> <span class="n">to</span> <span class="n">fit</span> <span class="n">Gaussian</span> <span class="n">to</span> <span class="n">PSF</span> <span class="mf">0.12</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">13</span>     <span class="n">INFO</span>    <span class="n">MPICommandServer</span><span class="p">::</span><span class="n">command_request_handler_service</span><span class="p">::</span><span class="n">SIImageStore</span><span class="p">::</span><span class="n">printBeamSet</span><span class="p">::</span><span class="n">MPIServer</span><span class="o">-</span><span class="mi">54</span>     <span class="n">Restoring</span> <span class="n">Beams</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">13</span>     <span class="n">INFO</span>    <span class="n">MPICommandServer</span><span class="p">::</span><span class="n">command_request_handler_service</span><span class="p">::</span><span class="n">SIImageStore</span><span class="p">::</span><span class="n">printBeamSet</span><span class="p">::</span><span class="n">MPIServer</span><span class="o">-</span><span class="mi">54</span> <span class="o">+</span>   <span class="n">Pol</span>   <span class="n">Type</span> <span class="n">Chan</span>         <span class="n">Freq</span>     <span class="n">Vel</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">13</span>     <span class="n">INFO</span>    <span class="n">MPICommandServer</span><span class="p">::</span><span class="n">command_request_handler_service</span><span class="p">::</span><span class="n">SIImageStore</span><span class="p">::</span><span class="n">printBeamSet</span><span class="p">::</span><span class="n">MPIServer</span><span class="o">-</span><span class="mi">54</span> <span class="o">+</span>     <span class="n">I</span>    <span class="n">Max</span>    <span class="mi">0</span> <span class="mf">2.351450e+11</span> <span class="o">-</span><span class="mf">824.59</span>    <span class="mf">0.0254</span> <span class="n">arcsec</span> <span class="n">x</span>    <span class="mf">0.0197</span> <span class="n">arcsec</span> <span class="n">pa</span><span class="o">=</span> <span class="o">-</span><span class="mf">6.8506</span> <span class="n">deg</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">13</span>     <span class="n">INFO</span>    <span class="n">MPICommandServer</span><span class="p">::</span><span class="n">command_request_handler_service</span><span class="p">::</span><span class="n">SIImageStore</span><span class="p">::</span><span class="n">printBeamSet</span><span class="p">::</span><span class="n">MPIServer</span><span class="o">-</span><span class="mi">54</span> <span class="o">+</span>     <span class="n">I</span>    <span class="n">Min</span>    <span class="mi">1</span> <span class="mf">2.351460e+11</span> <span class="o">-</span><span class="mf">825.84</span>    <span class="mf">0.0000</span> <span class="n">arcsec</span> <span class="n">x</span>    <span class="mf">0.0000</span> <span class="n">arcsec</span> <span class="n">pa</span><span class="o">=</span>  <span class="mf">0.0000</span> <span class="n">deg</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">08</span> <span class="mi">15</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">13</span>     <span class="n">INFO</span>    <span class="n">MPICommandServer</span><span class="p">::</span><span class="n">command_request_handler_service</span><span class="p">::</span><span class="n">SIImageStore</span><span class="p">::</span><span class="n">printBeamSet</span><span class="p">::</span><span class="n">MPIServer</span><span class="o">-</span><span class="mi">54</span> <span class="o">+</span>     <span class="n">I</span> <span class="n">Median</span>    <span class="mi">9</span> <span class="mf">2.351538e+11</span> <span class="o">-</span><span class="mf">835.82</span>    <span class="mf">0.0254</span> <span class="n">arcsec</span> <span class="n">x</span>    <span class="mf">0.0197</span> <span class="n">arcsec</span> <span class="n">pa</span><span class="o">=</span> <span class="o">-</span><span class="mf">6.8506</span> <span class="n">deg</span>
</pre></div>
<p>These blank psfs are <cite>wrong</cite>, there are no flagged data in this data set (no flagged channels).
Something about the parallel version of clean is reading the data wrong.</p>
<div class="section" id="solution">
<h3>Solution</h3>
<p>I finally solved this by manually unflagging the channels.  Thanks to Brian
Svoboda for helping with the antenna selection syntax.</p>
<div class="highlight"><pre><span></span><span class="n">flagdata</span><span class="p">(</span><span class="n">linevis</span><span class="p">,</span> <span class="n">spw</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">orig_spw</span><span class="p">),</span> <span class="n">antenna</span><span class="o">=</span><span class="s1">&#39;*&amp;*&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;unflag&#39;</span><span class="p">)</span>
</pre></div>
<p>I don't understand why flagdata was showing the channels as being unflagged,
as they were clearly flagged in all data sets (original &amp; backup).
I don't understand _when_ they were flagged, either, as it seems they were
flagged even before continuum imaging was done.</p>
</div>
</div>
 </div>
        <!-- /.entry-content   not article.summary--> 
    </article></li>
    <hr width=100%>
</ul><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
</section><!-- /#content -->
  </div>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37306139-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37306139-1');
    ga('send', 'pageview');
</script>
<script type="text/javascript">
  var disqus_shortname = 'adamginsburgsblog';
  (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();
</script>
</body>
</html>
