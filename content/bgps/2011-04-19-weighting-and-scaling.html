---
layout: post
title: "Weighting and Scaling"
date: 2011-04-19T17:51:00-07:00
categories:
 - weighting
 - calibration
 - pipeline
---

<div class='post'>
The "simple" relative sensitivity calibration was causing serious problems.<br /><br />The assumed model for a "gain" $G$, timestream $S$, and reference timestream $R$ is:<br />$S = G R$<br /><br />Naively, one would assume that something like<br />$G = median(S/R)$<br />would work.  However, it doesn't.  The distribution of $G$ values looks like:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-A3u4lJpkgtM/Ta4jA5BIwiI/AAAAAAAAGH4/fRg_ExqMVHw/s1600/GainValues_Simple.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="194" width="320" src="http://4.bp.blogspot.com/-A3u4lJpkgtM/Ta4jA5BIwiI/AAAAAAAAGH4/fRg_ExqMVHw/s320/GainValues_Simple.png" /></a></div><br /><br /><br />Note that this is true <b> no matter what reference bolometer you use </b>.  I've monte-carlo tested this and shown that the ratio $S/R&lt;1$ for all bolometers.  This is actually a well-understood phenomenon if you look at, e.g., Wall and Jenkins section on linear least squares.  If both X and Y values are gaussian-distributed quantities, the linear-least-squares solution is not ideal.  Similarly, but more confusing to me, is that the min($\chi^2$) is not a correct solution either, probably because you're minimizing with respect to only one variable.<br /><br />The solution is Principal Component Analysis.  The most correlated component is pretty much the atmosphere (not exactly, but we'll deal with that later).  The important thing is that the first row of the eigenvectors gives the relative scaling of each timestream to that most correlated component.  Actually the meaning has to be more carefully defined than that, but I can't figure it out right now.  However, it looks like the relative scales come out as expected if you scale to a bolometer based on the first row (column?) of eigenvectors corresponding to the most correlated component.<br /><br />Using PCA and the correct scaling, the results are very pretty, i.e. perfect recovery:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-W7O1lULkZFo/Ta4qYfOn66I/AAAAAAAAGIA/eB-08uNfG-4/s1600/Gains_PCA.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="194" width="320" src="http://1.bp.blogspot.com/-W7O1lULkZFo/Ta4qYfOn66I/AAAAAAAAGIA/eB-08uNfG-4/s320/Gains_PCA.png" /></a></div><br />So... now on to the tests of everything ever...</div>
