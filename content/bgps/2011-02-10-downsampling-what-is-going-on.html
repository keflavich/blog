---
layout: post
title: "Downsampling - what is going on?"
date: 2011-02-10T20:19:00-08:00
categories:
 - pipeline
---

<div class='post'>
The downsampling failure I <a href="http://bolocam.blogspot.com/2011/01/downsampling-has-serious-negative.html">noted</a> <a href="http://bolocam.blogspot.com/2011/01/more-evidence-that-downsampling-causes.html">previously</a> appears to be illusory.  It may be that the offset noted only holds for single-frame images, in which there may be many blank pixels.  It is possible - though not certain - that the ds1 images were significantly higher than ds5 because more noise-only pixels were included with higher outliers; i.e., ds1 high-outlier noise was being compared to ds5 noise that was lower amplitude. <br /><br />What led to these conclusions?  First, I was getting inconsistent results looking at Uranus in particular - ds5 appeared to have higher fluxes than ds1.  This was inconsistent with <a href="http://bolocam.blogspot.com/2011/01/downsampling-has-serious-negative.html">earlier results</a> on OMC1.  Partly, this is because I switched from my <a href="http://4.bp.blogspot.com/_lsgW26mWZnU/TTiWWl3j3dI/AAAAAAAAF3I/Ef3WHEv5oXU/s1600/omc1_dstest_pixel-pixel.png">hacked-together plots</a> to the much more refined <a href="http://code.google.com/p/bgpspipeline/source/browse/bgps_pipeline/plotting/compare_images.py">compare_images</a> script, which demonstrated the effect of changing the cutoff of the comparison.<br /><br />Also, I added in a Pearson Correlation Coefficient computation.  Given a single data set with the only difference being downsampling, the data should be perfectly correlated even if there is a flux offset (correlation should be 1, but the best fit slope should not be).  It was an indication of a problem when I started seeing correlation coefficients &lt;0.90 for data that had already been sigma-cut; that means that noise was being included in the correlation computations.<br /><br />Therefore, the approach needed is to cut out the high pixels that are on map edges.  This I accomplished by adding an 'aperture' capability to the compare_images code (for Uranus) and cropping using montage and a wcs-based box for Orion.<br /><br />The results... are ambiguous.  Wow.  In some sub-fields - within the same co-added map - the agreement is near-perfect.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-i20j3FEx758/TVR-PbQl7lI/AAAAAAAAGAY/imgMqceS9n8/s1600/v2.0_dl_omc_b_OMC4_ds1ds5_compare.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-i20j3FEx758/TVR-PbQl7lI/AAAAAAAAGAY/imgMqceS9n8/s1600/v2.0_dl_omc_b_OMC4_ds1ds5_compare.png" width="800" /></a></div>In others, ds1 is clearly &gt; ds5 .  <br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-JsRH_ZQilWM/TVR-Os6vBSI/AAAAAAAAGAQ/JRR6Trm-weo/s1600/v2.0_dl_omc_b_OMC2_ds1ds5_compare.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-JsRH_ZQilWM/TVR-Os6vBSI/AAAAAAAAGAQ/JRR6Trm-weo/s1600/v2.0_dl_omc_b_OMC2_ds1ds5_compare.png" width="800" /></a></div>What's going on?  ds1 does look uniformly more smooth.<br /><br />Note that the <i>disagreement</i> is nearly scale-free:<a href="http://2.bp.blogspot.com/-J1XXZki2sxU/TVSXhlmGZKI/AAAAAAAAGAg/aDyQ7Sz2CfM/s1600/v2.0_dl_omc_b_OMC2_ds1ds5_psd_compare.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="320" src="http://2.bp.blogspot.com/-J1XXZki2sxU/TVSXhlmGZKI/AAAAAAAAGAg/aDyQ7Sz2CfM/s320/v2.0_dl_omc_b_OMC2_ds1ds5_psd_compare.png" width="320" /></a><br /><br /><br />OK, so given the conclusion in Orion that ds1>=ds5, what's the deal with Uranus?<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-AosJ1vzcYSs/TVSZjIZ81fI/AAAAAAAAGAk/qVGeaJtkbPA/s1600/101208_o10_ds1ds5_compare.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="320" width="320" src="http://3.bp.blogspot.com/-AosJ1vzcYSs/TVSZjIZ81fI/AAAAAAAAGAk/qVGeaJtkbPA/s320/101208_o10_ds1ds5_compare.png" /></a></div><br />The first two comparisons are for 1x1&deg; observations; in both cases ds1 &lt; ds5, but by 6% and 24% respectively!  The image of Uranus looks much better (because of lack of parallel lines) in the second, more extreme case.  In both cases, the ds5 excess is nearly scale-free (not shown).<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/_lsgW26mWZnU/TVSZki9k9OI/AAAAAAAAGA0/t9LOGHOAL7Q/s1600/101208_o10_ds1ds5_compare.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="320" width="320" src="http://1.bp.blogspot.com/_lsgW26mWZnU/TVSZki9k9OI/AAAAAAAAGA0/t9LOGHOAL7Q/s320/101208_o10_ds1ds5_compare.png" /></a></div><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_lsgW26mWZnU/TVSZj1pglLI/AAAAAAAAGAs/-4153NoAQQ0/s1600/101208_o11_ds1ds5_compare.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="320" width="320" src="http://2.bp.blogspot.com/_lsgW26mWZnU/TVSZj1pglLI/AAAAAAAAGAs/-4153NoAQQ0/s320/101208_o11_ds1ds5_compare.png" /></a></div><br />The 3x1s are also highly discrepant.  #12 shows nearly perfect agreement, albeit with high dispersion (low correlation) because of pixel-to-pixel variations around the peak.  #13 is the only observation with a huge DS1 excess.  It also demonstrates very poor correlation.  It looks like the telescope got bumped for the ds5 data (which is not actually possible; recall they're the same data set).  What happened here?  Maybe a glitch that went unflagged (mad_flagger is off by default for individual scans)?<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-9gwzGfDBCEk/TVSZllWeBxI/AAAAAAAAGA8/x3mg5RbMScs/s1600/101208_o12_ds1ds5_compare.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="320" width="320" src="http://3.bp.blogspot.com/-9gwzGfDBCEk/TVSZllWeBxI/AAAAAAAAGA8/x3mg5RbMScs/s320/101208_o12_ds1ds5_compare.png" title="101208 Observation 12"/></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-9gwzGfDBCEk/TVSZllWeBxI/AAAAAAAAGA8/x3mg5RbMScs/s1600/101208_o13_ds1ds5_compare.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="320" width="320" src="http://3.bp.blogspot.com/-9gwzGfDBCEk/TVSZllWeBxI/AAAAAAAAGA8/x3mg5RbMScs/s320/101208_o13_ds1ds5_compare.png" title="101208 Observation 13"/></a></div><br /><br />In observations 4 and 5, we're looking at a 40-50% excess in ds5!  What the heck?  There really is no clear explanation for this.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/_lsgW26mWZnU/TVSaYfZx0WI/AAAAAAAAGBE/cWbbBQCJOvk/s1600/101208_ob4_ds1ds5_compare.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="320" width="320" src="http://1.bp.blogspot.com/_lsgW26mWZnU/TVSaYfZx0WI/AAAAAAAAGBE/cWbbBQCJOvk/s320/101208_ob4_ds1ds5_compare.png" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_lsgW26mWZnU/TVSaZM27sqI/AAAAAAAAGBM/XR-6pttUcBo/s1600/101208_ob5_ds1ds5_compare.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="320" width="320" src="http://2.bp.blogspot.com/_lsgW26mWZnU/TVSaZM27sqI/AAAAAAAAGBM/XR-6pttUcBo/s320/101208_ob5_ds1ds5_compare.png" /></a></div><br />But... what?  Magically, they come into perfect agreement when the scan axis nearly lines up with the coordinate axis!  Or, is this just an effect of the worse weather on night 2?<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_lsgW26mWZnU/TVSaaP6ISNI/AAAAAAAAGBU/PvN5aFOxBAQ/s1600/101209_ob5_ds1ds5_compare.png" imageanchor="1" style="margin-left:1em; margin-right:1em"><img border="0" height="320" width="320" src="http://3.bp.blogspot.com/_lsgW26mWZnU/TVSaaP6ISNI/AAAAAAAAGBU/PvN5aFOxBAQ/s320/101209_ob5_ds1ds5_compare.png" /></a></div><br />Next thing to try: masked source map comparison.  Unfortunately, masking royally screwed up the long scans - probably because the initial polysub didn't work.  And masking in the individual point source maps did nothing... so that pretty much rules out atmospheric oversubtraction, doesn't it?<br /><br />What else could be causing this offset?  0pca looks the same as 13pca, give or take, so it's not the atmospheric subtraction.  Could the downsampling result in an offset in the bolo-scaling?  Where else in the process could things go wrong?  Tomorrow, need to investigate .sav files with pyflagger...</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Adam</div>
<div class='content'>
From a comparison of 3 different epochs using about a dozen different reduction techniques, but all with pairs of cross-scans, ds1 is uniformly higher than ds5.<br /><br />The only thing left to do is compare the individual scans, I suppose... if the cross-scans behave differently, that explains the difference between 2010 and other epochs</div>
</div>
</div>
