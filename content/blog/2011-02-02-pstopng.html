---
layout: post
title: "pstopng"
date: 2011-02-02T07:40:00-08:00
categories:
 - postscript
---

<div class='post'>
Following  <a href="http://studio.imagemagick.org/discourse-server/viewtopic.php?f=1&t=8545&start=0">this thread</a> and my need to convert IDL .ps files to .pngs so that I can view them in Mac Preview without having to go through an (often failed) conversion process led to a few discoveries.<br /><br />First, it is challenging to get ImageMagick's convert to make an opaque background for the .ps file without seriously degrading the resolution.  This can be accomplished by passing <i>both</i> the <code>-alpha Off</code> and the <code> -density 300</code> simultaneously.  This is slow, though, and recommendations to speed it up using the <code>-limit area 4096 -limit memory 4096</code> tags actually made it slower!<br /><br />However, the thread pointed out that ghostscript can do the conversion directly:<br /><code>gs -dBATCH -sDEVICE=png16m -r300 -dEPSCrop -dNOPAUSE -sOutputFile=XXX.png XXX.ps</code><br /><br /><code>-sDEVICE</code> sets the output to png, <code>-r300</code> tag sets the density to be 300 pixels/inch, <code>-dEPSCrop</code> is necessary to get the right sized image out (otherwise it defaults to a portrait 8.5x11), and <code> -dBATCH </code> prevents the gs command line from activating after the command is executed.  I'm not sure if <code>-dNOPAUSE</code> is necessary, but apparently if you don't activate it you have to do something after every page is processed.<br /><br />My code to do batch ps-to-png conversion is available at <a href="http://code.google.com/p/agpy/source/browse/trunk/agpy/pstopng">http://code.google.com/p/agpy/source/browse/trunk/agpy/pstopng</a>.<br /><br />Timing demonstrations (units are seconds, R is 'real' or clock time, 'U' is user time, and 'S' is system time):<br /><code><br />/usr/local/bin/convert -density 300 -alpha Off deline_zero_10hz_timestreams_003.ps deline_zero_10hz_timestreams_003.png <br />TIMING: R: 3.126  U: 2.948  S: 0.084<br />/usr/local/bin/convert -limit area 4096 -limit memory 4096 -density 300 -alpha Off deline_zero_10hz_timestreams_003.ps deline_zero_10hz_timestreams_003.png <br />TIMING: R: 3.800  U: 2.970  S: 0.161<br />gs -dBATCH -sDEVICE=png16m -r300 -dEPSCrop -dNOPAUSE -sOutputFile=deline_zero_10hz_timestreams_003.png deline_zero_10hz_timestreams_003.ps<br />TIMING: R: 0.801  U: 0.781  S: 0.017<br /></code></div>
