---
layout: post
title: "Rebuilding python from scratch again"
date: 2010-03-05T07:55:00-08:00
categories:
 - python
 - mac
---

<div class='post'>
I got scipy working a week or two ago, but doing so killed matplotib's tkagg.  So, I switched to the MacOSX backend, which worked ok until I realized that the interactive (connect) features of macosx failed miserably.  This led me to try to get matplotlib working.... which broke with those awful "symbol not found" errors in ft2font.so and _path.so, which I've determined all have to do with linking to the wrong library files.<br /><br />The most worrisome part of this process was discovering that a full Time Machine recovery of /usr and /Library/Frameworks and /Library/Python did *not* restore python - it stayed dead with IDENTICAL errors.  So there are probably additional layers of hidden links.<br /><br />The process below is based on <a href="http://blog.hyperjeff.net/?p=160">hyperjeff's blog post</a> but differs substantially based on <a href="http://casa.colorado.edu/~skillman/research_and_codes/files/649710e82f85745eb65a90535f0f3098-5.html"> Sam Skillman's recommendations </a> and the very big issue I ran into that my /usr/local files appeared to be corrupted.  After this install, my path no longer includes /usr/local/bin and /sw has been moved to /_sw... hopefully one of these days I'll be ballsy enough to delete it.<br /><br /><ol><li> Install python 2.6.4<br /><ol type="a"><li> Needed a clean terminal with no flags set at all.  Don't know why - all I had set were a bunch of -arch x86_64 flags.<br /><code><br />export LD_LIBRARY_PATH="/usr/local/lib:/usr/X11/lib"<br />./configure --enable-framework=/Library/Frameworks MACOSX_DEPLOYMENT_TARGET=10.6 <br />make -j 17<br />sudo make install<br /></code><br /><li> Reset PYTHONPATH to blank<br /><li> <code> alias clearflags='export CFLAGS=""; export CCFLAGS=""; export CXXFLAGS=""; export LDFLAGS=""; export FFLAGS="";'</code> to make sure<br /></ol><br /><li> Install FFTW<br /><code><br />cd ~/tmp<br />curl -O http://www.fftw.org/fftw-3.2.2.tar.gz<br />tar xf fftw-3.2.2.tar.gz<br />cd fftw-3.2.2<br />clearflags<br />./configure CC="gcc -arch x86_64" CXX="g++ -arch x86_64" CPP="gcc -E" CXXCPP="g++ -E"<br />make -j 17<br />sudo make install<br /></code><br /><li> Install UMFPACK<br /><code><br />cd ~/tmp<br />curl -O http://www.cise.ufl.edu/research/sparse/umfpack/current/UMFPACK.tar.gz<br />curl -O http://www.cise.ufl.edu/research/sparse/UFconfig/current/UFconfig.tar.gz<br />curl -O http://www.cise.ufl.edu/research/sparse/amd/current/AMD.tar.gz<br />tar xf AMD.tar.gz<br />tar xf UFconfig.tar.gz<br />tar xf UMFPACK.tar.gz<br />sed -ibck 's/F77 = f77/F77 = gfortran/' UFconfig/UFconfig.mk <br />sed -ibck '299,303s/# //' UFconfig/UFconfig.mk<br />cp UFconfig/UFconfig.h AMD/Include/<br />cp UFconfig/UFconfig.h UMFPACK/Include/<br />cd UMFPACK<br />make -j 17<br />make hb<br />make clean<br /></code><br /><li> Install numpy<br /><ol type="a"><li> Set environment variables<br /><code><br />export MACOSX_DEPLOYMENT_TARGET=10.6<br />export CFLAGS="-arch x86_64"<br />export FFLAGS="-m64"<br />export LDFLAGS="-Wall -undefined dynamic_lookup -bundle -arch x86_64"<br />export PYTHONPATH="/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/site-packages/"<br />echo "[amd]<br />library_dirs = /Users/adam/tmp/AMD/Lib<br />include_dirs = /Users/adam/tmp/AMD/Include<br />amd_libs = amd<br /><br />[umfpack]<br />library_dirs = /Users/adam/tmp/UMFPACK/Lib<br />include_dirs = /Users/adam/tmp/UMFPACK/Include<br />umfpack_libs = umfpack" > site.cfg<br /></code><br /><li> Setup & Install<br /><code><br />python setup.py build --fcompiler=gnu95<br />sudo python setup.py install<br /></code><br /><li> Test: python -c "import numpy"<br /></ol><br /><li> Install scipy.  The important thing is to use g++-4.2 because g++-4.5 doesn't accept the -arch flag.  Also, get rid of /sw if it's on your computer at all.<br /><code><br />sudo mv /System/Library/Frameworks/Python.framework/Versions/2.6/Extras/lib/python/numpy /System/Library/Frameworks/Python.framework/Versions/2.6/Extras/lib/python/numpyX<br />cd ~/repos/scipy-0.7.1<br />python setup.py clean<br />rm -rf build<br />clearflags<br />FFLAGS="-m64" CFLAGS="-arch x86_64 -I/usr/local/include/freetype2 -I/usr/X11/include -L/usr/X11/lib"  LDFLAGS="-Wall -undefined dynamic_lookup -bundle  -lpng -arch x86_64" CXX="/usr/bin/g++-4.2" CC="/usr/bin/gcc-4.2" python setup.py build<br />python setup.py install<br /></code><br />Test the install:<br /><code><br />python -c "import scipy, scipy.fftpack, scipy.interpolate"<br /></code><br /><li> <ol type='a'> <li> Install matplotlib.  MAKE SURE /usr/bin/texbin is in front of /usr/local/bin and /sw/bin so that dvipng comes from MacTEX.  I also ended up having to remove /usr/local/bin from my path completely<br /><code><br />sudo mv /System/Library/Frameworks/Python.framework/Versions/2.6/Extras/lib/python/numpy /System/Library/Frameworks/Python.framework/Versions/2.6/Extras/lib/python/numpyX<br />cd ~/repos/matplotlib-svn<br />python setup.py clean<br />rm -rf build<br />clearflags<br /></code><br /><li> Do hyperjeff's recommended edits except don't use /usr/local because it's f'd: <br />make.osx:<br /><code><br />MACOSX_DEPLOYMENT_TARGET=10.6<br />PREFIX=/usr<br />PYTHON=/Library/Frameworks/Python.framework/Versions/Current/bin/python<br /><br />## You shouldn't need to configure past this point (and yetâ€¦)<br /><br />PKG_CONFIG_PATH="${PREFIX}/lib/pkgconfig"<br />CFLAGS="-arch i386 -arch x86_64 -I${PREFIX}/include -I${PREFIX}/include/freetype2 -isysroot /Developer/SDKs/MacOSX10.6.sdk"<br />LDFLAGS="-arch i386 -arch x86_64 -L${PREFIX}/lib -syslibroot,/Developer/SDKs/MacOSX10.6.sdk"<br />FFLAGS="-arch i386 -arch x86_64"<br /></code><br />setup.cfg:<br /><code><br />wxagg = False<br /></code><br /><li> Do the install (different from hyperjeff b/c I don't want root)<br /><code> sudo make -f make.osx fetch deps <br />make -f mpl_build mpl_install<br />python setup.py install<br /></code><br /></ol><br /><li> Install setuptools<br /><li> easy_install ipython<br /><li> install everything else pythonically<br /></ol></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Dennis</div>
<div class='content'>
I got through step 4 and have Numpy going with only known fails and skips.  In step 5, if I use the line that moves numpy to numpyX, scipy won&#39;t go - it is looking for the numpy module when it tries to python it?</div>
</div>
</div>
