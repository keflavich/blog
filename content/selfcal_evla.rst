Self-cal with EVLA data
#######################
:date: 2016-01-07 08:14
:author: Adam Ginsburg (Adam.G.Ginsburg@gmail.com)
:tags: w51, evla, casa

I'm trying to self-calibrate my A+C array C-band data on W51, since we're in a
clearly dynamic-range-limited regime.  I've never had any luck with self-cal,
though.  The images *always* get worse, and I still don't really understand
why.

This is a clue, though:

.. image:: |filename|/images/w51/selfcal_phasecal_vs_time.png
   :width: 600px

For many of the antennae, especially those in C array, self-calibration results
in phase plots that look nice, with corrections confined to +/-30 degrees as
you would hope and expect.

These plots show that some antennae are going through dozens or hundreds of
phase wraps.  That is obviously unacceptable and incorrect: the original images
actually looked pretty good, so it is obvious (to me, at least) that there
should be *no* phase wrapping in the self-cal.  I'm surprised at this, since
each of these points should have S/N > 3 and there is a lot of consistency in
these large phase shifts.

My suspicion is still that the clean process has failed.  I have been trying
multiscale clean, since the emission is completely dominated by extended
components.  However, even if I set smallscalebias to different values, there
are essentially no pointlike components being added to the clean model.  This
is wrong!  There are genuine point sources.  So I still suspect that this is a
modeling problem and the phase wraps are being caused by bad models.

I'm trying again with smaller pixels in the hope that a better match between
the beam size and the pixel size will produce a better model.  The only other
thing I can think to try is increasing the solint, but given the high S/N
already present, I doubt that's an important factor.
           
Smaller pixels didn't help, *but* forcing clean to include point-source
components by performing a second round of clean with ``multiscale=[]`` worked!
The solutions are MUCH more reasonable (no more phase wrap every integration),
and selfcal no longer diverges.  I also increased the solution interval to 30s
since it seems that the phase change timescale is significantly longer than
an integration.  I increased the S/N cutoff to 5 too.

There are still some "noisy" phases, even in the 3rd iteration:

.. image:: |filename|/images/w51/selfcal_phasecal_vs_time_3rditer.png
   :width: 600px

I think more iterations may be necessary, but I will also increase the S/N
threshold to 6 and solint to 60s to see if that helps.


RMS improvements are evident but not spectacular::

   SPW4 Iteration 0: RMS=1.003e-04
   SPW4 Iteration 1: RMS=6.009e-05
   SPW4 Iteration 2: RMS=6.698e-05
   SPW4 Iteration 3: RMS=7.061e-05

The bump in the last one is because I forgot to add a point clean for the last
iteration.*

Perhaps not unfortunately, it looks like the improvements in image quality are
tiny when self-cal is added.  The only real hope now is that self-cal on all
bands will result in an artifact-free final combined image.

On the "noisy" phases, now that it looks like there are decent solutions, it
may actually be worth keeping the flags generated by applycal.  <10% of the
data is being flagged out, which is negligible, and it probably is genuinely
bad (or signal-free, anyway) in that case.

* EDIT: Looks better... or at least different... now::

  SPW4 Iteration 0: RMS=1.003e-04
  SPW4 Iteration 1: RMS=5.962e-05
  SPW4 Iteration 2: RMS=6.817e-05
  SPW4 Iteration 3: RMS=6.775e-05
